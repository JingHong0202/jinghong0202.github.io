<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Git</title>
      <link href="/posts/629e.html"/>
      <url>/posts/629e.html</url>
      
        <content type="html"><![CDATA[<h1 id="Git-基本使用"><a href="#Git-基本使用" class="headerlink" title="Git 基本使用"></a>Git 基本使用</h1><p>参考链接:<br><a href="https://git-scm.com/docs" target="_blank" rel="noopener">git 官方文档</a><br><a href="https://www.liaoxuefeng.com/wiki/896043488029600" target="_blank" rel="noopener">廖雪峰 git</a></p><h2 id="Git-常用命令"><a href="#Git-常用命令" class="headerlink" title="Git 常用命令"></a>Git 常用命令</h2><h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><blockquote><p>克隆远程库<br><code>git clone [远程仓库]</code><br>创建一个新的存储库<br><code>git init</code></p></blockquote><h3 id="分支和标签"><a href="#分支和标签" class="headerlink" title="分支和标签"></a>分支和标签</h3><blockquote><p>列出所有分支<br><code>git branch -av</code><br>切换分支<br><code>git checkout -b [分支名]</code> 加 -b 可以创建并切换<br>创建新分支（基于当前分支）<br><code>git branch [新分支]</code><br>删除本地分支<br><code>git branch -d [分支名]</code><br>给当前分支打上标签<br><code>git tag [标签名]</code></p></blockquote><h3 id="本地变化"><a href="#本地变化" class="headerlink" title="本地变化"></a>本地变化</h3><blockquote><p>查看本地文件状态变化<br><code>git status</code><br>跟踪文件的更改 | 用于比较两次修改的差异<br><code>git diff</code><br>将当前工作区目录下所有变化的文件提交到暂存区<br><code>git add .</code><br>将暂存区的所有文件提交到本地分支<br><code>git commit -m [描述]</code></p></blockquote><h3 id="历史记录"><a href="#历史记录" class="headerlink" title="历史记录"></a>历史记录</h3><blockquote><p>显示所有提交日志<br><code>git log</code> 加 –pretty=oneline 可以简化显示<br>显示所有提交命令<br><code>git reflog</code></p></blockquote><h3 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h3><blockquote><p>将指定分支合并到当前分支内<br><code>git merge [分支名]</code></p></blockquote><h3 id="更新和发布"><a href="#更新和发布" class="headerlink" title="更新和发布"></a>更新和发布</h3><blockquote><p>列出所有当前配置的远程仓库<br><code>git remote -v</code><br>添加远程仓库<br><code>git remote add [别名] [远程仓库网址]</code><br>删除远程仓库<br><code>git remote remove [别名]</code><br>拉取远程仓库，不会替换掉当前工作区文件<br><code>git fetch [远程仓库网址?]</code><br>拉取远程仓库, 会合并掉当前工作区文件<br><code>git pull [远程仓库网址?][分支?]</code><br>推送到远程仓库<br><code>git push [远程仓库网址?][分支?]</code> 加 -f 强制提交<br>删除本地上的分支<br><code>git branch -dr [别名/分支]</code><br>删除远程上的分支<br><code>git push [别名] -delete [分支名]</code></p></blockquote><h3 id="回退"><a href="#回退" class="headerlink" title="回退"></a>回退</h3><blockquote><p>丢弃当前工作目录中的所有修改<br><code>git reset --hard HEAD</code><br>撤销指定文件的更改还原到最新一次提交后<br><code>git checkout -- [文件]</code><br>回退到以往指定版本<br><code>git reset --hard [HEAD^ | commit_id(通关log查看)]</code> HEAD^(上个版本), ^^ 上上个版本, HEAD~100 前一百个版本<br>撤销以往指定的版本并重新生成新的版本<br><code>git revert [commit_id]</code></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> VersionControl </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker入门</title>
      <link href="/posts/a01f.html"/>
      <url>/posts/a01f.html</url>
      
        <content type="html"><![CDATA[<h1 id="docker-基础入门"><a href="#docker-基础入门" class="headerlink" title="docker 基础入门"></a>docker 基础入门</h1><blockquote><p>参考链接:<br><a href="https://www.runoob.com/docker/docker-tutorial.html" target="_blank" rel="noopener">菜鸟 Docker</a><br> <a href="http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html" target="_blank" rel="noopener">docker 入门</a><br><a href="https://docs.docker.com/" target="_blank" rel="noopener">官方文档</a><br><a href="http://www.dockerinfo.net/document" target="_blank" rel="noopener">中文文档</a></p></blockquote><p>大概操作流程：</p><blockquote><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/base.png" alt=""> docker 在线测试网站： <a href="https://labs.play-with-docker.com/" target="_blank" rel="noopener">play With Docker</a>，这是一个可以用来在线练习 docker 指令的网站，具备一切 docker 环境，不用为环境而烦恼，网速还特别快</p></blockquote><h2 id="0-安装-docker"><a href="#0-安装-docker" class="headerlink" title="0. 安装 docker"></a>0. 安装 docker</h2><blockquote><p>window &amp; Mac 到<a href="https://docs.docker.com/" target="_blank" rel="noopener">官网</a>下载 Desktop 版<br>linux 参考<a href="https://docs.docker.com/install/linux/docker-ce/centos/" target="_blank" rel="noopener">官方</a>linux 安装方式</p></blockquote><h3 id="centOS-系统示例"><a href="#centOS-系统示例" class="headerlink" title="centOS 系统示例"></a>centOS 系统示例</h3><h4 id="1-安装依赖-yum-utils-device-mapper-persistent-data-lvm2"><a href="#1-安装依赖-yum-utils-device-mapper-persistent-data-lvm2" class="headerlink" title="1. 安装依赖 yum-utils device-mapper-persistent-data lvm2"></a>1. 安装依赖 yum-utils device-mapper-persistent-data lvm2</h4><blockquote><p><code>sudo yum install -y yum-utils device-mapper-persistent-data lvm2</code></p></blockquote><h4 id="2-设置镜像源"><a href="#2-设置镜像源" class="headerlink" title="2. 设置镜像源"></a>2. 设置镜像源</h4><blockquote><p><code>sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</code></p></blockquote><h4 id="3-下载-docker"><a href="#3-下载-docker" class="headerlink" title="3. 下载 docker"></a>3. 下载 docker</h4><blockquote><p><code>sudo yum install docker-ce docker-ce-cli containerd.io</code><br>失败，尝试添加’–skip-broken’ 来跳过无法安装的软件包 或 ‘–nobest’ 来不只使用最佳选择的软件包</p></blockquote><h4 id="4-启动-docker"><a href="#4-启动-docker" class="headerlink" title="4. 启动 docker"></a>4. 启动 docker</h4><blockquote><p><code>sudo systemctl start docker</code></p></blockquote><h4 id="5-test"><a href="#5-test" class="headerlink" title="5. test"></a>5. test</h4><blockquote><p><code>sudo docker run hello-world</code><br>有输出，没出错即可</p></blockquote><h4 id="6-配置-docker"><a href="#6-配置-docker" class="headerlink" title="6. 配置 docker"></a>6. 配置 docker</h4><blockquote><p><a href="https://docs.docker.com/install/linux/linux-postinstall/" target="_blank" rel="noopener">参考链接</a></p><ul><li><p>添加 docker 组并添加用户（解决不带 sudo&amp;非 root 用户 也可操作）</p><blockquote><ol><li><p>创建 docker 组</p><blockquote><p><code>sudo groupadd docker</code></p></blockquote></li><li><p>将您的用户添加到该 docker 组。</p><blockquote><p><code>sudo usermod -aG docker $USER</code></p></blockquote></li></ol></blockquote></li><li><p>开机自启</p><blockquote><p><code>sudo systemctl enable docker</code><br>若要禁用，enable 改用 disable</p></blockquote></li><li><p>镜像设置</p><blockquote><p>镜像地址：<br><a href="https://registry.docker-cn.com\" target="_blank" rel="noopener">https://registry.docker-cn.com\</a><br><a href="https://1vm68v1k.mirror.aliyuncs.com" target="_blank" rel="noopener">https://1vm68v1k.mirror.aliyuncs.com</a></p><ol><li><blockquote><p><code>sudo mkdir -p /etc/docker</code></p></blockquote></li><li><blockquote><p><code>sudo tee /etc/docker/daemon.json &lt;&lt;-&#39;EOF&#39; { &quot;registry-mirrors&quot;: [&quot;你的加速器地址&quot;] } EOF</code></p></blockquote></li><li><p>重启 docker :</p><blockquote><p><code>sudo systemctl daemon-reload</code><br><code>sudo systemctl restart docker</code></p></blockquote></li></ol></blockquote></li><li><p><a href="https://www.portainer.io/installation/" target="_blank" rel="noopener">可视化 docker</a></p></li></ul></blockquote><h2 id="1-入门练习：启动一个-nginx-容器"><a href="#1-入门练习：启动一个-nginx-容器" class="headerlink" title="1. 入门练习：启动一个 nginx 容器"></a>1. 入门练习：启动一个 nginx 容器</h2><h3 id="1-拉取-ngxin-镜像"><a href="#1-拉取-ngxin-镜像" class="headerlink" title="1. 拉取 ngxin 镜像"></a>1. 拉取 ngxin 镜像</h3><blockquote><p><code>docker pull nginx</code></p><p>不加版本后缀，默认为:<strong>latest</strong>即<strong>最新的版本</strong>，指定版本格式：docker pull ubuntu:14.04 此操作从<a href="https://hub.docker.com/" target="_blank" rel="noopener">docker Hub</a> 仓库 拉了 一个最新版本的 nginx</p></blockquote><h3 id="2-查看现有镜像"><a href="#2-查看现有镜像" class="headerlink" title="2. 查看现有镜像"></a>2. 查看现有镜像</h3><blockquote><p><code>docker images</code></p></blockquote><h3 id="3-启动镜像"><a href="#3-启动镜像" class="headerlink" title="3. 启动镜像"></a>3. 启动镜像</h3><blockquote><p><code>docker run --name my-nginx -d -p 8080:80 -v 要映射的路径: /usr/share/nginx/html</code></p><p>--name 指定 id -d 是否<strong>常驻后台</strong> -p 指定<strong>内外映射</strong>端口 <strong>左外右内</strong> -v 映射文件，可以写<strong>多个</strong> ，<strong>映射的效果就是把自己指定的目录绑定到容器中指定的目录，自己的目录文件改变时，容器的目录文件也会改变</strong>，完成后会返回进程 id</p></blockquote><h3 id="4-查看后台进程，检查容器是否启动"><a href="#4-查看后台进程，检查容器是否启动" class="headerlink" title="4. 查看后台进程，检查容器是否启动"></a>4. 查看后台进程，检查容器是否启动</h3><blockquote><p><code>docker ps</code></p></blockquote><h3 id="5-修改-nginx-默认显示内容（进入容器中）"><a href="#5-修改-nginx-默认显示内容（进入容器中）" class="headerlink" title="5. 修改 nginx 默认显示内容（进入容器中）"></a>5. 修改 nginx 默认显示内容（进入容器中）</h3><blockquote><p><code>docker exec -it my-nginx /bin/bash</code></p><p>进入一个名为 my-nginx 的容器里并打开终端，命令行用户会发生改变，接下来找到 nginx 的 index，路径为/usr/share/nginx/html/，修改文件</p><blockquote><p><code>cd /usr/share/nginx/html/</code> &gt; &gt; <code>echo hello world！ &gt; index.html</code></p></blockquote></blockquote><h3 id="6-退出容器"><a href="#6-退出容器" class="headerlink" title="6. 退出容器"></a>6. 退出容器</h3><blockquote><p><code>exit</code></p><blockquote><p>访问<a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a></p></blockquote></blockquote><h2 id="2-封装已有的容器为镜像"><a href="#2-封装已有的容器为镜像" class="headerlink" title="2. 封装已有的容器为镜像"></a>2. 封装已有的容器为镜像</h2><blockquote><p><code>docker commit my-nginx my-nginx2</code></p><blockquote><p>封装完成后，可以使用 images 查看封装好的镜像</p><p><code>docker images</code></p><blockquote><p>启动&amp;检测</p><p><code>docker run —name my-nginx -d -p 90:80 my-nginx2</code> &gt; &gt; &gt; <code>docker ps</code></p></blockquote></blockquote></blockquote><h3 id="另一种方式-使用-DockerFile-构建镜像-（需学习-dockerfile-语法）"><a href="#另一种方式-使用-DockerFile-构建镜像-（需学习-dockerfile-语法）" class="headerlink" title="(另一种方式) 使用 DockerFile 构建镜像 （需学习 dockerfile 语法）"></a>(另一种方式) 使用 DockerFile 构建镜像 （需学习 dockerfile 语法）</h3><blockquote><p>在当前路径创建 dockerFile 文件 vim dockerfile</p><blockquote><p>dockerfile 文件内容&gt;&gt;&gt;<br><code>FROM nginx</code><br><code>COPY . /usr/share/nginx/html/</code><br>vim index.html 文件内容&gt;&gt;&gt;<br><code>Hello world！</code></p><blockquote><p>使用当前路径下的 dockerFile 构建镜像 docker build -t app . 完成后，重复上面启动步骤即可</p></blockquote></blockquote></blockquote><h2 id="3-save-load-tar-文件"><a href="#3-save-load-tar-文件" class="headerlink" title="3. save/load tar 文件"></a>3. save/load tar 文件</h2><blockquote><p>指定镜像打包成 tar <code>docker save imagesName(镜像) &gt; app4.tar</code></p><p>指定 tar 还原成镜像 <code>docker load （tar）&lt; app4</code></p></blockquote><h2 id="4-DockerFile-配置介绍"><a href="#4-DockerFile-配置介绍" class="headerlink" title="4. DockerFile 配置介绍"></a>4. DockerFile 配置介绍</h2><blockquote><pre class=" language-dockerfile"><code class="language-dockerfile">FROM  aipine 指定镜像WORKDIR /app  指定当前工作路径COPY src/ /app 复制  | ADD 复制     区别&不同点： 功能一样，ADD源地址可以是网络地址RUN  echo 321 > 1.txt  构建时，运行shell语句CMD  tail -f 1.txt 运行时，执行shell语句 | ENTRYPOINT 一样  两者没有区别，可以混用，格式可以是数组格式： ['tail -f'，'1.txt']EXPOSE 指定暴露的端口  docker inspect nginx:1.13VOLUME  /app /html   路径映射ENV A=10 环境变量ARG 构建时的环境变量，构建完成后即消失LABEL k="v" 指定源数据，一般写在第二行ONBUILD  在子镜像build的时候触发USER  jinghong & id 指定运行shell时的用户</code></pre><blockquote><p>FROM 是 required，其他可选</p></blockquote></blockquote><h2 id="5-发布到-DockerHub"><a href="#5-发布到-DockerHub" class="headerlink" title="5. 发布到 DockerHub"></a>5. 发布到 DockerHub</h2><h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><blockquote><p><code>docker login</code></p></blockquote><h3 id="标注用户名和版本"><a href="#标注用户名和版本" class="headerlink" title="标注用户名和版本"></a>标注用户名和版本</h3><blockquote><p><code>docker image tag [imagename] [username]/[repository]:tag</code></p></blockquote><h3 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h3><blockquote><p><code>docker push [username]/[repository]:tag</code></p></blockquote><h2 id="6-Docker-容器之间通信"><a href="#6-Docker-容器之间通信" class="headerlink" title="6. Docker 容器之间通信"></a>6. Docker 容器之间通信</h2><h3 id="1-通过容器-IP"><a href="#1-通过容器-IP" class="headerlink" title="1. 通过容器 IP"></a>1. 通过容器 IP</h3><h3 id="2-通过宿主机-ip-暴露的-port"><a href="#2-通过宿主机-ip-暴露的-port" class="headerlink" title="2. 通过宿主机 ip+暴露的 port"></a>2. 通过宿主机 ip+暴露的 port</h3><h3 id="3-link"><a href="#3-link" class="headerlink" title="3. link"></a>3. link</h3><blockquote><p>步骤示范:<br>先创建 nginx: <code>docker run -itd -p 9090:80 nginx</code><br>再 link:<code>docker run -itd --link name:nginx alpine</code><br>进入 alpine <code>docker exec -it cdc sh</code><br>最后: <code>apk add curl</code> &amp;&amp; <code>curl nginx</code><br> 提示：link 后 hosts 文件会发生改变<br><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/link.PNG" alt=""><br>通过 link 建立连接的容器，被链接的容器能 ping 通源容器，反过来不行</p></blockquote><h3 id="4-User-defined-networks-recommend"><a href="#4-User-defined-networks-recommend" class="headerlink" title="4. User-defined networks (recommend)"></a>4. User-defined networks (recommend)</h3><blockquote><p>步骤示范:<br>查看 local 网络 <code>docker network ls</code><br>创建一个网络名为 my_net 且 driver 为 bridge 的网络：（默认创建的就是 bridge）<br><code>docker network create my_net</code><br>加入创建的网络<br><code>docker run -it --name=nginx --network my_net --network-alias nginx_as nginx</code><br><code>docker run -it --network my_net --network-alias alpine alpine</code><br>–network <code>newwork</code> –network-alias <code>该network的别名</code><br>最后 curl 即可</p></blockquote><h3 id="容器-ip-可以在-etc-hosts-中查看"><a href="#容器-ip-可以在-etc-hosts-中查看" class="headerlink" title="容器 ip 可以在/etc/hosts 中查看"></a>容器 ip 可以在/etc/hosts 中查看</h3><blockquote><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/container_ip.PNG" alt=""></p><blockquote><p>附加提示 这里使用 alpine 系统，加 curl 进行以上测试<br>alpine 下载指令: apk add curl</p></blockquote></blockquote><h2 id="7-docker-compose"><a href="#7-docker-compose" class="headerlink" title="7. docker-compose"></a>7. docker-compose</h2><blockquote><p>docker-compose 是一个多容器编排工具，可以简化多容器部署过程，也方便了统一管理</p></blockquote><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><blockquote><ol><li><p>下载 docker-compose</p><blockquote><ul><li><p>window&amp;Mac 安装 docker 自带 compose</p></li><li><p>linux 参考<a href="https://docs.docker.com/compose/install/#install-compose" target="_blank" rel="noopener">官方文档</a></p></li><li><p>linux+curl 安装示例</p><blockquote><ol><li>以下命令安装稳定版本</li></ol><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> curl -L <span class="token string">"https://github.com/docker/compose/releases/download/1.25.4/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span>"</span> -o /usr/local/bin/docker-compose</code></pre><ol start="2"><li>获得执行权限</li></ol><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose</code></pre><ol start="3"><li>测试，不报错即可</li></ol><pre class=" language-bash"><code class="language-bash">docker-compose --version</code></pre></blockquote></li></ul></blockquote></li><li><p>定义一个 <strong>docker-compose.yml</strong> <strong>配置文件</strong></p><blockquote><p>配置详情链接：<br><a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener">官方文档</a><br><a href="http://www.ruanyifeng.com/blog/2018/02/docker-wordpress-tutorial.html" target="_blank" rel="noopener">微服务</a></p></blockquote></li></ol></blockquote><h4 id="docker-compose-配置大全详情："><a href="#docker-compose-配置大全详情：" class="headerlink" title="docker-compose 配置大全详情："></a>docker-compose 配置大全详情：</h4><p>此配置转载自:<a href="https://www.jianshu.com/p/90bf0e231e5a" target="_blank" rel="noopener">docker-compose.yml 文件详解 </a></p><pre class=" language-yaml"><code class="language-yaml">Compose和Docker兼容性：    Compose 文件格式有3个版本，分别为1， 2.x 和 3.x    目前主流的为 3.x 其支持 docker 1.13.0 及其以上的版本常用参数：    version           <span class="token comment" spellcheck="true"># 指定 compose 文件的版本</span>    services          <span class="token comment" spellcheck="true"># 定义所有的 service 信息， services 下面的第一级别的 key 既是一个 service 的名称</span>        build                 <span class="token comment" spellcheck="true"># 指定包含构建上下文的路径， 或作为一个对象，该对象具有 context 和指定的 dockerfile 文件以及 args 参数值</span>            context               <span class="token comment" spellcheck="true"># context: 指定 Dockerfile 文件所在的路径</span>            dockerfile            <span class="token comment" spellcheck="true"># dockerfile: 指定 context 指定的目录下面的 Dockerfile 的名称(默认为 Dockerfile)</span>            args                  <span class="token comment" spellcheck="true"># args: Dockerfile 在 build 过程中需要的参数 (等同于 docker container build --build-arg 的作用)</span>            cache_from            <span class="token comment" spellcheck="true"># v3.2中新增的参数， 指定缓存的镜像列表 (等同于 docker container build --cache_from 的作用)</span>            labels                <span class="token comment" spellcheck="true"># v3.3中新增的参数， 设置镜像的元数据 (等同于 docker container build --labels 的作用)</span>            shm_size              <span class="token comment" spellcheck="true"># v3.5中新增的参数， 设置容器 /dev/shm 分区的大小 (等同于 docker container build --shm-size 的作用)</span>        command               <span class="token comment" spellcheck="true"># 覆盖容器启动后默认执行的命令， 支持 shell 格式和 [] 格式</span>        configs               <span class="token comment" spellcheck="true"># 不知道怎么用</span>        cgroup_parent         <span class="token comment" spellcheck="true"># 不知道怎么用</span>        container_name        <span class="token comment" spellcheck="true"># 指定容器的名称 (等同于 docker run --name 的作用)</span>        credential_spec       <span class="token comment" spellcheck="true"># 不知道怎么用</span>        deploy                <span class="token comment" spellcheck="true"># v3 版本以上， 指定与部署和运行服务相关的配置， deploy 部分是 docker stack 使用的， docker stack 依赖 docker swarm</span>            endpoint_mode         <span class="token comment" spellcheck="true"># v3.3 版本中新增的功能， 指定服务暴露的方式</span>                vip                   <span class="token comment" spellcheck="true"># Docker 为该服务分配了一个虚拟 IP(VIP)， 作为客户端的访问服务的地址</span>                dnsrr                 <span class="token comment" spellcheck="true"># DNS轮询， Docker 为该服务设置 DNS 条目， 使得服务名称的 DNS 查询返回一个 IP 地址列表， 客户端直接访问其中的一个地址</span>            labels                <span class="token comment" spellcheck="true"># 指定服务的标签，这些标签仅在服务上设置</span>            mode                  <span class="token comment" spellcheck="true"># 指定 deploy 的模式</span>                global                <span class="token comment" spellcheck="true"># 每个集群节点都只有一个容器</span>                replicated            <span class="token comment" spellcheck="true"># 用户可以指定集群中容器的数量(默认)</span>            placement             <span class="token comment" spellcheck="true"># 不知道怎么用</span>            replicas              <span class="token comment" spellcheck="true"># deploy 的 mode 为 replicated 时， 指定容器副本的数量</span>            resources             <span class="token comment" spellcheck="true"># 资源限制</span>                limits                <span class="token comment" spellcheck="true"># 设置容器的资源限制</span>                    <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token string">"0.5"</span>           <span class="token comment" spellcheck="true"># 设置该容器最多只能使用 50% 的 CPU</span>                    <span class="token key atrule">memory</span><span class="token punctuation">:</span> 50M           <span class="token comment" spellcheck="true"># 设置该容器最多只能使用 50M 的内存空间</span>                reservations          <span class="token comment" spellcheck="true"># 设置为容器预留的系统资源(随时可用)</span>                    <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token string">"0.2"</span>           <span class="token comment" spellcheck="true"># 为该容器保留 20% 的 CPU</span>                    <span class="token key atrule">memory</span><span class="token punctuation">:</span> 20M           <span class="token comment" spellcheck="true"># 为该容器保留 20M 的内存空间</span>            restart_policy        <span class="token comment" spellcheck="true"># 定义容器重启策略， 用于代替 restart 参数</span>                condition             <span class="token comment" spellcheck="true"># 定义容器重启策略(接受三个参数)</span>                    none                  <span class="token comment" spellcheck="true"># 不尝试重启</span>                    on<span class="token punctuation">-</span>failure            <span class="token comment" spellcheck="true"># 只有当容器内部应用程序出现问题才会重启</span>                    any                   <span class="token comment" spellcheck="true"># 无论如何都会尝试重启(默认)</span>                delay                 <span class="token comment" spellcheck="true"># 尝试重启的间隔时间(默认为 0s)</span>                max_attempts          <span class="token comment" spellcheck="true"># 尝试重启次数(默认一直尝试重启)</span>                window                <span class="token comment" spellcheck="true"># 检查重启是否成功之前的等待时间(即如果容器启动了， 隔多少秒之后去检测容器是否正常， 默认 0s)</span>            update_config         <span class="token comment" spellcheck="true"># 用于配置滚动更新配置</span>                parallelism           <span class="token comment" spellcheck="true"># 一次性更新的容器数量</span>                delay                 <span class="token comment" spellcheck="true"># 更新一组容器之间的间隔时间</span>                failure_action        <span class="token comment" spellcheck="true"># 定义更新失败的策略</span>                    continue              <span class="token comment" spellcheck="true"># 继续更新</span>                    rollback              <span class="token comment" spellcheck="true"># 回滚更新</span>                    pause                 <span class="token comment" spellcheck="true"># 暂停更新(默认)</span>                monitor               <span class="token comment" spellcheck="true"># 每次更新后的持续时间以监视更新是否失败(单位: ns|us|ms|s|m|h) (默认为0)</span>                max_failure_ratio     <span class="token comment" spellcheck="true"># 回滚期间容忍的失败率(默认值为0)</span>                order                 <span class="token comment" spellcheck="true"># v3.4 版本中新增的参数， 回滚期间的操作顺序</span>                    stop<span class="token punctuation">-</span>first            <span class="token comment" spellcheck="true">#旧任务在启动新任务之前停止(默认)</span>                    start<span class="token punctuation">-</span>first           <span class="token comment" spellcheck="true">#首先启动新任务， 并且正在运行的任务暂时重叠</span>            rollback_config       <span class="token comment" spellcheck="true"># v3.7 版本中新增的参数， 用于定义在 update_config 更新失败的回滚策略</span>                parallelism           <span class="token comment" spellcheck="true"># 一次回滚的容器数， 如果设置为0， 则所有容器同时回滚</span>                delay                 <span class="token comment" spellcheck="true"># 每个组回滚之间的时间间隔(默认为0)</span>                failure_action        <span class="token comment" spellcheck="true"># 定义回滚失败的策略</span>                    continue              <span class="token comment" spellcheck="true"># 继续回滚</span>                    pause                 <span class="token comment" spellcheck="true"># 暂停回滚</span>                monitor               <span class="token comment" spellcheck="true"># 每次回滚任务后的持续时间以监视失败(单位: ns|us|ms|s|m|h) (默认为0)</span>                max_failure_ratio     <span class="token comment" spellcheck="true"># 回滚期间容忍的失败率(默认值0)</span>                order                 <span class="token comment" spellcheck="true"># 回滚期间的操作顺序</span>                    stop<span class="token punctuation">-</span>first            <span class="token comment" spellcheck="true"># 旧任务在启动新任务之前停止(默认)</span>                    start<span class="token punctuation">-</span>first           <span class="token comment" spellcheck="true"># 首先启动新任务， 并且正在运行的任务暂时重叠</span>            注意：                支持 docker<span class="token punctuation">-</span>compose up 和 docker<span class="token punctuation">-</span>compose run 但不支持 docker stack deploy 的子选项                security_opt  container_name  devices  tmpfs  stop_signal  links    cgroup_parent                network_mode  external_links  restart  build  userns_mode  sysctls        devices               <span class="token comment" spellcheck="true"># 指定设备映射列表 (等同于 docker run --device 的作用)</span>        depends_on            <span class="token comment" spellcheck="true"># 定义容器启动顺序 (此选项解决了容器之间的依赖关系， 此选项在 v3 版本中 使用 swarm 部署时将忽略该选项)</span>            示例：                docker<span class="token punctuation">-</span>compose up 以依赖顺序启动服务，下面例子中 redis 和 db 服务在 web 启动前启动                默认情况下使用 docker<span class="token punctuation">-</span>compose up web 这样的方式启动 web 服务时，也会启动 redis 和 db 两个服务，因为在配置文件中定义了依赖关系                <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>                <span class="token key atrule">services</span><span class="token punctuation">:</span>                    <span class="token key atrule">web</span><span class="token punctuation">:</span>                        <span class="token key atrule">build</span><span class="token punctuation">:</span> .                        <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>                            <span class="token punctuation">-</span> db                            <span class="token punctuation">-</span> redis                    <span class="token key atrule">redis</span><span class="token punctuation">:</span>                        <span class="token key atrule">image</span><span class="token punctuation">:</span> redis                    <span class="token key atrule">db</span><span class="token punctuation">:</span>                        <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres        dns                   <span class="token comment" spellcheck="true"># 设置 DNS 地址(等同于 docker run --dns 的作用)</span>        dns_search            <span class="token comment" spellcheck="true"># 设置 DNS 搜索域(等同于 docker run --dns-search 的作用)</span>        tmpfs                 <span class="token comment" spellcheck="true"># v2 版本以上， 挂载目录到容器中， 作为容器的临时文件系统(等同于 docker run --tmpfs 的作用， 在使用 swarm 部署时将忽略该选项)</span>        entrypoint            <span class="token comment" spellcheck="true"># 覆盖容器的默认 entrypoint 指令 (等同于 docker run --entrypoint 的作用)</span>        env_file              <span class="token comment" spellcheck="true"># 从指定文件中读取变量设置为容器中的环境变量， 可以是单个值或者一个文件列表， 如果多个文件中的变量重名则后面的变量覆盖前面的变量， environment 的值覆盖 env_file 的值</span>            文件格式：                RACK_ENV=development        environment           <span class="token comment" spellcheck="true"># 设置环境变量， environment 的值可以覆盖 env_file 的值 (等同于 docker run --env 的作用)</span>        expose                <span class="token comment" spellcheck="true"># 暴露端口， 但是不能和宿主机建立映射关系， 类似于 Dockerfile 的 EXPOSE 指令</span>        external_links        <span class="token comment" spellcheck="true"># 连接不在 docker-compose.yml 中定义的容器或者不在 compose 管理的容器(docker run 启动的容器， 在 v3 版本中使用 swarm 部署时将忽略该选项)</span>        extra_hosts           <span class="token comment" spellcheck="true"># 添加 host 记录到容器中的 /etc/hosts 中 (等同于 docker run --add-host 的作用)</span>        healthcheck           <span class="token comment" spellcheck="true"># v2.1 以上版本， 定义容器健康状态检查， 类似于 Dockerfile 的 HEALTHCHECK 指令</span>            test                  <span class="token comment" spellcheck="true"># 检查容器检查状态的命令， 该选项必须是一个字符串或者列表， 第一项必须是 NONE， CMD 或 CMD-SHELL， 如果其是一个字符串则相当于 CMD-SHELL 加该字符串</span>                NONE                  <span class="token comment" spellcheck="true"># 禁用容器的健康状态检测</span>                CMD                   <span class="token comment" spellcheck="true"># test: ["CMD"， "curl"， "-f"， "http://localhost"]</span>                CMD<span class="token punctuation">-</span>SHELL             <span class="token comment" spellcheck="true"># test: ["CMD-SHELL"， "curl -f http://localhost || exit 1"] 或者　test: curl -f https://localhost || exit 1</span>            <span class="token key atrule">interval</span><span class="token punctuation">:</span> 1m30s       <span class="token comment" spellcheck="true"># 每次检查之间的间隔时间</span>            <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 10s          <span class="token comment" spellcheck="true"># 运行命令的超时时间</span>            <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3            </span><span class="token comment" spellcheck="true"># 重试次数</span>            <span class="token key atrule">start_period</span><span class="token punctuation">:</span> 40s     <span class="token comment" spellcheck="true"># v3.4 以上新增的选项， 定义容器启动时间间隔</span>            <span class="token key atrule">disable</span><span class="token punctuation">:</span> <span class="token boolean important">true         </span><span class="token comment" spellcheck="true"># true 或 false， 表示是否禁用健康状态检测和　test: NONE 相同</span>        image                 <span class="token comment" spellcheck="true"># 指定 docker 镜像， 可以是远程仓库镜像、本地镜像</span>        init                  <span class="token comment" spellcheck="true"># v3.7 中新增的参数， true 或 false 表示是否在容器中运行一个 init， 它接收信号并传递给进程</span>        isolation             <span class="token comment" spellcheck="true"># 隔离容器技术， 在 Linux 中仅支持 default 值</span>        labels                <span class="token comment" spellcheck="true"># 使用 Docker 标签将元数据添加到容器， 与 Dockerfile 中的 LABELS 类似</span>        links                 <span class="token comment" spellcheck="true"># 链接到其它服务中的容器， 该选项是 docker 历史遗留的选项， 目前已被用户自定义网络名称空间取代， 最终有可能被废弃 (在使用 swarm 部署时将忽略该选项)</span>        logging               <span class="token comment" spellcheck="true"># 设置容器日志服务</span>            driver                <span class="token comment" spellcheck="true"># 指定日志记录驱动程序， 默认 json-file (等同于 docker run --log-driver 的作用)</span>            options               <span class="token comment" spellcheck="true"># 指定日志的相关参数 (等同于 docker run --log-opt 的作用)</span>                max<span class="token punctuation">-</span>size              <span class="token comment" spellcheck="true"># 设置单个日志文件的大小， 当到达这个值后会进行日志滚动操作</span>                max<span class="token punctuation">-</span>file              <span class="token comment" spellcheck="true"># 日志文件保留的数量</span>        network_mode          <span class="token comment" spellcheck="true"># 指定网络模式 (等同于 docker run --net 的作用， 在使用 swarm 部署时将忽略该选项)</span>        networks              <span class="token comment" spellcheck="true"># 将容器加入指定网络 (等同于 docker network connect 的作用)， networks 可以位于 compose 文件顶级键和 services 键的二级键</span>            aliases               <span class="token comment" spellcheck="true"># 同一网络上的容器可以使用服务名称或别名连接到其中一个服务的容器</span>            ipv4_address      <span class="token comment" spellcheck="true"># IP V4 格式</span>            ipv6_address      <span class="token comment" spellcheck="true"># IP V6 格式</span>            <span class="token key atrule">示例</span><span class="token punctuation">:</span>                <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.7'</span>                <span class="token key atrule">services</span><span class="token punctuation">:</span>                    <span class="token key atrule">test</span><span class="token punctuation">:</span>                        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.14<span class="token punctuation">-</span>alpine                        <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mynginx                        <span class="token key atrule">command</span><span class="token punctuation">:</span> ifconfig                        <span class="token key atrule">networks</span><span class="token punctuation">:</span>                            <span class="token key atrule">app_net</span><span class="token punctuation">:</span>                                <span class="token comment" spellcheck="true"># 调用下面 networks 定义的 app_net 网络</span>                            <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.16.238.10                <span class="token key atrule">networks</span><span class="token punctuation">:</span>                    <span class="token key atrule">app_net</span><span class="token punctuation">:</span>                        <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge                        <span class="token key atrule">ipam</span><span class="token punctuation">:</span>                            <span class="token key atrule">driver</span><span class="token punctuation">:</span> default                            <span class="token key atrule">config</span><span class="token punctuation">:</span>                                <span class="token punctuation">-</span> <span class="token key atrule">subnet</span><span class="token punctuation">:</span> 172.16.238.0/24        <span class="token key atrule">pid</span><span class="token punctuation">:</span> <span class="token string">'host'</span>           <span class="token comment" spellcheck="true"># 共享宿主机的 进程空间(PID)</span>        ports                 <span class="token comment" spellcheck="true"># 建立宿主机和容器之间的端口映射关系， ports 支持两种语法格式</span>            SHORT 语法格式示例<span class="token punctuation">:</span>                <span class="token punctuation">-</span> <span class="token string">"3000"</span>                            <span class="token comment" spellcheck="true"># 暴露容器的 3000 端口， 宿主机的端口由 docker 随机映射一个没有被占用的端口</span>                <span class="token punctuation">-</span> <span class="token string">"3000-3005"</span>                       <span class="token comment" spellcheck="true"># 暴露容器的 3000 到 3005 端口， 宿主机的端口由 docker 随机映射没有被占用的端口</span>                <span class="token punctuation">-</span> <span class="token string">"8000:8000"</span>                       <span class="token comment" spellcheck="true"># 容器的 8000 端口和宿主机的 8000 端口建立映射关系</span>                <span class="token punctuation">-</span> <span class="token string">"9090-9091:8080-8081"</span>                <span class="token punctuation">-</span> <span class="token string">"127.0.0.1:8001:8001"</span>             <span class="token comment" spellcheck="true"># 指定映射宿主机的指定地址的</span>                <span class="token punctuation">-</span> <span class="token string">"127.0.0.1:5000-5010:5000-5010"</span>                <span class="token punctuation">-</span> <span class="token string">"6060:6060/udp"</span>                   <span class="token comment" spellcheck="true"># 指定协议</span>            LONG 语法格式示例<span class="token punctuation">:</span>(v3.2 新增的语法格式)                <span class="token key atrule">ports</span><span class="token punctuation">:</span>                    <span class="token punctuation">-</span> <span class="token key atrule">target</span><span class="token punctuation">:</span> <span class="token number">80                    </span><span class="token comment" spellcheck="true"># 容器端口</span>                      <span class="token key atrule">published</span><span class="token punctuation">:</span> <span class="token number">8080               </span><span class="token comment" spellcheck="true"># 宿主机端口</span>                      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> tcp                 <span class="token comment" spellcheck="true"># 协议类型</span>                      <span class="token key atrule">mode</span><span class="token punctuation">:</span> host                    <span class="token comment" spellcheck="true"># host 在每个节点上发布主机端口，  ingress 对于群模式端口进行负载均衡</span>        secrets               <span class="token comment" spellcheck="true"># 不知道怎么用</span>        security_opt          <span class="token comment" spellcheck="true"># 为每个容器覆盖默认的标签 (在使用 swarm 部署时将忽略该选项)</span>        stop_grace_period     <span class="token comment" spellcheck="true"># 指定在发送了 SIGTERM 信号之后， 容器等待多少秒之后退出(默认 10s)</span>        stop_signal           <span class="token comment" spellcheck="true"># 指定停止容器发送的信号 (默认为 SIGTERM 相当于 kill PID; SIGKILL 相当于 kill -9 PID; 在使用 swarm 部署时将忽略该选项)</span>        sysctls               <span class="token comment" spellcheck="true"># 设置容器中的内核参数 (在使用 swarm 部署时将忽略该选项)</span>        ulimits               <span class="token comment" spellcheck="true"># 设置容器的 limit</span>        userns_mode           <span class="token comment" spellcheck="true"># 如果Docker守护程序配置了用户名称空间， 则禁用此服务的用户名称空间 (在使用 swarm 部署时将忽略该选项)</span>        volumes               <span class="token comment" spellcheck="true"># 定义容器和宿主机的卷映射关系， 其和 networks 一样可以位于 services 键的二级键和 compose 顶级键， 如果需要跨服务间使用则在顶级键定义， 在 services 中引用</span>            SHORT 语法格式示例<span class="token punctuation">:</span>                <span class="token key atrule">volumes</span><span class="token punctuation">:</span>                    <span class="token punctuation">-</span> /var/lib/mysql                <span class="token comment" spellcheck="true"># 映射容器内的 /var/lib/mysql 到宿主机的一个随机目录中</span>                    <span class="token punctuation">-</span> /opt/data<span class="token punctuation">:</span>/var/lib/mysql      <span class="token comment" spellcheck="true"># 映射容器内的 /var/lib/mysql 到宿主机的 /opt/data</span>                    <span class="token punctuation">-</span> ./cache<span class="token punctuation">:</span>/tmp/cache            <span class="token comment" spellcheck="true"># 映射容器内的 /var/lib/mysql 到宿主机 compose 文件所在的位置</span>                    <span class="token punctuation">-</span> ~/configs<span class="token punctuation">:</span>/etc/configs/<span class="token punctuation">:</span>ro    <span class="token comment" spellcheck="true"># 映射容器宿主机的目录到容器中去， 权限只读</span>                    <span class="token punctuation">-</span> datavolume<span class="token punctuation">:</span>/var/lib/mysql     <span class="token comment" spellcheck="true"># datavolume 为 volumes 顶级键定义的目录， 在此处直接调用</span>            LONG 语法格式示例<span class="token punctuation">:</span>(v3.2 新增的语法格式)                <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.2"</span>                <span class="token key atrule">services</span><span class="token punctuation">:</span>                    <span class="token key atrule">web</span><span class="token punctuation">:</span>                        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>alpine                        <span class="token key atrule">ports</span><span class="token punctuation">:</span>                            <span class="token punctuation">-</span> <span class="token string">"80:80"</span>                        <span class="token key atrule">volumes</span><span class="token punctuation">:</span>                            <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> volume                  <span class="token comment" spellcheck="true"># mount 的类型， 必须是 bind、volume 或 tmpfs</span>                                <span class="token key atrule">source</span><span class="token punctuation">:</span> mydata              <span class="token comment" spellcheck="true"># 宿主机目录</span>                                <span class="token key atrule">target</span><span class="token punctuation">:</span> /data               <span class="token comment" spellcheck="true"># 容器目录</span>                                <span class="token key atrule">volume</span><span class="token punctuation">:</span>                     <span class="token comment" spellcheck="true"># 配置额外的选项， 其 key 必须和 type 的值相同</span>                                    <span class="token key atrule">nocopy</span><span class="token punctuation">:</span> <span class="token boolean important">true                </span><span class="token comment" spellcheck="true"># volume 额外的选项， 在创建卷时禁用从容器复制数据</span>                            <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> bind                    <span class="token comment" spellcheck="true"># volume 模式只指定容器路径即可， 宿主机路径随机生成; bind 需要指定容器和数据机的映射路径</span>                                <span class="token key atrule">source</span><span class="token punctuation">:</span> ./static                                <span class="token key atrule">target</span><span class="token punctuation">:</span> /opt/app/static                                <span class="token key atrule">read_only</span><span class="token punctuation">:</span> <span class="token boolean important">true             </span><span class="token comment" spellcheck="true"># 设置文件系统为只读文件系统</span>                <span class="token key atrule">volumes</span><span class="token punctuation">:</span>                    <span class="token key atrule">mydata</span><span class="token punctuation">:</span>                                 <span class="token comment" spellcheck="true"># 定义在 volume， 可在所有服务中调用</span>        restart               <span class="token comment" spellcheck="true"># 定义容器重启策略(在使用 swarm 部署时将忽略该选项， 在 swarm 使用 restart_policy 代替 restart)</span>            no                    <span class="token comment" spellcheck="true"># 禁止自动重启容器(默认)</span>            always                <span class="token comment" spellcheck="true"># 无论如何容器都会重启</span>            on<span class="token punctuation">-</span>failure            <span class="token comment" spellcheck="true"># 当出现 on-failure 报错时， 容器重新启动</span>        其他选项：            domainname， hostname， ipc， mac_address， privileged， read_only， shm_size， stdin_open， tty， user， working_dir            上面这些选项都只接受单个值和 docker run 的对应参数类似        对于值为时间的可接受的值：            2.5s            10s            1m30s            2h32m            5h34m56s            <span class="token key atrule">时间单位</span><span class="token punctuation">:</span> us， ms， s， m， h        对于值为大小的可接受的值：            2b            1024kb            2048k            300m            1gb            <span class="token key atrule">单位</span><span class="token punctuation">:</span> b， k， m， g 或者 kb， mb， gb    networks          <span class="token comment" spellcheck="true"># 定义 networks 信息</span>        driver                <span class="token comment" spellcheck="true"># 指定网络模式， 大多数情况下， 它 bridge 于单个主机和 overlay Swarm 上</span>            bridge                <span class="token comment" spellcheck="true"># Docker 默认使用 bridge 连接单个主机上的网络</span>            overlay               <span class="token comment" spellcheck="true"># overlay 驱动程序创建一个跨多个节点命名的网络</span>            host                  <span class="token comment" spellcheck="true"># 共享主机网络名称空间(等同于 docker run --net=host)</span>            none                  <span class="token comment" spellcheck="true"># 等同于 docker run --net=none</span>        driver_opts           <span class="token comment" spellcheck="true"># v3.2以上版本， 传递给驱动程序的参数， 这些参数取决于驱动程序</span>        attachable            <span class="token comment" spellcheck="true"># driver 为 overlay 时使用， 如果设置为 true 则除了服务之外，独立容器也可以附加到该网络; 如果独立容器连接到该网络，则它可以与其他 Docker 守护进程连接到的该网络的服务和独立容器进行通信</span>        ipam                  <span class="token comment" spellcheck="true"># 自定义 IPAM 配置. 这是一个具有多个属性的对象， 每个属性都是可选的</span>            driver                <span class="token comment" spellcheck="true"># IPAM 驱动程序， bridge 或者 default</span>            config                <span class="token comment" spellcheck="true"># 配置项</span>                subnet                <span class="token comment" spellcheck="true"># CIDR格式的子网，表示该网络的网段</span>        external              <span class="token comment" spellcheck="true"># 外部网络， 如果设置为 true 则 docker-compose up 不会尝试创建它， 如果它不存在则引发错误</span>        name                  <span class="token comment" spellcheck="true"># v3.5 以上版本， 为此网络设置名称</span>文件格式示例：    <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span>    <span class="token key atrule">services</span><span class="token punctuation">:</span>      <span class="token key atrule">redis</span><span class="token punctuation">:</span>        <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>alpine        <span class="token key atrule">ports</span><span class="token punctuation">:</span>          <span class="token punctuation">-</span> <span class="token string">"6379"</span>        <span class="token key atrule">networks</span><span class="token punctuation">:</span>          <span class="token punctuation">-</span> frontend        <span class="token key atrule">deploy</span><span class="token punctuation">:</span>          <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>          <span class="token key atrule">update_config</span><span class="token punctuation">:</span>            <span class="token key atrule">parallelism</span><span class="token punctuation">:</span> <span class="token number">2</span>            <span class="token key atrule">delay</span><span class="token punctuation">:</span> 10s          <span class="token key atrule">restart_policy</span><span class="token punctuation">:</span>            <span class="token key atrule">condition</span><span class="token punctuation">:</span> on<span class="token punctuation">-</span>failure      <span class="token key atrule">db</span><span class="token punctuation">:</span>        <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres<span class="token punctuation">:</span><span class="token number">9.4</span>        <span class="token key atrule">volumes</span><span class="token punctuation">:</span>          <span class="token punctuation">-</span> db<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/var/lib/postgresql/data        <span class="token key atrule">networks</span><span class="token punctuation">:</span>          <span class="token punctuation">-</span> backend        <span class="token key atrule">deploy</span><span class="token punctuation">:</span>          <span class="token key atrule">placement</span><span class="token punctuation">:</span>            <span class="token key atrule">constraints</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>node.role == manager<span class="token punctuation">]</span></code></pre><h2 id="8-Docker-volume-备份-恢复-迁移"><a href="#8-Docker-volume-备份-恢复-迁移" class="headerlink" title="8.Docker volume 备份\恢复\迁移"></a>8.Docker volume 备份\恢复\迁移</h2><p>此块参考自:<a href="https://www.pbeta.me/docker-volume-migrate/" target="_blank" rel="noopener">Docker volume 跨服务器迁移 </a></p><blockquote><p>大概流程:</p></blockquote><pre class="mermaid">graph LR;    id1(备份volume)-->id2(传输到目标服务器)    id2-->id3(创建过渡容器)    id3-->id4(恢复volume)    id4-->id5(删除过渡容器)</pre><h3 id="备份-volume"><a href="#备份-volume" class="headerlink" title="备份 volume"></a>备份 volume</h3><p>这一步主要运用–volumes-from [container] 这条命令和一个过渡容器，从其他容器的 volume 中挂载</p><p>过渡容器可以自由选择，container: 备份 volume 的容器名，DIR: 容器 volume 挂载的路径，–rm: 容器一旦停止就会自动删除， -C: 去除目标上层路径，只打包目标</p><blockquote><p>提示: 挂载路径可以通过 docker inspect [container] 查看</p></blockquote><pre class=" language-shell"><code class="language-shell">docker run --rm \--volumes-from [container] \-v $(pwd):/backup \busybox \tar -cvf /backup/backup.tar -C [DIR] ./</code></pre><p>以上命令实现了，把容器的 volume 打包成 tar 并（-v）映射到当前路径内</p><h3 id="传输到要迁移的服务器"><a href="#传输到要迁移的服务器" class="headerlink" title="传输到要迁移的服务器"></a>传输到要迁移的服务器</h3><p>这一步可以通过各种软件或服务器厂商自带传输的工具实现</p><p>软件推荐: FinalShell(重点推荐，监控传输终端，样样都有) FileZilla</p><h3 id="创建过渡容器"><a href="#创建过渡容器" class="headerlink" title="创建过渡容器"></a>创建过渡容器</h3><p>拿到传输过来的包后，接下来进行恢复步骤，再次创建过渡容器用来迁移</p><p>name: 可以自由选择，只要前后文对应即可，target_volume_name: 要恢复的 volume 名称，/data: 准备恢复\导入的文件夹，不固定可随意放置，只要跟恢复的路径一致即可</p><blockquote><p>注意: 如果是使用 docker-compose 创建， target_volume_name 就要加上目录名称， 如: 目录为 top，那 volume 名就得这样写: top_[volume_name]</p></blockquote><pre class=" language-shell"><code class="language-shell">docker create -v [target_volume_name]:[/data] \ --name box \ busybox \ true</code></pre><p>以上命令，创建了新的 volume，用来恢复/导入</p><h3 id="恢复-volume"><a href="#恢复-volume" class="headerlink" title="恢复 volume"></a>恢复 volume</h3><p>再次启动新容器(跟第一步差不多)，将打包的文件映射并解压到 volume 中，完成迁移</p><p>box: 和上面的–name 对应即可，data/: 上一步命令容器内已经创建好的文件夹，解压到这里面，会自动映射到外部(跟创建过渡容器时映射的路径一致即可)</p><pre class=" language-shell"><code class="language-shell">docker run --rm \ --volumes-from [box] \ -v $(pwd):/backup \ busybox \ tar -xvf /backup/backup.tar -C [data/]</code></pre><h3 id="最后，删除过渡容器"><a href="#最后，删除过渡容器" class="headerlink" title="最后，删除过渡容器"></a>最后，删除过渡容器</h3><p>到这一步已经完成迁移，删除之前创建的过渡容器<br><code>docker stop [containerID] &amp;&amp; docker rm [containerID]</code><br>最后，数据已经恢复到本机，创建新容器，-v 挂载迁移好的 volume，路径跟旧容器一样即可</p>]]></content>
      
      
      <categories>
          
          <category> Operation </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 基础</title>
      <link href="/posts/1db1.html"/>
      <url>/posts/1db1.html</url>
      
        <content type="html"><![CDATA[<h1 id="Linux-基础"><a href="#Linux-基础" class="headerlink" title="Linux 基础"></a>Linux 基础</h1><p>LAMP：Linux Apache MySQL PHP</p><p>LNMP：Linux Nginx MySQL PHP</p><p>WAMP：Windows Apache MySQL PHP</p><p><strong>Linux 是一个操作系统。</strong></p><h2 id="一、Linux-介绍"><a href="#一、Linux-介绍" class="headerlink" title="一、Linux 介绍"></a>一、Linux 介绍</h2><h3 id="1、常见的操作系统"><a href="#1、常见的操作系统" class="headerlink" title="1、常见的操作系统"></a>1、常见的操作系统</h3><ul><li>Windows</li></ul><blockquote><p>它微软公司开发的一款桌面操作系统（闭源系统）。版本有 dos、win98、win NT、win<br>XP、win 7、win vista、win 8、win 10。服务器操作系统：win server 2003、win<br>server 2008、win server 2012。</p></blockquote><ul><li>Mac</li></ul><blockquote><p>苹果公司开发的一款操作系统（闭源系统），目前最新的版本是 IOS12。界面风格还是不错。对于系统底层的优化也是很好。</p></blockquote><ul><li>Linux</li></ul><blockquote><p>Linux 是一个开源的操作系统，目前是市面上占有率极高的服务器操作系统。目前其分支有很多。安卓</p></blockquote><ul><li>Unix</li></ul><blockquote><p>Unix 是 Linux 操作系统的前身，Unix 时间戳是指 1970 年 1 月 1 日 0 时 0 分 0 秒，1970 年是 Unix 的时间元年，也就是 Unix 诞生的年份。</p></blockquote><h3 id="2、为什么要使用-Linux-操作系统"><a href="#2、为什么要使用-Linux-操作系统" class="headerlink" title="2、为什么要使用 Linux 操作系统"></a>2、为什么要使用 Linux 操作系统</h3><p>之所以大部分的公司开发的时候都是使用 Linux 操作系统，取决于两个特性：</p><p><strong>稳定性：取决于系统的底层架构，一般情况下 Linux 系统能做到很长时间不关机一点也不卡顿；</strong></p><p><strong>安全性：开源系统，所有人都可以贡献自己的源代码为 Linux 系统打补丁；</strong></p><p>问：开源一定意味着免费么？</p><p>答：不一定，有些可能会进行服务收费，例如 Redhat。</p><h3 id="3、Linux-简介"><a href="#3、Linux-简介" class="headerlink" title="3、Linux 简介"></a>3、Linux 简介</h3><h4 id="3-1、Linux-操作系统"><a href="#3-1、Linux-操作系统" class="headerlink" title="3.1、Linux 操作系统"></a>3.1、Linux 操作系统</h4><ul><li>人 物 Linus</li></ul><blockquote><p>Linux 的开发作者，李纳斯·托瓦兹。荷兰在校大学生。</p></blockquote><ul><li>1991 年 0.0.1 版本</li></ul><blockquote><p>李纳斯当时学校使用的就是 Unix 操作系统，然后其对系统的底层代码进行了修改，放到了学校为学生开放的网站上，原先他把文件命名写成了 Linus’s<br>Unix，后期网络管理发现之后觉得这个名字不好，自己手动的将名字改成 Linux。随后其他同学下载之后发现这个版本还是挺好用的，随后都把自己代码贡献给李纳斯。</p></blockquote><ul><li>1992 年 0.0.2 版本</li><li>1994 年 1.0 版本</li><li>2003 年 2.6 版本</li></ul><p>上面所说的版本是指<strong>Linux 的内核版本</strong>，不是指分支的发行版本。</p><h4 id="3-2、开源文化"><a href="#3-2、开源文化" class="headerlink" title="3.2、开源文化"></a>3.2、开源文化</h4><p>Linux 是<strong>开源</strong>的操作系统。所谓开源就是指开放源代码。</p><ul><li>人 物 Stallman 斯特曼</li></ul><blockquote><p>开源文化的倡导人。</p></blockquote><ul><li>1983 年 <strong>GNU</strong>计划 格奴计划</li><li>1985 年 FSF 基金会</li><li>1990 年 Emacs、<strong>GCC</strong>、程序库</li><li>1991 年 Stallman 去找 Linus，商谈让 Linux 加入其开源计划（GNU 计划）</li><li>1992 年 GNU/Linux</li></ul><h4 id="3-3、Linux-分支"><a href="#3-3、Linux-分支" class="headerlink" title="3.3、Linux 分支"></a>3.3、Linux 分支</h4><p>目前分支比较多，常见的有 centos（社区企业网络操作系统）、RedHat、乌班图、debian 等等。</p><p>具体的分支，可以查看【文件】中的 Linux 分支图。</p><h2 id="二、Linux-安装"><a href="#二、Linux-安装" class="headerlink" title="二、Linux 安装"></a>二、Linux 安装</h2><p>通常情况下安装分为真机安装、在虚拟环境中安装。</p><p>真机安装：是指将电脑上的操作系统真实的换做其他的操作系统；</p><p><strong>虚拟环境安装：是指通过一些特殊的软件虚拟出一个安装环境，然后在安装环境中进行安装</strong>；</p><h3 id="1、安装虚拟环境"><a href="#1、安装虚拟环境" class="headerlink" title="1、安装虚拟环境"></a>1、安装虚拟环境</h3><p>虚拟环境可以通过特殊的软件来实现：<strong>VMare Wrokstation</strong>、Virtual Box 等。</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8483d72c01b346a25608ff4d25482f8b.png" alt=""></p><p>32 位安装：适用于 32 位电脑；</p><p>64 位安装：是用于 64 位电脑；</p><p>系统的位数可以在【计算机】-【属性】中查看：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/47b07e2718da5b8ffdc37f73e4771660.png" alt=""></p><p>CentOS-6.6-i386-bin-DVD1.iso：镜像文件，也就是 Linux 的安装包</p><p><strong>第一步：先运行 VM 的安装程序，然后点击下一步</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8e05b3f110cd0a37def69006fef67fc5.png" alt=""></p><p><strong>第二步：同意其许可协议，然后点击下一步</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/2092071b73b0b85a936c5e69fe55b9aa.png" alt=""></p><p><strong>第三步：选择安装的位置</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8f3cefa29d5e3610a05e54ac5984ec3f.png" alt=""></p><p><strong>说明：该路径是指虚拟机软件的安装路径</strong>。</p><p><strong>第四步：选择是否帮助 VM 公司提高软件的用户体验，可以不选。</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/e402c1c29969d12ca5a1d14bc0b56cc2.png" alt=""></p><p><strong>第五步：勾选快捷方式</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/e1c8fe4d2bf52a8fd75fb98a0eba07bd.png" alt=""></p><p><strong>第六步：点击安装按钮</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/f98777f0e0a896ba2bf4a4158b2501f4.png" alt=""></p><p><strong>第七步：安装完成</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/de682a9902bb4dd89e64d93586eeb5b3.png" alt=""></p><p>桌面上会有这个图标：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/805fc3ed1924b9242e557ba12b382316.png" alt=""></p><p><strong>要求在网卡里面要多出 2 个网卡</strong>：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8b3a0ad2498d1e4a83ad9a4bf217be88.png" alt=""></p><p>安装完成之后打开软件会看到下面的界面：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/a42e446ad631b280dc9c4e20dcdfaa46.png" alt=""></p><h3 id="2、Linux-安装"><a href="#2、Linux-安装" class="headerlink" title="2、Linux 安装"></a>2、Linux 安装</h3><p><strong>第一步：打开软件，点击屏幕中大的“+”或者选择【文件】选项卡中的【创建新的虚拟机】创建新的虚拟机</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5a16be58986447567cb4915510375991.png" alt=""></p><p><strong>第二步：在弹出的引导界面，选择【自定义（高级）】，点击【下一步】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/b202edef574816837e0476e688d922f5.png" alt=""></p><p><strong>第三步：在选择虚拟机兼容性界面直接点击下一步</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/3a69ae6f8ee60522a1b9271abc65d427.png" alt=""></p><p><strong>第四步：选择介质来源，这个时候选择第三个【稍后安装操作系统】，然后点击【下一步】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/687d2b935149fdd422bdefb2680f88f0.png" alt=""></p><p><strong>第五步：选择操作系统类型，然后点击下一步</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/d51910c4864e1b4f59aa711f12ef213e.png" alt=""></p><p><strong>第六步：设置虚拟机的名称已经其安装目录</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ef353875149434bad0b75f7864a2b072.png" alt=""></p><p><strong>说明：这个路径是指虚拟机安装的操作系统所产生的文件存放目录，不是指虚拟机的安装目录；</strong></p><p><strong>第七步：选择虚拟操作系统的 cpu 核心数</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/da662961e6afb8ab2e866f1debe1ee27.png" alt=""></p><p><strong>说明：此处以及后续的配置设置中设置的配置不要超过当前运行电脑的配置</strong>。</p><p><strong>第八步：设置操作系统的内存数值，一般情况下默认即可</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ca41f31b1b81963608b70254cd2a8ddc.png" alt=""></p><p><strong>说明：</strong></p><p><strong>1、设置内存的数值必须是 4 的倍数；</strong></p><p><strong>2、内存的设置数值不要超过当前电脑的内存数值；</strong></p><p><strong>第九步：选择网络类型，选择【NAT】，然后点击【下一步】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/04b66d2c91f744883be89443f86367ec.png" alt=""></p><p><strong>第十步：选择 I/O 控制器类型，默认即可，点击【下一步】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/95402fc890b24f17929127aed1eecfe8.png" alt=""></p><p><strong>第十一步：选择磁盘类型，默认即可，点击【下一步】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/f8848eb24ad8cd8ad56e8a0c93c71d9e.png" alt=""></p><p><strong>第十二步：选择磁盘位置，选【创建新的磁盘】，然后点击【下一步】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/cd804f2a9ef2244b630912ad651f1452.png" alt=""></p><p><strong>第十三步：选择磁盘大小，默认 20G</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8e52a13e35193aaea9733c26ef0f9efa.png" alt=""></p><p><strong>第十四步：设置磁盘文件位置，默认即可，点击【下一步】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/b1bd5c89e8d9bf4226344458ee8c210c.png" alt=""></p><p><strong>第十五步：安装向导结束，点击【完成】就可以</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ae22de634d792b3a9255ad492669b5c8.png" alt=""></p><p>安装完成看到下面这个界面：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/69966006aee4d804492130728190174c.png" alt=""></p><p><strong>第十六步：选择镜像文件</strong></p><p>点击【编辑虚拟机设置】</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/d61ae15e6471f67ab3b1c0524bbe049c.png" alt=""></p><p>选择 ISO 文件，然后点击【确定】：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/082a8bed2126918823193fb46fdcb962.png" alt=""></p><p>此处 iso 文件不需要解压。</p><p>开启虚拟机：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/575a763ba298e5c4ea38915f0d84f6c4.png" alt=""></p><p><strong>第十七步：选择【安装或更新一个已经存在的系统】，按下回车</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/9c88b9f78cd513a317fc743de33540ab.png" alt=""></p><p><strong>小技巧：首次运行虚拟机系统的时候，我们可能把鼠标点进去，然后发现鼠标出不来了，这个时候我们可以按下键盘上的组合键【ctrl+alt】，鼠标就可以出到外面的系统了</strong>。</p><p><strong>第十八步：是否检测媒体文件，不检测，通过 ← 和 → 来选择选项，选择【skip】，按下回车</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/400dbeaf25a15014646abdaba5da7564.png" alt=""></p><p><strong>第十九步：重新引导之后选择唯一一个按钮【next】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/a8c36432b0fdae8898d11206b25248b5.png" alt=""></p><p><strong>第二十步：选择语言，可以选择【简体中文】，然后点击【next】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/7f8fbe3b4f001dfbc3ddd65584696aba.png" alt=""></p><p><strong>第二十一步：选择键盘类型，默认【美式英语】即可，点击【下一步】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/2ad34c5a36fee76f3294c30d064c5dcf.png" alt=""></p><p><strong>第二十二步：选择存储设备类型，默认即可，然后点击【下一步】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/64c944e2ed6d4f7b515bb7958c68e7d8.png" alt=""></p><p><strong>第二十三步：设置磁盘，选择【忽略所有数据】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/17cd68476675f7ccc8472ef90f3a288a.png" alt=""></p><p><strong>第二十四步：设置网络</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/e05e0c528dcae617e02b1a4d80ad1f65.png" alt=""></p><p>设置网卡开机自动连接</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/072c8eb58a48b38847cced91dccbf307.png" alt=""></p><p>点击【应用】再点击【关闭】</p><p>最后再点击【下一步】</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/e99d81ecb7c53da049d40f06a8b4f54f.png" alt=""></p><p><strong>第二十五步：设置时区，默认即可，直接点击【下一步】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/607fd4926c23d2a9a0fc89ed96b53a49.png" alt=""></p><p><strong>第二十六步：设置密码，密码对用的用户名是 root</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/44a8080f0abbed87bb154d3a63405393.png" alt=""></p><p>密码有限制：最少是 6 位，并且建议是大写+小写+数字的组合</p><p>设置完成之后点击【下一步】</p><p><strong>第二十七步：选择安装类型，这个时候选择【使用所有空间】，然后点击【下一步】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/212de1ff33c2db5730e55de414579790.png" alt=""></p><p>然后选【将修改写入磁盘】</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/fbdc0f3801e6357516846b284994a2b6.png" alt=""></p><p><strong>第二十八步：选择 Linux 系统的安装模式，默认 desktop-现在自定义-下一步</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/6180d93e64149a39ec6dcb4c187dd6c0.png" alt=""></p><p>下一步中勾选【开发】中的【开发工具】</p><p><strong>注意：一定要确保【开发工具】前面有一个 √。</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/957765df3ce9a343a9c5554476022da9.png" alt=""></p><p>然后再点击【下一步】</p><p><strong>第二十九步：等待安装完成重新引导，这个过程需要安装 1160 多个软件，时间大概消耗 20 分钟左右</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/45b3510afceffbfe3d9d61c590db7cd0.png" alt=""></p><p><strong>第三十步：完成之后点击【重新引导】，系统会重新启动</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/b05193a54cc7c2caf6feaedf70ada5ef.png" alt=""></p><p><strong>第三十一步：在欢迎界面点击【前进】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/83ff198ff0a6c0552af392bac528b161.png" alt=""></p><p>在许可协议界面同意协议，再点击【前进】</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/66c50c1f060ded493671498186e57e1d.png" alt=""></p><p><strong>第三十二步：设置新的用户（非超级管理员用户），填写好之后点击【前进】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/e75d3e667a052249874bdad560dda916.png" alt=""></p><p><strong>第三十三步：设置时间，然后点击【前进】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/824379a57c576378bd3f5a8b70f1a767.png" alt=""></p><p><strong>第三十四步：设置 kdump 的时候会提示错误，因为没有足够的内存，所以这一步默认跳过，最后点击【完成】</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/a76a6a7259a97af42951b06f930e6656.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8654d579108fa4e44566d43e3e0b14dc.png" alt=""></p><p><strong>第三十五步：重启之后的效果</strong></p><p>会出现一个登录框，并且显示出非 root 用户的帐号名，点击需要进行登录的用户名之后输入其密码即可进行登录；如果需要使用 root 帐号登录，则点击【其他】，然后输入 root 用户名和密码即可。</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/4398e3bd61ab95583965ed53e1c1bd55.png" alt=""></p><p>登录之后的显示界面：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/d5b1db36b70d4dc2c2d973f4c5a7cfa1.png" alt=""></p><h2 id="三、Linux-目录介绍"><a href="#三、Linux-目录介绍" class="headerlink" title="三、Linux 目录介绍"></a>三、Linux 目录介绍</h2><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8a63a078ef01b77feec16c89bca36919.png" alt=""></p><p>/：表示的是根的意思</p><p>/bin：（binary）存放的是一些二进制文件，但是在 Linux 中二进制文件是可以被执行的。这个目录中的命令文件是给普通用户使用（非超级管理员用户）。</p><p><strong>/etc：Linux 下所有的配置文件都会存放到 etc 目录。</strong></p><p>/home：是所有非 root 用户家目录的一个集合。</p><p>/root：root 用户的家目录。</p><p>/sbin：sbin 表示 super bin（shell<br>bin），里面同样也类似于 bin 目录，也存放了一些二进制文件，只不过这些命令只能是让超级管理员去运行。</p><p><strong>/usr：存放着一些用户自己安装的软件，其实类似于 windows 下的 Program Files 目录。</strong></p><p><strong>/var：（variable）存放着 Linux 下的一些日志文件，在实际开发的时候有一些公司也习惯把 Apache 或者 nginx 的站点目录也会放到这个目录中。</strong></p><h2 id="四、命令行-shell"><a href="#四、命令行-shell" class="headerlink" title="四、命令行(shell)"></a>四、命令行(shell)</h2><p>了解：常见的 shell。</p><p>Csh、tcsh、zsh、<strong>bash</strong>等</p><p>在 Linux 中如何打开命令行界面？</p><p>打开方式：在 Linux 中的任意一个空白的地方（不要点着图标），右键然后选择【在终端中打开】，会看到一个类似于下面界面的窗口：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/46aa840293edc28e35daa09513f9ff4b.png" alt=""></p><p>命令行符号介绍：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/9fba6c43cdb4d45b5d081b996f72927c.png" alt=""></p><p>关于用户身份标记说明：</p><p><strong>在 Linux 中#表示超级管理员身份，$符号表示普通用户</strong>。</p><h2 id="五、基本命令（重点）"><a href="#五、基本命令（重点）" class="headerlink" title="五、基本命令（重点）"></a>五、基本命令（重点）</h2><p>通用语法格式：# <strong>指令名称 [选项][操作的目标]</strong></p><p>假设：让小明去楼下超市买清风牌的餐巾纸和农夫山泉牌矿泉水。</p><h3 id="1、简单命令"><a href="#1、简单命令" class="headerlink" title="1、简单命令"></a>1、简单命令</h3><h4 id="1-1、ls-指令"><a href="#1-1、ls-指令" class="headerlink" title="1.1、ls 指令"></a>1.1、ls 指令</h4><p>语法 1：<strong>#ls [路径]</strong></p><p>表示列出指定路径下的文件夹和文件的名字，如果路径没有指定则列出当前路径下的（list）</p><p>例如：在 root 用户的家目录中输入 ls 命令，则会看到以下的效果：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/fbf68a338bb84bc192633478bacd7753.png" alt=""></p><p>要求列出/home 的文档的名称。</p><p>#ls /home</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/2494ced62bc7d10ab4f4e90d0f303175.png" alt=""></p><p>语法 2：<strong>#ls -l [路径]</strong></p><p>表示<strong>以列表的形式</strong>列出指定路径下的文件夹和文件的名字</p><p>例如：使用 ls –l 的命令列出当前用户家目录中的文件夹和文件信息</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/64e08840731c47e94fb6691d671b9771.png" alt=""></p><p>语法 3：<strong>#ls -la [路径]</strong></p><p>表示<strong>以列表的形式</strong>列出指定路径下的文件夹和文件名（<strong>包含隐藏文件,all</strong>）</p><p>例如：在当前用户的家目录中输入 ls<br>–la 命令可以查看全部的文件夹和文件名，并且包含了隐藏文件（<strong>特点是以“.”开头的名字</strong>）</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8ab83e8325acfd590201bac968433d80.png" alt=""></p><h4 id="1-2、clear-指令"><a href="#1-2、clear-指令" class="headerlink" title="1.2、clear 指令"></a>1.2、clear 指令</h4><p>表示的含义：清空当前屏幕中全部的命令（<strong>其实质是没有清空，只不过是顶到上面去了</strong>）</p><p><strong>语法：#clear</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/2225c32c9d1a72b04c03b1341c1ed9c0.png" alt=""></p><p><strong>等效于快捷键：ctrl + L</strong></p><h4 id="1-3、su-指令"><a href="#1-3、su-指令" class="headerlink" title="1.3、su 指令"></a>1.3、su 指令</h4><p>作用：切换用户（switch user）。</p><p>语法：<strong>#su 需要切换到的用户名（用户名可以不写，则表示切换到 root 用户）</strong></p><p>例如：</p><p>1、从 root 用户切换到 admin 用户。</p><p>#su admin</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/7c30c9d430490620ce51791900b43faf.png" alt=""></p><p>2、从 admin 用户切换到 root 用户。</p><p>#su root</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/19e0602a33d63fc76633d07cbf80afb7.png" alt=""></p><p>等价于：</p><p>#su</p><p>通过上述两个命令的操作发现一个结论：</p><p><strong>当切换到的用户权限如果比当前用户的权限低，可以直接切换，不需要密码；反之，如果从低往高切换则要求输入被切换到的账户对应的密码。</strong></p><h4 id="1-4、cd-指令"><a href="#1-4、cd-指令" class="headerlink" title="1.4、cd 指令"></a>1.4、cd 指令</h4><p>作用：切换目录（change directory）。</p><p><strong>语法：#cd 需要切换到的路径（路径可以是相对路径，也可以是绝对路径）</strong></p><p><strong>路径可以写也可以不写，不写则表示切换到当前用户的家目录。</strong></p><p>例如：</p><p>1、从 root 用户家目录中切换到 admin 用户的家目录中</p><p>#cd /home/admin</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ba0f590fb015480cd27a2ebb3e09c186.png" alt=""></p><p><strong>提示：在切换路径或者后期打开一个文件的时候可以多建议使用 tab 键（可以自动补全命令路径）。</strong></p><p>2、切换用户切换到 admin 用户，然后从 admin 用户的家目录使用 cd 切换到 root 的家目录</p><p>#su admin</p><p>#cd /root</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/9fb7f3378ccec037d53453c24cbe7bf3.png" alt=""></p><p>结论： <strong>低级用户没有权限访问高级用户相关的资源</strong>。</p><p><strong>关于路径：</strong></p><p>路径分为相对路径和绝对路径。</p><p>相对路径是相对当前路径的一种表现形式。</p><p>特点：只要不是以“/”开头的就是相对路径。</p><p>绝对路径是直接从“根”开始的一种路径形式。</p><p>特点：以“/”开头的路径称之为绝对路径。</p><p>案例：从 root 用户家目录中切换到 admin 用户的家目录中，要求以相对路径形式书写。</p><p>#cd ../home/admin</p><p>分析：</p><p>当前路径：<strong>/</strong>root</p><p>目标路径：<strong>/</strong>home/admin</p><h4 id="1-5、pwd-指令"><a href="#1-5、pwd-指令" class="headerlink" title="1.5、pwd 指令"></a>1.5、pwd 指令</h4><p><strong>作用：打印当前的工作路径（print working directory）</strong>。</p><p>例如：在当前用户的家目录中使用 pwd 命令。</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/6f7220bdfabe270e727602ef8c91d1b3.png" alt=""></p><h3 id="2、文档的操作命令"><a href="#2、文档的操作命令" class="headerlink" title="2、文档的操作命令"></a>2、文档的操作命令</h3><h4 id="2-1、创建文件"><a href="#2-1、创建文件" class="headerlink" title="2.1、创建文件"></a>2.1、创建文件</h4><p>命令：touch</p><p>语法：#<strong>touch</strong>路径</p><p>例如：</p><p>1、在当前路径下创建一个文件名字叫 php2018.txt。</p><p># touch php2018.txt</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/cc5b9932f7b21e53068b4f28a6edd84e.png" alt=""></p><p>2、在磁盘根目录下创建文件 php2018.txt。</p><p># touch /php2018.txt</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/1258ea362c5e0ea6d76fa04acd741642.png" alt=""></p><h4 id="2-2、创建文件夹"><a href="#2-2、创建文件夹" class="headerlink" title="2.2、创建文件夹"></a>2.2、创建文件夹</h4><p>命令：mkdir [make directory]</p><p>语法：#mkdir 文件夹路径</p><p>例如：在 root 的桌面上创建一个 php69 的文件夹</p><p>#mkdir php69</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/c7972603b98c05086cb3adf03b2c9e1e.png" alt=""></p><p>问题：</p><p>#mkdir index.php 创建的是什么？ 【文件夹】</p><p>问题：</p><p>在上述的指令执行的基础上行，执行#touch index.php，创建的是什么？【什么都没有】</p><h4 id="2-3、复制"><a href="#2-3、复制" class="headerlink" title="2.3、复制"></a>2.3、复制</h4><p>命令：cp （copy）</p><p>语法：<strong>#cp [-r] 需要复制的文档 需要保存的位置</strong></p><p>选项说明：</p><p>-r：表示递归。<strong>如果复制的是文件夹，则-r 就不是选项，是必须要加的。</strong></p><p>问题：文档在复制的过程中，其名称一般是否变化？ 【不变，数量变化】</p><p>案例 1：需要使用 root 用户，将根下的 php2018.txt 复制到 admin 用户的家目录下</p><p>#cp /php2018.txt /home/admin/</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5e06e307e1ec0cd28e00e87bc37ed898.png" alt=""></p><p>案例 2：将桌面上（当前目录）的 php69 文件夹复制到 admin 的家目录下</p><p>#cp php69 /home/admin/</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5bf195c89f384b0fbd9a139183048e21.png" alt=""></p><h4 id="2-4、移动-剪切-重命名"><a href="#2-4、移动-剪切-重命名" class="headerlink" title="2.4、移动/剪切/重命名"></a>2.4、移动/剪切/重命名</h4><p>命令：mv （move）【剪切+粘贴】</p><p><strong>语法：#mv 需要操作的文档 新的文档的位置</strong></p><p>案例：【移动/剪切】将 admin 家目录下的 php2018.txt，移动到 root 家目录下。</p><p>问题：移动操作会影响什么？ 【<strong>路径变化，数量不变，名称不变</strong>】</p><p>#mv /home/admin/php2018.txt /root/</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ae83652cc9409e99064616d7a0e191f9.png" alt=""></p><p>案例 2：【重命名】将 root 下的 php2018.txt 重命名为 php.doc。</p><p>问题：重命名操作会影响什么？ 【<strong>名称变，路径不变，数量不变</strong>】</p><p>#mv /root/php2018.txt /root/php.doc</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/47203631997bb4ef81706081146518d4.png" alt=""></p><h4 id="2-5、删除"><a href="#2-5、删除" class="headerlink" title="2.5、删除"></a>2.5、删除</h4><p>命令：rm （remove）</p><p><strong>语法：#rm [-rf] 需要删除的文档</strong></p><p>选项说明：</p><p>-r：表示递归</p><p>-f：force，表示强制，没有删除确认提示</p><p>案例 1：删除 root 下的 php.doc</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5f015728cfa38c66090109ec90b5d3d0.png" alt=""></p><p>案例 2：删除 root 下的 php 文件夹</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/bfd89395f0154a8589b66f33c55593a0.png" alt=""></p><p><strong>面试题：</strong></p><p>请问使用 root 用户“#rm -rf /”这个命令能不能执行？</p><p>答：从语法上讲，该指令可以执行，表示递归删除根，但是这个操作很危险，不建议执行。</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8ae7006ec68a7d86e7313682cd3f9c23.png" alt=""></p><h3 id="3、文档的查看指令"><a href="#3、文档的查看指令" class="headerlink" title="3、文档的查看指令"></a>3、文档的查看指令</h3><h4 id="3-1、tail-指令"><a href="#3-1、tail-指令" class="headerlink" title="3.1、tail 指令"></a>3.1、tail 指令</h4><p>作用：查看一个文件的末 n 行</p><p>语法：#tail -n 文件的路径</p><p>说明：-n 可以不写，不写，默认表示 10 行。</p><p>案例：使用 tail 指令查看 root/install.log 文件的末 5 行和末 10 行</p><p>#tail -5 /root/install.log</p><p>#tail /root/install.log 等价于 #tail -10 /root/install.log</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/e70f9151823ad9e802f1db51726dd565.png" alt=""></p><h4 id="3-2、head-指令"><a href="#3-2、head-指令" class="headerlink" title="3.2、head 指令"></a>3.2、head 指令</h4><p>作用：查看文件的头 n 行</p><p>语法：#head -n 文件的路径</p><p>注意：如果不指定-n 则默认头 10 行</p><p>案例：使用 head 指令查看 root/install.log 文件的头 5 行和头 10 行</p><p>#head -5 /root/install.log</p><p>#head /root/install.log 等价于 #head -10 /root/install.log</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/12fbd3b00bbba7f902a107ab9964aab3.png" alt=""></p><h4 id="3-3、cat-指令"><a href="#3-3、cat-指令" class="headerlink" title="3.3、cat 指令"></a>3.3、cat 指令</h4><p>作用：查看某个文件的全部内容（将内容全部输出在命令行中）【正序】</p><p>语法：#cat 文件路径 1 文件路径 2 文件路径 3 …</p><p>案例：使用 cat 指令输出 install.log 文件内容</p><p>#cat /root/install.log</p><h4 id="3-4、tac-指令"><a href="#3-4、tac-指令" class="headerlink" title="3.4、tac 指令"></a>3.4、tac 指令</h4><p>作用：查看某个文件的全部内容（倒序的）</p><p>语法：#tac 文件路径 1 文件路径 2 文件路径 3…</p><p>案例：使用 tac 指令输出 install.log 文件内容</p><p>#tac /root/install.log</p><h4 id="3-5、vim-指令"><a href="#3-5、vim-指令" class="headerlink" title="3.5、vim 指令"></a>3.5、vim 指令</h4><p>作用：打开一个文件，显示内容</p><p>语法：#vim 文件路径</p><p>例如：打开/root/install.log</p><p>#vim /root/install.log</p><p>退出输入“:q”按下回车即可。</p><h3 id="4、关机重启指令"><a href="#4、关机重启指令" class="headerlink" title="4、关机重启指令"></a>4、关机重启指令</h3><h4 id="4-1、reboot-指令"><a href="#4-1、reboot-指令" class="headerlink" title="4.1、reboot 指令"></a>4.1、reboot 指令</h4><p>作用：重启计算机</p><p>语法：#reboot</p><p>注意：<strong>部分情况下（除非自开机以来只有当前一个普通用户登录过）</strong>普通用户无法执行 reboot 指令</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ea4e1f613636197a0a8807f3a146effd.png" alt=""></p><h4 id="4-2、shutdown-指令"><a href="#4-2、shutdown-指令" class="headerlink" title="4.2、shutdown 指令"></a>4.2、shutdown 指令</h4><p>作用：关机</p><p>语法：#shutdown -h 时间</p><p>时间常见的值：</p><p>now：（shutdown -h now），表示立即关机</p><p>+m：（m 表示 minutes 数字），例如+5，则表示五分钟之后关机</p><h4 id="4-3、halt-指令"><a href="#4-3、halt-指令" class="headerlink" title="4.3、halt 指令"></a>4.3、halt 指令</h4><p>作用：关机（关闭内存）</p><p>语法：#halt</p><h1 id="六、扩展（1）"><a href="#六、扩展（1）" class="headerlink" title="六、扩展（1）"></a>六、扩展（1）</h1><h3 id="1、ctrl-a"><a href="#1、ctrl-a" class="headerlink" title="1、ctrl+a"></a>1、ctrl+a</h3><p>在命令行中可以使用 ctrl+a，来进行光标的快速定位：可以将命令行中的光标从其他的位置快速移动到行首。【ahead】</p><h3 id="2、ctrl-e"><a href="#2、ctrl-e" class="headerlink" title="2、ctrl+e"></a>2、ctrl+e</h3><p>在命令行中可以使用 ctrl+e，来进行光标的快速定位：可以将命令行中的光标从任意位置快速定位到行末。【end】</p><h3 id="3、↑-和-↓-键"><a href="#3、↑-和-↓-键" class="headerlink" title="3、↑ 和 ↓ 键"></a>3、↑ 和 ↓ 键</h3><p>在命令行输入的位置可以按下 ↑ 来查看之前的执行命令历史，可以按下 ↓ 来翻到最新的命令执行历史。【即使远程终端断开连接，下次连接上依然可以使用】</p><h3 id="4、将命令执行结果保存到文件中去"><a href="#4、将命令执行结果保存到文件中去" class="headerlink" title="4、将命令执行结果保存到文件中去"></a>4、将命令执行结果保存到文件中去</h3><p>按照下面的语法：</p><p>#需要执行的命令 &gt; 需要保存到的文件路径 【覆盖写】</p><p>或者</p><p>#需要执行的命令 &gt;&gt; 需要保存到的文件路径 【追加写】</p><h1 id="七、进阶指令"><a href="#七、进阶指令" class="headerlink" title="七、进阶指令"></a>七、进阶指令</h1><h3 id="1、du-指令"><a href="#1、du-指令" class="headerlink" title="1、du 指令"></a>1、du 指令</h3><p>作用：du 表示 directory used，显示出目录所占的磁盘空间大小的情况。</p><p>语法：#du -sh 目录路径</p><p>选项说明：</p><p>-s：表示 sumary，汇总统计</p><p>-h：表示以较高可读性的形式显示</p><p>案例：使用 du -sh 指令统计出“/etc”的大小情况</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/15b78d22127fd3fc6d610bf057932254.png" alt=""></p><h3 id="2、df-指令"><a href="#2、df-指令" class="headerlink" title="2、df 指令"></a>2、df 指令</h3><p>作用：disk free，查看磁盘的剩余空间的情况。</p><p>语法：#df -h</p><p>选项说明：</p><p>-h：表示以较高可读性单位进行查看。</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/156bec15d471af0801f6a31ea9099a48.png" alt=""></p><h3 id="3、free-指令"><a href="#3、free-指令" class="headerlink" title="3、free 指令"></a>3、free 指令</h3><p>作用：查看内存的使用情况</p><p>语法：#free -m</p><p>选项含义：</p><p>-m：表示以 mb 为单位进行查看</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/907bdb04b6abfe36cc56240a3a5f5faa.png" alt=""></p><p>注意：</p><p>第一行表示 memory，是内存各项的数字。</p><p>其中，如果查看可用的剩余内存，应该是 3527 的位置。</p><p>如果看的是剩余的内存，则应该是 3725 的位置。</p><h3 id="4、find-指令"><a href="#4、find-指令" class="headerlink" title="4、find 指令"></a>4、find 指令</h3><p>作用：表示根据条件去查询文档的所在位置。</p><p>语法：#find 范围路径 选项 选项的值</p><p>常见的选项：</p><p><strong>-name：根据名字进行查询</strong></p><p><strong>-type：根据文档的类型进行查询。[d 表示文件夹，f 表示普通文件，s 表示套接字文件，l 表示连接文件，c 表示字符设备文件，b 表示块状设备文件]</strong></p><p>-user：根据所有者进行查询</p><p>-group：根据所属的用户组进行查询</p><p>-size：根据大小进行查询</p><p>案例：我们记不清一个文件 httpd.conf 所在位置，现在要求使用 find 指令进行查询</p><p>#find / -name httpd.conf -type f</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/1ae26f7664fb7782c8a9cff96f6f88f3.png" alt=""></p><p><strong>补充：-name 选项支持通配符（“*”），模糊查询。</strong></p><p>例如：假设我需要查询磁盘中全部的.conf 文件，则可以写成：#find / -name *.conf<br>-type f</p><h3 id="5、ps-指令"><a href="#5、ps-指令" class="headerlink" title="5、ps 指令"></a>5、ps 指令</h3><p>作用：表示 process show，查看进程</p><p>语法：#ps -ef</p><p>选项含义：</p><p>-e：等价于-A，all，表示全部</p><p>-f：表示 full，显示全部的列</p><p>操作效果：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/0edbbbb59056c477a332323118bf8f31.png" alt=""></p><p>UID：该进程的启动用户名；</p><p>PID：process id，进程的 id 号</p><p>PPID：parent process id，父级进程 id 号</p><p>C：表示的 cpu 的使用情况</p><p>STIME：start time，启动时间</p><p>TTY：终端的设备编号，“？”表示该进程不是由终端发起的</p><p>TIME：持续运行的时间</p><p>CMD：command，显示进程的名称或者位置</p><p><strong>补充：结束进程的指令</strong></p><p><strong>#kill PID</strong></p><h3 id="6、service-指令"><a href="#6、service-指令" class="headerlink" title="6、service 指令"></a>6、service 指令</h3><p>作用：操作服务的（启动/停止/重启）</p><p>语法：#service 服务名 start/stop/restart</p><p>案例：使用 service 指令启动 apache（httpd）</p><p>#service httpd start</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/d25e1bbd5428a26a5c0d7e21e15ed34e.png" alt=""></p><p><strong>注意：对于服务名是存在要求的，要求服务名必须存在于“/etc/init.d”目录下。</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/beb4f78c5eec8a9ad9144f7318f9546a.png" alt=""></p><p>除了可以用 service 指令操作服务，还可以通过如下语法：</p><p><strong>#/etc/init.d/服务名 start/stop/restart</strong></p><p>所以刚才 apache 的启动指令还可以写成：#/etc/init.d/httpd start</p><h3 id="7、grep-指令（重点）"><a href="#7、grep-指令（重点）" class="headerlink" title="7、grep 指令（重点）"></a>7、grep 指令（重点）</h3><p>作用：搜索、过滤，主要用于对文件/内容进行筛选，选出需要的内容</p><p>语法：#grep [选项] 关键词 文件路径/内容</p><p>常见的选项：</p><p>-v：排除</p><p><strong>案例：使用 grep 筛选出 php2018.txt 中的 admin 行</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/925b8c76ab1caa0ea47b2120f3795ecd.png" alt=""></p><p>案例：使用 grep -v 实现排除 admin 所在行</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ff32256cf0e778e06844d0573d27e551.png" alt=""></p><p><strong>扩展用法：</strong></p><p>#grep -E “关键词 1|关键词 2|…” 文件路径或内容</p><p>选项：-E 表示 extension，该语法表示多条件筛选，“|”表示 or</p><p>上述扩展用法等价于：</p><p>#egrep “关键词 1|关键词 2|….” 文件的内容或路径</p><h3 id="8、wc-指令"><a href="#8、wc-指令" class="headerlink" title="8、wc 指令"></a>8、wc 指令</h3><p>作用：word count，其作用是用于统计文件的各项数值（行、单词数、字节数）</p><p>语法：#wc -lwc 文档的路径</p><p>选项含义：</p><p>-l：line，行数</p><p>-w：word，单词数</p><p>-c：byte，字节数</p><p>案例：使用 wc 指令分别统计文件/etc/passwd 的行、单词数、字节数</p><p>#wc -lwc /etc/passwd</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ddc6a6ca5621f6d52246ed79de9a511e.png" alt=""></p><p><strong>注意：lwc 选项的顺序，不影响其指令输出的结果的顺序，结果顺序一定是行 、 单词<br>、字节。</strong></p><h3 id="9、管道（重点）"><a href="#9、管道（重点）" class="headerlink" title="9、管道（重点）"></a>9、管道（重点）</h3><p>管道严格意义上说其不是指令，其只是一个符号“|”。该符号主要起到辅助的作用，能够将多个指令合在一行上进行操作。主要用在搜索过滤等上面。</p><p><strong>语法：# 必须在终端中有输出内容的指令 |<br>有输入的指令[要求有读取文件内容的需求]</strong></p><p>管道的核心理解概念：<strong>管道前面的指令的输出其实就是管道后面指令的输入</strong>。</p><p>案例：通过 ps 指令查看进程，只查看 httpd 的进程。</p><p>#ps -ef | grep “httpd”</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/3049ab0d711f19491d32130b0a811ba5.png" alt=""></p><p>课堂作业：</p><p>“/etc/passwd”文件是存储用户信息的文件，该文件中<strong>一行即为一个用户</strong>，要求使用所学的指令统计出当前计算机中一共有多少个用户。</p><p>#cat /etc/passwd | wc -l</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/3e9b88e6cc74fa33a81e7c018e30c2e3.png" alt=""></p><h2 id="八、vim-编辑器"><a href="#八、vim-编辑器" class="headerlink" title="八、vim 编辑器"></a>八、vim 编辑器</h2><h3 id="1、vi-介绍"><a href="#1、vi-介绍" class="headerlink" title="1、vi 介绍"></a>1、vi 介绍</h3><p>Vi 编辑器是所有 Unix 及 Linux 系统下标准的编辑器，类似于 windows 系统下的 notepad（记事本）编辑器，由于在 Unix 及 Linux 系统的任何版本，Vi 编辑器是完全相同的，因此可以在其他任何介绍 vi 的地方都能进一步了解它，Vi 也是 Linux 中最基本的文本编辑器，学会它后，我们将在 Linux 的世界里畅行无阻，<strong>尤其是在终端中</strong>。</p><p>关于 vim：</p><p>vi 和 vim 都是 Linux 中的编辑器，不同的是，<strong>vim 比较高级</strong>，可以视为 vi 的升级版本。vi 使用于文本编辑，但是 vim 更适用于 coding（写代码的）。</p><p><strong>Vim 重点是光标的移动，模式切换，删除，查找，替换，复制，粘贴，撤销命令的使用</strong>。</p><p><strong>在后期使用的 Linux 系统中，有些可能没有初始自带 vim，而自带了 vi，那么 vim 指令是不能直接使用的，需要先安装。</strong></p><h3 id="2、三种模式"><a href="#2、三种模式" class="headerlink" title="2、三种模式"></a>2、三种模式</h3><p>Vim 中存在三种模式（大众的认知）：<strong>命令模式、编辑模式（输入模式）、末行模式（尾行模式）</strong>。</p><p>命令模式：在该模式下是不能对文件直接编辑，可以输入快捷键（命令）进行一些操作（删除行，复制行，移动光标，粘贴等等）【打开文件之后默认进入的模式】；</p><p>编辑模式：在该模式下可以对文件的内容进行编辑；</p><p>末行模式：可以在末行输入命令来对文件进行操作（搜索、替换、保存、退出、撤销、高亮等等）；</p><p>Vim 的打开文件的方式：</p><p><strong>#vim 文件路径 作用：打开指定的文件(可以是不存在的)</strong></p><p>#vim +数字 文件的路径 作用：打开指定的文件，并且将光标移动到指定行</p><p>#vim +/关键词 文件的路径 作用：打开指定的文件，并且高亮显示关键词（搜索）</p><p><strong>重点：先复制出一个/etc/passwd 文件，复制当前目录下（千万不要在 etc 下直接修改！！！）</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/a1c8030822beb8b1b46ba3382744aef7.png" alt=""></p><h3 id="2-1、命令模式"><a href="#2-1、命令模式" class="headerlink" title="2.1、命令模式"></a>2.1、命令模式</h3><p>注意：该模式是打开文件的第一个看到的模式（打开文件即可进入）</p><h4 id="2-1-1、光标移动"><a href="#2-1-1、光标移动" class="headerlink" title="2.1.1、光标移动"></a>2.1.1、光标移动</h4><p>① 光标移动到行首</p><p>按键：shift + 6 或 <strong>^</strong>（T 字母上面的 6，不要按小键盘的 6）</p><p>② 光标移动到行尾</p><p>按键：shift + 4 或 <strong>$</strong>（R 字母的左上角的 4，不是小键盘的 4）</p><p><strong>③ 光标移动到首行行首</strong></p><p>按键：gg</p><p><strong>④ 光标移动到末行行首</strong></p><p>按键：G [Capslk 再加 G 键] / [Shift + G 键]</p><p><strong>⑤ 翻屏</strong></p><p>向上翻屏：按键 ctrl + b （before） 或 PgUp</p><p>向下翻屏：按键 ctrl + f （after） 或 PgDn</p><p><strong>⑥ 快速定位到指定行</strong></p><p>数字 G</p><h4 id="2-1-2、复制操作"><a href="#2-1-2、复制操作" class="headerlink" title="2.1.2、复制操作"></a>2.1.2、复制操作</h4><p>① 复制光标所在行</p><p>按键：yy</p><p><strong>粘贴：在想要粘贴的地方按下 p 键【将粘贴在光标所在行的下一行】,如果想粘贴在光标所在行之前，则使用 P 键</strong></p><p><strong>② 以光标所在行为准（包含当前行），向下复制指定的行数</strong></p><p>按键：数字 yy</p><h4 id="2-1-3、剪切-删除"><a href="#2-1-3、剪切-删除" class="headerlink" title="2.1.3、剪切/删除"></a>2.1.3、剪切/删除</h4><p><strong>① 剪切/删除光标所在行</strong></p><p>按键：dd （删除之后下一行上移）</p><p><strong>注意：dd 严格意义上说是剪切命令，但是如果剪切了不粘贴就是删除的效果。</strong></p><p><strong>② 剪切/删除光标所在行为准（包含当前行），向下删除/剪切指定的行</strong></p><p>按键：数字 dd （删除之后下一行上移）</p><p>③ 剪切/删除光标所在的当前行（光标所在位置）之后的内容，但是删除之后下一行不上移</p><p>按键：D （删除之后当前行会变成空白行）</p><h4 id="2-1-4、撤销-恢复"><a href="#2-1-4、撤销-恢复" class="headerlink" title="2.1.4、撤销/恢复"></a>2.1.4、撤销/恢复</h4><p>撤销：输入“:u”（不属于命令模式） 或者 u （undo）</p><p>恢复：ctrl + r 恢复（取消）之前的撤销操作【重做，redo】</p><h3 id="2-2、模式间的切换"><a href="#2-2、模式间的切换" class="headerlink" title="2.2、模式间的切换"></a>2.2、模式间的切换</h3><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ba3485ec5bcca1155a82b3de904545ee.png" alt=""></p><p><strong>末行模式进入之后的特征：光标在最后一行上</strong></p><p><strong>编辑模式进入之后的特征：在最后一行有类似于“——插入（insert）—–”的提</strong></p><p>注意：<strong>末行模式和编辑模式之间是没有办法直接切换</strong>的，必须先走命令模式。</p><h3 id="2-3、末行模式"><a href="#2-3、末行模式" class="headerlink" title="2.3、末行模式"></a>2.3、末行模式</h3><p>进入方式：由命令模式进入，按下“:”或者“/（表示查找）”即可进入</p><p>退出方式：</p><p>a. 按下 esc</p><p>b. 连按 2 次 esc 键</p><p>c. 删除末行全部输入字符</p><p><strong>① 保存操作（write）</strong></p><p><strong>输入：“:w” 保存文件</strong></p><p>输入：“:w 路径” <strong>另存</strong>为 （了解）</p><p><strong>② 退出（quit）</strong></p><p>输入：“:q” 退出文件</p><p>默认情况下，退出的时候需要对已经进行修改的文件进行保存（:w），然后才能退出。</p><p><strong>③ 保存并退出</strong></p><p>输入：“:wq” 保存并且退出</p><p><strong>④ 强制 （!）</strong></p><p>输入：“:q!” 表示强制退出，刚才做的修改操作不做保存</p><p><strong>⑤ 搜索/查找</strong></p><p>输入：“<strong>/关键词</strong>”，再按下回车 【按下/也是进入末行模式的方式之一】</p><p>例如：想在 passwd 文件中搜索“sbin”关键词</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/0c7447a3a3b3e612ca8eb0d4e7cf6b2a.png" alt=""></p><p><strong>在搜索结果中切换上/下一个结果：N/n （next）</strong></p><p>如果需要取消高亮，则需要在末行模式中输入：“:nohl”【no highlight】</p><p><strong>⑥ 替换</strong></p><p>:s/搜索的关键词/新的内容 替换光标所在行的第一处符合条件的内容</p><p>:s/搜索的关键词/新的内容/g 替换光标所在行的全部符合条件的内容</p><p>:%s/搜索的关键词/新的内容 替换整个文档中每行第一个符合条件的内容</p><p>:%s/搜索的关键词/新的内容/g 替换整个文档的符合条件的内容</p><p>%表示整个文件</p><p>g 表示全局（global）</p><p>案例：将测试文件中的 bin 关键词全部替换成 xxxx</p><p>:%s/bin/xxxx/g</p><p>⑦ 显示行号（临时）</p><p>输入：“_:set nu_”[number]</p><p>如果想取消显示，则输入：“:set nonu”</p><p><strong>补充：要想永久显示行号，需要进行对 vim 的配置。</strong></p><p>建议创建文件：“~/.vimrc”（该配置是针对用户的，每个用户自己家下有一个独立.vimrc）</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ed78da02cde497b0780ffa64250c0f90.png" alt=""></p><p>⑧ 扩展：部分命令模式操作使用末行模式实现</p><p>了解：</p><p>末行模式下的复制（yy）、剪切（dd）、删除（dd）操作</p><p>复制语法：“:开始行号,结束行号 y”，例如输入“:1,10y”</p><p>剪切删除语法：“:开始行号,结束行号 d”，例如输入“:1,10d”</p><p>一步到位的复制语法——“:开始行号,结束行号 co 粘贴到的行号”</p><p>剪切粘贴一步到位语法——“:开始行号,结束行号 m 粘贴到的行号”</p><h3 id="2-4、编辑模式"><a href="#2-4、编辑模式" class="headerlink" title="2.4、编辑模式"></a>2.4、编辑模式</h3><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/e604fe89e64655e8b4572055ff90bbcc.png" alt=""></p><p>重点看前 2 个进入方式：i（insert）、a（after）。</p><p>退出方式：按下 esc 键</p><h3 id="3、vim-其他"><a href="#3、vim-其他" class="headerlink" title="3、vim 其他"></a>3、vim 其他</h3><h4 id="3-1、异常退出"><a href="#3-1、异常退出" class="headerlink" title="3.1、异常退出"></a>3.1、异常退出</h4><p>什么是异常退出：在编辑文件之后并没有正常的去 wq（保存退出），而是遇到突然关闭终端或者断电的情况，则会显示下面的效果，这个情况称之为异常退出：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/a0853563539f2a47b35bd3ab1d793cee.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/a1ba32270da81f36ef37a35f8d05d703.png" alt=""></p><p><strong>解决办法：删除“.文件名.swp”文件即可解决上述问题。</strong></p><h2 id="九、用户与用户组（重点）"><a href="#九、用户与用户组（重点）" class="headerlink" title="九、用户与用户组（重点）"></a>九、用户与用户组（重点）</h2><p>Linux 系统是一个<strong>多用户多任务</strong>的操作系统，任何一个要使用系统资源的用户，都必须首先向系统管理员申请一个账号，然后以这个账号的身份进入系统。</p><p>用户的账号一方面可以帮助系统管理员对使用系统的用户进行跟踪，并控制他们对系统资源的访问；另一方面也可以帮助用户组织文件，并为用户提供安全性保护。</p><p>每个用户账号都拥有一个唯一的用户名和各自的密码。</p><p>用户在登录时键入正确的用户名和密码后，就能够进入系统和自己的主目录。</p><p>要想实现用户账号的管理，要完成的工作主要有如下几个方面：</p><p>用户账号的添加、删除、修改以及用户密码的管理。</p><p>用户组的管理。</p><p><strong>注意三个文件：</strong></p><p>/etc/passwd 存储用户的关键信息</p><p>/etc/group 存储用户组的关键信息</p><p>/etc/shadow 存储用户的密码信息</p><h3 id="1、用户管理"><a href="#1、用户管理" class="headerlink" title="1、用户管理"></a>1、用户管理</h3><p>① 添加用户</p><p><strong>语法：#useradd 选项 用户名</strong></p><p>常用选项：</p><p>-g：表示指定用户的用户主（主要）组，选项的值可以是用户组的 id，也可以是组名</p><p>-G：表示指定用户的用户附加（额外）组，选项的值可以是用户组的 id，也可以是组名</p><p>-u：uid，用户的 id（用户的标识符），<strong>系统默认会从 500 之后按顺序分配 uid</strong>，如果不想使用系统分配的，可以通过该选项自定义【类似于腾讯 QQ 的自选靓号情况】</p><p>-c：comment，添加注释（选择是否添加）</p><p>-s：指定用户登入后所使用的<strong>shell 解释器</strong> 【专门的接待员】</p><p>-d：指定用户登入时的启始目录（家目录位置）</p><p>-n：取消建立以用户名称为名的群组（了解）</p><p>案例：创建用户 zhangsan，不带任何选项</p><p>#useradd zhangsan</p><p>验证是否成功：</p><p>a. 验证/etc/passwd 的最后一行，查看是否有 zhangsan 的信息；</p><p>#tail -1 /etc/passwd</p><p>b. 验证是否存在家目录（在 Centos 下创建好用户之后随之产生一个同名家目录）；</p><p>扩展：认识 passwd 文件</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/69a49b606aeadc149681c0147aaf705f.png" alt=""></p><p>用户名:密码:用户 ID:用户组 ID:注释:家目录:解释器 shell</p><p>用户名：创建新用户名称，后期登录的时候需要输入；</p><p>密码：此密码位置一般情况都是“x”，表示密码的占位；</p><p>用户 ID：用户的识别符；【-u】</p><p>用户组 ID：该用户所属的主组 ID；【-g】</p><p>注释：解释该用户是做什么用的；【-c】</p><p>家目录：用户登录进入系统之后默认的位置；【-d】</p><p>解释器 shell：等待用户进入系统之后，用户输入指令之后，该解释器会收集用户输入的指令，传递给内核处理；【如果解释器是/bin/bash 表示用户可以登录到系统，/sbin/nologin 表示该用户不能登录到系统】【-s】</p><p><strong>注意：在不添加选项的时候，执行 useradd 之后会执行一系列的操作</strong></p><p><strong>a. 创建同名的家目录；</strong></p><p><strong>b. 创建同名的用户组；</strong></p><p>案例：添加选项，创建用户 lisi，让 lisi 属于 501 主组，<strong>附加组 500</strong>，自选靓号 666，并且要求不能登录到系统，可以写注释为“user<br>lisi”。</p><p>#useradd -g 501 -G 500 -u 666 -s /sbin/nologin -c “user lisi” lisi</p><p>验证是否创建成功：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/fa7309aacdde79b7dca00e9b333a3963.png" alt=""></p><p>注意：查看用户的主组可以查看 passwd 文件，查看附加组可以查看 group 文件。</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/a6939ec7079585fd2928ac832620f3c1.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/9d39bd9ca48ecd30c3445ee12f79c889.png" alt=""></p><p>linux123 行的含义：在 linux123 的组里（组 id 是 500）有一个组内用户 lisi（lisi 的附加组就是 500，附加组的名字是 linux123）。</p><p>如果需要为一个用户指定多个附加组，只需要将多个附件组的 id 通过英文逗号“,”分割即可。</p><p>【主组只能有 1 个（类似于亲生父母只有一对），附加组可以多个，也可以没有附加组（类似于认干爹干妈，可以有也可以没有，也可以有多个）】</p><p>【主组必须有】</p><p>【文档的属组指的是主组】</p><p>② 修改用户</p><p><strong>语法：#usermod 选项 用户名</strong></p><p>Usermod：user modify，用户修改</p><p>常用选项：</p><p>-g：表示指定用户的用户主组，选项的值可以是用户组的 id，也可以是组名</p><p>-G：表示指定用户的用户附加组，选项的值可以是用户组的 id，也可以是组名</p><p>-u：uid，用户的 id（用户的标识符），<strong>系统默认会从 500 之后按顺序分配 uid</strong>，如果不想使用系统分配的，可以通过该选项自定义【类似于腾讯 QQ 的自选靓号情况】</p><p><strong>-l：修改用户名</strong></p><p>-c&lt;备注&gt;：修改用户帐号的备注文字</p><p>-d&lt;登入目录&gt;：修改用户登入时的目录</p><p>-s&lt;shell&gt;：修改用户登入后所使用的 shell</p><p>案例：修改 zhangsan 用户主组为 500，附加组改为 501</p><p>#usermod -g 500 -G 501 zhangsan</p><p>案例：修改 zhangsan 用户用户名，改为 wangerma</p><p>#usermod -l wangerma zhangsan</p><p>③ 设置密码</p><p>Linux 不允许没有密码的用户登录到系统，因此前面创建的用户目前都处于锁定状态，需要设置密码之后才能登录计算机。</p><p><strong>语法：#passwd [用户名] 【如果不指定用户名则修改自己的密码】</strong></p><p>案例：设置 wangerma 用户的密码</p><p>#passwd wangerma</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/293fe615752d4950b599fa96cf85d380.png" alt=""></p><p>在设置密码的时候也是没有任何输入提示的，放心输入，确保两次输入的密码一致，按下回车即可。</p><p>也可以使用弱密码，但是不建议，否则会看到以下的提示：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/2d59f340821673ce40b54e26b2153777.png" alt=""></p><p>设置密码之后 shadow 文件中的体现：能够看出 lisi 用户没有密码的。</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/1605ede610e3d0560e621273d437f470.png" alt=""></p><p>在设置用户密码之后可以登录帐号，例如此处需要登录 wangerma</p><p>切换用户命令：#su [用户名] （switch user）</p><p>如果用户名不指定则表示切换到 root 用户。</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/142cc7aeed00a6bd609f70d6e16616e4.png" alt=""></p><p>切换用户需要注意的事项：</p><p>a. 从 root 往普通用户切换不需要密码，但是反之则需要 root 密码；</p><p>b. 切换用户之后前后的工作路径是不变的；</p><p>c. 普通用户没有办法访问 root 用户家目录，但是反之则可以；</p><p>④ 删除用户</p><p>语法：#userdel 选项 用户名</p><p>Userdel：user delete（用户删除）</p><p>常用选项：</p><p>-r：表示删除用户的同时，删除其家目录；</p><p>案例：删除 wangerma 用户</p><p>#userdel -r wangerma</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/a6a44b608ab76adefd495cdc910ffb48.png" alt=""></p><p><strong>注意：已经登录的 wangerma 用户删除的时候提示删除失败，但是没有登录的 lisi 用户可以正常删除</strong>。</p><p>解决办法：简单粗暴，kill 对应用户的全部进程</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/02f40d92101f3e3b606fd92c682aefe7.png" alt=""></p><p><strong>提示：所有跟用户操作的命令（除 passwd 外，只能修改自己的密码，即不指定用户名）只有 root 超级管理员有权限执行。</strong></p><p><strong>备注：也可以在登录需要删除的用户之后，按下快捷键“ctrl+d”进行对当前用户的注销，随后退回到上一个用户（root）此时就可以对需要删除的用户进行删除操作。</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/63d25b8b6f1c3f2636e26109ed6a5384.png" alt=""></p><h3 id="2、用户组管理"><a href="#2、用户组管理" class="headerlink" title="2、用户组管理"></a>2、用户组管理</h3><p>每个用户都有一个用户组，系统可以对一个用户组中的所有用户进行集中管理。不同 Linux<br>系统对用户组的规定有所不同，如 Linux 下的用户属于与它同名的用户组，<strong>这个用户组在创建用户时同时创建</strong>。</p><p>用户组的管理涉及用户组的<strong>添加、删除和修改</strong>。组的增加、删除和修改实际上就是对/etc/group 文件的更新。</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/f5288b73b1e8dd23f421cde6d2cae653.png" alt=""></p><p>文件结构：</p><p><strong>用户组名:密码:用户组 ID:组内用户名</strong></p><p>密码：X 表示占位符，虽然用户组可以设置密码，但是绝大部分的情况下不设置密码；</p><p>组内用户名：表示附加组是该组的用户名称；</p><p>① 用户组添加</p><p><strong>语法：#groupadd 选项 用户组名</strong></p><p>常用选项：</p><p>-g：类似用户添加里的“-u”，-g 表示选择自己设置一个自定义的用户组 ID 数字，如果自己不指定，则默认从 500 之后递增；</p><p>案例：使用 groupadd 指令创建一个新的用户组，命名为 admins</p><p>#groupadd admins</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/0cfb2817f392d54d9beed14c936c5cbf.png" alt=""></p><p>② 用户组编辑</p><p><strong>语法：#groupmod 选项 用户组名</strong></p><p>常用选项：</p><p>-g：类似用户修改里的“-u”，-g 表示选择自己设置一个自定义的用户组 ID 数字</p><p>-n：类似于用户修改“-l”，表示设置新的用户组的名称</p><p>案例：修改 admins 用户组，将组 ID 改成 520，将名称改为 admin123</p><p>#groupmod -g 520 -n admin123 admins</p><p>③ 用户组删除</p><p><strong>语法：#groupdel 用户组名</strong></p><p>案例：删除 admin 组</p><p>#groupdel admin</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/c0a6cde09b2832a7fdeb84ad8d89c454.png" alt=""></p><p>注意：当如果需要删除一个组，但是这个组是某个用户的主组时，则不允许删除（附加组是可以的）；如果确实需要删除，则先从组内移出所有用户。</p><p>提示</p><p>针对用户和用户组的管理指令，除了 passwd 指令之外，其他指令一般情况下只有 root 用户可以执行。</p><h2 id="十、权限管理"><a href="#十、权限管理" class="headerlink" title="十、权限管理"></a>十、权限管理</h2><h3 id="1、权限介绍（重点）"><a href="#1、权限介绍（重点）" class="headerlink" title="1、权限介绍（重点）"></a>1、权限介绍（重点）</h3><p>在 Linux 中分别有<strong>读、写、执行</strong>权限：</p><p>读权限：</p><p>对于文件夹来说，读权限影响用户是否能够列出目录结构</p><p>对于文件来说，读权限影响用户是否可以查看文件内容</p><p>写权限：</p><p>对文件夹来说，写权限影响用户是否可以在文件夹下“创建/删除/复制到/移动到”文档</p><p>对于文件来说，写权限影响用户是否可以编辑文件内容</p><p>执行权限：</p><p>一般都是对于文件来说，特别脚本文件。</p><p>对于文件来说，执行权限影响文件是否可以运行。</p><p>对于文件夹来说，执行权限影响对应的用户是否可以在文件夹内执行指令。</p><h3 id="2、身份介绍（重点）"><a href="#2、身份介绍（重点）" class="headerlink" title="2、身份介绍（重点）"></a>2、身份介绍（重点）</h3><h4 id="Owner-身份（文件所有者，默认为文档的创建者）"><a href="#Owner-身份（文件所有者，默认为文档的创建者）" class="headerlink" title="Owner 身份（文件所有者，默认为文档的创建者）"></a>Owner 身份（文件所有者，默认为文档的创建者）</h4><p>由于 Linux 是多用户、多任务的操作系统，因此可能常常有多人同时在某台主机上工作，但每个人均可在主机上设置文件的权限，让其成为个人的“私密文件”，即个人所有者。因为设置了适当的文件权限，除本人（文件所有者）之外的用户无法查看文件内容。</p><p>例如某个 MM 给你发了一封 Email 情书，你将情书转为文件之后存档在自己的主文件夹中。为了不让别人看到情书的内容，你就能利用所有者的身份去设置文件的适当权限，这样，即使你的情敌想偷看你的情书内容也是做不到的。</p><h4 id="Group-身份（与文件所有者同组的用户）"><a href="#Group-身份（与文件所有者同组的用户）" class="headerlink" title="Group 身份（与文件所有者同组的用户）"></a>Group 身份（与文件所有者同组的用户）</h4><p>与文件所有者同组最有用的功能就体现在<strong>多个团队在同一台主机上开发资源的时候</strong>。例如主机上有 A、B 两个团体（用户组），A 中有 a1,a2,a3 三个成员，B 中有 b1,b2 两个成员，这两个团体要共同完成一份报告 F。由于设置了适当的权限，A、B 团体中的成员都能互相修改对方的数据，但是团体 C 的成员则不能修改 F 的内容，甚至连查看的权限都没有。同时，团体的成员也能设置自己的私密文件，让团队的其它成员也读取不了文件数据。<strong>在 Linux 中，每个账户支持多个用户组。如用户 a1、b1 即可属于 A 用户组，也能属于 B 用户组【主组和附加组】</strong>。</p><h4 id="Others-身份（其他人，相对于所有者与同组用户）"><a href="#Others-身份（其他人，相对于所有者与同组用户）" class="headerlink" title="Others 身份（其他人，相对于所有者与同组用户）"></a>Others 身份（其他人，相对于所有者与同组用户）</h4><p>这个是个相对概念。打个比方，大明、二明、小明一家三兄弟住在一间房，房产证上的登记者是大明（owner 所有者），那么，大明一家就是一个用户组，这个组有大明、二明、小明三个成员；另外有个人叫张三，和他们三没有关系，那么这个张三就是其他人（others）了。</p><p>同时，大明、二明、小明有各自的房间，三者虽然能自由进出各自的房间，但是小明不能让大明看到自己的情书、日记等，这就是文件所有者（用户）的意义。</p><h4 id="Root-用户（超级用户）"><a href="#Root-用户（超级用户）" class="headerlink" title="Root 用户（超级用户）"></a>Root 用户（超级用户）</h4><p>在 Linux 中，还有一个神一样存在的用户，这就是 root 用户，因为在所有用户中它拥有最大的权限<br>，所以管理着普通用户。因此以后在设置文档的权限的时候不必考虑 root 用户。</p><h3 id="3、Linux-的权限查看"><a href="#3、Linux-的权限查看" class="headerlink" title="3、Linux 的权限查看"></a>3、Linux 的权限查看</h3><p>要设置权限，就需要知道文件的一些基本属性和权限的分配规则。在 Linux 中，ls 命令常用来查看文档的属性，用于显示文件的文件名和相关属性。</p><p>#ls -l 路径 【ls -l 等价于 ll】</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/a3b303078e4de1bf16905b52cd110343.png" alt=""></p><p>标红的部分就是 Linux 的文档权限属性信息。</p><p><strong>Linux 中存在用户（owner）、用户组（group）和其他人（others）概念</strong>，各自有不同的权限，对于一个文档来说，其权限具体分配如下：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ef471ff7574d72a6dabc26b5c9fa6f51.png" alt="bVk3s0"></p><p>十位字符表示含义：</p><p>第 1 位：表示文档类型，取值常见的有“d 表示文件夹”、“-表示文件”、“l 表示软连接”、“s 表示套接字”、“c 表示字符设备”、“b 表示块状设备”等等；</p><p>第 2-4 位：表示文档所有者的权限情况，第 2 位表示读权限的情况，取值有 r、-；第 3 位表示写权限的情况，w 表示可写，-表示不可写，第 4 位表示执行权限的情况，取值有 x、-。</p><p>第 5-7 位：表示与所有者同在一个组的用户的权限情况，第 5 位表示读权限的情况，取值有 r、-；第 6 位表示写权限的情况，w 表示可写，-表示不可写，第 7 位表示执行权限的情况，取值有 x、-。</p><p>第 8-10 位：表示除了上面的前 2 部分的用户之外的其他用户的权限情况，第 8 位表示读权限的情况，取值有 r、-；第 9 位表示写权限的情况，w 表示可写，-表示不可写，第 10 位表示执行权限的情况，取值有 x、-。</p><p><strong>注意：除了权限位上的 rwx 以及-之外，还有一些特殊的权限代码“s”、“t”，这些不在本次考虑范围内。</strong></p><p>权限分配中,均是 rwx 的三个参数组合，<strong>且位置顺序不会变化</strong>。没有对应权限就用 –<br>代替。</p><h3 id="4、权限设置（重点）"><a href="#4、权限设置（重点）" class="headerlink" title="4、权限设置（重点）"></a>4、权限设置（重点）</h3><p><strong>语法：#chmod [选项] 权限模式 文档</strong></p><p>注意事项：</p><p>常用选项：</p><p>-R：递归设置权限 （当文档类型为文件夹的时候）</p><p>权限模式：就是该文档需要设置的权限信息</p><p>文档：可以是文件，也可以是文件夹，可以是相对路径也可以是绝对路径。</p><p><strong>注意点：如果想要给文档设置权限，操作者要么是 root 用户，要么就是文档的所有者。</strong></p><h3 id="4-1、字母形式"><a href="#4-1、字母形式" class="headerlink" title="4.1、字母形式"></a>4.1、字母形式</h3><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/4489bc17d3c2d3213ddabf222ade7e74.png" alt=""></p><p>给谁设置：</p><p>u：表示所有者身份 owner（user）</p><p>g：表示给所有者同组用户设置（group）</p><p>o：表示 others，给其他用户设置权限</p><p>a：表示 all，给所有人（包含 ugo 部分）设置权限</p><p><strong>如果在设置权限的时候不指定给谁设置，则默认给所有用户设置</strong></p><p>权限字符：</p><p>r：读</p><p>w：写</p><p>x：表示执行</p><p>-：表示没有权限</p><p>权限分配方式：</p><p>+：表示给具体的用户新增权限（相对当前）</p><p>-：表示删除用户的权限（相对当前）</p><p>=：表示将权限设置成具体的值（注重结果）【赋值】</p><p><strong>设置多个身份的权限时候，每个身份之间需要通过英文逗号分开。</strong></p><p><strong>例如：需要给/root/anaconda-ks.cfg 文件（-rw——-.）设置权限，要求所有者拥有全部的权限，同组用户拥有读和写权限，其他用户只读权限。</strong></p><p>答案：</p><p>所有者（u）：rwx</p><p>同组用户（g）：rw</p><p>其他用户（o）：r</p><p>方式 1：</p><p>#chmod u=rwx,g=rw,o=r /root/anaconda-ks.cfg</p><p>方式 2：</p><p>#chmod u+x,g+rw,o+r /root/anaconda-ks.cfg</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/4ef289c244d7babd72985b7f56de8286.png" alt=""></p><p><strong>提示：当文档拥有执行权限（任意部分），则其颜色在终端中是绿色。</strong></p><p>#chmod ug=rwx 形式，如果有两部分权限一样则可以合在一起写的</p><p>等价于：</p><p>#chmod u=rwx,g=rwx</p><p><strong>例如：如果 anaconda-ks.cfg 文件什么权限都没有，可以使用 root 用户设置所有的人都有执行权限，则可以写成</strong></p><p><strong>什么权限都没有应该是：———-</strong></p><p><strong>目标的效果：—x–x–x</strong></p><p><strong>#chmod a=x anaconda-ks.cfg</strong></p><p><strong>#chmod a+x anaconda-ks.cfg</strong></p><p><strong>#chmod u+x,g+x,o+x anaconda-ks.cfg</strong></p><p><strong>#chmod ugo=x anaconda-ks.cfg</strong></p><p><strong>#chmod ugo+x anaconda-ks.cfg</strong></p><p><strong>#chmod +x anaconda-ks.cfg</strong></p><p><strong>案例：设置文件“~/yunwei/yunwei.txt”权限，要求所有者全部权限，同组用户拥有读权限、写权限，其他人拥有读权限</strong></p><p>#chmod u=rwx,g=rw,o=r ~/yunwei/yunwei.txt</p><p><strong>更改要求：所有者全部权限，同组用户拥有读权限、写权限，其他人拥有读权限、写权限</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/b2bf39d199b22b4c47f6487d76ead049.png" alt=""></p><p><strong>练习：</strong></p><p><strong>① 设置文件夹/tmp/yunwei 的权限（如果文件夹不存在，自行创建），要求权限为递归权限，并且所有者有全部权限，同组用户有读执行权限，其他用户只读权限；</strong></p><p><strong>② 设置文件/tmp/yunwei/class04.sh 权限，文件如果不存在则自行创建，要求权限为所有者全部权限，同组用户读和执行权限，其他用户没有权限；</strong></p><p><strong>③ 使用普通用户在/tmp/yunwei 目录下创建 test 目录，设置目录权限为所有者拥有全部权限，同组用户只读，其他用户只读；</strong></p><h3 id="4-2、数字形式"><a href="#4-2、数字形式" class="headerlink" title="4.2、数字形式"></a>4.2、数字形式</h3><p>经常会在一些技术性的网页上看到类似于<strong>#chmod 777 a.txt</strong><br>这样的一个权限，这种形式称之为数字形式权限（777）。</p><p><strong>读：r 4</strong></p><p><strong>写：w 2</strong></p><p><strong>执行：x 1</strong></p><p>没有任何权限（-）：0</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/15c08f5b800cddc1d87b821df3d2498d.png" alt=""></p><p>例如：需要给 anaconda-ks.cfg 设置权限，权限要求所有者拥有全部权限，同组用户拥有读执行权限，其他用户只读。</p><p><strong>分析：</strong></p><p><strong>所有者：全部权限 = 读 + 写 + 执行 = 4 + 2 + 1 = 7</strong></p><p><strong>同组用户：读执行权限 = 读 + 执行 = 4 + 1 = 5</strong></p><p><strong>其他用户：只读权限 = 读 = 4</strong></p><p>最终得出的结果是 754</p><p>#chmod 754 anaconda-ks.cfg</p><p><strong>面试题：用超级管理员设置文档的权限命令是#chmod -R 731<br>aaa，请问这个命令有没有什么不合理的地方？</strong></p><p>所有者 = 7 = 4 + 2 + 1 = 读 + 写 + 执行</p><p>同组用户 = 3 = 2 + 1 = 写 + 执行</p><p>其他用户 = 1 = 执行</p><p>问题在权限 731 中 3 表示写+执行权限，但是写又不必须需要能打开之后才可以写，因此必须需要具备读权限，因此权限不合理。以后建议各位在设置权限的时候不要设置这种“奇葩权限”。单独出现 2、3 的权限数字一般都是有问题的权限</p><p>注意：在写权限的时候千万不要设置类似于上面的这种“奇葩权限”。如果一个权限数字中但凡出现 2 与 3 的数字，则该权限有不合理的情况。</p><p>练习：</p><p>① 使用 root 用户设置文件夹/root/20180811 的权限为：所有者全部权限，同组用户拥有读和执行权限，其他用户没有权限，请使用数字权限的形式设置，写出指令；750</p><p>② 请使用 root 用户写出设置文件/root/20180811.txt 文件的权限，权限要求为：所有者拥有全部权限，同组用户要求可以读写，其他用户只读，要求使用数字形式；764</p><p>③ 张三疯（root）收到某个 MM 的情书，请使用数字形式设置张三疯的 Email 情书权限（文件为/root/email.doc），权限要求只有所有者可以读写，除此之外任何人没有权限；600</p><h3 id="4-3、注意事项"><a href="#4-3、注意事项" class="headerlink" title="4.3、注意事项"></a>4.3、注意事项</h3><p>使用 root 用户创建一个文件夹（/oo），权限默认，权限如下：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8fbf5b78821018cdca91c5feb6ca04de.png" alt=""></p><p>需要在 oo 目录下创建文件（oo/xx.txt），需要给 777 权限：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/398a5ba4cac6728af11b42f699df23ed.png" alt=""></p><p>扩展：</p><p>在 Linux 系统中，创建文档的权限有一个默认值，以当前的系统为例，其创建文件夹之后的默认权限是 755，创建文件之后的权限是 644。</p><p>之所以会这样是受到了系统中 umask（掩码）的值的影响，其是用于指定文档创建好之后的权限，umask 默认为 022。</p><p>计算方式：</p><p>对于文件：文件的权限 = 666 – umask 掩码</p><p>对于文件夹：文件夹的权限 = 777 - umask 掩码</p><p>切换到 linux123 用户（不是文档所有者，也不是同组用户，属于 other 部分）：</p><p>问题 1：linux123 用户是否可以打开 oo/xx.txt 文件？</p><p>问题 2：linux123 用户是否可以编辑 oo/xx.txt 文件？</p><p>问题 3：linux123 用户是否可以删除 oo/xx.txt 文件？</p><p><strong>在 Linux 中，如果要删除一个文件，不是看文件有没有对应的权限，而是看文件所在的目录是否有写权限，如果有才可以删除</strong>。</p><h3 id="5、属主与属组"><a href="#5、属主与属组" class="headerlink" title="5、属主与属组"></a>5、属主与属组</h3><p>属主：所属的用户（文件的主人），文档所有者</p><p>属组：所属的用户组（同组用户的组名称）</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/2611388ec54e6dc667bf51a501fbb035.png" alt=""></p><p><strong>前面的那个 root 就是属主</strong></p><p><strong>后面的那个 root 就是属组</strong></p><p>这两项信息在文档创建的时候<strong>会使用创建者</strong>的信息（用户名、用户所属的主组名称）。</p><p><strong>之所以需要设置这个：如果有时候去删除某个用户，则该用户对应的文档的属主和属组信息就需要去修改（类似离职之前的工作交接）。</strong></p><h4 id="5-1、chown（重点）"><a href="#5-1、chown（重点）" class="headerlink" title="5.1、chown（重点）"></a>5.1、chown（重点）</h4><p><strong>作用：更改文档的所属用户（change owner）</strong></p><p><strong>语法：#chown [-R] 新的 username 文档路径</strong></p><p>案例：将先前设置的/oo 目录的所有者设置成成 linux123</p><p>#chown -R linux123 /oo</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/93c9fc3925f81de942846f550a64f57f.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/fa4bddcd1c58f60d733d98753ebf2386.png" alt=""></p><h4 id="5-2、chgrp（了解）"><a href="#5-2、chgrp（了解）" class="headerlink" title="5.2、chgrp（了解）"></a>5.2、chgrp（了解）</h4><p><strong>作用：更改文档的所属用户组（change group）</strong></p><p>语法：#chgrp [-R] groupname 文档的路径</p><p>案例：将刚才 oo 目录的所有用户组名改为 linux123</p><p>#chgrp -R linux123 /oo</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/9fa490dd60a6579eda14b36c16cb0f36.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/2628385d86058698b33569646a6c1afc.png" alt=""></p><p><strong>思考，如何通过一个命令实现既可以更改所属的用户，也可以修改所属的用户组呢？</strong></p><p>答：可以实现的，通过 chown 命令</p><p>语法：#chown [-R] username:groupname 文档路径</p><p>案例：将刚才 oo 的文档的所属组所属用户修改为 root</p><p>#chown -R root:root /oo</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/dd99d557f7b3c805cfae66ba997cd335.png" alt=""></p><p><strong>问题：zhangsan 用户使用自己的帐号创建文件 index.html，并且当时默认的权限是 644，后续管理员 root 将该文件的属主改成了 lisi，属组改成 lisi，则 zhangsan 对文件的操作权限有变化吗？如果有权限是多少？</strong></p><h2 id="十一、权限管理"><a href="#十一、权限管理" class="headerlink" title="十一、权限管理"></a>十一、权限管理</h2><h3 id="1、权限介绍（重点）-1"><a href="#1、权限介绍（重点）-1" class="headerlink" title="1、权限介绍（重点）"></a>1、权限介绍（重点）</h3><p>在 Linux 中分别有<strong>读、写、执行</strong>权限：</p><p>读权限：</p><p>对于文件夹来说，读权限影响用户是否能够列出目录结构</p><p>对于文件来说，读权限影响用户是否可以查看文件内容</p><p>写权限：</p><p>对文件夹来说，写权限影响用户是否可以在文件夹下“创建/删除/复制到/移动到”文档</p><p>对于文件来说，写权限影响用户是否可以编辑文件内容</p><p>执行权限：</p><p>一般都是对于文件来说，特别脚本文件。</p><p>对于文件来说，执行权限影响文件是否可以运行。</p><p>对于文件夹来说，执行权限影响对应的用户是否可以在文件夹内执行指令。</p><h3 id="2、身份介绍（重点）-1"><a href="#2、身份介绍（重点）-1" class="headerlink" title="2、身份介绍（重点）"></a>2、身份介绍（重点）</h3><h4 id="Owner-身份（文档所有者，默认为文档的创建者）"><a href="#Owner-身份（文档所有者，默认为文档的创建者）" class="headerlink" title="Owner 身份（文档所有者，默认为文档的创建者）"></a>Owner 身份（文档所有者，默认为文档的创建者）</h4><p>由于 Linux 是多用户、多任务的操作系统，因此可能常常有多人同时在某台主机上工作，但每个人均可在主机上设置文件的权限，让其成为个人的“私密文件”，即个人所有者。因为设置了适当的文件权限，除本人（文件所有者）之外的用户无法查看文件内容。</p><p>例如某个 MM 给你发了一封 Email 情书，你将情书转为文件之后存档在自己的主文件夹中。为了不让别人看到情书的内容，你就能利用所有者的身份去设置文件的适当权限，这样，即使你的情敌想偷看你的情书内容也是做不到的。</p><h4 id="Group-身份（与文件所有者同组的用户）-1"><a href="#Group-身份（与文件所有者同组的用户）-1" class="headerlink" title="Group 身份（与文件所有者同组的用户）"></a>Group 身份（与文件所有者同组的用户）</h4><p>与文件所有者同组最有用的功能就体现在<strong>多个团队在同一台主机上开发资源的时候</strong>。例如主机上有 A、B 两个团体（用户组），A 中有 a1,a2,a3 三个成员，B 中有 b1,b2 两个成员，这两个团体要共同完成一份报告 F。由于设置了适当的权限，A、B 团体中的成员都能互相修改对方的数据，但是团体 C 的成员则不能修改 F 的内容，甚至连查看的权限都没有。同时，团体的成员也能设置自己的私密文件，让团队的其它成员也读取不了文件数据。<strong>在 Linux 中，每个账户支持多个用户组。如用户 a1、b1 即可属于 A 用户组，也能属于 B 用户组【主组和附加组】</strong>。</p><h4 id="Others-身份（其他人，相对于所有者与同组用户）-1"><a href="#Others-身份（其他人，相对于所有者与同组用户）-1" class="headerlink" title="Others 身份（其他人，相对于所有者与同组用户）"></a>Others 身份（其他人，相对于所有者与同组用户）</h4><p>这个是个相对概念。打个比方，大明、二明、小明一家三兄弟住在一间房，房产证上的登记者是大明（owner 所有者），那么，大明一家就 ��� 一个用户组，这个组有大明、二明、小明三个成员；另外有个人叫张三，和他们三没有关系，那么这个张三就是其他人（others）了。</p><p>同时，大明、二明、小明有各自的房间，三者虽然能自由进出各自的房间，但是小明不能让大明看到自己的情书、日记等，这就是文件所有者（用户）的意义。</p><h4 id="Root-用户（超级用户）-1"><a href="#Root-用户（超级用户）-1" class="headerlink" title="Root 用户（超级用户）"></a>Root 用户（超级用户）</h4><p>在 Linux 中，还有一个神一样存在的用户，这就是 root 用户，因为在所有用户中它拥有最大的权限<br>，所以管理着普通用户。因此以后在设置文档的权限的时候不必考虑 root 用户。</p><h3 id="3、Linux-的权限查看-1"><a href="#3、Linux-的权限查看-1" class="headerlink" title="3、Linux 的权限查看"></a>3、Linux 的权限查看</h3><p>要设置权限，就需要知道文件的一些基本属性和权限的分配规则。在 Linux 中，ls 命令常用来查看文档的属性，用于显示文件的文件名和相关属性。</p><p>#ls -l 路径 【ls -l 等价于 ll】</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/a3b303078e4de1bf16905b52cd110343.png" alt=""></p><p>标红的部分就是 Linux 的文档权限属性信息。</p><p><strong>Linux 中存在用户（owner）、用户组（group）和其他人（others）概念</strong>，各自有不同的权限，对于一个文档来说，其权限具体分配如下：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ef471ff7574d72a6dabc26b5c9fa6f51.png" alt="bVk3s0"></p><p>十位字符表示含义：</p><p>第 1 位：表示文档类型，取值常见的有“d 表示文件夹”、“-表示文件”、“l 表示软连接”、“s 表示套接字”、“c 表示字符设备”、“b 表示块状设备”等等；</p><p>第 2-4 位：表示文档所有者的权限情况，第 2 位表示读权限的情况，取值有 r、-；第 3 位表示写权限的情况，w 表示可写，-表示不可写，第 4 位表示执行权限的情况，取值有 x、-。</p><p>第 5-7 位：表示与所有者同在一个组的用户的权限情况，第 5 位表示读权限的情况，取值有 r、-；第 6 位表示写权限的情况，w 表示可写，-表示不可写，第 7 位表示执行权限的情况，取值有 x、-。</p><p>第 8-10 位：表示除了上面的前 2 部分的用户之外的其他用户的权限情况，第 8 位表示读权限的情况，取值有 r、-；第 9 位表示写权限的情况，w 表示可写，-表示不可写，第 10 位表示执行权限的情况，取值有 x、-。</p><p><strong>注意：除了权限位上的 rwx 以及-之外，还有一些特殊的权限代码“s”、“t”，这些不在本次考虑范围内。（黏贴位，特殊权限位）</strong></p><p>权限分配中,均是 rwx 的三个参数组合，<strong>且位置顺序不会变化</strong>。没有对应权限就用 –<br>代替。</p><h3 id="4、权限设置（重点）-1"><a href="#4、权限设置（重点）-1" class="headerlink" title="4、权限设置（重点）"></a>4、权限设置（重点）</h3><p><strong>语法：#chmod [选项] 权限模式 文档路径</strong></p><p>注意事项：</p><p>常用选项：</p><p>-R：递归设置权限 （<strong>当文档类型为文件夹的时候</strong>）</p><p>权限模式：就是该文档需要设置的权限信息</p><p>文档：可以是文件，也可以是文件夹，可以是相对路径也可以是绝对路径。</p><p><strong>注意点：如果想要给文档设置权限，操作者要么是 root 用户，要么就是文档的所有者。</strong></p><h4 id="4-1、字母形式-1"><a href="#4-1、字母形式-1" class="headerlink" title="4.1、字母形式"></a>4.1、字母形式</h4><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/4489bc17d3c2d3213ddabf222ade7e74.png" alt=""></p><p>给谁设置：</p><p>u：表示所有者身份 owner（user）</p><p>g：表示给所有者同组用户设置（group）</p><p>o：表示 others，给其他用户设置权限</p><p>a：表示 all，给所有人（包含 ugo 部分）设置权限</p><p><strong>如果在设置权限的时候不指定给谁设置，则默认给所有用户设置</strong></p><p>什么权限-权限字符：</p><p>r：读</p><p>w：写</p><p>x：表示执行</p><p>-：表示没有权限</p><p>如何设置-权限分配方式：</p><p>+：表示给具体的用户新增权限（相对当前）</p><p>-：表示删除用户的权限（相对当前）</p><p>=：表示将权限设置成具体的值（注重结果）【赋值】</p><p><strong>设置多个身份的权限时候，每个身份之间需要通过英文逗号分开。</strong></p><p><strong>例如：需要给/root/anaconda-ks.cfg 文件（-rw——-.）设置权限，要求所有者拥有全部的权限，同组用户拥有读和写权限，其他用户只读权限。</strong></p><p>答案：</p><p>#chmod u+x,g+rw,o+r /root/anaconda-ks.cfg</p><p>或者：</p><p>#chmod u=rwx,g=rw,o=r /root/anaconda-ks.cfg</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/f2b12b5660109c0889e0579c9dd3d4c5.png" alt=""></p><p><strong>提示：当文档拥有执行权限（任意部分），则其颜色在终端中是绿色。</strong></p><p>#chmod ug=rwx 形式，如果有两部分权限一样则可以合在一起写的</p><p>等价于：</p><p>#chmod u=rwx,g=rwx</p><p><strong>例如：如果 anaconda-ks.cfg 文件什么权限都没有，可以使用 root 用户设置所有的人都有执行权限，则可以写成</strong></p><p><strong>什么权限都没有应该是：———-</strong></p><p><strong>目标的效果：—x–x–x</strong></p><p><strong>#chmod a=x anaconda-ks.cfg</strong></p><p><strong>#chmod a+x anaconda-ks.cfg</strong></p><p><strong>#chmod u+x,g+x,o+x anaconda-ks.cfg</strong></p><p><strong>#chmod ugo=x anaconda-ks.cfg</strong></p><p><strong>#chmod ugo+x anaconda-ks.cfg</strong></p><p><strong>#chmod +x anaconda-ks.cfg</strong></p><p><strong>案例：设置文件“~/php/php.txt”权限，要求所有者全部权限，同组用户拥有读权限、写权限，其他人拥有读权限</strong></p><p>#chmod u=rwx,g=rw,o=r <strong>~/php/php.txt</strong></p><p><strong>更改要求：所有者全部权限，同组用户拥有读权限、写权限，其他人拥有读权限、写权限</strong></p><p>#chmod o+w <strong>~/php/php.txt</strong></p><p><strong>练习：</strong></p><p><strong>① 设置文件夹/tmp/php 的权限（如果文件夹不存在，自行创建），要求权限为递归权限，并且所有者有全部权限，同组用户有读执行权限，其他用户只读权限；</strong></p><p><strong>#mkdir /tmp/php</strong></p><p><strong>#chmod -R u=rwx,g=rx,o=r /tmp/php</strong></p><p><strong>② 设置文件/tmp/php/class.sh 权限，文件如果不存在则自行创建，要求权限为所有者全部权限，同组用户读和执行权限，其他用户没有权限；</strong></p><p><strong>#touch /tmp/php/class.sh</strong></p><p><strong>#chmod u=rwx,g=rx,o=— /tmp/php/class.sh</strong></p><p><strong>③ 使用普通用户在/tmp/php 目录下创建 test 目录，设置目录权限为所有者拥有全部权限，同组用户只读，其他用户只读；（创建不了 test 用户）</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/e5bc7b77a2a0f1e13ec4c05bfa57036c.png" alt=""></p><h4 id="4-2、数字形式-1"><a href="#4-2、数字形式-1" class="headerlink" title="4.2、数字形式"></a>4.2、数字形式</h4><p>经常会在一些技术性的网页上看到类似于<strong>#chmod 777 a.txt</strong><br>这样的一个权限，这种形式称之为数字形式权限（777）。</p><p><strong>读：r 4</strong></p><p><strong>写：w 2</strong></p><p><strong>执行：x 1</strong></p><p>没有任何权限（-）：0</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/15c08f5b800cddc1d87b821df3d2498d.png" alt=""></p><p><strong>组合权限数字的时候遵循，最短路径要求，并且最多只能出现一次。</strong></p><p>例如：需要给 anaconda-ks.cfg 设置权限，权限要求所有者拥有全部权限，同组用户拥有读执行权限，其他用户只读。</p><p><strong>分析：</strong></p><p><strong>所有者（第 1 位）：全部权限 = 读 + 写 + 执行 = 4 + 2 + 1 = 7</strong></p><p><strong>同组用户（第 2 位）：读执行 = 读 + 执行 = 4 + 1 = 5</strong></p><p><strong>其他用户（第 3 位）：读 = 4</strong></p><p><strong>组合： 754</strong></p><p>最终得出的结果是 754</p><p>#chmod 754 anaconda-ks.cfg</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ed1235abb00cc583e92aeee274f703f0.png" alt=""></p><p><strong>面试题：用超级管理员设置文档的权限命令是#chmod -R 731<br>aaa，请问这个命令有没有什么不合理的地方？</strong></p><p>所有者 = 7 = 4 + 2 + 1 = 读 + 写 + 执行</p><p>同组用户 = 3 = 2 + 1 = 写 + 执行</p><p>其他用户 = 1 = 执行</p><p>问题在权限 731 中 3 表示写+执行权限，但是写又不必须需要能打开之后才可以写，因此必须需要具备读权限，因此权限不合理。以后建议各位在设置权限的时候不要设置这种“奇葩权限”。单独出现 2、3 的权限数字一般都是有问题的权限</p><p>注意：在写权限的时候千万不要设置类似于上面的这种“奇葩权限”。如果一个权限数字中但凡出现 2 与 3 的数字，则该权限有不合理的情况。</p><p>练习：</p><p>① 使用 root 用户设置文件夹/root/20180811 的权限为：所有者全部权限，同组用户拥有读和执行权限，其他用户没有权限，请使用数字权限的形式设置，写出指令；750</p><p>② 请使用 root 用户写出设置文件/root/20180811.txt 文件的权限，权限要求为：所有者拥有全部权限，同组用户要求可以读写，其他用户只读，要求使用数字形式；764</p><p>③ 张三疯（root）收到某个 MM 的情书，请使用数字形式设置张三疯的 Email 情书权限（文件为/root/email.doc），权限要求只有所有者可以读写，除此之外任何人没有权限；600</p><h4 id="4-3、注意事项-1"><a href="#4-3、注意事项-1" class="headerlink" title="4.3、注意事项"></a>4.3、注意事项</h4><p>使用 root 用户创建一个文件夹（/oo），权限默认，权限如下：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8fbf5b78821018cdca91c5feb6ca04de.png" alt=""></p><p>需要在 oo 目录下创建文件（oo/xx.txt），需要给 777 权限：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/398a5ba4cac6728af11b42f699df23ed.png" alt=""></p><p>扩展：</p><p>在 Linux 系统中，创建文档的权限有一个默认值，以当前的系统为例，其创建文件夹之后的默认权限是 755，创建文件之后的权限是 644。</p><p>之所以会这样是受到了系统中 umask（掩码）的值的影响，其是用于指定文档创建好之后的权限，umask 默认为 022。</p><p>计算方式：</p><p>对于文件：文件的权限 = 666 – umask 掩码</p><p>对于文件夹：文件夹的权限 = 777 - umask 掩码</p><p>切换到 admin 用户（不是文档所有者，也不是同组用户，属于 other 部分）：</p><p>问题 1：admin 用户是否可以打开 oo/xx.txt 文件？</p><p>问题 2：admin 用户是否可以编辑 oo/xx.txt 文件？</p><p>问题 3：admin 用户是否可以删除 oo/xx.txt 文件？</p><p><strong>在 Linux 中，如果要删除一个文件，不是看文件有没有对应的权限，而是看文件所在的目录是否有写权限，如果有才可以删除</strong>。</p><h3 id="5、属主与属组-1"><a href="#5、属主与属组-1" class="headerlink" title="5、属主与属组"></a>5、属主与属组</h3><p>属主：所属的用户（文件的主人），文档所有者</p><p>属组：所属的用户组（同组用户的组名称）</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/2611388ec54e6dc667bf51a501fbb035.png" alt=""></p><p><strong>前面的那个 root 就是属主</strong></p><p><strong>后面的那个 root 就是属组</strong></p><p>这两项信息在文档创建的时候<strong>会使用创建者</strong>的信息（用户名、用户所属的主组名称）。</p><p><strong>之所以需要设置这个：如果有时候去删除某个用户，则该用户对应的文档的属主和属组信息就需要去修改（类似离职之前的工作交接）。</strong></p><h4 id="5-1、chown（重点）-1"><a href="#5-1、chown（重点）-1" class="headerlink" title="5.1、chown（重点）"></a>5.1、chown（重点）</h4><p><strong>作用：更改文档的所属用户（change owner）</strong></p><p><strong>语法：#chown [-R] 新的 username 文档路径</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/85b9b45063f06189a34b1e79dd7c92eb.png" alt=""></p><p><strong>注意：修改所有者的人必须是 root 或者所有者自己，其他人无权修改所有者。</strong></p><p>案例：将先前设置的/oo 目录的所有者设置成成 admin</p><p>#chown -R admin /oo</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/3eaecf5244e2dd3ebde92bf2ab757ef2.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8e7ec79eae7ab35e16449af7b732473b.png" alt=""></p><h4 id="5-2、chgrp（了解）-1"><a href="#5-2、chgrp（了解）-1" class="headerlink" title="5.2、chgrp（了解）"></a>5.2、chgrp（了解）</h4><p><strong>作用：更改文档的所属用户组（change group）</strong></p><p>语法：#chgrp [-R] groupname 文档的路径</p><p>案例：将刚才 oo 目录的所有用户组名改为 admin</p><p>#chgrp -R admin /oo</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/4f80907a339947cb290f86cb8a6f82db.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/32350f976fcbf67acaf31315f77fb3d2.png" alt=""></p><p><strong>思考，如何通过一个命令实现既可以更改所属的用户，也可以修改所属的用户组呢？</strong></p><p>答：可以实现的，通过 chown 命令</p><p>语法：#chown [-R] username:groupname 文档路径</p><p>案例：将刚才 oo 的文档的所属组所属用户修改为 root</p><p>#chown -R root:root /oo</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/d8d6eedebb33abe54ac141bfc6e4433b.png" alt=""></p><p><strong>问题：zhangsan 用户使用自己的帐号创建文件 index.html，并且当时默认的权限是 644，后续管理员 root 将该文件的属主改成了 lisi，属组改成 lisi，则 zhangsan 对文件的操作权限有变化吗？如果有权限是多少？</strong></p><h3 id="6、sudo（重点）"><a href="#6、sudo（重点）" class="headerlink" title="6、sudo（重点）"></a>6、sudo（重点）</h3><p>问题：reboot、shutdown、init、halt，在普通用户身份上都是操作不了，但是有些特殊的情况下又需要有执行权限。又不可能让 root 用户把自己的密码告诉普通用户，这个问题该怎么解决？</p><p><strong>该问题是可以被解决的，可以使用 sudo（switch user<br>do）命令来进行权限设置。Sudo 可以让管理员（root）事先定义某些特殊命令谁可以执行</strong>。</p><p>默认 sudo 中是没有除 root 之外用户的规则，要想使用则先<strong>配置</strong>sudo。</p><p><strong>Sudo 配置文件：/etc/sudoers</strong></p><p>该文件默认只读，不允许修改，因此不能直接修改。</p><p>a. 配置 sudo 文件请使用“#visudo”，打开之后其使用方法和 vim 一致</p><p><strong>b. 配置普通用户的权限</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/2f674725664b6eb79d626e7d753b48a9.png" alt=""></p><p>Root 表示用户名，如果是用户组，则可以写成“%组名”</p><p>ALL：表示允许登录的主机（地址白名单）</p><p>(ALL)：表示以谁的身份执行，ALL 表示 root 身份</p><p>ALL：表示当前用户可以执行的命令，多个命令可以使用“,”分割</p><p><strong>案例：使用 admin 这个用户，赋予其添加用户权限。</strong></p><p>注意：在写 sudo 规则的时候不建议写直接形式的命令，而是写命令的完整路径。</p><p>路径可以使用 which（whereis 亦可）命令来查看</p><p>语法：#which 指令名称</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/2e1c5ad4669cb3f4424d60028e0ab9d9.png" alt=""></p><p>Whereis 会找出一些非可执行文件，建议使用 which</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8af2d21a77d085a0f86faaad1f08427b.png" alt=""></p><p>在添加好对应的规则之后就可以切换用户，切换到普通用户 admin，再去执行：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/add19f303a5a4fc1ccdfea380887ee71.png" alt=""></p><p>此时要想使用刚才的规则，则以以下命令进行：</p><p><strong>#sudo 需要执行的指令（就是放权的指令名称）</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ed6e367044f6205e35ed9a3270ec6f91.png" alt=""></p><p>此时输入的密码是当前执行 sudo 指令的用户的密码，而非 root 密码。</p><p><strong>在输入 sudo 指令之后需要输入当前的用户密码进行确认的操作（不是 root 用户密码），输入之后在接下来 5 分钟内再次执行 sudo 指令不需要密码</strong>。</p><p>补充：在普通用户下怎么查看自己具有哪些特殊权限呢？</p><p><strong>#sudo -l 表示 list</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/7d3649e24e7057c8e6b63a20fdffb2ad.png" alt=""></p><p>最后：sudo 不是任何 Linux 分支都有的命令，常见 centos 与 ubuntu 都存在 sudo 命令。</p><p>作业：使用 sudu 实现让普通用户具备添加、删除用户的权限。</p><h2 id="十二、运行级别"><a href="#十二、运行级别" class="headerlink" title="十二、运行级别"></a>十二、运行级别</h2><p>运行模式也可以称之为<strong>运行级别（Running Level）</strong>。</p><p>在 linux 中存在一个进程：init （initialize，初始化），进程 id 是 1。</p><p>查看进程：#ps -ef|grep init</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/a9bb831480570a1aa9c714e1fb98193b.png" alt=""></p><p>该进程存在一个对应的配置文件：inittab（<strong>系统运行级别配置文件</strong>，位置/etc/inittab）</p><p>文件的主要内容：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/f5552f1a1d1e1c8097b118c89e8e452b.png" alt=""></p><p>根据上述的描述，可以得知，Centos6.5 中存在 7 种运行级别/模式。</p><p>0 — 表示关机级别（不要将默认的运行级别设置成这个值）</p><p>1 — 单用户模式（找回 root 密码的）</p><p>2 — 多用户模式，不带 NFS（Network File Syetem）</p><p>3 — 多用户模式，完全的多用户模式（不带桌面的，纯命令行模式）</p><p>4 — 没有被使用的模式（被保留模式）</p><p>5 — X11，完整的图形化界面模式</p><p>6 — 表示重启级别（不要将默认的运行级别设置成这个值）</p><p>与该级别相关的几个命令（<strong>临时切换，立即生效</strong>）：</p><p>#init 0 表示关机</p><p>#init 3 表示切换到不带桌面的模式（CLI 命令行模式）</p><p>#init 5 切换到图形界面（前提必须先确保已经安装了图形化界面）</p><p>#init 6 重启电脑</p><p>注意：init 指令需要超级管理员的权限，普通用户无法执行。</p><p><strong>这些命令其实都是调用的 init 进程，将数字（运行级别）传递给进程，进程去读配置文件执行对应的操作。</strong></p><p>① 切换到纯命令行模式下（<strong>临时切换，重启之后又恢复</strong>）</p><p>#init 3</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/30e7ecae196e0feb67866e9dc8964a33.png" alt=""></p><p>切换之后需要输入用户名和密码，在<strong>输入密码的时候没有“*”提示输入，只要自己确认输入的密码没有错误，按下回车即可</strong>。</p><p>② 回到桌面模式</p><p>#init 5</p><p><strong>③ 设置模式永久为命令行模式</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/9deac8ea4757fdba1ab44c98eb3de93f.png" alt=""></p><p>将/etc/inittab 文件中的 initdefault 值设置成 3，然后重启操作系统。</p><p>切换重启之后默认即命令行模式：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/07cc6efbf80ba712d5afcd8ebb9defe2.png" alt=""></p><h2 id="十三、网络设置"><a href="#十三、网络设置" class="headerlink" title="十三、网络设置"></a>十三、网络设置</h2><h3 id="1、ip-地址查看"><a href="#1、ip-地址查看" class="headerlink" title="1、ip 地址查看"></a>1、ip 地址查看</h3><p>需要的场景：远程连接、配置相关软件时</p><p>指令：#ifconfig</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/60c0c9ff43ea15b79ae7c74a5a473ff2.png" alt=""></p><p>得知的信息有：</p><p>① 有 2 块网卡，一个叫 eth0，另一个 lo（本地回环网卡，本机 ip）</p><p>②ip 地址是 inet addr 那一项</p><h3 id="2、网卡配置文件"><a href="#2、网卡配置文件" class="headerlink" title="2、网卡配置文件"></a>2、网卡配置文件</h3><p>位置：/etc/sysconfig/network-scripts/ifcfg-*文件</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8351868a4fc23619cf1fce789f68b1ba.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ea3bc8b7cec440fa2cabd3718b7bda04.png" alt=""></p><p>ONBOOT：表示是否自动连接</p><p>BOOTPROTO（COL）：网卡启动之后使用的协议，一般情况下是 DHCP</p><p>HWADDR：硬件地址（mac 地址，物理地址），计算机之间的通信都是依赖于 mac 地址</p><p><strong>扩展：针对像网卡配置目录层次比较深的文件，如果需要频繁更改，可以将需要的文件设置一个快捷方式，将其放在经常操作的目录，以简化后续的打开文件操作。</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/3ec0f30639892bddd276d93977314a0f.png" alt=""></p><p><strong>语法：#ln -s 原始路径 快捷方式路径</strong></p><p>案例：将 ifcfg-eth0 文件在 root 家目录下创建快捷方式。</p><p>#ln -s /etc/sysconfig/network-scripts/ifcfg-eth0 /root/wangka.conf</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/6594e0f3048f785dbcfdd624a336c6d1.png" alt=""></p><h3 id="3、网络服务操作"><a href="#3、网络服务操作" class="headerlink" title="3、网络服务操作"></a>3、网络服务操作</h3><p>可以通过 service 指令来对网络的服务进行重启/停止/启动等操作。</p><p>语法：#service network start/stop/restart (<strong>操作所有的网卡设备</strong>)</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/69f21ac9d0551b0aef15b4a7651a7035.png" alt=""></p><p>上述的指令还等价于：#/etc/init.d/network start/stop/restart</p><p>补充对于单个网卡的操作：</p><p>#ifdown 网卡名 停止某个网卡</p><p>#ifup 网卡名 启动某个网卡</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8ae03e627ef4a8df759add212f50d14c.png" alt=""></p><p><strong>注意：上述这些操作不要随意在服务器上运行。</strong></p><h2 id="十四、ssh"><a href="#十四、ssh" class="headerlink" title="十四、ssh"></a>十四、ssh</h2><h3 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h3><p>ssh（secure<br>shell，安全外壳协议），该协议有 2 个常用的作用：<strong>远程连接</strong>、远程文件传输。</p><p>协议使用<strong>端口</strong>号：<strong>默认是 22。</strong></p><p>可以是被修改的，如果需要修改，则需要修改 ssh 服务的配置文件：</p><p><strong>#/etc/ssh/ssh_config</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/88a88bc5d83628ff87a198d093e6917b.png" alt=""></p><p>端口号可以修改，但是得注意 2 个事项：</p><p>a. 注意范围，端口范围是从 0-65535；</p><p>b.<br>不能使用别的服务已经占用的端口（常见的不能使用：20，21，23，25，80，443，3389，3306，11211 等等）；</p><p><strong>服务启动/停止/重启 ｛服务名中的 d 全称 daemon，守护进程｝</strong></p><p>#service sshd start/stop/restart</p><p>#/etc/init.d/sshd start/stop/restart</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/39392555f2457120df16599067cc0253.png" alt=""></p><p>Sshd 服务一般默认就已经启动，不需要再去启动，可以在<strong>修改完其配置的情况下重启</strong>。</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/efa7ba9f217b3b530fdfcbe69e2fe5a0.png" alt=""></p><h3 id="2、ssh-的应用"><a href="#2、ssh-的应用" class="headerlink" title="2、ssh 的应用"></a>2、ssh 的应用</h3><h4 id="2-1、远程登录（重点）"><a href="#2-1、远程登录（重点）" class="headerlink" title="2.1、远程登录（重点）"></a>2.1、远程登录（重点）</h4><p>终端工具主要帮助运维人员连接远程的服务器，常见终端工具有：Xshell、secureCRT、Putty 等。以 putty 为例：</p><p>① 获取服务器 ip 地址，可以通过 ifconfig 命令进行查看，然后顺手测试 ip 的连接相通性</p><p>#ifconfig</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/905192724c6f92961432b9ef31c9052a.png" alt=""></p><p>此处获取的 ip 地址地址还是 192.168.254.130</p><p>测试连通性：ping 192.168.254.130</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5871f51f76c556f412898a4c110b2e47.png" alt=""></p><p>② 打开 putty，输入相关的信息</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/6b3cb4fdbea840acea24eb3bb59bfbb7.png" alt=""></p><p>③ 在弹出 key 确认的时候点击“是”，以后不会再提示</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/b9f43c99da8fc4a2060298905088a58a.png" alt=""></p><p>④ 输入登录信息</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/64a1bca32e3e9b34512159a12b69403f.png" alt=""></p><p>之前在虚拟机的 centos 中全部的指令在远程终端中都是可以得到执行的。</p><p><strong>扩展：不借助第三方工具实现远程连接。</strong></p><p>① 打开 Windows 的 cmd 黑窗口（前提是 Windows 必须安装 ssh 服务，如果没有而需要这个功能，则自行安装 openSSH）</p><p>② 输入“ssh 需要登录的用户名@远程服务器的连接地址”回车</p><p>③ 输入密码</p><p>例如：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/e2f499ef74f5d45b29fa8a7389fe2021.png" alt=""></p><h4 id="2-2、sftp-文件传输"><a href="#2-2、sftp-文件传输" class="headerlink" title="2.2、sftp 文件传输"></a>2.2、sftp 文件传输</h4><p>可视化的界面传输工具：Filezilla</p><p>安装好之后可以查看到桌面图标：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/ebde5fc6cf7430a33a37eec69771d3d1.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/3b8ca0a77d6bab2d166fe8738a9343c9.png" alt=""></p><p>① 选择“文件”- “站点管理器（Ctrl + S）”</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/adf12e65148ed12517f165997d47a24d.png" alt=""></p><p>② 点击“文件”菜单下方的“▽”选择需要连接的服务器，连接好之后的效果</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/6c5c3ba6d96aea4d7f74ab5de898c5e6.png" alt=""></p><p>③ 从本地 windows 上传文件到 linux 中方式</p><p>支持直接拖拽文件，也可以右键本地需要上传的文件，然后点选“上传”即可</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/a8687f602aa571705138c0f8482ccf47.png" alt=""></p><p>④ 下载 linux 文件到本地</p><p>支持服务器文件直接拖拽到本地，也可以在右侧窗口选择需要下载的文件，右键，点选“下载”。</p><h2 id="十五、软件的安装方式"><a href="#十五、软件的安装方式" class="headerlink" title="十五、软件的安装方式"></a>十五、软件的安装方式</h2><p>在 Linux 系统中，软件的管理方式有三种：rpm、yum、编译方式。</p><h3 id="1、rpm"><a href="#1、rpm" class="headerlink" title="1、rpm"></a>1、rpm</h3><p>优点：对于软件包的操作比较简单，通过简单指令即可操作</p><p>缺点：</p><p>① 安装时需要自行下载软件包</p><p>② 安装、卸载软件时需要考虑到依赖关系</p><p>③ 软件的自定义性比较差，不适合有特殊需求的场景</p><p>语法：</p><p>① 查询</p><p>#rpm -qa 关键词 （查询机器上是否有安装指定的软件包）</p><p>选项说明：</p><p>-q：query，查询</p><p>-a：all，所有</p><p>② 卸载</p><p>#rpm -e 软件包全称 [–nodeps] （卸载软件，包的全称需要通过 ① 去查询）</p><p>选项说明：</p><p>-e：卸载</p><p>--nodeps：忽略依赖关系</p><p>③ 安装</p><p>#rpm -ivh 软件包路径 （软件包的下载需要自行解决）</p><p>选项说明：</p><p>-i：install，安装</p><p>-v：显示安装过程</p><p>-h：以“#”形式显示安装过程</p><p>④ 更新（了解）</p><p>#rpm -Uvh 软件包路径 （软件包的下载需要自行解决）</p><p>选项说明：</p><p>-U：upgrade，升级</p><p>-v：显示安装过程</p><p>-h：以“#”形式显示安装过程</p><p>案例：查询、卸载、安装 firefox 浏览器。</p><p>查询：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/85fedd43eb6f735c7e9d2a872112dcbe.png" alt=""></p><p>卸载：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/2a3a135ad5d7ac24bacfc5e051658a23.png" alt=""></p><p>安装：</p><p>① 查找 FF31.1.0 软件包</p><p>/<a href="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/CentOS_6.6_Final/Packages" target="_blank" rel="noopener">https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/CentOS_6.6_Final/Packages</a></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/df8841136bc1318f13634560939e0b95.png" alt=""></p><p>② 开始安装</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/cb21cca04e80e3e8ac8be88436dd10e2.png" alt=""></p><h3 id="2、yum-安装"><a href="#2、yum-安装" class="headerlink" title="2、yum 安装"></a>2、yum 安装</h3><p>优点：</p><p>① 快速、傻瓜式的软件管理方式</p><p>② 在联网情况下，自动从服务器上下载软件包（内、外网服务器均可）</p><p>③ 自动解决软件依赖关系</p><p>缺点：</p><p>因其底层实为 rpm 操作，所以也丧失了对软件的自定义功能</p><p>Yum 常用语法：</p><p>① 搜索/查询相关</p><p>#yum search [all] 关键词 （根据关键词搜索服务器上的包资源）</p><p>#yum list [关键词] （列出所有的包，包含已经安装的和可供安装的）</p><p>#yum list installed [关键词] （列出当前已经安装的包）</p><p>② 安装</p><p>注意：操作指令（install）与-y 选项可以颠倒，下同。</p><p>#yum [-y] install 关键词 （安装指定的软件）</p><p>③ 卸载</p><p>#yum [-y] remove 关键词 （卸载指定的软件）</p><p>④ 更新</p><p>#yum [-y] update （更新整个系统，包含内核）</p><p>#yum [-y] update 关键词</p><p>案例：使用 yum 方式快速安装 L<strong>AMP</strong>环境。</p><p>建议采用 PAM 的安装顺序，原因是在安装 php 的时候，yum 会顺带安装 apache。</p><p>#yum install php</p><p>#yum install mysql-server</p><p>MySQL 的初始化（设置 root 密码的）：</p><p>#service mysqld start</p><p>#mysql_secure_installation</p><p>启动 apache</p><p>#service httpd start</p><p>安装好的 apache 默认站点在：/var/www/html/位置</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/92a9ba8e429d5cd68a5778649de5c4d4.png" alt=""></p><p>Apache 配置文件位于：/etc/httpd/conf/httpd.conf</p><h3 id="3、编译安装（难点）"><a href="#3、编译安装（难点）" class="headerlink" title="3、编译安装（难点）"></a>3、编译安装（难点）</h3><p>优点：</p><p>① 用户可选择需要的软件功能</p><p>② 源码方式，有开发能力的用户，可对源码进行自定义</p><p>缺点：</p><p>① 需要自行解决依赖关系</p><p>② 编译时间较长</p><p>③ 容易出错，一旦出错，需要重新编译安装</p><p>编译安装步骤：</p><p>① 下载源码包</p><p>② 解压源码包</p><p>③ 进入解压目录</p><p>④ 配置安装</p><p>⑤ 编译</p><p>⑥ 安装</p><p>案例：编译安装 Nginx。</p><p>类似于 apache，是一款开源的 web 服务器软件，其默认用的端口号也是 80。</p><p>① 下载 nginx 包</p><p>下载地址：<a href="https://nginx.org/en/download.html" target="_blank" rel="noopener">https://nginx.org/en/download.html</a></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/30e66139924447d09a5e128f9f685743.png" alt=""></p><p>复制下载地址。</p><p>需要将下载地址在终端中输入，进行下载：</p><p>#cd /usr/local/src</p><p>#wget <a href="https://nginx.org/download/nginx-1.15.5.tar.gz" target="_blank" rel="noopener">https://nginx.org/download/nginx-1.15.5.tar.gz</a></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/27fd5530b8effe999011849925e765f1.png" alt=""></p><p>② 解压压缩包</p><p>#tar -jxvf 路径(针对.tar.bz2 格式)</p><p>#tar -zxvf 路径(针对.tar.gz 格式) 【当前选这个】</p><p>#tar -zxvf nginx-1.15.5.tar.gz</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/d7af6ee2c555b8a0b35b672665b8aa42.png" alt=""></p><p>③ 进入解压后的目录</p><p>#cd nginx-1.15.5</p><p>④ 配置安装</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/bb4cd4a8597ed56301ad10e4a7d2be19.png" alt=""></p><p>配置包含：指定安装的位置、需要的模块功能</p><p>指定位置使用：–prefix 选项</p><p>例如：–prefix=/usr/local/nginx</p><p># ./configure –prefix=/usr/local/nginx</p><p>需要安装 2 个依赖：</p><p>#yum install pcre-devel</p><p>#yum install zlib-devel</p><p>然后继续重新配置，确认没有问题会看到如下效果：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/8d0f85128947036b8606d626c6e9457d.png" alt=""></p><p>⑤ 编译&amp;&amp;完成安装</p><p>#make &amp;&amp; make install</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/314925842377c6cd8c924c9ab4194dda.png" alt=""></p><p>测试 NGINX 的使用：</p><p>#service httpd stop</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/1469e0135eee753de07695e46c6fc4be.png" alt=""></p><p>注意：nginx 编译安装之后不支持 service 指令进行操作，需要找到 nginx 的执行文件才能启动。</p><p><strong>nginx -s reload</strong> ## 重新载入配置文件<br><strong>nginx -s reopen</strong> ## 重启 Nginx<br><strong>nginx -s stop</strong> # #停止 Nginx</p><h2 id="十六、CentOs-系统-node-环境搭建"><a href="#十六、CentOs-系统-node-环境搭建" class="headerlink" title="十六、CentOs 系统 node 环境搭建"></a>十六、CentOs 系统 node 环境搭建</h2><h3 id="1-Node-环境搭建"><a href="#1-Node-环境搭建" class="headerlink" title="1.Node 环境搭建"></a>1.Node 环境搭建</h3><p>命令</p><ul><li>cd / 进入根目录</li><li>ls 查看目录</li><li>ls -ls</li><li>clear 清除</li><li>cd /usr/local/src</li><li>wget nodejs 链接 下载<ul><li>百度 nodejs 中文网</li><li>下载</li><li>用阿里云镜像</li><li>wget 下载资源</li><li>ctrl + c 终止</li><li>rm -f 文件名</li></ul></li><li>安全组开放访问端口</li></ul><pre class=" language-css"><code class="language-css">tab键可以补全文件或路径名进入指定目录cd/usr/local/src/下载资源（淘宝镜像 <span class="token number">.</span>gz后缀文件）wget <span class="token property">https</span><span class="token punctuation">:</span>//nodejs<span class="token number">.</span>org/dist/v<span class="token number">10.12.0</span>/node-v<span class="token number">10.12.0</span>-linux-x<span class="token number">64.</span>tar<span class="token number">.</span>gz 下载完成后, 执行解压命令 tar xvf node-v<span class="token number">10.12.0</span>-linux-x<span class="token number">64.</span>tar<span class="token number">.</span>gz    删掉文件 rm -f 文件名 cd node-v<span class="token number">10.12.0</span>-linux-x<span class="token number">64</span>/bin 查看文件，会看到 node npm ls 设置全局, 在任何目录都可能运行    node 和 npm 命令 ln -s / usr/local/src/node-v<span class="token number">10.12.0</span>-linux-x<span class="token number">64</span>/bin/node / usr/local/bin/node    ln -s / usr/local/src/node-v<span class="token number">10.12.0</span>-linux-x<span class="token number">64</span>/bin/npm / usr/local/bin/npm    因为个别同学服务器地区问题原因，全局变量配置不成功，就配置到 / bin/下面 ln -s /    usr/local/src/node-v<span class="token number">10.12.0</span>-linux-x<span class="token number">64</span>/bin/node / bin/node ln -s /    usr/local/src/node-v<span class="token number">10.12.0</span>-linux-x<span class="token number">64</span>/bin/npm / bin/npm<span class="token punctuation">;</span></code></pre><pre class=" language-css"><code class="language-css"><span class="token number">11.</span> 安全组开放访问端口- 进入实例- 安全组- 配置规则- 添加安全规则- 协议类型 TCP  - <span class="token number">80</span>/<span class="token number">80</span>  - <span class="token number">6000</span>/<span class="token number">9999</span>  - <span class="token number">443</span>/<span class="token number">443</span>- 协议类型 HTTP/HTTPS  - <span class="token number">80</span>/<span class="token number">80</span>- 授权类型：地址段访问- 授权对象  - <span class="token number">0.0.0.0</span>/<span class="token number">0</span></code></pre><h3 id="2-FTP"><a href="#2-FTP" class="headerlink" title="2. FTP"></a>2. FTP</h3><p>图形化文件上传工具</p><ul><li>利用 filezilla 上传项目</li><li>主机<ul><li>公网 ip</li></ul></li><li>端口<ul><li>22</li></ul></li><li>协议<ul><li>ssh</li></ul></li><li>登录类型<ul><li>正常</li></ul></li><li>用户名<ul><li>root</li></ul></li><li>密码 不告诉你</li><li>如果通行命令行的形式下载 node 压缩包不成功（由于网络慢或其他原因）<ul><li>可以在 nodejs 中文网直接点击 node-v10.3.0-linux-x64.tar.gz 下载到电脑 包 通过 filezilla 上传到 <code>/usr/local/src</code> 里</li><li>上传完成之后用命令行解压</li></ul></li></ul><h3 id="3-配置-pm2"><a href="#3-配置-pm2" class="headerlink" title="3. 配置 pm2"></a>3. 配置 pm2</h3><p><em>pm2</em> 是一个带有负载均衡功能的 Node 应用的进程管理器.当你要把你的独立代码利用全部的服务器上的所有 CPU,并保证进程永远都活着</p><pre class=" language-css"><code class="language-css">进入node/bin目录安装pm<span class="token number">2</span>npm i -g pm<span class="token number">2</span>$ pm<span class="token number">2</span> start app<span class="token number">.</span>js -i <span class="token number">4</span>    #后台运行pm<span class="token number">2</span>，启动<span class="token number">4</span>个app<span class="token number">.</span>js # 也可以把<span class="token string">'max'</span> 参数传递给 start # 正确的进程数目依赖于Cpu的核心数目$ pm<span class="token number">2</span> start app<span class="token number">.</span>js --name my-api    # 命名进程$ pm<span class="token number">2</span> list    # 显示所有进程状态$ pm<span class="token number">2</span> monit    # 监视所有进程$ pm<span class="token number">2</span> logs    # 显示所有进程日志$ pm<span class="token number">2</span> stop all    # 停止所有进程$ pm<span class="token number">2</span> restart all        # 重启所有进程$ pm<span class="token number">2</span> reload all    # <span class="token number">0</span>秒停机重载进程 <span class="token punctuation">(</span>用于 NETWORKED 进程<span class="token punctuation">)</span>$ pm<span class="token number">2</span> stop <span class="token number">0</span>    # 停止指定的进程$ pm<span class="token number">2</span> restart <span class="token number">0</span>    # 重启指定的进程$ pm<span class="token number">2</span> startup    # 产生 init 脚本 保持进程活着$ pm<span class="token number">2</span> web    # 运行健壮的 computer API endpoint <span class="token punctuation">(</span><span class="token property">http</span><span class="token punctuation">:</span>//<span class="token property">localhost</span><span class="token punctuation">:</span><span class="token number">9615</span><span class="token punctuation">)</span>$ pm<span class="token number">2</span> delete <span class="token number">0</span>    # 杀死指定的进程$ pm<span class="token number">2</span> delete all    # 杀死全部进程 运行进程的不同方式：$ pm<span class="token number">2</span> start app<span class="token number">.</span>js -i max    # 根据有效CPU数目启动最大进程数目$ pm<span class="token number">2</span> start app<span class="token number">.</span>js -i <span class="token number">3</span>    # 启动<span class="token number">3</span>个进程$ pm<span class="token number">2</span> start app<span class="token number">.</span>js -x    #用fork模式启动 app<span class="token number">.</span>js 而不是使用 cluster$ pm<span class="token number">2</span> start app<span class="token number">.</span>js -x -- -a <span class="token number">23</span>    # 用fork模式启动 app<span class="token number">.</span>js 并且传递参数 <span class="token punctuation">(</span>-a <span class="token number">23</span><span class="token punctuation">)</span>$ pm<span class="token number">2</span> start app<span class="token number">.</span>js --name serverone    # 启动一个进程并把它命名为 serverone$ pm<span class="token number">2</span> stop serverone    # 停止 serverone 进程$ pm<span class="token number">2</span> start app<span class="token number">.</span>json    # 启动进程, 在 app<span class="token number">.</span>json里设置选项$ pm<span class="token number">2</span> start app<span class="token number">.</span>js -i max -- -a <span class="token number">23</span>    #在--之后给 app<span class="token number">.</span>js 传递参数$ pm<span class="token number">2</span> start app<span class="token number">.</span>js -i max -e err<span class="token number">.</span>log -o out<span class="token number">.</span>log    # 启动 并 生成一个配置文件 你也可以执行用其他语言编写的app <span class="token punctuation">(</span> fork 模式<span class="token punctuation">)</span><span class="token punctuation">:</span>$ pm<span class="token number">2</span> start my-bash-script<span class="token number">.</span>sh -x --interpreter bash$ pm<span class="token number">2</span> start my-python-script<span class="token number">.</span>py -x --interpreter python</code></pre><h3 id="4-解压"><a href="#4-解压" class="headerlink" title="4.解压"></a>4.解压</h3><blockquote><p>yum install -y unzip zip</p></blockquote><pre class=" language-css"><code class="language-css">Linux中zip压缩和unzip解压缩命令详解<span class="token number">1</span>、把/home目录下面的mydata目录压缩为mydata<span class="token number">.</span>zipzip -r mydata<span class="token number">.</span>zip mydata #压缩mydata目录<span class="token number">2</span>、把/home目录下面的mydata<span class="token number">.</span>zip解压到mydatabak目录里面unzip mydata<span class="token number">.</span>zip -d mydatabak<span class="token number">3</span>、把/home目录下面的abc文件夹和<span class="token number">123.</span>txt压缩成为abc<span class="token number">123.</span>zipzip -r abc<span class="token number">123.</span>zip abc <span class="token number">123.</span>txt<span class="token number">4</span>、把/home目录下面的wwwroot<span class="token number">.</span>zip直接解压到/home目录里面unzip wwwroot<span class="token number">.</span>zip<span class="token number">5</span>、把/home目录下面的abc<span class="token number">12.</span>zip、abc<span class="token number">23.</span>zip、abc<span class="token number">34.</span>zip同时解压到/home目录里面unzip abc\*<span class="token number">.</span>zip<span class="token number">6</span>、查看把/home目录下面的wwwroot<span class="token number">.</span>zip里面的内容unzip -v wwwroot<span class="token number">.</span>zip<span class="token number">7</span>、验证/home目录下面的wwwroot<span class="token number">.</span>zip是否完整unzip -t wwwroot<span class="token number">.</span>zip<span class="token number">8</span>、把/home目录下面wwwroot<span class="token number">.</span>zip里面的所有文件解压到第一级目录unzip -j wwwroot<span class="token number">.</span>zip主要参数-c：将解压缩的结果-l：显示压缩文件内所包含的文件-p：与-c参数类似，会将解压缩的结果显示到屏幕上，但不会执行任何的转换-t：检查压缩文件是否正确-u：与-f参数类似，但是除了更新现有的文件外，也会将压缩文件中的其它文件解压缩到目录中-v：执行是时显示详细的信息-z：仅显示压缩文件的备注文字-a：对文本文件进行必要的字符转换-b：不要对文本文件进行字符转换-C：压缩文件中的文件名称区分大小写-j：不处理压缩文件中原有的目录路径-L：将压缩文件中的全部文件名改为小写-M：将输出结果送到more程序处理-n：解压缩时不要覆盖原有的文件-o：不必先询问用户，unzip执行后覆盖原有文件-P：使用zip的密码选项-q：执行时不显示任何信息-s：将文件名中的空白字符转换为底线字符-V：保留VMS的文件版本信息-X：解压缩时同时回存文件原来的UID/GID</code></pre><h3 id="5-rz-sz-上传下载文件"><a href="#5-rz-sz-上传下载文件" class="headerlink" title="5. rz sz 上传下载文件"></a>5. rz sz 上传下载文件</h3><ul><li><p>方法一 解压版</p><p>用法：</p><p>rz 电脑里的文件名</p><p>sz 当前目录下文件名</p><p><u>上传文件和下载文件 最好都是压缩包</u></p></li></ul><pre class=" language-css"><code class="language-css">下载安装包lrzsz-<span class="token number">0.12.20.</span>tar<span class="token number">.</span><span class="token property">gz</span> <span class="token punctuation">:</span> <span class="token property">http</span><span class="token punctuation">:</span>//www<span class="token number">.</span>ohse<span class="token number">.</span>de/uwe/software/lrzsz<span class="token number">.</span>html       # wget <span class="token property">http</span><span class="token punctuation">:</span>//www<span class="token number">.</span>ohse<span class="token number">.</span>de/uwe/releases/lrzsz-<span class="token number">0.12.20.</span>tar<span class="token number">.</span>gz       # tar zxvf lrzsz-<span class="token number">0.12.20.</span>tar<span class="token number">.</span>gz &amp;&amp; cd lrzsz-<span class="token number">0.12.20</span>       # <span class="token number">.</span>/configure &amp;&amp; make &amp;&amp; make install       上面安装过程默认把lsz和lrz安装到了/usr/local/bin/目录下, 下面创建软链接, 并命名为rz/<span class="token property">sz</span><span class="token punctuation">:</span>       # cd /usr/bin       # ln -s /usr/local/bin/lrz rz       # ln -s /usr/local/bin/lsz sz</code></pre><ul><li><p>安装版</p><pre class=" language-css"><code class="language-css">yum install -y lrzsz</code></pre></li></ul><h3 id="6-服务器重启"><a href="#6-服务器重启" class="headerlink" title="6. 服务器重启"></a>6. 服务器重启</h3><pre><code>shutdown -h 10          #计算机将于10分钟后关闭，且会显示在登录用户的当前屏幕中         shutdown -h now       #计算机会立刻关机         shutdown -h 22:22     #计算机会在这个时刻关机         shutdown -r now        #计算机会立刻重启         shutdown -r +10         #计算机会将于10分钟后重启         reboot                           #重启         halt                                #关机</code></pre><h3 id="7-Node-版本控制"><a href="#7-Node-版本控制" class="headerlink" title="7. Node 版本控制"></a>7. Node 版本控制</h3><blockquote><p>进入到 node 的安装目录<br>​ cd /usr/local/src/你的 node 目录/bin</p></blockquote><ul><li><p>1.安装 n 管理工具</p><pre><code>&gt; npm install -g n</code></pre><blockquote><p>ls</p></blockquote></li><li><p>2.安装最新版本</p><pre><code>&gt; n latest</code></pre><p>默认会安装到 /usr/local/n/versions/node/11.0.0</p></li><li><p>3.也可以安装指定版本<br>n 8.12.0<br>​ n 10.12.0<br>n 10.8.0<br>​ …</p></li><li><p>4.切换 nodejs 版本<br>​ n</p></li><li><p>5.【键盘方向键选择版本】<br>选择已安装的版本<br>​ ο node/11.0.0<br>​ node/10.12.0<br>​ node/10.8.0<br>查看当前版本 node -v，下面表示已切换成功</p><blockquote><p>v11.0.0</p></blockquote></li><li><p>6.问题来了，切换后，查看版本可能还是原来的版本，看下面 <strong>使用 n 切换 nodejs 版本失效的解决办法</strong></p><ul><li>a) 切换失效的解决办法，查看 node 当前安装路径</li></ul><blockquote><p>which node</p></blockquote><p>/usr/local/bin/node</p><ul><li><p>b) n 默认安装路径是 /usr/local，若你的 node 不是在此路径下，n 切换版本就不能把 bin、lib、include、share 复制该路径中，所以我们必须通过 N_PREFIX 变量来修改 n 的默认 node 安装路径。</p><ul><li><p>编辑环境配置文件：</p><blockquote><p>vim ~/.bash_profile</p></blockquote></li></ul></li><li><p>将下面两行代码插入到文件末尾</p><blockquote><p>export N_PREFIX=/usr/local #node 实际安装位置 &gt;</p><blockquote><pre><code>&gt; export PATH=$N_PREFIX/bin:$PATH</code></pre></blockquote></blockquote></li></ul><p>:wq 保存退出</p><ul><li><p>c) 执行 source 使修改生效。</p><blockquote><p>source ~/.bash_profile</p></blockquote></li><li><p>这时候再查看 node -v 发现版本切换成功了。</p></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
            <tag> OS </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx</title>
      <link href="/posts/248b.html"/>
      <url>/posts/248b.html</url>
      
        <content type="html"><![CDATA[<h2 id="location"><a href="#location" class="headerlink" title="location"></a>location</h2><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/location匹配总结.jpg" /><p>优先级 <strong>=    &gt;    ^~（匹配开头）   &gt;   ~（正则）   &gt;   /</strong></p><h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86.jpg" alt=""></p><p>设想： 访问 <a href="http://localhost/music" target="_blank" rel="noopener">http://localhost/music</a> 代理到 <a href="http://music.jinghong.ml" target="_blank" rel="noopener">http://music.jinghong.ml</a></p><p> 写法如下：</p><pre class=" language-nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span>music <span class="token punctuation">{</span>    <span class="token keyword">proxy_pass</span>  <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>music<span class="token punctuation">.</span>jinghong<span class="token punctuation">.</span>ml<span class="token punctuation">}</span><span class="token keyword">location</span> <span class="token operator">/</span>music<span class="token operator">/</span> <span class="token punctuation">{</span>    <span class="token keyword">proxy_pass</span>  <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>music<span class="token punctuation">.</span>jinghong<span class="token punctuation">.</span>ml<span class="token punctuation">}</span>两者不同点<span class="token punctuation">:</span>  前者  实际代理的地址是 <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>music<span class="token punctuation">.</span>jinghong<span class="token punctuation">.</span>ml<span class="token operator">/</span>music<span class="token punctuation">,</span>会把后面的参数一并带入            后者 则相反，不会把参数带入， 代理地址 <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>music<span class="token punctuation">.</span>jinghong<span class="token punctuation">.</span>ml</code></pre><h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.jpg" alt=""></p><p><strong>weight 权重</strong></p>]]></content>
      
      
      <categories>
          
          <category> Operation </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TypeScript</title>
      <link href="/posts/cc59.html"/>
      <url>/posts/cc59.html</url>
      
        <content type="html"><![CDATA[<h2 id="tsconfig-文件配置选项介绍"><a href="#tsconfig-文件配置选项介绍" class="headerlink" title="tsconfig 文件配置选项介绍"></a>tsconfig 文件配置选项介绍</h2><h3 id="compilerOptions编译选项"><a href="#compilerOptions编译选项" class="headerlink" title="compilerOptions编译选项"></a>compilerOptions编译选项</h3><p>target用于指定编译之后的版本目录<br>“target”: “es5”,</p><p>module用来指定要使用的模板标准 “module”: “commonjs”,</p><p>lib用于指定要包含在编译中的库文件 “lib”:[   “es6”,   “dom” ],</p><p>allowJs用来指定是否允许编译JS文件，默认false,即不编译JS文件 “allowJs”: true,</p><p>checkJs用来指定是否检查和报告JS文件中的错误，默认false “checkJs”: true,</p><p>指定jsx代码用于的开发环境:’preserve’,’react-native’,or ‘react “jsx”: “preserve”,</p><p>declaration用来指定是否在编译的时候生成相的d.ts声明文件，如果设为true,编译每个ts文件之后会生成一个js文件和一个声明文件，但是declaration和allowJs不能同时设为true “declaration”: true,</p><p>declarationMap用来指定编译时是否生成.map文件 “declarationMap”: true,</p><p>socuceMap用来指定编译时是否生成.map文件 “sourceMap”: true,</p><p>outFile用于指定输出文件合并为一个文件，只有设置module的值为amd和system模块时才支持这个配置 “outFile”: “./“,</p><p>outDir用来指定输出文件夹，值为一个文件夹路径字符串，输出的文件都将放置在这个文件夹 “outDir”: “./“,</p><p>rootDir用来指定编译文件的根目录，编译器会在根目录查找入口文件 “rootDir”: “./“,</p><p>composite是否编译构建引用项目 “composite”: true,</p><p>removeComments用于指定是否将编译后的文件注释删掉，设为true的话即删除注释，默认为false “removeComments”: true,</p><p>noEmit不生成编译文件 “noEmit”: true,</p><p>importHelpers指定是否引入tslib里的复制工具函数，默认为false “importHelpers”: true,</p><p>当target为”ES5”或”ES3”时，为”for-of” “spread”和”destructuring”中的迭代器提供完全支持 “downlevelIteration”: true,</p><p>isolatedModules指定是否将每个文件作为单独的模块，默认为true，他不可以和declaration同时设定 “isolatedModules”: true,</p><p>strict用于指定是否启动所有类型检查，如果设为true这回同时开启下面这几个严格检查，默认为false “strict”: true,</p><p>noImplicitAny如果我们没有一些值设置明确类型，编译器会默认认为这个值为any类型，如果将noImplicitAny设为true,则如果没有设置明确的类型会报错，默认值为false “noImplicitAny”: true,</p><p>strictNullChecks当设为true时，null和undefined值不能赋值给非这两种类型的值，别的类型的值也不能赋给他们，除了any类型，还有个例外就是undefined可以赋值给void类型 “strictNullChecks”: true,</p><p>strictFunctionTypes用来指定是否使用函数参数双向协变检查 “strictFunctionTypes”: true,</p><p>strictBindCallApply设为true后对bind、call和apply绑定的方法的参数的检测是严格检测 “strictBindCallApply”: true,</p><p>strictPropertyInitialization设为true后会检查类的非undefined属性是否已经在构造函数里初始化，如果要开启这项，需要同时开启strictNullChecks,默认为false “strictPropertyInitialization”: true,</p><p>当this表达式的值为any类型的时候，生成一个错误 “noImplicitThis”: true,</p><p>alwaysStrict指定始终以严格模式检查每个模块，并且在编译之后的JS文件中加入”use strict”字符串，用来告诉浏览器该JS为严格模式 “alwaysStrict”: true,</p><p>noUnusedLocals用于检查是否有定义了但是没有使用变量，对于这一点的检测，使用ESLint可以在你书写代码的时候做提示，你可以配合使用，他的默认值为false “noUnusedLocals”: true,</p><p>noUnusedParameters用于检测是否在函数中没有使用的参数 “noUnusedParameters”: true,</p><p>noImplicitReturns用于检查函数是否有返回值，设为true后，如果函数没有返回值则会提示，默认为false “noImplicitReturns”: true,</p><p>noFallthroughCasesInSwitch用于检查switch中是否有case没有使用break跳出switch,默认为false “noFallthroughCasesInSwitch”: true,</p><p>moduleResolution用于选择模块解析策略，有”node”和”classic”两种类型 “moduleResolution”: “node”,</p><p>baseUrl用于设置解析非相对模块名称的基本目录，相对模块不会受到baseUrl的影响 “baseUrl”: “./“,</p><p>paths用于设置模块名到基于baseUrl的路径映射   “paths”: {       “*”:[“./node_modules/@types”, “./typings/*”]     },</p><p>rootDirs可以指定一个路径列表，在构建时编译器会将这个路径中的内容都放到一个文件夹中 “rootDirs”: [],</p><p>typeRoots用来指定声明文件或文件夹的路径列表，如果指定了此项，则只有在这里列出的声明文件才会被加载 “typeRoots”: [],</p><p>types用于指定需要包含的模块，只有在这里列出的模块的声明文件才会被加载 “types”: [],</p><p>allowSyntheticDefaultImports用来指定允许从没有默认导出的模块中默认导入 “allowSyntheticDefaultImports”: true,</p><p>esModuleInterop通过导入内容创建命名空间，实现CommonJS和ES模块之间的互操作性 “esModuleInterop”: true,</p><p>不把符号链接解析为真实路径，具体可以了解下webpack和node.js的symlink相关知识 “preserveSymlinks”: true,</p><p>sourceRoot用于指定调试器应该找到TypeScript文件而不是源文件的位置，这个值会被写进.map文件里 “sourceRoot”: “”,</p><p>mapRoot用于指定调试器找到映射文件而非生成文件的位置，指定map文件的根路径，该选项会影响.map文件中的sources属性 “mapRoot”: “”,</p><p>inlineSourceMap指定是否将map文件内容和js文件编译在一个同一个js文件中，如果设为true,则map的内容会以//#soureMappingURL=开头，然后接base64字符串的形式插入在js文件底部 “inlineSourceMap”: true,</p><p>inlineSources用于指定是否进一步将ts文件的内容也包含到输出文件中 “inlineSources”: true,</p><p>experimentalDecorators用于指定是否启用实验性的装饰器特性 “experimentalDecorators”: true,</p><p>emitDecoratorMetadata用于指定是否为装上去提供元数据支持，关于元数据，也是ES6的新标准，可以通过Reflect提供的静态方法获取元数据，如果需要使用Reflect的一些方法，需要引用ES2015.Reflect这个库 “emitDecoratorMetadata”: true,</p><p>include也可以指定要编译的路径列表 “include”:[],</p><p>files可以配置一个数组列表 “files”:[],</p><p>exclude表示要排除的，不编译的文件，它也可以指定一个列表，规则和include一样，可以是文件可以是文件夹，可以是相对路径或绝对路径，可以使用通配符 “exclude”:[]</p><p>extends可以通过指定一个其他的tsconfig.json文件路径，来继承这个配置文件里的配置，继承来的文件的配置会覆盖当前文件定义的配置 “extends”:””</p><p>compileOnSave如果设为true,在我们编辑了项目文件保存的时候，编辑器会根据tsconfig.json的配置更新重新生成文本，不过这个编辑器支持 “compileOnSave”:true</p><p>一个对象数组，指定要引用的项目 “references”:[]</p><h2 id="ts-webpack4环境构建"><a href="#ts-webpack4环境构建" class="headerlink" title="ts+webpack4环境构建"></a>ts+webpack4环境构建</h2><h3 id="安装Node-js"><a href="#安装Node-js" class="headerlink" title="安装Node.js"></a>安装Node.js</h3><h3 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h3><p>npm init</p><h3 id="全局安装typescript"><a href="#全局安装typescript" class="headerlink" title="全局安装typescript"></a>全局安装typescript</h3><p>mac电脑需要在npm 前面加sudo,代表以管理员身份运行 npm install webpack webpack-cli typescript ts-loader –save-dev 安装成功后进入项目根目录</p><h3 id="用tsc命令进行初始化"><a href="#用tsc命令进行初始化" class="headerlink" title="用tsc命令进行初始化"></a>用tsc命令进行初始化</h3><pre><code>tsc --init</code></pre><p>此时项目根目录多了一个tsconfig.json文件</p><h3 id="添加webpack"><a href="#添加webpack" class="headerlink" title="添加webpack"></a>添加webpack</h3><pre><code>npm install webpack-cli webpack dev-server -D</code></pre><h3 id="写webpck的配置文件"><a href="#写webpck的配置文件" class="headerlink" title="写webpck的配置文件"></a>写webpck的配置文件</h3><p>创建一个build文件夹，里面创建webpack.config.js文件, 代码如下：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//使用node的模块</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//这就是我们项目编译的入口文件</span>    entry<span class="token punctuation">:</span> <span class="token string">"./src/index.ts"</span><span class="token punctuation">,</span>    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>        filename<span class="token punctuation">:</span> <span class="token string">"main.js"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>        extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'.ts'</span><span class="token punctuation">,</span><span class="token string">'tsx'</span><span class="token punctuation">,</span><span class="token string">'.js'</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">//这里可以配置一些对指定文件的处理</span>    <span class="token comment" spellcheck="true">//这里匹配后缀为ts或者tsx的文件</span>    <span class="token comment" spellcheck="true">//使用exclude来排除一些文件</span>    module<span class="token punctuation">:</span><span class="token punctuation">{</span>        rules<span class="token punctuation">:</span><span class="token punctuation">[</span>            <span class="token punctuation">{</span>                test<span class="token punctuation">:</span><span class="token regex">/\.tsx?$/</span><span class="token punctuation">,</span>                use<span class="token punctuation">:</span><span class="token string">'ts-loader'</span><span class="token punctuation">,</span>                exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span>            <span class="token punctuation">}</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">//这个参数就可以在webpack中获取到了</span>    devtool<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">===</span> <span class="token string">'production'</span><span class="token operator">?</span> <span class="token boolean">false</span> <span class="token punctuation">:</span> <span class="token string">'inline-source-map'</span><span class="token punctuation">,</span>    devServer<span class="token punctuation">:</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//这个本地开发环境运行时是基于哪个文件夹作为根目录</span>        contentBase<span class="token punctuation">:</span><span class="token string">'./dist'</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">//当你有错误的时候在控制台打出</span>        stats<span class="token punctuation">:</span> <span class="token string">'errors-only'</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">//不启动压缩</span>        compress<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        host<span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>        port<span class="token punctuation">:</span> <span class="token number">8081</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">//这里就是一些插件</span>    plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>        <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            cleanOnceBeforeBuildPatterns<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'./dist'</span><span class="token punctuation">]</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            template<span class="token punctuation">:</span> <span class="token string">'./src/template/index.html'</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><h3 id="安装ts-loader"><a href="#安装ts-loader" class="headerlink" title="安装ts-loader"></a>安装ts-loader</h3><p>解析ts文件转换成浏览器可以识别的文件(webpack)</p><pre><code>npm install ts-loader -D</code></pre><h3 id="安装cross-env"><a href="#安装cross-env" class="headerlink" title="安装cross-env"></a>安装cross-env</h3><p>用于设置环境变量的,方便设置开发环境和生产环境</p><pre><code>npm install cross-env -D</code></pre><h3 id="安装一些插件"><a href="#安装一些插件" class="headerlink" title="安装一些插件"></a>安装一些插件</h3><p>clean-webpack-plugin 能清理一些指定的文件夹 html-webpack-plugin 指定一个编译的模型</p><pre><code>npm install clean-webpack-plugin html-webpack-plugin -D</code></pre><h3 id="项目中安装typescript依赖"><a href="#项目中安装typescript依赖" class="headerlink" title="项目中安装typescript依赖"></a>项目中安装typescript依赖</h3><pre><code>npm install typescript //之前是全局安装</code></pre><h3 id="在package-json文件写指定命令"><a href="#在package-json文件写指定命令" class="headerlink" title="在package.json文件写指定命令"></a>在package.json文件写指定命令</h3><p>上边weapack的命令已经写好了，下边我们就在package.json文件中写指定的命令：</p><pre><code>  &quot;scripts&quot;: {    &quot;start&quot;: &quot;cross-env NODE_ENV=development webpack-dev-server --config ./build/webpack.config.js&quot;,    &quot;build&quot;: &quot;cross-env NODE_ENV=production webpack --config ./build/webpack.config.js&quot;  },</code></pre><p>写代码测试一下,启动本地服务器执行,安装完毕后</p><pre><code>npm start</code></pre><p>打包执行 npm run build 之后就多了个dist目录</p>]]></content>
      
      
      <categories>
          
          <category> Front </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 笔记 </tag>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IndexedDB</title>
      <link href="/posts/2cbc.html"/>
      <url>/posts/2cbc.html</url>
      
        <content type="html"><![CDATA[<h1 id="IndexedDB"><a href="#IndexedDB" class="headerlink" title="IndexedDB"></a>IndexedDB</h1><p>参考链接：<a href="http://www.ruanyifeng.com/blog/2018/07/indexeddb.html" target="_blank" rel="noopener">阮一峰</a>   <a href="https://wangdoc.com/javascript/bom/indexeddb.html#indexeddb-%E5%AF%B9%E8%B1%A1" target="_blank" rel="noopener">网道API</a>   <a href="https://www.baidu.com/link?url=v-T5vFhGb4J4VPU9QdQe1jkehlkqSqzTBcLpsZbUAXkcCPzXY3Uj7PAKbVOtMJe7r_3qJ2zkYh4rhVymjoPZjv9BI1L53NzDfVoIlBi5oSC&wd=&eqid=809f7542008cef74000000065e2eceae" target="_blank" rel="noopener">MDN</a></p><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>IndexedDB 是一个比较复杂的 API，涉及不少概念。它把不同的实体，抽象成一个个对象接口。学习这个 API，就是学习它的各种对象接口。</p><ul><li>数据库：IDBDatabase 对象</li><li>对象仓库：IDBObjectStore 对象</li><li>索引： IDBIndex 对象</li><li>事务： IDBTransaction 对象</li><li>操作请求：IDBRequest 对象</li><li>指针： IDBCursor 对象</li><li>主键集合：IDBKeyRange 对象</li></ul><h2 id="open-database"><a href="#open-database" class="headerlink" title="open database"></a>open database</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> request <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>databaseName<span class="token punctuation">,</span> version<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// databaseName: 数据库名  version: 版本</span><span class="token comment" spellcheck="true">// 如果指定的数据库不存在，将会创建，版本默认为1</span><span class="token comment" spellcheck="true">// return IDBRequest 对象。这个对象有三种事件error、success、upgradeneeded，用于打开数据库后的操作。</span>request<span class="token punctuation">.</span>onerror <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>request<span class="token punctuation">.</span>onsuccess <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> db <span class="token operator">=</span> request<span class="token punctuation">.</span>result    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>request<span class="token punctuation">.</span>onupgradeneeded <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'update 当指定版本大于版本，就会触发升级事件 第一次打开数据库时，会先触发upgradeneeded事件，然后触发success事件。'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token comment" spellcheck="true">//成功后，即可通过request.result 访问IDBdatabse对象</span></code></pre><p>IDBDatabase 对象有以下属性。</p><ul><li><p><code>IDBDatabase.name</code>：字符串，数据库名称。</p></li><li><p><code>IDBDatabase.version</code>：整数，数据库版本。数据库第一次创建时，该属性为空字符串。</p></li><li><p><code>IDBDatabase.objectStoreNames</code>：DOMStringList 对象（字符串的集合），包含当前数据的所有 object store 的名字。</p></li><li><p><code>IDBDatabase.onabort</code>：指定 abort 事件（事务中止）的监听函数。</p></li><li><p><code>IDBDatabase.onclose</code>：指定 close 事件（数据库意外关闭）的监听函数。</p></li><li><p><code>IDBDatabase.onerror</code>：指定 error 事件（访问数据库失败）的监听函数。</p></li><li><p><code>IDBDatabase.onversionchange</code>：数据库版本变化时触发（发生<code>upgradeneeded</code>事件，或调用<code>indexedDB.deleteDatabase()</code>）。</p></li></ul><p>IDBTransaction 对象</p><p>IDBTransaction 对象用来异步操作数据库事务，所有的读写操作都要通过这个对象进行,<code>IDBDatabase.transaction()</code>方法返回的就是一个 IDBTransaction 对象。</p><ul><li><code>IDBTransaction.db</code>：返回当前事务所在的数据库对象 IDBDatabase。</li><li><code>IDBTransaction.error</code>：返回当前事务的错误。如果事务没有结束，或者事务成功结束，或者被手动终止，该方法返回<code>null</code>。</li><li><code>IDBTransaction.mode</code>：返回当前事务的模式，默认是<code>readonly</code>（只读），另一个值是<code>readwrite</code>。</li><li><code>IDBTransaction.objectStoreNames</code>：返回一个类似数组的对象 DOMStringList，成员是当前事务涉及的对象仓库的名字。</li><li><code>IDBTransaction.onabort</code>：指定<code>abort</code>事件（事务中断）的监听函数。</li><li><code>IDBTransaction.oncomplete</code>：指定<code>complete</code>事件（事务成功）的监听函数。</li><li><code>IDBTransaction.onerror</code>：指定<code>error</code>事件（事务失败）的监听函数。</li></ul><p>IDBTransaction 对象有以下方法。</p><ul><li><code>IDBTransaction.abort()</code>：终止当前事务，回滚所有已经进行的变更。</li><li><code>IDBTransaction.objectStore(name)</code>：返回指定名称的对象仓库 IDBObjectStore。</li></ul><p>IDBIndex 对象<br>IDBObjectStore.index()方法可以获取 IDBIndex 对象。</p><ul><li><code>IDBIndex.name</code>：字符串，索引的名称。</li><li><code>IDBIndex.objectStore</code>：索引所在的对象仓库。</li><li><code>IDBIndex.keyPath</code>：索引的主键。</li><li><code>IDBIndex.multiEntry</code>：布尔值，针对<code>keyPath</code>为数组的情况，如果设为<code>true</code>，创建数组时，每个数组成员都会有一个条目，否则每个数组都只有一个条目。</li><li><code>IDBIndex.unique</code>：布尔值，表示创建索引时是否允许相同的主键。</li></ul><p>IDBIndex 对象有以下方法，它们都是异步的，立即返回的都是一个 IDBRequest 对象。</p><ul><li><code>IDBIndex.count()</code>：用来获取记录的数量。它可以接受主键或 IDBKeyRange 对象作为参数，这时只返回符合主键的记录数量，否则返回所有记录的数量。</li><li><code>IDBIndex.get(key)</code>：用来获取符合指定主键的数据记录。</li><li><code>IDBIndex.getKey(key)</code>：用来获取指定的主键。</li><li><code>IDBIndex.getAll()</code>：用来获取所有的数据记录。它可以接受两个参数，都是可选的，第一个参数用来指定主键，第二个参数用来指定返回记录的数量。如果省略这两个参数，则返回所有记录。由于获取成功时，浏览器必须生成所有对象，所以对性能有影响。如果数据集比较大，建议使用 IDBCursor 对象。</li><li><code>IDBIndex.getAllKeys()</code>：该方法与<code>IDBIndex.getAll()</code>方法相似，区别是获取所有主键。</li><li><code>IDBIndex.openCursor()</code>：用来获取一个 IDBCursor 对象，用来遍历索引里面的所有条目。</li><li><code>IDBIndex.openKeyCursor()</code>：该方法与<code>IDBIndex.openCursor()</code>方法相似，区别是遍历所有条目的主键。</li></ul><p>IDBCursor 对象<br>IDBCursor 对象代表指针对象，用来遍历数据仓库（IDBObjectStore）或索引（IDBIndex）的记录。</p><p>IDBCursor 对象一般通过IDBObjectStore.openCursor()方法获得。</p><ul><li><code>IDBCursor.source</code>：返回正在遍历的对象仓库或索引。</li><li><code>IDBCursor.direction</code>：字符串，表示指针遍历的方向。共有四个可能的值：next（从头开始向后遍历）、nextunique（从头开始向后遍历，重复的值只遍历一次）、prev（从尾部开始向前遍历）、prevunique（从尾部开始向前遍历，重复的值只遍历一次）。该属性通过<code>IDBObjectStore.openCursor()</code>方法的第二个参数指定，一旦指定就不能改变了。</li><li><code>IDBCursor.key</code>：返回当前记录的主键。</li><li><code>IDBCursor.value</code>：返回当前记录的数据值。</li><li>IDBCursor.primaryKey：返回当前记录的主键。对于数据仓库（objectStore）来说，这个属性等同于 IDBCursor.key；对于索引，IDBCursor.key 返回索引的位置值，该属性返回数据记录的主键。</li></ul><p>IDBCursor 对象有如下方法。</p><ul><li><code>IDBCursor.advance(n)</code>：指针向前移动 n 个位置。</li><li><code>IDBCursor.continue()</code>：指针向前移动一个位置。它可以接受一个主键作为参数，这时会跳转到这个主键。</li><li><code>IDBCursor.continuePrimaryKey()</code>：该方法需要两个参数，第一个是<code>key</code>，第二个是<code>primaryKey</code>，将指针移到符合这两个参数的位置。</li><li><code>IDBCursor.delete()</code>：用来删除当前位置的记录，返回一个 IDBRequest 对象。该方法不会改变指针的位置。</li><li><code>IDBCursor.update()</code>：用来更新当前位置的记录，返回一个 IDBRequest 对象。它的参数是要写入数据库的新的值。</li></ul><p>IDBKeyRange 对象<br>IDBKeyRange 对象代表数据仓库（object store）里面的一组主键。根据这组主键，可以获取数据仓库或索引里面的一组记录。</p><p>IDBKeyRange 可以只包含一个值，也可以指定上限和下限。它有四个静态方法，用来指定主键的范围。</p><ul><li><code>IDBKeyRange.lowerBound()</code>：指定下限。</li><li><code>IDBKeyRange.upperBound()</code>：指定上限。</li><li><code>IDBKeyRange.bound()</code>：同时指定上下限。</li><li><code>IDBKeyRange.only()</code>：指定只包含一个值。</li></ul><p>下面是一些代码实例。</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// All keys ≤ x</span><span class="token keyword">var</span> r1 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">upperBound</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// All keys &lt; x</span><span class="token keyword">var</span> r2 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">upperBound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// All keys ≥ y</span><span class="token keyword">var</span> r3 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">lowerBound</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// All keys > y</span><span class="token keyword">var</span> r4 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">lowerBound</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// All keys ≥ x &amp;&amp; ≤ y</span><span class="token keyword">var</span> r5 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// All keys > x &amp;&amp;&lt; y</span><span class="token keyword">var</span> r6 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// All keys > x &amp;&amp; ≤ y</span><span class="token keyword">var</span> r7 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// All keys ≥ x &amp;&amp;&lt; y</span><span class="token keyword">var</span> r8 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// The key = z</span><span class="token keyword">var</span> r9 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>IDBKeyRange.lowerBound()</code>、<code>IDBKeyRange.upperBound()</code>、<code>IDBKeyRange.bound()</code>这三个方法默认包括端点值，可以传入一个布尔值，修改这个属性。</p><p>与之对应，IDBKeyRange 对象有四个只读属性。</p><ul><li><code>IDBKeyRange.lower</code>：返回下限</li><li><code>IDBKeyRange.lowerOpen</code>：布尔值，表示下限是否为开区间（即下限是否排除在范围之外）</li><li><code>IDBKeyRange.upper</code>：返回上限</li><li><code>IDBKeyRange.upperOpen</code>：布尔值，表示上限是否为开区间（即上限是否排除在范围之外）</li></ul><p>IDBKeyRange 实例对象生成以后，将它作为参数输入 IDBObjectStore 或 IDBIndex 对象的<code>openCursor()</code>方法，就可以在所设定的范围内读取数据。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> t <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'people'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readonly'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> store <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'people'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> index <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> range <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>index<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">.</span>onsuccess <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> cursor <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>key <span class="token operator">+</span> <span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> field <span class="token keyword">in</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>value<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    cursor<span class="token punctuation">.</span><span class="token keyword">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>IDBKeyRange 有一个实例方法<code>includes(key)</code>，返回一个布尔值，表示某个主键是否包含在当前这个主键组之内。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> keyRangeValue <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'K'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>keyRangeValue<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'F'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// true</span>keyRangeValue<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'W'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// false</span></code></pre><h2 id="createDatabase"><a href="#createDatabase" class="headerlink" title="createDatabase"></a>createDatabase</h2><pre class=" language-js"><code class="language-js">request<span class="token punctuation">.</span>onupgradeneeded <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>db<span class="token punctuation">.</span>objectStoreNames<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'persion'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">let</span> objcetStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'persion'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>keyPath<span class="token punctuation">:</span> <span class="token string">'id'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true">// db.createObjectStore(databaseName, options) options: keyPath 主键 或 autoIncrement 设置为true,两者只能存在一个 </span><span class="token punctuation">}</span></code></pre><h2 id="createIndex"><a href="#createIndex" class="headerlink" title="createIndex"></a>createIndex</h2><pre class=" language-js"><code class="language-js">objcetStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//方法用于新建当前数据库的一个索引。该方法只能在VersionChange监听函数里面调用,只有存在数据库后才能使用。</span>objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span>indexName<span class="token punctuation">,</span> keyPath<span class="token punctuation">,</span> objectParameters<span class="token punctuation">)</span>该方法可以接受三个参数。indexName：索引名keyPath：主键objectParameters：配置对象（可选）第三个参数可以配置以下属性。unique：如果设为<span class="token boolean">true</span>，将不允许重复的值multiEntry：如果设为<span class="token boolean">true</span>，对于有多个值的主键数组，每个值将在索引里面新建一个条目，否则主键数组对应一个条目。</code></pre><h2 id="add"><a href="#add" class="headerlink" title="add"></a>add</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span> email<span class="token punctuation">:</span> <span class="token string">'zhangsan@example.com'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  request<span class="token punctuation">.</span>onsuccess <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据写入成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  request<span class="token punctuation">.</span>onerror <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据写入失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>上面代码中，写入数据需要新建一个事务。新建时必须指定表格名称和操作模式（“只读”或“读写”）。新建事务以后，通过<code>IDBTransaction.objectStore(name)</code>方法，拿到 IDBObjectStore 对象，再通过表格对象的<code>add()</code>方法，向表格写入一条记录。</p><p>写入操作是一个异步操作，通过监听连接对象的<code>success</code>事件和<code>error</code>事件，了解是否写入成功。</p><h2 id="read"><a href="#read" class="headerlink" title="read"></a>read</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token keyword">var</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">var</span> objectStore <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">var</span> request <span class="token operator">=</span> objectStore<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   request<span class="token punctuation">.</span>onerror <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'事务失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">;</span>   request<span class="token punctuation">.</span>onsuccess <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Name: '</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>result<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Age: '</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>result<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Email: '</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>result<span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'未获得数据记录'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>   <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>上面代码中，<code>objectStore.get()</code>方法用于读取数据，参数是主键的值</p><h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><p>遍历数据表格的所有记录，要使用指针对象 IDBCursor。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   objectStore<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onsuccess <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">var</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Id: '</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Name: '</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Age: '</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Email: '</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>       cursor<span class="token punctuation">.</span><span class="token keyword">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'没有更多数据了！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>上面代码中，新建指针对象的<code>openCursor()</code>方法是一个异步操作，所以要监听<code>success</code>事件。</p><h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><p>更新数据要使用<code>IDBObject.put()</code>方法。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'李四'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span> email<span class="token punctuation">:</span> <span class="token string">'lisi@example.com'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  request<span class="token punctuation">.</span>onsuccess <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据更新成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  request<span class="token punctuation">.</span>onerror <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据更新失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>上面代码中，<code>put()</code>方法自动更新了主键为<code>1</code>的记录。</p><h2 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h2><p><code>IDBObjectStore.delete()</code>方法用于删除记录。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  request<span class="token punctuation">.</span>onsuccess <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据删除成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="use-Index"><a href="#use-Index" class="headerlink" title="use Index"></a>use Index</h2><p>索引的意义在于，可以让你搜索任意字段，也就是说从任意字段拿到数据记录。如果不建立索引，默认只能搜索主键（即从主键取值）。</p><p>假定新建表格的时候，对<code>name</code>字段建立了索引。</p><pre class=" language-js"><code class="language-js">objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> unique<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>现在，就可以从<code>name</code>找到对应的数据记录了。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readonly'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> store <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> index <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> request <span class="token operator">=</span> index<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'李四'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>request<span class="token punctuation">.</span>onsuccess <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> result <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ...</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ...</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Front </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 笔记 </tag>
            
            <tag> Web Storage </tag>
            
            <tag> IndexedDB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LocalStorage</title>
      <link href="/posts/de13.html"/>
      <url>/posts/de13.html</url>
      
        <content type="html"><![CDATA[<h1 id="localStorage"><a href="#localStorage" class="headerlink" title="localStorage"></a>localStorage</h1><p>localStorage，在HTML5中，新加入了一个localStorage特性，这个特性主要是用来作为本地存储来使用的，解决了cookie存储空间不足的问题(cookie中每条cookie的存储空间为4k)，localStorage中一般浏览器支持的是5M大小，这个在不同的浏览器中localStorage会有所不同。</p><p>(1).储存数据</p><pre><code>localStorage.setItem(&#39;accessToken&#39;, &#39;Bearer &#39; + response.data.result.accessToken)</code></pre><p>(2).取出数据</p><pre><code>localStorage.getItem(&#39;accessToken&#39;)</code></pre><p>(3).删除储存数据</p><pre><code> localStorage.removeItem(&#39;accessToken&#39;)</code></pre><p>(4).更改数据</p><pre><code>localStorage.setItem(&#39;accessToken&#39;, &#39;更改后&#39; + response.data.result.accessToken)</code></pre><p>使用时有两点需要注意过的地方：</p><p>localStorage在浏览器的隐私模式下面是不可读取的。<br>localStorage本质上是对字符串的读取，有json格式时需要JSON.stringify()转化为字符串。<br>localStorage不能被爬虫抓取到</p>]]></content>
      
      
      <categories>
          
          <category> Front </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 笔记 </tag>
            
            <tag> Web Storage </tag>
            
            <tag> LocalStorage </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue</title>
      <link href="/posts/ab06.html"/>
      <url>/posts/ab06.html</url>
      
        <content type="html"><![CDATA[<h2 id="Vue-js"><a href="#Vue-js" class="headerlink" title="Vue.js"></a>Vue.js</h2><h2 id="第-0-章-Vue-介绍"><a href="#第-0-章-Vue-介绍" class="headerlink" title="第 0 章 Vue 介绍"></a>第 0 章 Vue 介绍</h2><h3 id="0-0-开发工程发展历史"><a href="#0-0-开发工程发展历史" class="headerlink" title="0.0 开发工程发展历史"></a>0.0 开发工程发展历史</h3><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-13_14-13-19.png" alt=""></p><p>通过前面的介绍，我们对目前的项目工程化有了大体了了解，那么其中，在第二阶段的工程化演进中，有一个重要的工程设计理念诞生，他就是著名的 MVC 设计模式，简单点，MVC 其实就是为了项目工程化的一种分工模式；</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-13_21-43-05.png" alt=""></p><p>MVC 中的最大缺点就是单项输入输出，所有的 M 的变化及 V 层的变化，必须通过 C 层调用才能展示；</p><p>为了解决相应的问题，出现了 MVVM 的设计思想，简单理解就是实想数据层与展示层的相互调用，降低业务层面的交互逻辑；后面再进行详细介绍；</p><h3 id="0-1-Vue-介绍"><a href="#0-1-Vue-介绍" class="headerlink" title="0.1 Vue 介绍"></a>0.1 Vue 介绍</h3><p>Vue (读音 /vjuː/，类似于 <strong>view</strong>) 是一套用于构建用户界面的 <strong>渐进式框架</strong>。</p><p>注意：Vue 是一个框架，相对于 jq 库来说，是由本质区别的；</p><p><a href="https://cn.vuejs.org/" target="_blank" rel="noopener">https://cn.vuejs.org/</a></p><p>Vue <strong>不支持</strong> IE8 及以下版本，因为 Vue 使用了 IE8 无法模拟的 ECMAScript 5 特性。但它支持所有<a href="https://caniuse.com/#feat=es5" target="_blank" rel="noopener">兼容 ECMAScript 5 的浏览器</a>。</p><h3 id="0-2-Vue-初体验"><a href="#0-2-Vue-初体验" class="headerlink" title="0.2 Vue 初体验"></a>0.2 Vue 初体验</h3><p>直接下载引入：<a href="https://cn.vuejs.org/v2/guide/installation.html" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/installation.html</a></p><p>CDN 引入：</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.16/vue.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>最新版<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://cdn.jsdelivr.net/npm/vue/dist/vue.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>CDN 加速： <a href="https://www.bootcdn.cn/" target="_blank" rel="noopener">https://www.bootcdn.cn/</a></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    { {user_name} }  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>// 两种引入方式，任意选择<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 设置要操作的元素</span>    <span class="token comment" spellcheck="true">// 要替换的额数据</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      user_name<span class="token punctuation">:</span> <span class="token string">"我是一个div"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="0-3-学习-Vue"><a href="#0-3-学习-Vue" class="headerlink" title="0.3 学习 Vue"></a>0.3 学习 Vue</h3><p>基础知识 –&gt; 项目 –&gt; 构建工具 –&gt; Vue 其他相关技术</p><h2 id="第-1-章-Vue-实例对象"><a href="#第-1-章-Vue-实例对象" class="headerlink" title="第 1 章 Vue 实例对象"></a>第 1 章 Vue 实例对象</h2><p>每个 Vue 应用都是通过用 <code>Vue</code> 函数创建一个新的 <strong>Vue 实例</strong> 开始的：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 选项</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    { {user_name} }  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 设置要操作的元素</span>    <span class="token comment" spellcheck="true">// 要替换的额数据</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      user_name<span class="token punctuation">:</span> <span class="token string">"我是一个div"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 打印Vue实例对象</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-14_13-25-03.png" alt=""></p><p>通过打印实例对象发现，其中 el 被 Vue 放入了公有属性中，而 data 则被放入了 私有属性中，而 data 中的数据，需要被外部使用，于是 Vue 直接将 data 中的属性及属性值，直接挂载到 Vue 实例中，也就是说，data 中的数据，我们可以直接使用 <code>app.user_name</code> 直接调用；</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 设置要操作的元素</span>  <span class="token comment" spellcheck="true">// 要替换的额数据</span>  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>    user_name<span class="token punctuation">:</span> <span class="token string">"我是一个div"</span><span class="token punctuation">,</span>    user<span class="token punctuation">:</span> <span class="token number">222222</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>user_name<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="第-2-章-模板语法-插值"><a href="#第-2-章-模板语法-插值" class="headerlink" title="第 2 章 模板语法-插值"></a>第 2 章 模板语法-插值</h2><p>我们在前面的代码中，使用 { {} } 的形式在 html 中获取实例对象对象中 data 的属性值；</p><p>这种使用 { {} } 获取值得方式，叫做 <strong><em>插值</em></strong> 或 <strong><em>插值表达式</em></strong> ；</p><h3 id="2-1-文本"><a href="#2-1-文本" class="headerlink" title="2.1 文本"></a>2.1 文本</h3><p>数据绑定最常见的形式就是使用“Mustache”语法 (双大括号) 的文本插值：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>Message: { { ms g }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></code></pre><p>Mustache 标签将会被替代为对应数据对象上 <code>msg</code> 属性的值。无论何时，绑定的数据对象上 <code>msg</code> 属性发生了改变，插值处的内容都会更新。即便数据内容为一段 html 代码，仍然以文本内容展示</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    文本插值 { {html_str} }  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      html_str<span class="token punctuation">:</span> <span class="token string">"&lt;h2>Vue&lt;h2>"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>浏览器渲染结果：<code>&lt;div id=&quot;div&quot;&gt;文本插值 &lt;h2&gt;Vue&lt;h2&gt;&lt;/div&gt;</code></p><p>打开浏览器的 REPL 环境 输入 <code>app.html_str = &#39;&lt;s&gt;vue&lt;/s&gt;&#39;</code></p><p>随机浏览器渲染结果就会改变： <code>&lt;div id=&quot;div&quot;&gt;文本插值 &lt;s&gt;vue&lt;/s&gt;&lt;/div&gt;</code></p><pre class=" language-html"><code class="language-html">### 2.2 使用 JavaScript 表达式迄今为止，在我们的模板中，我们一直都只绑定简单的属性键值。但实际上，对于所有的数据绑定，Vue.js都提供了完全的 JavaScript 表达式支持，但是不能使用 JS 语句；(表达式是运算，有结果；语句就是代码，可以没有结果)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    { { u n > 3 ? '大' : '小'}} { { fu n() }}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      un<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>      fun<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h2 id="第-3-章-模板语法-指令"><a href="#第-3-章-模板语法-指令" class="headerlink" title="第 3 章 模板语法-指令"></a>第 3 章 模板语法-指令</h2><p>指令 (Directives) 是带有 <code>v-</code> 前缀的特殊特性。指令特性的值预期是<strong>单个 JavaScript 表达式</strong> (<code>v-for</code> 是例外情况，稍后我们再讨论)。指令的职责是，当表达式的值改变时，将其产生的连带影响，响应式地作用于 DOM；参考 <a href="https://cn.vuejs.org/v2/guide/syntax.html#%E6%8C%87%E4%BB%A4" target="_blank" rel="noopener">手册</a> 、 <a href="https://cn.vuejs.org/v2/api/#%E6%8C%87%E4%BB%A4" target="_blank" rel="noopener">API</a></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>seen<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>现在你看到我了<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      seen<span class="token punctuation">:</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>这里，<code>v-if</code> 指令将根据表达式 <code>seen</code> 的值的真假来插入/移除 <code>&lt;p&gt;</code> 元素。</p><h3 id="3-1-v-text-v-html-文本"><a href="#3-1-v-text-v-html-文本" class="headerlink" title="3.1 v-text / v-html 文本"></a>3.1 v-text / v-html 文本</h3><p><a href="https://cn.vuejs.org/v2/api/#v-text" target="_blank" rel="noopener">https://cn.vuejs.org/v2/api/#v-text</a></p><p><a href="https://cn.vuejs.org/v2/api/#v-html" target="_blank" rel="noopener">https://cn.vuejs.org/v2/api/#v-html</a></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span> <span class="token attr-name">{</span> <span class="token attr-name">{class}}</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>seen<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-html</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>str_html<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      seen<span class="token punctuation">:</span> <span class="token string">"&lt;h1>Vue&lt;/h1>"</span><span class="token punctuation">,</span>      str_html<span class="token punctuation">:</span> <span class="token string">"&lt;h1>Vue&lt;/h1>"</span><span class="token punctuation">,</span>      <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">"dd"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-15_10-18-14.png" alt=""></p><blockquote><p>注意：</p><ul><li>v-text<ul><li>v-text 和差值表达式的区别<ul><li>v-text 标签的指令更新整个标签中的内容(替换整个标签包括标签自身)</li><li>差值表达式，可以更新标签中局部的内容</li></ul></li></ul></li><li>v-html<ul><li>可以渲染内容中的 HTML 标签</li><li>尽量避免使用，否则会带来危险(XSS 攻击 跨站脚本攻击)</li></ul></li></ul></blockquote><p><strong>HTML 属性不能用 <code>{ {}}</code> 语 法</strong></p><h3 id="3-2-v-bind-属性绑定"><a href="#3-2-v-bind-属性绑定" class="headerlink" title="3.2 v-bind 属性绑定"></a>3.2 v-bind 属性绑定</h3><p><a href="https://cn.vuejs.org/v2/api/#v-bind" target="_blank" rel="noopener">https://cn.vuejs.org/v2/api/#v-bind</a></p><p>可以绑定标签上的任何属性。</p><p><strong>动态绑定图片的路径</strong></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>“app”<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-bind:</span>src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>src<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      src<span class="token punctuation">:</span> <span class="token string">"1.jpg"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p><strong>绑定 a 标签上的 id</strong></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-bind:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>del.php?id<span class="token punctuation">=</span><span class="token punctuation">'</span> + id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      id<span class="token punctuation">:</span> <span class="token number">11</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p><strong>绑定 class</strong></p><p>对象语法和数组语法</p><ul><li><p>对象语法</p><p>如果 isActive 为 true，则返回的结果为 <code>&lt;div id=&quot;app&quot; class=&quot;active&quot;&gt;&lt;/div&gt;</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-bind:</span>class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{active: isActive}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  hei<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      isActive<span class="token punctuation">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li><li><p>数组语法</p><p>渲染的结果： <code>&lt;div id=&quot;app&quot; class=&quot;active text-danger&quot;&gt;&lt;/div&gt;</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-bind:</span>class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>[activeClass, dangerClass]<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  hei<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      activeClass<span class="token punctuation">:</span> <span class="token string">"active"</span><span class="token punctuation">,</span>      dangerClass<span class="token punctuation">:</span> <span class="token string">"text-danger"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li></ul><p><strong>绑定 style</strong></p><p>对象语法和数组语法</p><ul><li><p>对象语法</p><p>渲染的结果： <code>&lt;div id=&quot;app&quot; style=&quot;color: red; font-size: 40px;&quot;&gt;hei&lt;/div&gt;</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-bind:</span></span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token punctuation">{</span><span class="token property">color</span><span class="token punctuation">:</span> redColor, <span class="token property">fontSize</span><span class="token punctuation">:</span> font + <span class="token string">'px'</span><span class="token punctuation">}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  hei<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      redColor<span class="token punctuation">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span>      font<span class="token punctuation">:</span> <span class="token number">40</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li><li><p>数组语法</p><p>渲染结果：<code>&lt;div id=&quot;app&quot; style=&quot;color: red; font-size: 18px;&quot;&gt;abc&lt;/div&gt;</code></p></li></ul><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-bind:</span></span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value">[color, fontSize]</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>abc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      color<span class="token punctuation">:</span> <span class="token punctuation">{</span>        color<span class="token punctuation">:</span> <span class="token string">"red"</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      fontSize<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token string">"font-size"</span><span class="token punctuation">:</span> <span class="token string">"18px"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p><strong>简化语法</strong></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>imageSrc<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 缩写 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>imageSrc<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      imageSrc<span class="token punctuation">:</span> <span class="token string">"1.jpg"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="3-3-v-model-双向数据绑定"><a href="#3-3-v-model-双向数据绑定" class="headerlink" title="3.3 v-model 双向数据绑定"></a>3.3 v-model 双向数据绑定</h3><p><a href="https://cn.vuejs.org/v2/api/#v-model" target="_blank" rel="noopener">https://cn.vuejs.org/v2/api/#v-model</a></p><p><strong>单向数据绑定</strong></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input_val<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      input_val<span class="token punctuation">:</span> <span class="token string">"hello world "</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>浏览器渲染结果： <code>&lt;div id=&quot;div&quot;&gt;&lt;input type=&quot;text&quot; value=&quot;hello world&quot;&gt;&lt;/div&gt;</code></p><p>通过浏览器 REPL 环境可以进行修改 <code>app.input_val = &#39;Vue&#39;</code></p><p>浏览器渲染结果： <code>&lt;div id=&quot;div&quot;&gt;&lt;input type=&quot;text&quot; value=&quot;Vue&quot;&gt;&lt;/div&gt;</code></p><p>我们通过 vue 对象修改数据可以直接影响到 DOM 元素，但是，如果直接修改 DOM 元素，却不会影响到 vue 对象的数据；我们把这种现象称为 <strong><em>单向数据绑定</em></strong> ；</p><p><strong>双向数据绑定</strong></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input_val<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      input_val<span class="token punctuation">:</span> <span class="token string">"hello world "</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>通过 v-model 指令展示表单数据，此时就完成了 <strong><em>双向数据绑定</em></strong> ；</p><p>不管 DOM 元素还是 vue 对象，数据的改变都会影响到另一个；</p><p><strong>多行文本 / 文本域</strong></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>inp_val<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>{ { inp_va l }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      inp_val<span class="token punctuation">:</span> <span class="token string">""</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p><strong>绑定复选框</strong></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  吃饭：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>eat<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checklist<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>  睡觉：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sleep<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checklist<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>  打豆豆：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ddd<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checklist<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>  { { checklis t }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      checklist<span class="token punctuation">:</span> <span class="token string">""</span>      <span class="token comment" spellcheck="true">// checklist: []</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p><strong>绑定单选框</strong></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  男<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>男<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> 女<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span>    <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span>    <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>女<span class="token punctuation">"</span></span>    <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span>  <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>  { {sex} }<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      sex<span class="token punctuation">:</span> <span class="token string">""</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p><strong>修饰符</strong></p><p><a href="https://cn.vuejs.org/v2/guide/forms.html#lazy" target="_blank" rel="noopener"><code>.lazy</code></a> - 取代 <code>input</code> 监听 <code>change</code> 事件</p><p><a href="https://cn.vuejs.org/v2/guide/forms.html#number" target="_blank" rel="noopener"><code>.number</code></a> - 输入字符串转为有效的数字</p><p><a href="https://cn.vuejs.org/v2/guide/forms.html#trim" target="_blank" rel="noopener"><code>.trim</code></a> - 输入首尾空格过滤</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model.lazy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input_val<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  { {input_val} }<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      input_val<span class="token punctuation">:</span> <span class="token string">"hello world "</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="3-4-v-on-绑定事件监听"><a href="#3-4-v-on-绑定事件监听" class="headerlink" title="3.4 v-on 绑定事件监听"></a>3.4 v-on 绑定事件监听</h3><p><a href="https://cn.vuejs.org/v2/api/#v-on" target="_blank" rel="noopener">https://cn.vuejs.org/v2/api/#v-on</a></p><p><a href="https://cn.vuejs.org/v2/guide/events.html" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/events.html</a></p><h4 id="3-4-1-基本使用"><a href="#3-4-1-基本使用" class="headerlink" title="3.4.1 基本使用"></a>3.4.1 基本使用</h4><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>按钮<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cli<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      cli<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>上面的代码运行是没有问题的，但是，我们不建议这样做，因为 data 是专门提供数据的对象，事件触发需要执行的是一段代码，需要的是一个方法 (事件处理程序) ；</p><p>修改代码如下：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 使用事件绑定的简写形式 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>按钮<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cli<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 将事件处理程序写入methods对象</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      cli<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p><strong>向事件处理器中传参</strong></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 直接调用传参即可 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>按钮<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cli(1,3)<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 接受参数</span>      cli<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">alert</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>而此时，如果在处理器中需要使用事件对象，则无法获取，我们可以用特殊变量 <code>$event</code> 把它传入方法</p><p><code>&lt;input type=&quot;button&quot; value=&quot;按钮&quot; @click=&quot;cli(1,3,$event)&quot;&gt;</code></p><pre class=" language-js"><code class="language-js">methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 接受参数</span>    cli<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">alert</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="3-4-2-事件修饰符"><a href="#3-4-2-事件修饰符" class="headerlink" title="3.4.2 事件修饰符"></a>3.4.2 事件修饰符</h4><p>原生 JS 代码，想要阻止浏览器的默认行为(a 标签跳转、submit 提交)，我们要使用事件对象的 <code>preventDefault()</code> 方法</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.qq.com<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>腾百万<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> ev <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 组织浏览器的默认行为</span>    ev<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>使用修饰符 阻止浏览器的默认行为</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.qq.com<span class="token punctuation">"</span></span> <span class="token attr-name">@click.prevent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cli<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>腾百万<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 将事件处理程序写入methods对象</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      cli<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>使用修饰符绑定一次性事件</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.qq.com<span class="token punctuation">"</span></span> <span class="token attr-name">@click.once</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cli($event)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>腾百万<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 将事件处理程序写入methods对象</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      cli<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ev<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h4 id="3-4-3-按键修饰符"><a href="#3-4-3-按键修饰符" class="headerlink" title="3.4.3 按键修饰符"></a>3.4.3 按键修饰符</h4><p>绑定键盘抬起事件，但是只有<code>enter</code> 键能触发此事件</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">@keyup.enter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>keyup<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      keyup<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"111"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h4 id="3-4-4-系统修饰符"><a href="#3-4-4-系统修饰符" class="headerlink" title="3.4.4 系统修饰符"></a>3.4.4 系统修饰符</h4><p>按住 <code>shift</code> 后才能触发点击事件</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>按钮<span class="token punctuation">"</span></span> <span class="token attr-name">@click.shift</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cli<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      cli<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"111"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h4 id="3-4-5-鼠标修饰符"><a href="#3-4-5-鼠标修饰符" class="headerlink" title="3.4.5 鼠标修饰符"></a>3.4.5 鼠标修饰符</h4><p>鼠标中键触发事件</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>按钮<span class="token punctuation">"</span></span> <span class="token attr-name">@click.middle</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cli<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      cli<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"111"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h4 id="3-4-6-为什么在-HTML-中监听事件"><a href="#3-4-6-为什么在-HTML-中监听事件" class="headerlink" title="3.4.6 为什么在 HTML 中监听事件?"></a>3.4.6 为什么在 HTML 中监听事件?</h4><blockquote><p>你可能注意到这种事件监听的方式违背了关注点分离 (separation of concern) 这个长期以来的优良传统。但不必担心，因为所有的 Vue.js 事件处理方法和表达式都严格绑定在当前视图的 ViewModel 上，它不会导致任何维护上的困难。实际上，使用 <code>v-on</code> 有几个好处：</p><ol><li>扫一眼 HTML 模板便能轻松定位在 JavaScript 代码里对应的方法。</li><li>因为你无须在 JavaScript 里手动绑定事件，你的 ViewModel 代码可以是非常纯粹的逻辑，和 DOM 完全解耦，更易于测试。</li><li>当一个 ViewModel 被销毁时，所有的事件处理器都会自动被删除。你无须担心如何清理它们。</li></ol></blockquote><h3 id="3-5-v-show-显示隐藏"><a href="#3-5-v-show-显示隐藏" class="headerlink" title="3.5 v-show 显示隐藏"></a>3.5 v-show 显示隐藏</h3><p><a href="https://cn.vuejs.org/v2/api/#v-show" target="_blank" rel="noopener">https://cn.vuejs.org/v2/api/#v-show</a></p><p>根据表达式之真假值，切换元素的 <code>display</code> CSS 属性。</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>is_show<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Vue<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      is_show<span class="token punctuation">:</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>案例：点击按钮切换隐藏显示</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>按钮<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>isshow<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>is_show<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Vue<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      is_show<span class="token punctuation">:</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      isshow<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>is_show <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>is_show<span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="3-6-v-if-v-else-v-else-if-条件判断"><a href="#3-6-v-if-v-else-v-else-if-条件判断" class="headerlink" title="3.6 v-if / v-else / v-else-if 条件判断"></a>3.6 v-if / v-else / v-else-if 条件判断</h3><p><a href="https://cn.vuejs.org/v2/api/#v-if" target="_blank" rel="noopener">https://cn.vuejs.org/v2/api/#v-if</a></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>type <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">'</span>A<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    A  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>type <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">'</span>B<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    B  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>type <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">'</span>C<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    C  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span><span class="token punctuation">></span></span>    Not A/B/C  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      type<span class="token punctuation">:</span> <span class="token string">"F"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="3-7-v-for-循环"><a href="#3-7-v-for-循环" class="headerlink" title="3.7 v-for 循环"></a>3.7 v-for 循环</h3><p><a href="https://cn.vuejs.org/v2/api/#v-for" target="_blank" rel="noopener">https://cn.vuejs.org/v2/api/#v-for</a></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(val,key) in arr<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{ {val}}--- { {key}}&lt; /li><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(val,key) in obj<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      { {val}}--- { {key}}&lt; /li> // in 也可以用 of 来替换 如： （val,key）of      obj,两者没有区别    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      obj<span class="token punctuation">:</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">"李四"</span> <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>//v-for 不只可以传入两个参数 ，可以传三个，顺序作用分别：(value 当前遍历的值,键名name, 索引index)</code></pre><h3 id="3-8-v-cloak"><a href="#3-8-v-cloak" class="headerlink" title="3.8 v-cloak"></a>3.8 v-cloak</h3><p><a href="https://cn.vuejs.org/v2/api/#v-cloak" target="_blank" rel="noopener">https://cn.vuejs.org/v2/api/#v-cloak</a></p><p>和 CSS 规则如 <code>[v-cloak] { display: none }</code> 一起用时，这个指令可以隐藏未编译的 Mustache 标签直到实例准备完毕。</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{ {obj.i d}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>      data<span class="token punctuation">:</span> <span class="token punctuation">{</span>        arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        obj<span class="token punctuation">:</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">"李四"</span> <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>当我们的网络受阻时，或者页面加载完毕而没有初始化得到 vue 实例时，DOM 中的 <code>{ {}}</code> 则会展示出来 ；</p><p>为了防止现象，我们可以使用 CSS 配合 v-cloak 实现获取 VUE 实例前的隐藏；</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">  <span class="token selector"><span class="token attribute">[v-cloak]</span> </span><span class="token punctuation">{</span>    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>  <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-cloak</span><span class="token punctuation">></span></span>{ {obj.i d}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>      data<span class="token punctuation">:</span> <span class="token punctuation">{</span>        obj<span class="token punctuation">:</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">"李四"</span> <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="3-9-v-once"><a href="#3-9-v-once" class="headerlink" title="3.9 v-once"></a>3.9 v-once</h3><p><a href="https://cn.vuejs.org/v2/api/#v-once" target="_blank" rel="noopener">https://cn.vuejs.org/v2/api/#v-once</a></p><p>只渲染元素和组件<strong>一次</strong>。随后的重新渲染，元素/组件及其所有的子节点将被视为静态内容并跳过</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-once</span><span class="token punctuation">></span></span>{ {msg}}&lt; /p><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      msg<span class="token punctuation">:</span> <span class="token string">"kkk"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="补充：数组更新检测-对象更新检测"><a href="#补充：数组更新检测-对象更新检测" class="headerlink" title="补充：数组更新检测/对象更新检测"></a>补充：数组更新检测/对象更新检测</h3><p><a href="https://cn.vuejs.org/v2/guide/list.html#%E6%95%B0%E7%BB%84%E6%9B%B4%E6%96%B0%E6%A3%80%E6%B5%8B" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/list.html#%E6%95%B0%E7%BB%84%E6%9B%B4%E6%96%B0%E6%A3%80%E6%B5%8B</a></p><p>在 vue 的数据双向绑定中，数组以：arr[0] = value ，obj.v=1 等方式赋值或添加，都不会触发视图的更新，也就不能实现双向绑定，之所以会这样是因为在 Vue 每个数据都会进行包装/包囊，直接修改就会把包装给卸掉，但是也不是没有解决办法，解决这种情况可以使用以下几种方式：</p><h4 id="数组监测"><a href="#数组监测" class="headerlink" title="数组监测"></a>数组监测</h4><pre class=" language-js"><code class="language-js"><span class="token number">1</span><span class="token punctuation">.</span>使用数组自带的添加、删除等等方法<span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token number">2</span><span class="token punctuation">.</span>改变引用\替换数组如：（<span class="token number">1</span>）使用一些会返回一个新数组的方法example1<span class="token punctuation">.</span>items <span class="token operator">=</span> example1<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> item<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/Foo/</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token function">这样的方法有：filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">、concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 和 <span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>等（<span class="token number">2</span>）直接重置赋值<span class="token punctuation">,</span>在原有的基础上添加、删除等如：   原数组attr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>      attr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>      这样也会改变引用<span class="token number">3</span><span class="token punctuation">.</span>使用<span class="token keyword">set</span>\$<span class="token keyword">set</span>方法</code></pre><h4 id="对象监测"><a href="#对象监测" class="headerlink" title="对象监测"></a>对象监测</h4><pre class=" language-js"><code class="language-js"><span class="token number">1</span><span class="token punctuation">.</span>改变引用\重载对象和数组同理，在这使用对象独有的 Object<span class="token punctuation">.</span>assign 和jquery的$<span class="token punctuation">.</span>extendObject<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>userProfile<span class="token punctuation">,</span> <span class="token punctuation">{</span>  age<span class="token punctuation">:</span> <span class="token number">27</span><span class="token punctuation">,</span>  favoriteColor<span class="token punctuation">:</span> <span class="token string">'Vue Green'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>上面这种方式和直接obj<span class="token punctuation">.</span>a <span class="token operator">=</span> v一样，视图不会更新，要想发威作用必须以下面的方式vm<span class="token punctuation">.</span>userProfile <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>vm<span class="token punctuation">.</span>userProfile<span class="token punctuation">,</span><span class="token punctuation">{</span>age<span class="token punctuation">:</span><span class="token number">27</span><span class="token punctuation">,</span>favoriteColor<span class="token punctuation">:</span><span class="token string">'Vue Green'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>assign源对象不能直接是vue的数据，并且还要对vue指定的数据进行重置赋值<span class="token number">2</span><span class="token punctuation">.</span>使用<span class="token keyword">set</span><span class="token operator">/</span>$<span class="token keyword">set</span>方法</code></pre><h4 id="set-set-方法的使用"><a href="#set-set-方法的使用" class="headerlink" title="set/$set 方法的使用"></a>set/$set 方法的使用</h4><pre class=" language-js"><code class="language-js">Vue<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>object 要添加等操作的数据<span class="token punctuation">,</span> propertyName 键名<span class="token punctuation">,</span> value 值<span class="token punctuation">)</span>Vue<span class="token punctuation">.</span>$<span class="token keyword">set</span> 是vue的实例方法也是全局方法，使用方式和<span class="token keyword">set</span>一样Vue<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>items<span class="token punctuation">,</span> indexOfItem<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>vm<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>indexOfItem<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>vm<span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>items<span class="token punctuation">,</span> indexOfItem<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span></code></pre><h3 id="补充：is"><a href="#补充：is" class="headerlink" title="补充：is"></a>补充：is</h3><p><a href="https://cn.vuejs.org/v2/api/#is" target="_blank" rel="noopener">https://cn.vuejs.org/v2/api/#is</a></p><p><a href="https://cn.vuejs.org/v2/guide/components.html#%E5%8A%A8%E6%80%81%E7%BB%84%E4%BB%B6" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/components.html#%E5%8A%A8%E6%80%81%E7%BB%84%E4%BB%B6</a></p><p>is 命令的使用场景通常在必须使用固定的 DOM 子元素的 table、ul、select 等 DOM 元素上，解决组件在这些 DOM 中的使用发生错乱的问题，is 可以让 DOM 编译时改变成指定的组件</p><p>不受这种影响的情况有：</p><ul><li><p>字符串 (例如：<code>template: &#39;...&#39;</code>)</p></li><li><p><a href="https://cn.vuejs.org/v2/guide/single-file-components.html" target="_blank" rel="noopener">单文件组件 (<code>.vue</code>)</a></p></li></ul><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 当 <span class="token template-string"><span class="token string">`currentView`</span></span> 改变时，组件也跟着改变 <span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span>component v<span class="token operator">-</span>bind<span class="token punctuation">:</span>is<span class="token operator">=</span><span class="token string">"currentView"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>component<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 这样做是有必要的，因为 <span class="token template-string"><span class="token string">`&lt;my-row>`</span></span> 放在一个 <span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token template-string"><span class="token string">`&lt;table>`</span></span> 内可能无效且被放置到外面 <span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span>table<span class="token operator">></span>  <span class="token operator">&lt;</span>tr is<span class="token operator">=</span><span class="token string">"my-row"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">></span></code></pre><h2 id="第-4-章-TodoList-案例"><a href="#第-4-章-TodoList-案例" class="headerlink" title="第 4 章 TodoList 案例"></a>第 4 章 TodoList 案例</h2><p>上市产品： <a href="http://www.todolist.cn/" target="_blank" rel="noopener">ToDoList</a> 、<a href="https://www.wunderlist.com/zh/" target="_blank" rel="noopener">奇妙清单</a> 、<a href="https://www.dida365.com/" target="_blank" rel="noopener">滴答清单</a></p><p>学习练手项目 ： <a href="http://todomvc.com/" target="_blank" rel="noopener">TodoMVC</a> 、 <a href="https://cn.vuejs.org/v2/examples/todomvc.html" target="_blank" rel="noopener">Vue 官方示例</a></p><p>为什么选择这样的案例：</p><p>产品功能简洁，需求明确，所需知识点丰富；实现基本功能容易，涵盖所学基础知识；而可扩展性强，完善所有功能比较复杂，所需技术众多；在学习中，可以灵活取舍；</p><h3 id="4-1-项目初始化"><a href="#4-1-项目初始化" class="headerlink" title="4.1 项目初始化"></a>4.1 项目初始化</h3><p>在项目目录中执行 <code>npm install</code> 命令，下载所需静态资源 ; 将 Vue.js 框架代码，复制到 js 目录，在 index.html 中引入 vue : <code>&lt;script src=&quot;./js/vue.js&quot;&gt;&lt;/script&gt;</code></p><p>同时 在 index.html 最下方，项目引入了 app.js ; 而我们要写的 vuejs 代码，都放在这个文件中；</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-15_17-22-36.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-15_17-22-51.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-15_17-23-06.png" alt=""></p><h3 id="4-2-数据遍历"><a href="#4-2-数据遍历" class="headerlink" title="4.2 数据遍历"></a>4.2 数据遍历</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> list_data <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">"吃饭"</span><span class="token punctuation">,</span> stat<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">"睡觉"</span><span class="token punctuation">,</span> stat<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">"打豆豆"</span><span class="token punctuation">,</span> stat<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token punctuation">:</span> <span class="token string">"#todoapp"</span><span class="token punctuation">,</span>  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// list_data:list_data,</span>    list_data <span class="token comment" spellcheck="true">// es6属性简写</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>todo-list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(val,key) in list_data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>view<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toggle<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>val.stat<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span>{ {val.titl e}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>destroy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>edit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Rule the web<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></code></pre><h3 id="4-3-展示无数据状态"><a href="#4-3-展示无数据状态" class="headerlink" title="4.3 展示无数据状态"></a>4.3 展示无数据状态</h3><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-15_17-59-59.png" alt=""></p><p>标签及内容都是在 section footer 两个标签中的，当 list_data 中没有数据时，我们只需要隐藏这个两个标签即可：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list_data.length<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  ……<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list_data.length<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  ……<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span></code></pre><p>两个标签都有 <code>v-if</code> 判断 ，因此我们可以使用一个 <code>div</code> 包裹两个标签，使 <code>div</code> 隐藏即可：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list_data.length<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    ……  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    ……  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>如果有内容，那么 DOM 书中就会多出一个 div 标签，那么我们可以选择使用 <code>template</code> (vue 中的模板标识)，有内容时，浏览器渲染不会有此节点；</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list_data.length<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    ……  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    ……  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre><h3 id="4-3-添加任务"><a href="#4-3-添加任务" class="headerlink" title="4.3 添加任务"></a>4.3 添加任务</h3><p>绑定 <code>enter</code> 键盘事件:</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">@keyup.enter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>addTodo<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>new-todo<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>请输入<span class="token punctuation">"</span></span> <span class="token attr-name">autofocus</span> <span class="token punctuation">/></span></span></code></pre><pre class=" language-js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token punctuation">:</span> <span class="token string">"#todoapp"</span><span class="token punctuation">,</span>  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// list_data:list_data,</span>    list_data <span class="token comment" spellcheck="true">// es6属性简写</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//添加事件处理器</span>  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// addTodo:function(){}</span>    <span class="token comment" spellcheck="true">// 简写形式</span>    <span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>修改代码完成任务添加：</p><pre class=" language-js"><code class="language-js">methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 添加任务</span>    <span class="token comment" spellcheck="true">// addTodo:function(){}</span>    <span class="token comment" spellcheck="true">// 简写形式</span>    <span class="token function">addTodo</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 获取当前触发事件的元素</span>        <span class="token keyword">var</span> inputs <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 获取value值，去除空白后判断，如果为空，则不添加任务</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>inputs<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 组装任务数据</span>        <span class="token keyword">var</span> todo_data <span class="token operator">=</span> <span class="token punctuation">{</span>            id<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list_data<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> inputs<span class="token punctuation">.</span>value<span class="token punctuation">,</span>            stat<span class="token punctuation">:</span> <span class="token boolean">false</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 将数据添加进数组</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>list_data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>todo_data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 清空文本框内容</span>        inputs<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="4-4-任务的全选与反选"><a href="#4-4-任务的全选与反选" class="headerlink" title="4.4 任务的全选与反选"></a>4.4 任务的全选与反选</h3><p>点击文本框左边的下箭头，实现全选和反选操作</p><p>为元素绑定点击事件：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toggleAll<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toggle-all<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toggle-all<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><p>添加处理程序：</p><pre class=" language-js"><code class="language-js"><span class="token function">toggleAll</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">// 获取点击的元素</span>    <span class="token keyword">var</span> inputs <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// console.log(inputs.checked);</span>    <span class="token comment" spellcheck="true">// 循环所有数据为状态重新赋值</span>    <span class="token comment" spellcheck="true">// 因为每个元素的选中状态都是使用 v-model 的双向数据绑定，</span>    <span class="token comment" spellcheck="true">// 因此 数据发生改变，状态即改变，状态改变，数据也会改变</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>list_data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>list_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>stat <span class="token operator">=</span> inputs<span class="token punctuation">.</span>checked<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="4-5-完成任务"><a href="#4-5-完成任务" class="headerlink" title="4.5 完成任务"></a>4.5 完成任务</h3><p>如果任务完成，状态改为选中， <code>li</code> 的 <code>class</code> 属性为 <code>completed</code> 时文字有中划线；</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(val,key) in list_data<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-bind:</span>class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{completed:val.stat}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></code></pre><h3 id="4-6-删除任务"><a href="#4-6-删除任务" class="headerlink" title="4.6 删除任务"></a>4.6 删除任务</h3><p>绑定点击事件，将当前索引值传入事件处理程序：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>removeTodo(key)<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>destroy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></code></pre><p>按照索引，删除相应的数据：</p><pre class=" language-js"><code class="language-js"><span class="token function">removeTodo</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>list_data<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><h3 id="4-7-删除已完成的任务"><a href="#4-7-删除已完成的任务" class="headerlink" title="4.7 删除已完成的任务"></a>4.7 删除已完成的任务</h3><p>绑定事件</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>removeAllDone<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>clear-completed<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Clear completed<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></code></pre><p>循环遍历所有数据，删除已被标记为完成的任务：</p><pre class=" language-js"><code class="language-js"><span class="token function">removeAllDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>list_data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>list_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>stat <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>list_data<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>循环的代码看起来很不舒服, <strong><code>Array.prototype.filter()</code></strong> 方法创建一个新数组, 其包含通过所提供函数实现的测试的所有元素。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 原始写法</span><span class="token comment" spellcheck="true">// var new_arr = arr.filter(function(v){</span><span class="token comment" spellcheck="true">//     // if(v>8){</span><span class="token comment" spellcheck="true">//     //     return true;</span><span class="token comment" spellcheck="true">//     // }</span><span class="token comment" spellcheck="true">//     return v>8;</span><span class="token comment" spellcheck="true">// })</span><span class="token comment" spellcheck="true">// 箭头函数写法</span><span class="token comment" spellcheck="true">// var new_arr = arr.filter((v)=>{</span><span class="token comment" spellcheck="true">//     return v>8;</span><span class="token comment" spellcheck="true">// })</span><span class="token comment" spellcheck="true">// 精简写法</span><span class="token keyword">var</span> new_arr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">></span> v <span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>new_arr<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>修改项目代码：</p><pre class=" language-js"><code class="language-js"><span class="token function">removeAllDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 原始循环判断用法</span>    <span class="token comment" spellcheck="true">// for(let i=0;i&lt;list_data.length;i++){</span>    <span class="token comment" spellcheck="true">//     if(list_data[i].stat == true){</span>    <span class="token comment" spellcheck="true">//         this.list_data.splice(i,1);</span>    <span class="token comment" spellcheck="true">//     }</span>    <span class="token comment" spellcheck="true">// }</span>    <span class="token comment" spellcheck="true">// 上面是循环删除符合条件的数据</span>    <span class="token comment" spellcheck="true">// 下面是保留不符合条件的数据</span>    <span class="token comment" spellcheck="true">// 原始标准库对象方法</span>    <span class="token comment" spellcheck="true">// this.list_data = this.list_data.filter(function(v){</span>    <span class="token comment" spellcheck="true">//     if(v.stat == false){</span>    <span class="token comment" spellcheck="true">//         return true;</span>    <span class="token comment" spellcheck="true">//     }</span>    <span class="token comment" spellcheck="true">// })</span>    <span class="token comment" spellcheck="true">// 箭头函数方法</span>    <span class="token comment" spellcheck="true">// this.list_data = this.list_data.filter(function(v){</span>    <span class="token comment" spellcheck="true">//     return !v.stat;</span>    <span class="token comment" spellcheck="true">// })</span>    <span class="token comment" spellcheck="true">// 精简方法</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>list_data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list_data<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token operator">!</span>v<span class="token punctuation">.</span>stat<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>TodoList 案例暂时告一段落，我们并没有将产品做完，因为我们需要用到其他知识了；</p><blockquote><h5 id="Vue-Devtools-调试工具"><a href="#Vue-Devtools-调试工具" class="headerlink" title="Vue Devtools 调试工具"></a><a href="https://cn.vuejs.org/v2/guide/installation.html#Vue-Devtools" target="_blank" rel="noopener">Vue Devtools</a> 调试工具</h5><p>在使用 Vue 时，我们推荐在你的浏览器上安装 <a href="https://github.com/vuejs/vue-devtools#vue-devtools" target="_blank" rel="noopener">Vue Devtools</a>。它允许你在一个更友好的界面中审查和调试 Vue 应用。</p></blockquote><h2 id="第-5-章-MVVM-设计思想"><a href="#第-5-章-MVVM-设计思想" class="headerlink" title="第 5 章 MVVM 设计思想"></a>第 5 章 MVVM 设计思想</h2><p><strong>MVC 设计思想：</strong></p><p>M: model 数据模型层 提供数据</p><p>V: Views 视图层 渲染数据</p><p>C: controller 控制层 调用数据渲染视图</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-20_12-59-04.png" alt=""></p><p><strong>MVVM 设计思想：</strong></p><p>M: model 数据模型层 提供数据</p><p>V: Views 视图层 渲染数据</p><p>VM：ViewsModel 视图模型层 调用数据渲染视图</p><p>​ 由数据来驱动视图（不需要过多考虑 dom 操作，把重心放在 VM）</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-20_13-42-18.png" alt=""></p><h2 id="第-6-章-其他知识点汇总"><a href="#第-6-章-其他知识点汇总" class="headerlink" title="第 6 章 其他知识点汇总"></a>第 6 章 其他知识点汇总</h2><h3 id="6-1-计算属性与侦听器"><a href="#6-1-计算属性与侦听器" class="headerlink" title="6.1 计算属性与侦听器"></a>6.1 计算属性与侦听器</h3><h4 id="6-1-1-计算属性"><a href="#6-1-1-计算属性" class="headerlink" title="6.1.1 计算属性"></a>6.1.1 计算属性</h4><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xing<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ming<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  { {xing + ming}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      xing<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>      ming<span class="token punctuation">:</span> <span class="token string">""</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>模板内的表达式非常便利，但是设计它们的初衷是用于简单运算的。在模板中放入太多的逻辑会让模板过重且难以维护。因此我们可以使用方法，来进行运算并返回数据：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xing<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ming<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  { { fullnam e() }}  <span class="token comment" spellcheck="true">&lt;!-- 一百次调用，观察时间结果--></span>  { { fullnam e() }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      xing<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>      ming<span class="token punctuation">:</span> <span class="token string">""</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token function">fullname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>xing <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ming <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>注意，每次在模板中使用 <code>{ { fullnam e() }}</code> fullname 方法就会被调用执行一次；所以，对于任何复杂逻辑，你都应当使用<strong>计算属性</strong> ，因为计算属性，会自动缓存数据：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xing<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ming<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>  { {fulln} }  <span class="token comment" spellcheck="true">&lt;!-- 一百次调用 --></span>  { {fulln} }<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      xing<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>      ming<span class="token punctuation">:</span> <span class="token string">""</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token function">fulln</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>xing <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ming <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>我们可以将同一函数定义为一个方法而不是一个计算属性。两种方式的最终结果确实是完全相同的。然而，不同的是<strong>计算属性是基于它们的依赖进行缓存的</strong>。只在相关依赖发生改变时它们才会重新求值；多次调用，计算属性会立即返回之前的计算结果，而不必再次执行函数。</p><h4 id="6-1-2-利用计算属性获取未完成任务个数"><a href="#6-1-2-利用计算属性获取未完成任务个数" class="headerlink" title="6.1.2 利用计算属性获取未完成任务个数"></a>6.1.2 利用计算属性获取未完成任务个数</h4><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>todo-count<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">></span></span>{ {getNu}}&lt; /strong> item left<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></code></pre><pre class=" language-js"><code class="language-js">computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 未完成任务个数</span>    <span class="token function">getNu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>list_data<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">!</span>v<span class="token punctuation">.</span>stat<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="6-1-3-使用侦听器"><a href="#6-1-3-使用侦听器" class="headerlink" title="6.1.3 使用侦听器"></a>6.1.3 使用侦听器</h4><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xing<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ming<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  { { fullnam e }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      xing<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>      ming<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>      fullname<span class="token punctuation">:</span> <span class="token string">""</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 设置侦听器</span>    watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 侦听器中的方法名和要真挺的数据属性名必须一致</span>      <span class="token comment" spellcheck="true">// xing 发生变化，侦听器就会被执行，且将变化后的值和变化前的值传入</span>      xing<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> old_val<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>fullname <span class="token operator">=</span> newVal <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ming<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      ming<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>fullname <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>xing <span class="token operator">+</span> newVal<span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>通过上面的案例，我们基本掌握了侦听器的使用，但是我们也发现，与计算属性相比，侦听器并没有优势；也不见得好用，直观上反而比计算属性的使用更繁琐；</p><p>虽然计算属性在大多数情况下更合适，但有时也需要一个自定义的侦听器。这就是为什么 Vue 通过 <code>watch</code> 选项提供了一个更通用的方法，来响应数据的变化。当需要在数据变化时执行异步或开销较大的操作时，这个方式是最有用的。</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xing<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ming<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  { { fullnam e }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./jq.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#div"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      xing<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>      ming<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>      fullname<span class="token punctuation">:</span> <span class="token string">""</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 设置侦听器</span>    watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 侦听器中的方法名和要真挺的数据属性名必须一致</span>      <span class="token comment" spellcheck="true">// xing 发生变化，侦听器就会被执行，且将变化后的值和变化前的值传入</span>      xing<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> old_val<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// this.fullname = newVal+this.ming;</span>        <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 在侦听器中执行异步网络请求</span>        $<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"./xx.php"</span><span class="token punctuation">,</span> d <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          t<span class="token punctuation">.</span>fullname <span class="token operator">=</span> d<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="6-2-使用-ref-操作-DOM"><a href="#6-2-使用-ref-操作-DOM" class="headerlink" title="6.2 使用 ref 操作 DOM"></a>6.2 使用 ref 操作 DOM</h3><p>在学习 jq 时，我们首要任务就是学习选择的使用，因为选择可以极其方便帮助我们获取节点查找 dom，因为我们要通过 dom 展示处理数据。而在 Vue 中，我们的编程理念发生了变化，变为了数据驱动 dom；但有时我们因为某些情况不得不脱离数据操作 dom,因此 vue 为我们提供了 ref 属性获取 dom 节点；</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>click<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>按钮<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pv<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>123<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      click<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 使用原生JS获取dom数据</span>        <span class="token comment" spellcheck="true">// var p = document.getElementsByTagName('p')[0].innerHTML;</span>        <span class="token comment" spellcheck="true">// console.log(p);</span>        <span class="token comment" spellcheck="true">// 使用vue ref 属性获取dom数据</span>        <span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>pv<span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>$refs<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>但是在项目开发中，尽可能不要这样做，因为从一定程度上，ref 违背的 mvvm 设计原则；</p><h3 id="6-3-过滤器的使用"><a href="#6-3-过滤器的使用" class="headerlink" title="6.3 过滤器的使用"></a>6.3 过滤器的使用</h3><h4 id="6-3-1-私有-局部-过滤器"><a href="#6-3-1-私有-局部-过滤器" class="headerlink" title="6.3.1 私有(局部)过滤器"></a>6.3.1 私有(局部)过滤器</h4><p><strong>定义过滤器</strong></p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>  data<span class="token punctuation">:</span> <span class="token punctuation">{</span> msg<span class="token punctuation">:</span> <span class="token string">"UP"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//定义过滤器</span>  filters<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 过滤器的名称及方法</span>    myFilters<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>过滤器的使用：</p><p>Vue.js 允许你自定义过滤器，可被用于一些常见的文本格式化转义等操作。过滤器可以用在两个地方：<strong>双花括号插值和 v-bind 表达式</strong> (后者从 2.1.0+ 开始支持)。过滤器要被添加到操作值得后面，使用 管道符 <code>|</code> 分割；vue 会自动将操作值，以实参的形式传入过滤器的方法中；</p><p><code>{ {msg|myFilter s}}</code></p><p><strong>过滤敏感词汇</strong></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>  { {msg|myFilter s|get3}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      msg<span class="token punctuation">:</span> <span class="token string">""</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">//定义过滤器</span>    filters<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 过滤器的名称及方法</span>      myFilters<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      get3<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 遇到数字替换为 0</span>        <span class="token comment" spellcheck="true">// var reg = /\d/g;</span>        <span class="token comment" spellcheck="true">// return val.replace(reg,0);</span>        <span class="token keyword">return</span> val<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"苍井空"</span><span class="token punctuation">,</span> <span class="token string">"***"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h4 id="6-3-2-全局过滤器"><a href="#6-3-2-全局过滤器" class="headerlink" title="6.3.2 全局过滤器"></a>6.3.2 全局过滤器</h4><p>上面的代码中，<code>myFilters</code> 及 <code>get3</code> 两个过滤器，仅在当前 vue 实例中可用；如果在代码 再次 <code>var app2 = new Vue()</code> 得到变量为 <code>app2</code> 的 vue 实例，则两个过滤器在 app2 中都不可用；如果需要过滤器在所有实例对象中可用，我们需要声明 <strong>全局过滤器</strong></p><p><code>Vue.filter(名称,处理器)</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>  { {msg|myFilter s}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- 定义两个DOM节点 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>  { {msg|myFilter s|get3}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">"myFilters"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 定义两个全局过滤器</span>  Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">"get3"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> val<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"苍井空"</span><span class="token punctuation">,</span> <span class="token string">"***"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 两个Vue 实例</span>  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      msg<span class="token punctuation">:</span> <span class="token string">""</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> app2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app2"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      msg<span class="token punctuation">:</span> <span class="token string">""</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="6-4-自定义指令"><a href="#6-4-自定义指令" class="headerlink" title="6.4 自定义指令"></a>6.4 自定义指令</h3><p>前面我们学过 <code>v-on 、v-model、v-show</code> 等指令，在操作 dom 时使用了 ref 属性，其实之前学过的指令也是操作 dom 的一种方式，但有时，这些指令并不能满足我们的需求，因此 vue 允许我们自定义指令来操作 dom</p><h4 id="6-4-1-全局自定义指令"><a href="#6-4-1-全局自定义指令" class="headerlink" title="6.4.1 全局自定义指令"></a>6.4.1 全局自定义指令</h4><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>p v<span class="token operator">-</span>setcolor<span class="token operator">></span>自定义指令的使用<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token operator">&lt;</span>script<span class="token operator">></span>    <span class="token comment" spellcheck="true">// 注册一个全局自定义指令 `v-focus`</span>    Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'setcolor'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 当被绑定的元素插入到 DOM 中时……</span>        inserted<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 聚焦元素</span>            el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><h4 id="6-4-2-私有-局部-自定义指令"><a href="#6-4-2-私有-局部-自定义指令" class="headerlink" title="6.4.2 私有(局部)自定义指令"></a>6.4.2 私有(局部)自定义指令</h4><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-setcolor</span><span class="token punctuation">></span></span>自定义指令的使用<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 注册 局部(私有)指令</span>    directives<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 定义指令名称</span>      setcolor<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 当被绑定的元素插入到 DOM 中时……</span>        inserted<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">// 聚焦元素</span>          el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h4 id="6-4-3-利用自定义指令使-TodoList-获取焦点"><a href="#6-4-3-利用自定义指令使-TodoList-获取焦点" class="headerlink" title="6.4.3 利用自定义指令使 TodoList 获取焦点"></a>6.4.3 利用自定义指令使 TodoList 获取焦点</h4><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>  <span class="token attr-name">@keyup.enter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>addTodo<span class="token punctuation">"</span></span>  <span class="token attr-name">v-getfocus</span>  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>new-todo<span class="token punctuation">"</span></span>  <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>请输入<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 注册 局部(私有)指令</span>directives<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 定义指令名称</span>    getfocus<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 当被绑定的元素插入到 DOM 中时……</span>        inserted<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 聚焦元素</span>            el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><h4 id="6-4-4-为自定义指令传值"><a href="#6-4-4-为自定义指令传值" class="headerlink" title="6.4.4 为自定义指令传值"></a>6.4.4 为自定义指令传值</h4><p>之前学习的指令中，有的指令可以传值，有的则没有，而我们自定的指令中是没有值的，如果想为自定义指令赋值，如下即可：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-setcolor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>colors<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>自定义指令的使用<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      colors<span class="token punctuation">:</span> <span class="token string">"yellow"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 注册 局部(私有)指令</span>    directives<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 定义指令名称</span>      setcolor<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 自定义指令可以接受第二个参数</span>        inserted<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">// 第二个参数中包含了指令名称、挂载名称及数据键值</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// 聚焦元素</span>          el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> val<span class="token punctuation">.</span>value<span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="6-5-过度及动画"><a href="#6-5-过度及动画" class="headerlink" title="6.5 过度及动画"></a>6.5 过度及动画</h3><p>我们可以使用 v-if 或者 v-show 控制 dom 元素的显示和隐藏</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>go<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>显示/隐藏<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>is<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>pppppp1111<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      isShow<span class="token punctuation">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>isShow <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isShow<span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>而在显示和隐藏的过程中，我们加入一些动画效果：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-18_18-21-21.png" alt=""></p><p>在进入/离开的过渡中，会有 6 个 class 切换。</p><ol><li><code>v-enter</code>：定义进入过渡的开始状态。在元素被插入之前生效，在元素被插入之后的下一帧移除。</li><li><code>v-enter-active</code>：定义进入过渡生效时的状态。在整个进入过渡的阶段中应用，在元素被插入之前生效，在过渡/动画完成之后移除。这个类可以被用来定义进入过渡的过程时间，延迟和曲线函数。</li><li><code>v-enter-to</code>: <strong>2.1.8 版及以上</strong> 定义进入过渡的结束状态。在元素被插入之后下一帧生效 (与此同时 <code>v-enter</code> 被移除)，在过渡/动画完成之后移除。</li><li><code>v-leave</code>: 定义离开过渡的开始状态。在离开过渡被触发时立刻生效，下一帧被移除。</li><li><code>v-leave-active</code>：定义离开过渡生效时的状态。在整个离开过渡的阶段中应用，在离开过渡被触发时立刻生效，在过渡/动画完成之后移除。这个类可以被用来定义离开过渡的过程时间，延迟和曲线函数。</li><li><code>v-leave-to</code>: <strong>2.1.8 版及以上</strong> 定义离开过渡的结束状态。在离开过渡被触发之后下一帧生效 (与此同时 <code>v-leave</code> 被删除)，在过渡/动画完成之后移除。</li></ol><p>对于这些在过渡中切换的类名来说，如果你使用一个没有名字的 <code>&lt;transition&gt;</code>，则 <code>v-</code> 是这些类名的默认前缀。如果你使用了 <code>&lt;transition name=&quot;my-transition&quot;&gt;</code>，那么 <code>v-enter</code> 会替换为 <code>my-transition-enter</code>。</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">  <span class="token selector"><span class="token class">.fade-enter-active</span>,  <span class="token class">.fade-leave-active</span> </span><span class="token punctuation">{</span>    <span class="token property">transition</span><span class="token punctuation">:</span> opacity <span class="token number">1</span>s<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector"><span class="token class">.fade-enter</span>,  <span class="token class">.fade-leave-to</span> </span><span class="token punctuation">{</span>    <span class="token property">opacity</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector"><span class="token class">.man-enter-active</span>,  <span class="token class">.man-leave-active</span> </span><span class="token punctuation">{</span>    <span class="token property">transition</span><span class="token punctuation">:</span> opacity <span class="token number">4</span>s<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector"><span class="token class">.man-enter</span>,  <span class="token class">.man-leave-to</span> </span><span class="token punctuation">{</span>    <span class="token property">opacity</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>go<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>显示/隐藏<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fade<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>isShow<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>pppppp1111<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>man<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>isShow<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>pppppp222<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition-group</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fade<span class="token punctuation">"</span></span> <span class="token attr-name">tag</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ul<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(v,k) in list<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>v<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      { {v} }      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:void(0)<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>del(k)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition-group</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      isShow<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>isShow <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isShow<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token function">del</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--注意：transition只对单个有效，而transition-group可以对一组有效，两者使用方式基本一样，后者有tag，这个属性作用主要是当页面完成后，替换transition标签，可以是任何DOM元素可以配合第三方vue2-animate包使用npm install vue2-animate此包只需在transition标签的name加上要应用的效果即可(以上示例)也可使用原始的animate官方包 ，效果更多，但需自行修改class名称下载：从下面效果展示链接下载以下是原animate使用示例--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span>  <span class="token attr-name"><span class="token namespace">name:</span>fade</span>  <span class="token attr-name">enter-active-class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>animated swing<span class="token punctuation">"</span></span>  <span class="token attr-name">leave-active-class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>animated shake<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--使用注意：在修改类内必须加animate 后面接着要使用的动画类即可--></span></code></pre><p>transition</p><ul><li><code>name</code> - string，用于自动生成 CSS 过渡类名。例如：<code>name: &#39;fade&#39;</code> 将自动拓展为<code>.fade-enter</code>，<code>.fade-enter-active</code>等。默认类名为 <code>&quot;v&quot;</code></li><li><code>appear</code> - boolean，是否在初始渲染时使用过渡。默认为 <code>false</code>。</li><li><code>css</code> - boolean，是否使用 CSS 过渡类。默认为 <code>true</code>。如果设置为 <code>false</code>，将只通过组件事件触发注册的 JavaScript 钩子。</li><li><code>type</code> - string，指定过渡事件类型，侦听过渡何时结束。有效值为 <code>&quot;transition&quot;</code> 和 <code>&quot;animation&quot;</code>。默认 Vue.js 将自动检测出持续时间长的为过渡事件类型。</li><li><code>mode</code> - string，控制离开/进入的过渡时间序列。有效的模式有 <code>&quot;out-in&quot;</code> 和 <code>&quot;in-out&quot;</code>；默认同时生效。</li><li><code>duration</code> - number | { <code>enter</code>: number, <code>leave</code>: number } 指定过渡的持续时间。默认情况下，Vue 会等待过渡所在根元素的第一个 <code>transitionend</code> 或 <code>animationend</code> 事件。</li></ul><p>transition-group</p><ul><li><code>tag</code> - string，默认为 <code>span</code></li><li><code>move-class</code> - 覆盖移动过渡期间应用的 CSS 类。</li><li>除了 <code>mode</code>，其他特性和 <code>&lt;transition&gt;</code> 相同。</li></ul><h4 id="初次渲染动画"><a href="#初次渲染动画" class="headerlink" title="初次渲染动画"></a>初次渲染动画</h4><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//在transition标签中，可以设置一个appear指令，这个指令可以实现打开网页\初次进入时触发动画</span><span class="token comment" spellcheck="true">//基本使用：</span><span class="token operator">&lt;</span>transition appear <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>transition<span class="token operator">></span><span class="token comment" spellcheck="true">//也可使用自定义动画效果或第三方库，通过修改class实现</span><span class="token operator">&lt;</span>transition appear  appear<span class="token operator">-</span>active<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">'animated swing'</span> <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>transition<span class="token operator">></span><span class="token comment" spellcheck="true">//appear也可修改类名</span></code></pre><p>vue2-animate 动画样式参考链接：<a href="https://the-allstars.com/vue2-animate/" target="_blank" rel="noopener">https://the-allstars.com/vue2-animate/</a></p><p>animate 样式参考链接：<a href="https://daneden.github.io/animate.css/" target="_blank" rel="noopener">https://daneden.github.io/animate.css/</a></p><p>官方文档所说：<strong>对于这些在过渡中切换的类名来说，如果你使用一个没有名字的 <code>&lt;transition&gt;</code>，则 <code>v-</code> 是这些类名的默认前缀。如果你使用了 <code>&lt;transition name=&quot;my-transition&quot;&gt;</code>，那么 <code>v-enter</code> 会替换为 <code>my-transition-enter</code>。</strong></p><p>这就是 Vue 中动画及过渡的基本使用方式，因为这些动画效果都需要我们自己写 CSS 样式，相对比较麻烦，在项目中，大多情况下，我们会借助第三方 CSS 动画库来实现，如：Animate.css ；后面项目中具体使用时，我们在进一步学习第三方 CSS 动画库的使用；</p><h4 id="使用-js-钩子来动画"><a href="#使用-js-钩子来动画" class="headerlink" title="使用 js 钩子来动画"></a>使用 js 钩子来动画</h4><pre class=" language-html"><code class="language-html">&lt;transition <span class="token comment" spellcheck="true">&lt;!-- 进入 --></span>  v-on:before-enter="beforeEnter" v-on:enter="enter"  v-on:after-enter="afterEnter" v-on:enter-cancelled="enterCancelled"  <span class="token comment" spellcheck="true">&lt;!-- 离开 --></span>  v-on:before-leave="beforeLeave" v-on:leave="leave"  v-on:after-leave="afterLeave" v-on:leave-cancelled="leaveCancelled" >  <span class="token comment" spellcheck="true">&lt;!-- ... --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span>// ... methods: { // -------- // 进入中 // -------- beforeEnter: function (el) {// ... }, // 当与 CSS 结合使用时 // 回调函数 done 是可选的 enter: function (el,done) { // ... done() }, afterEnter: function (el) { // ... }, enterCancelled:function (el) { // ... }, // -------- // 离开时 // -------- beforeLeave:function (el) { // ... }, // 当与 CSS 结合使用时 // 回调函数 done 是可选的leave: function (el, done) { // ... done() }, afterLeave: function (el) { // ...}, // leaveCancelled 只用于 v-show 中 leaveCancelled: function (el) { // ... } }<span class="token comment" spellcheck="true">&lt;!--@before-enter   动画执行前@enter        执行动画@after        动画执行中@enter        执行完毕//离开/进入 各有一套--></span></code></pre><p>当只用 JavaScript 过渡的时候，<strong>在 enter 和 leave 中必须使用 done 进行回调</strong>。否则，它们将被同步调用，过渡会立即完成。</p><p>推荐对于仅使用 JavaScript 过渡的元素添加 <code>v-bind:css=&quot;false&quot;</code>，Vue 会跳过 CSS 的检测。这也可以避免过渡过程中 CSS 的影响。</p><h4 id="Velocity-js-js-钩子"><a href="#Velocity-js-js-钩子" class="headerlink" title="Velocity.js + js 钩子"></a>Velocity.js + js 钩子</h4><p>velocity 下载链接：<a href="http://www.velocityjs.org/" target="_blank" rel="noopener">http://www.velocityjs.org/</a></p><p><a href="https://cn.vuejs.org/v2/guide/transitions.html#JavaScript-%E9%92%A9%E5%AD%90" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/transitions.html#JavaScript-%E9%92%A9%E5%AD%90</a></p><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!--Velocity 和 jQuery.animate 的工作方式类似，也是用来实现 JavaScript 动画的一个很棒的选择--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/velocity/1.2.3/velocity.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>example-4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>show <span class="token punctuation">=</span> !show<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    Toggle  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span>    <span class="token attr-name"><span class="token namespace">v-on:</span>before-enter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>beforeEnter<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">v-on:</span>enter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>enter<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">v-on:</span>leave</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>leave<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">v-bind:</span>css</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>  <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>show<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      Demo    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#example-4"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      show<span class="token punctuation">:</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      beforeEnter<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>        el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transformOrigin <span class="token operator">=</span> <span class="token string">"left"</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token comment" spellcheck="true">//进入</span>      enter<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> done<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">Velocity</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">{</span> opacity<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token string">"1.4em"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> duration<span class="token punctuation">:</span> <span class="token number">300</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">Velocity</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">{</span> fontSize<span class="token punctuation">:</span> <span class="token string">"1em"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> complete<span class="token punctuation">:</span> done <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//complete 作用：通知动画结束</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token comment" spellcheck="true">//离开</span>      leave<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> done<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">Velocity</span><span class="token punctuation">(</span>          el<span class="token punctuation">,</span>          <span class="token punctuation">{</span> translateX<span class="token punctuation">:</span> <span class="token string">"15px"</span><span class="token punctuation">,</span> rotateZ<span class="token punctuation">:</span> <span class="token string">"50deg"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">{</span> duration<span class="token punctuation">:</span> <span class="token number">600</span> <span class="token punctuation">}</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">Velocity</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">{</span> rotateZ<span class="token punctuation">:</span> <span class="token string">"100deg"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> loop<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">Velocity</span><span class="token punctuation">(</span>          el<span class="token punctuation">,</span>          <span class="token punctuation">{</span>            rotateZ<span class="token punctuation">:</span> <span class="token string">"45deg"</span><span class="token punctuation">,</span>            translateY<span class="token punctuation">:</span> <span class="token string">"30px"</span><span class="token punctuation">,</span>            translateX<span class="token punctuation">:</span> <span class="token string">"30px"</span><span class="token punctuation">,</span>            opacity<span class="token punctuation">:</span> <span class="token number">0</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">{</span> complete<span class="token punctuation">:</span> done <span class="token punctuation">}</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h4 id="多个元素-组件过渡"><a href="#多个元素-组件过渡" class="headerlink" title="多个元素/组件过渡"></a>多个元素/组件过渡</h4><p><a href="https://cn.vuejs.org/v2/guide/transitions.html#%E5%A4%9A%E4%B8%AA%E5%85%83%E7%B4%A0%E7%9A%84%E8%BF%87%E6%B8%A1" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/transitions.html#%E5%A4%9A%E4%B8%AA%E5%85%83%E7%B4%A0%E7%9A%84%E8%BF%87%E6%B8%A1</a></p><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!--多个元素--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>out-in<span class="token punctuation">'</span></span><span class="token punctuation">></span></span> <span class="token comment" spellcheck="true">&lt;!--如果不设置mode 那么开始离开动画将同时执行，有时效果会不那么好，  参数可以参考以上，这里用的是先离开后进入 --></span>    &lt;button v-if='show === 'div1' ' key='1'>  <span class="token comment" spellcheck="true">&lt;!--相同标签名必须设置key区分，否则应用全部--></span>        name:1    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    &lt;button v-if='show === 'div2' ' key='2'>        name:2    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>toggle<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>        toggle    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>new Vue({el:'#app',data:{show:'div1'},methods:{toggle()    {        this.show = this.show === 'div1' ? 'div2' : 'div1'    }}})<span class="token comment" spellcheck="true">&lt;!--上面的例子利用动态key简写--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>show<span class="token punctuation">'</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>out-in<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    { {ShowMassage} }<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>toggle<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    toggle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>new Vue({el:'#app',data:{show:'div1'},computed:{    ShowMassage()    {         switch (this.show) {          case 'div1': return 'div1'          case 'div2': return 'div2'        }    } },methods:{toggle()    {        this.show = this.show === 'div1' ? 'div2' : 'div1'    }}})<span class="token comment" spellcheck="true">&lt;!--在一些场景中，也可以通过给同一个元素的 key 特性设置不同的状态来代替 v-if 和 v-else，上面的例子可以重写为：--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>isEditing<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    { { isEditin g ? 'Save' : 'Edit' }}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--多个组件--></span><span class="token comment" spellcheck="true">&lt;!--不需要使用 key 特性。相反，我们只需要使用动态组件--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span>  <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>out-in<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>view<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>toggle<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    toggle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>new Vue({  el: '#transition-components-demo',  data: {    view: 'v-a'  },methods:{toggle(){this.view = this.view === 'v-a' ? 'v-b' :'v-a'}},  components: {    'v-a': {      template: '<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Component A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>'    },    'v-b': {      template: '<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Component B<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>'    }  }})</code></pre><h2 id="第-7-章-json-server-与-axios"><a href="#第-7-章-json-server-与-axios" class="headerlink" title="第 7 章 json-server 与 axios"></a>第 7 章 json-server 与 axios</h2><p>一个项目从立项开始，一般都是前后端同时进行编码工作的，而此时前端需要的接口和数据后台都是无法提供的；</p><h3 id="7-1-json-server-使用"><a href="#7-1-json-server-使用" class="headerlink" title="7.1 json-server 使用"></a>7.1 json-server 使用</h3><p>使用全局安装 ：<code>npm install json-server -g</code></p><p>json-server 会将一个 json 文件作为数据库来存储数据，对 json 数据的格式是有要求的，如 data.json 的内容：</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"tb1"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"标题1"</span><span class="token punctuation">,</span>      <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"描述信息1"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"标题2"</span><span class="token punctuation">,</span>      <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"描述信息2"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token property">"tb2"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      <span class="token property">"body"</span><span class="token operator">:</span> <span class="token string">"some comment"</span><span class="token punctuation">,</span>      <span class="token property">"postId"</span><span class="token operator">:</span> <span class="token number">1</span>    <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token property">"tb3"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"typicode"</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>启动服务： <code>json-server --watch data.json</code></p><p>启动成功后，提示信息如下：</p><pre class=" language-shell"><code class="language-shell">$ json-server --watch data.json  \{^_^}/ hi!  Loading data.json  Done  Resources  http://localhost:3000/tb1  http://localhost:3000/tb2  http://localhost:3000/tb3  Home  http://localhost:3000  Type s + enter at any time to create a snapshot of the database  Watching...</code></pre><p>得到 tb1 所有的数据 GET： <a href="http://localhost:3000/tb1" target="_blank" rel="noopener">http://localhost:3000/tb1</a></p><p>根据 id 得到数据 GET ： <a href="http://localhost:3000/tb1/2" target="_blank" rel="noopener">http://localhost:3000/tb1/2</a></p><p>添加一条数据 POST： <a href="http://localhost:3000/tb1" target="_blank" rel="noopener">http://localhost:3000/tb1</a></p><p>删除一条数据 DELETE： <a href="http://localhost:3000/tb1/2" target="_blank" rel="noopener">http://localhost:3000/tb1/2</a></p><p>模糊查找 GET ： <a href="http://localhost:3000/tb1?title_like=标题" target="_blank" rel="noopener">http://localhost:3000/tb1?title_like=标题</a></p><p>根据 id 修改数据 PUT： <a href="http://localhost:3000/tb1/1" target="_blank" rel="noopener">http://localhost:3000/tb1/1</a></p><blockquote><p>注意：json-server 严格遵循 HTTP 请求语义进行数据处理</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-18_03-34-14.png" alt=""></p><h3 id="7-2-axios"><a href="#7-2-axios" class="headerlink" title="7.2 axios"></a>7.2 axios</h3><p>我们在构建应用时需要访问一个 API 并展示其数据。做这件事的方法有好几种，而使用基于 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener"><strong>Promise</strong></a> 的 HTTP 客户端 <a href="https://github.com/axios/axios" target="_blank" rel="noopener">axios</a> 则是其中非常流行的一种。</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./axios.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token comment" spellcheck="true">// 获取全部数据</span>  axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"http://localhost:3000/list_data"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 获取一条数据</span>  axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"http://localhost:3000/list_data/2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 添加一条数据</span>  axios    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"http://localhost:3000/list_data"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> stat<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">"喝水"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>d <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 删除一条数据</span>  axios    <span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token string">"http://localhost:3000/list_data/4"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>d <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 修改一条数据</span>  axios    <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"http://localhost:3000/list_data/6"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">"hhhhhh"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>d <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h2 id="第-8-章-重构-TodoList-案例"><a href="#第-8-章-重构-TodoList-案例" class="headerlink" title="第 8 章 重构 TodoList 案例"></a>第 8 章 重构 TodoList 案例</h2><h3 id="8-1-启动-API-接口及数据"><a href="#8-1-启动-API-接口及数据" class="headerlink" title="8.1 启动 API 接口及数据"></a>8.1 启动 API 接口及数据</h3><p><strong>db.json:</strong></p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"list_data"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"吃饭"</span><span class="token punctuation">,</span>      <span class="token property">"stat"</span><span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"睡觉"</span><span class="token punctuation">,</span>      <span class="token property">"stat"</span><span class="token operator">:</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"打豆豆"</span><span class="token punctuation">,</span>      <span class="token property">"stat"</span><span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><p>启动服务： <code>json-server --watch db.json</code></p><h3 id="8-2-获取全部任务"><a href="#8-2-获取全部任务" class="headerlink" title="8.2 获取全部任务"></a>8.2 获取全部任务</h3><pre class=" language-js"><code class="language-js">el<span class="token punctuation">:</span> <span class="token string">'#todoapp'</span><span class="token punctuation">,</span>data<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// list_data:list_data,</span>    list_data<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">// es6属性简写</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 当vue实例获取到 el:'#todoapp' 自动调用执行 mounted 方法</span>mounted<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">'http://localhost:3000/list_data'</span><span class="token punctuation">;</span>    axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>backdata<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(backdata.data);</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>list_data <span class="token operator">=</span> backdata<span class="token punctuation">.</span>data<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><h3 id="8-3-添加任务"><a href="#8-3-添加任务" class="headerlink" title="8.3 添加任务"></a>8.3 添加任务</h3><pre class=" language-js"><code class="language-js">……methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 添加任务事件处理器</span>    <span class="token comment" spellcheck="true">// addTodo:function(){}</span>    <span class="token comment" spellcheck="true">// 简写形式</span>    <span class="token function">addTodo</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 获取当前触发事件的元素</span>        <span class="token keyword">var</span> inputs <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 获取value值，去除空白后判断，如果为空，则不添加任务</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>inputs<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 组装任务数据</span>        <span class="token keyword">var</span> todo_data <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 通过服务器添加数据时，不需要id值</span>            <span class="token comment" spellcheck="true">// id: this.list_data.length + 1 + 1,</span>            title<span class="token punctuation">:</span> inputs<span class="token punctuation">.</span>value<span class="token punctuation">,</span>            stat<span class="token punctuation">:</span> <span class="token boolean">false</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">'http://localhost:3000/list_data'</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 将数据提交保存到服务器</span>        axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>todo_data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>back_data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>            <span class="token keyword">let</span> <span class="token punctuation">{</span>data<span class="token punctuation">,</span>status<span class="token punctuation">}</span> <span class="token operator">=</span> back_data<span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>status <span class="token operator">==</span> <span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// console.log(this.list_data);</span>                <span class="token comment" spellcheck="true">// 数据保存成功后，将数据添加到任务列表展示</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>list_data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// 清空文本框</span>        inputs<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    ……</code></pre><h3 id="8-4-删除任务"><a href="#8-4-删除任务" class="headerlink" title="8.4 删除任务"></a>8.4 删除任务</h3><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>removeTodo(key,val.id)<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>destroy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></code></pre><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 删除操作</span><span class="token function">removeTodo</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">'http://localhost:3000/list_data/'</span><span class="token operator">+</span>id<span class="token punctuation">;</span>    axios<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>back_data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 结构对象</span>        <span class="token keyword">let</span> <span class="token punctuation">{</span>data<span class="token punctuation">,</span>status<span class="token punctuation">}</span> <span class="token operator">=</span> back_data<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// console.log(back_data);</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>list_data<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><h3 id="8-5-完成任务"><a href="#8-5-完成任务" class="headerlink" title="8.5 完成任务"></a>8.5 完成任务</h3><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span>  <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(val,key) in list_data<span class="token punctuation">"</span></span>  <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>todoDone(key,val.id)<span class="token punctuation">"</span></span>  <span class="token attr-name"><span class="token namespace">v-bind:</span>class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{completed:val.stat}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></code></pre><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 完成任务 事件处理器(新添加，原案例中没有)</span><span class="token function">todoDone</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">'http://localhost:3000/list_data/'</span><span class="token operator">+</span>id<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 组装数据准备修改服务器数据</span>    setdata <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 注意：事件优先于浏览器渲染执行，获取当前状态</span>    <span class="token keyword">var</span> chestat <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list_data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>stat<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 状态取反</span>    setdata<span class="token punctuation">.</span>stat <span class="token operator">=</span> <span class="token operator">!</span>chestat<span class="token punctuation">;</span>    setdata<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list_data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// console.log(setdata);</span>    axios<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>setdata<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>backdata<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token keyword">var</span> <span class="token punctuation">{</span>data<span class="token punctuation">,</span>status<span class="token punctuation">}</span> <span class="token operator">=</span> backdata<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 如果服务器修改失败,则重新渲染DOM节点样式，改回原始状态</span>        <span class="token comment" spellcheck="true">// 服务器返回状态有误</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>status <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>list_data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>stat <span class="token operator">=</span> chestat<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 如果异步执行失败失败,则重新渲染DOM节点样式，改回原始状态</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>list_data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>stat <span class="token operator">=</span> chestat<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><h3 id="8-6-案例中的-Bug"><a href="#8-6-案例中的-Bug" class="headerlink" title="8.6 案例中的 Bug"></a>8.6 案例中的 Bug</h3><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-18_13-45-49.png" alt=""></p><p>修改：<code>&lt;button @click.stop=&quot;removeTodo(key,val.id)&quot; class=&quot;destroy&quot;&gt;&lt;/button&gt;</code></p><h2 id="第-9-章-组件"><a href="#第-9-章-组件" class="headerlink" title="第 9 章 组件"></a>第 9 章 组件</h2><p><a href="https://cn.vuejs.org/v2/guide/components.html" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/components.html</a></p><p><a href="https://cn.vuejs.org/v2/guide/components-registration.html" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/components-registration.html</a></p><h3 id="9-1-认识组件"><a href="#9-1-认识组件" class="headerlink" title="9.1 认识组件"></a>9.1 认识组件</h3><p>组件系统是 Vue 的一个重要概念，因为它是一种抽象，允许我们使用小型、独立和通常可复用的组件构建大型应用。通常一个应用会以一棵嵌套的组件树的形式来组织：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-18_18-33-54.png" alt=""></p><p>例如，你可能会有页头、侧边栏、内容区等组件，每个组件又包含了其它的像导航链接、博文之类的组件。</p><h3 id="9-2-基本使用"><a href="#9-2-基本使用" class="headerlink" title="9.2 基本使用"></a>9.2 基本使用</h3><p>组件是可复用的 Vue 实例，且带有一个名字。把这个组件作为自定义元素来使用。组件的好处是写一次可以进行任意次数的复用。</p><pre class=" language-html"><code class="language-html">//1.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 使用组件 --></span>  <span class="token comment" spellcheck="true">&lt;!-- 将组件名直接当做标签名在html代码中使用即可 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mytemp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mytemp</span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 组件可以进行任意次数的复用 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mytemp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mytemp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>//2.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>我是一个组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token comment" spellcheck="true">// 定义一个名为 mytemp 的新组件</span>  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">"mytemp"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// template属性的值，作为组件的内容</span>    <span class="token comment" spellcheck="true">// vue 会把这个值替换到html中并会被浏览器渲染</span>    template<span class="token punctuation">:</span> <span class="token string">"&lt;h2>我是一个组件&lt;/h2>"</span> <span class="token comment" spellcheck="true">//template 值也可以是  #app2 像vue实例的el一样</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>上面代码中我们直接使用 <code>Vue.component()</code> 方法定义了组件，而这个 <code>mytemp</code> 组件可以用在所有 vue 实例中，</p><p>这种组件被称为 <strong><em>全局组件</em></strong></p><p>在具体的某个 vue 实例中，也可以定义组件，但是组件仅会在具体的 vue 实例中起作用，这种组件被称为 <strong><em>局部(私有)组件</em></strong></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 使用组件 --></span>  <span class="token comment" spellcheck="true">&lt;!-- 将组件名直接当做标签名在html代码中使用即可 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mytemp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mytemp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 不可用 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mytemp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mytemp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// app 的私有组件，其他实例对象不可用</span>    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>      mytemp<span class="token punctuation">:</span> <span class="token punctuation">{</span>        template<span class="token punctuation">:</span> <span class="token string">"&lt;h2>我是一个组件&lt;/h2>"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> app2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app2"</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="9-3-使用注意"><a href="#9-3-使用注意" class="headerlink" title="9.3 使用注意"></a>9.3 使用注意</h3><p>组件名如果是驼峰法命名，使用组件时要将大写字母改为小写，并且在前面加上 <code>-</code></p><p>组件中的 tamplate 属性必须有一个唯一的根元素，否则会报错</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 使用组件 --></span>  <span class="token comment" spellcheck="true">&lt;!-- 将组件名直接当做标签名在html代码中使用即可 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-temp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-temp</span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 单标签方式使用 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-temp</span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 不可用 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mytemp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mytemp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// app 的私有组件，其他实例对象不可用</span>    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 驼峰法命名</span>      myTemp<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 必须有唯一的根标签，多标签报错</span>        template<span class="token punctuation">:</span> <span class="token string">"&lt;div>&lt;h2>我是一个组件&lt;/h2>&lt;h3>df&lt;/h3>&lt;/div>"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> app2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app2"</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="9-4-组件的使用"><a href="#9-4-组件的使用" class="headerlink" title="9.4 组件的使用"></a>9.4 组件的使用</h3><p><strong>CSS 代码</strong></p><pre class=" language-css"><code class="language-css"><span class="token selector">* </span><span class="token punctuation">{</span>  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.top</span> </span><span class="token punctuation">{</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">80</span>px<span class="token punctuation">;</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#ccc</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.left</span> </span><span class="token punctuation">{</span>  <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">800</span>px<span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">600</span>px<span class="token punctuation">;</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#ccc</span><span class="token punctuation">;</span>  <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.right</span> </span><span class="token punctuation">{</span>  <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">400</span>px<span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">600</span>px<span class="token punctuation">;</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#ccc</span><span class="token punctuation">;</span>  <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p><strong>原始 HTML 代码</strong></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>top<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>我是顶<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>我是左<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>我是右<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p><strong>组件化代码</strong></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tops</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tops</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lefts</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lefts</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rights</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rights</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>      tops<span class="token punctuation">:</span> <span class="token punctuation">{</span>        template<span class="token punctuation">:</span> <span class="token string">'&lt;div class="top">我是顶&lt;/div>'</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      lefts<span class="token punctuation">:</span> <span class="token punctuation">{</span>        template<span class="token punctuation">:</span> <span class="token string">'&lt;div class="left">我是左&lt;/div>'</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      rights<span class="token punctuation">:</span> <span class="token punctuation">{</span>        template<span class="token punctuation">:</span> <span class="token string">'&lt;div class="right">我是右&lt;/div>'</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="9-5-组件中的数据及方法"><a href="#9-5-组件中的数据及方法" class="headerlink" title="9.5 组件中的数据及方法"></a>9.5 组件中的数据及方法</h3><p>组件是带有名字的可复用的 <strong>Vue 实例</strong> ，所以它们与 <code>new Vue</code> 实例对象接收相同的参数选项 <code>data</code>、<code>computed</code>、<code>watch</code>、<code>methods</code> , 但 <code>el</code>例外；</p><p>虽然组件和实例对象可以接收相同的参数选项，但在具体使用中，vue 实例对象的 <code>data</code> 与组件中的 <code>data</code> 还是有差异的, 在我们自己写的组件中，<a href="https://cn.vuejs.org/v2/guide/components.html#data-必须是一个函数" target="_blank" rel="noopener"><code>data 必须是一个函数</code></a></p><p><strong>一个组件的 data 选项必须是一个函数</strong>，因此每个实例可以维护一份被返回的对象；</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-temp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-temp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>      myTemp<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 一个组件的 data 选项必须是一个函数</span>        data<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">// 将 数据 装入 对象 返回</span>          <span class="token keyword">return</span> <span class="token punctuation">{</span> msg<span class="token punctuation">:</span> <span class="token string">"我是data选项"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">// 其他选项的使用不受影响</span>        methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>          <span class="token function">cli</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        template<span class="token punctuation">:</span> <span class="token string">"&lt;div @click='cli'>{ {msg}}&lt; /div>"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>除 <code>data</code> 选项外，其他选项的使用都是一样的；</p><h3 id="9-6-vue-实例也是组件"><a href="#9-6-vue-实例也是组件" class="headerlink" title="9.6 vue 实例也是组件"></a>9.6 vue 实例也是组件</h3><p>通过<code>new Vue()</code> 可以得到一个实例对象，其实这个实例对象就是一个特殊的组件，也有 <code>template</code> 参数，也可以当做组件来使用；</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  { {msg} }<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span> msg<span class="token punctuation">:</span> <span class="token string">"数据"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    template<span class="token punctuation">:</span> <span class="token string">"&lt;h2>组件&lt;/h2>"</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>上面的代码中直接为 Vue 实例对象传入了 <code>template</code> 参数，那么 vue 会使用<code>template</code>中的数据替换 <code>el</code> 选中的整个 DOM 节点 , 因此 <code>data</code> 选项中的的数据也不会绑定，因为在绑定数据之前，整个 DOM 节点包括节点中 <code>{ {msg}}</code> 都会被替换；如果想让数据正常绑定，我们可以在 template 数据中加入 <code>{ {msg}}</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  { {msg} }<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span> msg<span class="token punctuation">:</span> <span class="token string">"数据"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    template<span class="token punctuation">:</span> <span class="token string">"&lt;h2>组件{ {msg}}&lt; /h2>"</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="父子组件通信"><a href="#父子组件通信" class="headerlink" title="父子组件通信*"></a>父子组件通信*</h3><h4 id="通过-Prop-向子组件传递数据"><a href="#通过-Prop-向子组件传递数据" class="headerlink" title="通过 Prop 向子组件传递数据"></a>通过 Prop 向子组件传递数据</h4><p><a href="https://cn.vuejs.org/v2/guide/components.html" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/components.html</a></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mytemp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mytemp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span> msg<span class="token punctuation">:</span> <span class="token string">"数据"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>      mytemp<span class="token punctuation">:</span> <span class="token punctuation">{</span>        template<span class="token punctuation">:</span> <span class="token string">"&lt;h2>data:{ {msg}}&lt; /h2>"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>运行上面的代码，我们发现，组件 <code>mytemp</code> 并不能获取实例中 <code>data</code> 的数据，这是因为组件与组件之间都拥有各自独立的作用域；</p><p>vue 在组件中提供了<code>props</code> 选项，props 接受一个在组件中自定义属性的值；</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mytemp</span> <span class="token attr-name">cc</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>我是cc<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mytemp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span> msg<span class="token punctuation">:</span> <span class="token string">"数据"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>      mytemp<span class="token punctuation">:</span> <span class="token punctuation">{</span>        template<span class="token punctuation">:</span> <span class="token string">"&lt;h2>data:{ {cc}}&lt; /h2>"</span><span class="token punctuation">,</span>        props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"cc"</span><span class="token punctuation">]</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>我们知道了 props 的用法后，怎么才能将 vue 实例对象中的数据传入组件中呢？我们可以借助 <code>v-bind</code> 指令来进行传值；</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mytemp</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>cc</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-bind:</span>kk</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>msg2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mytemp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      msg<span class="token punctuation">:</span> <span class="token string">"数据"</span><span class="token punctuation">,</span>      msg2<span class="token punctuation">:</span> <span class="token string">"数据二"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>      mytemp<span class="token punctuation">:</span> <span class="token punctuation">{</span>        template<span class="token punctuation">:</span> <span class="token string">"&lt;h2>data:{ {cc}} &lt;br>{ {kk}}&lt; /h2>"</span><span class="token punctuation">,</span>        props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"cc"</span><span class="token punctuation">,</span> <span class="token string">"kk"</span><span class="token punctuation">]</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>vue 实例对象也是一个组件，而 <code>mytemp</code> 组件就是运行在 实例对象下面的，这时我们也会将 实例对象称为 <strong>父组件</strong>，将 <code>mytemp</code> 组件称为 <strong>子组件</strong>； 而我们上面的代码，实际上已经实现了 <strong>父组件向子组件传递数据</strong>的 功能；</p><h4 id="检索-prop-数据类型"><a href="#检索-prop-数据类型" class="headerlink" title="检索 prop 数据类型"></a>检索 prop 数据类型</h4><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//Prop 类型</span><span class="token comment" spellcheck="true">//到这里，我们只看到了以字符串数组形式列出的 prop：</span>props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'likes'</span><span class="token punctuation">,</span> <span class="token string">'isPublished'</span><span class="token punctuation">,</span> <span class="token string">'commentIds'</span><span class="token punctuation">,</span> <span class="token string">'author'</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">//但是，通常你希望每个 prop 都有指定的值类型。这时，你可以以对象形式列出 prop，这些属性的名称和值分别是 prop 各自的名称和类型：</span>props<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 基础的类型检查 (`null` 和 `undefined` 会通过任何类型验证)</span>    propA<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 多个可能的类型</span>    propB<span class="token punctuation">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">,</span> Number<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 必填的字符串</span>    propC<span class="token punctuation">:</span> <span class="token punctuation">{</span>      type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>      required<span class="token punctuation">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 带有默认值的数字</span>    propD<span class="token punctuation">:</span> <span class="token punctuation">{</span>      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">100</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 带有默认值的对象</span>    propE<span class="token punctuation">:</span> <span class="token punctuation">{</span>      type<span class="token punctuation">:</span> Object<span class="token punctuation">,</span>      <span class="token comment" spellcheck="true">// 对象或数组默认值必须从一个工厂函数获取</span>      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">{</span> message<span class="token punctuation">:</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 自定义验证函数</span>    propF<span class="token punctuation">:</span> <span class="token punctuation">{</span>      validator<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 这个值必须匹配下列字符串中的一个</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token string">'warning'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span></code></pre><h4 id="通过-ref-实现父传子"><a href="#通过-ref-实现父传子" class="headerlink" title="通过$ref 实现父传子"></a>通过$ref 实现父传子</h4><p>对于 ref 官方的解释是：ref 是被用来给元素或子组件注册引用信息的。引用信息将会注册在父组件的 $refs 对象上。<br>看不懂对吧？很正常，我也看不懂。那应该怎么理解？看看我的解释：</p><ul><li>如果 ref 用在子组件上，指向的是组件实例，可以理解为对子组件的索引，<strong>通过$ref 可能获取到在子组件里定义的属性和方法</strong>。</li><li>如果 ref 在普通的 DOM 元素上使用，引用指向的就是 DOM 元素，通过$ref 可能获取到该 DOM 的属性集合，轻松访问到 DOM 元素，作用与 JQ 选择器类似。</li></ul><p>那如何通过$ref 实现通信？下面我将上面prop实现的功能，用$ref 实现一遍</p><pre class=" language-js"><code class="language-js"> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 父组件 <span class="token operator">--</span><span class="token operator">></span>    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span>      <span class="token operator">&lt;</span>h1<span class="token operator">></span>我是父组件！<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>      <span class="token operator">&lt;</span>child ref<span class="token operator">=</span><span class="token string">"msg"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>child<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 子组件 <span class="token operator">--</span><span class="token operator">></span>    <span class="token operator">&lt;</span>template id<span class="token operator">=</span><span class="token string">"app2"</span><span class="token operator">></span>      <span class="token operator">&lt;</span>div<span class="token operator">></span>        <span class="token operator">&lt;</span>h1<span class="token operator">></span>我是子组件一！<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>    <span class="token operator">&lt;</span>script<span class="token operator">></span>      <span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>        components<span class="token punctuation">:</span> <span class="token punctuation">{</span>          Child<span class="token punctuation">:</span> <span class="token punctuation">{</span>            template<span class="token punctuation">:</span> <span class="token string">"#app2"</span><span class="token punctuation">,</span>            <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">return</span> <span class="token punctuation">{</span>                msg<span class="token punctuation">:</span> <span class="token string">"子组件的信息"</span>              <span class="token punctuation">}</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>              <span class="token function">getmsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">;</span>              <span class="token punctuation">}</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        mounted<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//   console.log(this.$refs.msg); 子组件的属性和方法都可以在$refs中拿到</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>msg<span class="token punctuation">.</span><span class="token function">getmsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"父组件："</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token operator">+</span><span class="token string">'已经被我拿到了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>prop 着重于数据的传递，它并不能调用子组件里的属性和方法。像创建文章组件时，自定义标题和内容这样的使用场景，最适合使用 prop。</p><p>$ref 着重于索引，主要用来调用子组件里的属性和方法，其实并不擅长数据传递。而且 ref 用在 dom 元素的时候，能使到选择器的作用，这个功能比作为索引更常有用到。</p><h4 id="通过自定义事件实现子向父传递数据"><a href="#通过自定义事件实现子向父传递数据" class="headerlink" title="通过自定义事件实现子向父传递数据"></a>通过自定义事件实现子向父传递数据</h4><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span> <span class="token operator">></span>        <span class="token comment" spellcheck="true">//3.在父组件中绑定传过来的自定义事件，然后使用这个自定义事件绑定自己的函数，即可实现子传父</span>        <span class="token operator">&lt;</span>mytemp @childevents<span class="token operator">=</span><span class="token string">"Sendparent"</span><span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">/</span>mytemp<span class="token operator">></span>        <span class="token comment" spellcheck="true">//&lt;mytemp @childevents="msg = $event"> &lt;/mytemp> 也可以不用函数，使用$event来获取发来的值</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>    <span class="token operator">&lt;</span>script<span class="token operator">></span>      <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>        data<span class="token punctuation">:</span> <span class="token punctuation">{</span>          msg<span class="token punctuation">:</span> <span class="token string">"数据"</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        components<span class="token punctuation">:</span> <span class="token punctuation">{</span>          mytemp<span class="token punctuation">:</span> <span class="token punctuation">{</span>               <span class="token comment" spellcheck="true">//1.在子组件模板中，定义一个触发事件，触发的函数必须是子组件自己拥有的函数</span>            template<span class="token punctuation">:</span> <span class="token string">' &lt;input type="button" value="提交" @click="send" />'</span><span class="token punctuation">,</span>            <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">return</span> <span class="token punctuation">{</span>                chilAttr<span class="token punctuation">:</span> <span class="token string">"child"</span>              <span class="token punctuation">}</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>              <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//2.使用$emit实现子传父</span>                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">"childevents"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chilAttr<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//向父元素发送自定义事件    两个参数：1 自定义事件名   2 传参</span>              <span class="token punctuation">}</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>          <span class="token function">Sendparent</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> child<span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token comment" spellcheck="true">//注意： 自定义事件的命名不能为驼峰，否则会出错。</span></code></pre><h4 id="父子之间访问"><a href="#父子之间访问" class="headerlink" title="父子之间访问"></a>父子之间访问</h4><h5 id="vm-parent"><a href="#vm-parent" class="headerlink" title="vm.$parent"></a><a href="https://cn.vuejs.org/v2/api/#vm-parent" target="_blank" rel="noopener">vm.$parent</a></h5><ul><li><p><strong>类型</strong>：<code>Vue instance</code></p></li><li><p><strong>只读</strong></p></li><li><p><strong>详细</strong>：</p><p>父实例，如果当前实例有的话。</p></li></ul><h5 id="vm-root"><a href="#vm-root" class="headerlink" title="vm.$root"></a><a href="https://cn.vuejs.org/v2/api/#vm-root" target="_blank" rel="noopener">vm.$root</a></h5><ul><li><p><strong>类型</strong>：<code>Vue instance</code></p></li><li><p><strong>只读</strong></p></li><li><p><strong>详细</strong>：</p><p>当前组件树的根 Vue 实例。如果当前实例没有父实例，此实例将会是其自己。</p></li></ul><h5 id="vm-children"><a href="#vm-children" class="headerlink" title="vm.$children"></a><a href="https://cn.vuejs.org/v2/api/#vm-children" target="_blank" rel="noopener">vm.$children</a></h5><ul><li><p><strong>类型</strong>：<code>Array&lt;Vue instance&gt;</code></p></li><li><p><strong>只读</strong></p></li><li><p><strong>详细</strong>：</p><p>当前实例的直接子组件。<strong>需要注意 $children 并不保证顺序，也不是响应式的。</strong>如果你发现自己正在尝试使用 <code>$children</code> 来进行数据绑定，考虑使用一个数组配合 <code>v-for</code> 来生成子组件，并且使用 Array 作为真正的来源。</p></li></ul><h3 id="非父子组件传值"><a href="#非父子组件传值" class="headerlink" title="非父子组件传值"></a>非父子组件传值</h3><p>有时候，非父子关系的两个组件之间也需要通信。在简单的场景下，可以使用一个空的 Vue 实例作为事件总线。原理就是把 Vue 实例当作一个中转站。</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/%E9%9D%9E%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E4%BC%A0%E5%80%BC.png" alt=""></p><p>可以像上图一样，把 vue 实例放在 vue 的原型上，也可想下面一样，放在根 Vue 的 data 中,使用$root 访问</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>child</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hello<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>child</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>child</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>world<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>child</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token comment" spellcheck="true">//子组件</span>  <span class="token keyword">let</span> child <span class="token operator">=</span> <span class="token punctuation">{</span>    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>      content<span class="token punctuation">:</span> String    <span class="token punctuation">}</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>        childCt<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>content      <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    template<span class="token punctuation">:</span> <span class="token string">"&lt;button @click='add'>{ {childCt}}&lt; /button>"</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// $root 可以访问到根组件</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">.</span>Bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">"change"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>childCt<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">.</span>Bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">"change"</span><span class="token punctuation">,</span> res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        that<span class="token punctuation">.</span>childCt <span class="token operator">=</span> res<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//根组件</span>  <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      Bus<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>      child    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>其中可以直接拿$root来$on 或$emit，效果一样，那为什么要创建另一个 vue 的空实例呢？，按照官网文档的说法，创建另一个 vue 空实例，用来当总线中央处理且更加清晰也便于管理</p><h3 id="插槽"><a href="#插槽" class="headerlink" title="插槽"></a>插槽</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">/*插槽的基本使用： 默认 &lt;slot>&lt;/slot>              具名插槽 &lt;slot name='?'>&lt;/slot>默认的插槽由于没有名字，所以当嵌套标签时，默认会替换全部而具名插槽就是来解决这个问题的，使用方式： slot = '对应的name' 即可替换对应的slot，从而解决上述问题注意：但没有传入标签时，会使用默认的规定好的嵌套标签*/</span><span class="token comment" spellcheck="true">//案例</span> <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span>      <span class="token operator">&lt;</span>child<span class="token operator">></span>        <span class="token operator">&lt;</span>span slot<span class="token operator">=</span><span class="token string">'header'</span><span class="token operator">></span>头<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>        <span class="token operator">&lt;</span>span slot<span class="token operator">=</span><span class="token string">'center'</span><span class="token operator">></span>body<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>        <span class="token operator">&lt;</span>span slot<span class="token operator">=</span><span class="token string">'footer'</span><span class="token operator">></span>脚<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>child<span class="token operator">></span>      <span class="token operator">&lt;</span>child<span class="token operator">></span>        <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>    <span class="token comment" spellcheck="true">//默认  不会产生影响  因为没有名字</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>child<span class="token operator">></span>      <span class="token operator">&lt;</span>child<span class="token operator">></span>        <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token keyword">new</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>child<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>    <span class="token operator">&lt;</span>template id<span class="token operator">=</span><span class="token string">"child"</span><span class="token operator">></span>      <span class="token operator">&lt;</span>div<span class="token operator">></span>        <span class="token operator">&lt;</span>slot name<span class="token operator">=</span><span class="token string">'header'</span><span class="token operator">></span>Default<span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">></span>        <span class="token operator">&lt;</span>slot name<span class="token operator">=</span><span class="token string">'center'</span><span class="token operator">></span>Default<span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">></span>        <span class="token operator">&lt;</span>slot name<span class="token operator">=</span><span class="token string">'footer'</span><span class="token operator">></span>Default<span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>    <span class="token operator">&lt;</span>script<span class="token operator">></span>      <span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>        components<span class="token punctuation">:</span> <span class="token punctuation">{</span>          child<span class="token punctuation">:</span> <span class="token punctuation">{</span>            template<span class="token punctuation">:</span> <span class="token string">"#child"</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token comment" spellcheck="true">//2.6.0版本更新后以上语法已经废弃，新语法：</span>        <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://cdn.jsdelivr.net/npm/vue/dist/vue.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>        <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">'app'</span><span class="token operator">></span>                <span class="token operator">&lt;</span>child<span class="token operator">></span>                    <span class="token operator">&lt;</span>template v<span class="token operator">-</span>slot<span class="token punctuation">:</span>header<span class="token operator">></span>                    <span class="token operator">&lt;</span>div<span class="token operator">></span>title<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>                    <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>                    <span class="token operator">&lt;</span>template v<span class="token operator">-</span>slot<span class="token punctuation">:</span>body<span class="token operator">></span>                    <span class="token operator">&lt;</span>div<span class="token operator">></span>body<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>                    <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>                    <span class="token operator">&lt;</span>template v<span class="token operator">-</span>slot<span class="token punctuation">:</span>footer<span class="token operator">></span>                    <span class="token operator">&lt;</span>div<span class="token operator">></span>footer<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>                    <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>                <span class="token operator">&lt;</span><span class="token operator">/</span>child<span class="token operator">></span>            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>            <span class="token operator">&lt;</span>template id<span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">></span>             <span class="token operator">&lt;</span>div<span class="token operator">></span>                  <span class="token operator">&lt;</span>header<span class="token operator">></span>                    <span class="token operator">&lt;</span>slot name<span class="token operator">=</span><span class="token string">"header"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">></span>                  <span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">></span>                  <span class="token operator">&lt;</span>main<span class="token operator">></span>                    <span class="token operator">&lt;</span>slot name<span class="token operator">=</span><span class="token string">"body"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">></span>                  <span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">></span>                  <span class="token operator">&lt;</span>footer<span class="token operator">></span>                    <span class="token operator">&lt;</span>slot name<span class="token operator">=</span><span class="token string">"footer"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">></span>                  <span class="token operator">&lt;</span><span class="token operator">/</span>footer<span class="token operator">></span>             <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>            <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>            <span class="token operator">&lt;</span>script<span class="token operator">></span>                  <span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>                    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>                      child<span class="token punctuation">:</span> <span class="token punctuation">{</span>                        template<span class="token punctuation">:</span> <span class="token string">"#container"</span>                      <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token comment" spellcheck="true">//注意 v-slot 只能添加在一个 &lt;template> 上</span></code></pre><h4 id="具名插槽缩写"><a href="#具名插槽缩写" class="headerlink" title="具名插槽缩写"></a>具名插槽缩写</h4><p>v-slot 可以缩写成 # 后跟名称 如： v-slot:title == #title</p><p>如果写成#= “” 将无效，该缩写必须要有参数，必须按照这种格式： #default = ”{user}“</p><p>注意：以上写法在 2.6.0 以上才有效</p><h4 id="编译作用域"><a href="#编译作用域" class="headerlink" title="编译作用域"></a>编译作用域</h4><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span>      <span class="token operator">&lt;</span>child v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"isShow"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>child<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>    <span class="token operator">&lt;</span>script<span class="token operator">></span>      <span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        el<span class="token punctuation">:</span> <span class="token string">"div"</span><span class="token punctuation">,</span>        components<span class="token punctuation">:</span> <span class="token punctuation">{</span>          child<span class="token punctuation">:</span> <span class="token punctuation">{</span>            template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`&lt;div>                  &lt;span>child&lt;/span>                  &lt;/div>`</span></span><span class="token punctuation">,</span>            <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">return</span> <span class="token punctuation">{</span>                isShow<span class="token punctuation">:</span> <span class="token boolean">false</span>              <span class="token punctuation">}</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        data<span class="token punctuation">:</span> <span class="token punctuation">{</span>          isShow<span class="token punctuation">:</span> <span class="token boolean">true</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token comment" spellcheck="true">//在组件作用域中，每个组件都有自己的作用域，上述的isShow 默认选择了vue实例的isShow，而不是子组件自己的isShow</span></code></pre><h4 id="解决作用域问题-作用域插槽"><a href="#解决作用域问题-作用域插槽" class="headerlink" title="解决作用域问题 (作用域插槽)"></a>解决作用域问题 (作用域插槽)</h4><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">/*作用域插槽的基本使用：1.在插槽或具名插槽中绑定要传输的数据                    2. 在父级作用域中（应用的地方），加上template标签并添加 v-slot指令，接着赋值任意的名称，最后就可以使用刚刚自定义的名称来访问传过来的数据了                    */</span>    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://cdn.jsdelivr.net/npm/vue/dist/vue.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span>      <span class="token operator">&lt;</span>child ref<span class="token operator">=</span><span class="token string">'child1'</span><span class="token operator">></span>            <span class="token operator">&lt;</span>template #title<span class="token operator">=</span><span class="token string">'s'</span><span class="token operator">></span> <span class="token comment" spellcheck="true">// v-slot:title = 's'</span>              <span class="token operator">&lt;</span>span v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">'s.data'</span> @click<span class="token operator">=</span><span class="token string">'toggle(s.data)'</span><span class="token operator">></span>child<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>            <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>child<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>   <span class="token operator">&lt;</span>script<span class="token operator">></span>      <span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        el<span class="token punctuation">:</span> <span class="token string">"div"</span><span class="token punctuation">,</span>        components<span class="token punctuation">:</span> <span class="token punctuation">{</span>          child<span class="token punctuation">:</span> <span class="token punctuation">{</span>            template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`&lt;div>                            &lt;slot :data='isShow' name ='title' >                            &lt;/slot>                        &lt;/div>`</span></span><span class="token punctuation">,</span>            <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">return</span> <span class="token punctuation">{</span>                isShow<span class="token punctuation">:</span> <span class="token boolean">true</span>              <span class="token punctuation">}</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        data<span class="token punctuation">:</span> <span class="token punctuation">{</span>          isShow<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>          res<span class="token punctuation">:</span><span class="token keyword">null</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        methods<span class="token punctuation">:</span><span class="token punctuation">{</span>            <span class="token function">toggle</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>                <span class="token punctuation">{</span>                  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$children<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>child1<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment" spellcheck="true">//$children $refs 都可以获取子组件数据</span>                  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>child1<span class="token punctuation">.</span>isShow <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isShow                <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token comment" spellcheck="true">//此语法只能在2.6.0版本以上使用</span></code></pre><h3 id="动态组件-amp-v-once-amp-keep-live"><a href="#动态组件-amp-v-once-amp-keep-live" class="headerlink" title="动态组件 &amp; v-once &amp; keep-live"></a>动态组件 &amp; v-once &amp; keep-live</h3><h4 id="动态组件的使用"><a href="#动态组件的使用" class="headerlink" title="动态组件的使用"></a>动态组件的使用</h4><pre class=" language-html"><code class="language-html">//使用内置组件 component，并指定 :is 指令，:is指令指向要切换的标签<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name"><span class="token namespace">is:</span>'toggle'</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span></code></pre><h4 id="v-once"><a href="#v-once" class="headerlink" title="v-once"></a>v-once</h4><p>v-once 这个指令不需要任何表达式，它的作用就是定义它的元素或组件只会渲染一次，包括元素或者组件的所有字节点。首次渲染后，不再随着数据的改变而重新渲染。也就是说使用 v-once，那么该块都将被视为静态内容。</p><pre class=" language-html"><code class="language-html">//只渲染元素和组件一次。随后的重新渲染，元素/组件及其所有的子节点将被视为静态内容并跳过。这可以用于优化更新性能。<span class="token comment" spellcheck="true">&lt;!-- 单个元素 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-once</span>  <span class="token punctuation">></span></span>This will never change: { {msg}}&lt; /span>  <span class="token comment" spellcheck="true">&lt;!-- 有子元素 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-once</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>comment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{ {msg}}&lt; /p><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 组件 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-component</span> <span class="token attr-name">v-once</span> <span class="token attr-name">:comment</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-component</span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- `v-for` 指令--></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>i in list<span class="token punctuation">"</span></span> <span class="token attr-name">v-once</span><span class="token punctuation">></span></span>{ {i}}&lt; /li><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>  //试着不要过度使用这个模式。当你需要渲染大量静态内容时，极少数的情况下它会给你带来便利，除非你非常留意渲染变慢了，不然它完全是没有必要的——再加上它在后期会带来很多困惑。例如，设想另一个开发者并不熟悉  v-once  或漏看了它在模板中，他们可能会花很多个小时去找出模板为什么无法正确更新。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></code></pre><h4 id="keep-live"><a href="#keep-live" class="headerlink" title="keep-live"></a>keep-live</h4><p><a href="https://cn.vuejs.org/v2/guide/components-dynamic-async.html" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/components-dynamic-async.html</a></p><p><a href="https://cn.vuejs.org/v2/api/#keep-alive" target="_blank" rel="noopener">https://cn.vuejs.org/v2/api/#keep-alive</a></p><ul><li><p><strong>Props</strong>：</p><ul><li><code>include</code> - 字符串或正则表达式。只有名称匹配的组件会被缓存。</li><li><code>exclude</code> - 字符串或正则表达式。任何名称匹配的组件都不会被缓存。</li><li><code>max</code> - 数字。最多可以缓存多少组件实例。</li></ul></li><li><p><strong>用法</strong>：</p><p><code>&lt;keep-alive&gt;</code> 包裹动态组件时，会缓存不活动的组件实例，而不是销毁它们。和 <code>&lt;transition&gt;</code> 相似，<code>&lt;keep-alive&gt;</code> 是一个抽象组件：它自身不会渲染一个 DOM 元素，也不会出现在父组件链中。</p><p>当组件在 <code>&lt;keep-alive&gt;</code> 内被切换，它的 <code>activated</code> 和 <code>deactivated</code> 这两个生命周期钩子函数将会被对应执行。</p><blockquote><p>在 2.2.0 及其更高版本中，<code>activated</code> 和 <code>deactivated</code> 将会在 <code>&lt;keep-alive&gt;</code> 树内的所有嵌套组件中触发。</p></blockquote><p>主要用于保留组件状态或避免重新渲染。</p><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 基本 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>view<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- 多个条件判断的子组件 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp-a</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a <span class="token punctuation">></span> 1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp-a</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp-b</span> <span class="token attr-name">v-else</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp-b</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- 和 `&lt;transition>` 一起使用 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>view<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span></code></pre><p>注意，<code>&lt;keep-alive&gt;</code> 是用在其一个直属的子组件被开关的情形。如果你在其中有 <code>v-for</code> 则不会工作。如果有上述的多个条件性的子元素，<code>&lt;keep-alive&gt;</code> 要求同时只有一个子元素被渲染。</p></li><li><p><strong>include and exclude</strong></p><blockquote><p>2.1.0 新增<br><code>include</code> 和 <code>exclude</code> 属性允许组件有条件地缓存。二者都可以用逗号分隔字符串、正则表达式或一个数组来表示：</p></blockquote><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 逗号分隔字符串 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span> <span class="token attr-name">include</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a,b<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>view<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- 正则表达式 (使用 `v-bind`) --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span> <span class="token attr-name">:include</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/a|b/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>view<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- 数组 (使用 `v-bind`) --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span> <span class="token attr-name">:include</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>[<span class="token punctuation">'</span>a<span class="token punctuation">'</span>, <span class="token punctuation">'</span>b<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>view<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">></span></span></code></pre><p>匹配首先检查组件自身的 <code>name</code> 选项，如果 <code>name</code> 选项不可用，则匹配它的局部注册名称 (父组件 <code>components</code> 选项的键值)。匿名组件不能被匹配。</p></li><li><p><strong>max</strong></p><blockquote><p>2.5.0 新增</p></blockquote><p>最多可以缓存多少组件实例。一旦这个数字达到了，在新实例被创建之前，已缓存组件中最久没有被访问的实例会被销毁掉。</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span> <span class="token attr-name">:max</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>view<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">></span></span></code></pre><p><code>&lt;keep-alive&gt;</code> 不会在函数式组件中正常工作，因为它们没有缓存实例</p></li></ul><h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p>keep-live</p><p><a href="https://jsfiddle.net/chrisvfritz/Lp20op9o/" target="_blank" rel="noopener">https://jsfiddle.net/chrisvfritz/Lp20op9o/</a></p><p><a href="https://jsfiddle.net/Roam/s2erq3b6/61/" target="_blank" rel="noopener">https://jsfiddle.net/Roam/s2erq3b6/61/</a></p><h2 id="第-10-章-Vue-的生命周期"><a href="#第-10-章-Vue-的生命周期" class="headerlink" title="第 10 章 Vue 的生命周期"></a>第 10 章 Vue 的生命周期</h2><p>每个 Vue 实例在被创建时都要经过一系列的初始化过程——例如，需要设置数据监听、编译模板、将实例挂载到 DOM 并在数据变化时更新 DOM 等。同时在这个过程中也会运行一些叫做<strong>生命周期钩子</strong>的函数，这给了用户在不同阶段添加自己的代码的机会。</p><p>比如 <a href="https://cn.vuejs.org/v2/api/#created" target="_blank" rel="noopener"><code>created</code></a> 钩子可以用来在一个实例被创建之后执行代码：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>    a<span class="token punctuation">:</span> <span class="token number">1</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  created<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// `this` 指向 vm 实例</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"a is: "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// => "a is: 1"</span></code></pre><p>也有一些其它的钩子，在实例生命周期的不同阶段被调用，如 <a href="https://cn.vuejs.org/v2/api/#mounted" target="_blank" rel="noopener"><code>mounted</code></a>、<a href="https://cn.vuejs.org/v2/api/#updated" target="_blank" rel="noopener"><code>updated</code></a> 和 <a href="https://cn.vuejs.org/v2/api/#destroyed" target="_blank" rel="noopener"><code>destroyed</code></a>。生命周期钩子的 <code>this</code> 上下文指向调用它的 Vue 实例。</p><p>下图展示了实例的生命周期。你不需要立马弄明白所有的东西，不过随着你的不断学习和使用，它的参考价值会越来越高。</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-18_18-33-56.jpg" alt=""></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  { { ms g }}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>txt<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      msg<span class="token punctuation">:</span> <span class="token string">"hello vue"</span><span class="token punctuation">,</span>      dataList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 在vue对象初始化过程中执行</span>    <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"beforeCreate"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// undefined</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 在vue对象初始化完成后执行</span>    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"created"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//hello vue</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// ……</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h2 id="第-11-章-单页应用"><a href="#第-11-章-单页应用" class="headerlink" title="第 11 章 单页应用"></a>第 11 章 单页应用</h2><h3 id="11-1-单页应用"><a href="#11-1-单页应用" class="headerlink" title="11.1 单页应用"></a>11.1 单页应用</h3><ul><li><p>什么是单页应用</p><p><strong>单页应用</strong>(single page web application，<strong>SPA</strong>)，是在一个页面完成所有的业务功能，浏览器一开始会加载必需的 HTML、CSS 和 JavaScript，之后所有的操作都在这张页面完成，这一切都由 JavaScript 来控制。</p></li><li><p>单页应用优缺点</p><ul><li>优点<ul><li><strong>操作体验流畅</strong></li><li><strong>完全的前端组件化</strong></li></ul></li><li>缺点<ul><li><strong>首次加载大量资源</strong>(可以只加载所需部分)</li><li><strong>对搜索引擎不友好</strong></li><li><strong>开发难度相对较高</strong></li></ul></li></ul></li></ul><p>优缺点都很明显，但是我们都还没尝试过就来评价，就会显得空口无凭；接下来我们先来学习制作单页应用，然后再来进行点评；</p><h3 id="11-2-vue-路由插件-vue-router"><a href="#11-2-vue-路由插件-vue-router" class="headerlink" title="11.2 vue 路由插件 vue-router"></a>11.2 vue 路由插件 vue-router</h3><p><a href="https://cn.vuejs.org/v2/guide/routing.html" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/routing.html</a></p><p><a href="https://router.vuejs.org/zh/" target="_blank" rel="noopener">https://router.vuejs.org/zh/</a></p><p>$route    当前路由信息<br>$router 操作路由</p><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 引入路由 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue-router.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#/login<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#/register<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>注册<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 路由中设置的组件会替换router-view标签 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token comment" spellcheck="true">// 1:定义路由组件</span>  <span class="token keyword">var</span> login <span class="token operator">=</span> <span class="token punctuation">{</span>    template<span class="token punctuation">:</span> <span class="token string">"&lt;h2>我是登录页面&lt;/h2>"</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> register <span class="token operator">=</span> <span class="token punctuation">{</span>    template<span class="token punctuation">:</span> <span class="token string">"&lt;h2>注册有好礼&lt;/h2>"</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 2:获取路由对象</span>  <span class="token keyword">var</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 定义路由规则</span>    routes<span class="token punctuation">:</span> <span class="token punctuation">[</span>      <span class="token comment" spellcheck="true">// {请求的路径,componet是模板}</span>      <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">"/register"</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> register <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">"/login"</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> login <span class="token punctuation">}</span>    <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// ES6 属性简写</span>    <span class="token comment" spellcheck="true">// 3:将router对象传入Vue</span>    router  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>上例中，在 HTML 中我们直接使用了 a 标签，但是这样并不好，因为官方为我们提供了 <code>router-link</code> 标签</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/login<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/register<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>注册<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- &lt;li>&lt;a href="#/login">登录&lt;/a>&lt;/li>        &lt;li>&lt;a href="#/register">注册&lt;/a>&lt;/li> --></span>    <span class="token comment" spellcheck="true">&lt;!-- router-link 会被解析为a标签 --></span>    <span class="token comment" spellcheck="true">&lt;!--             不同的是，router-link在解析为a标签后，            会自动为点击的 a 标签添加class属性         --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 路由中设置的组件会替换router-view标签 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>使用 router-link 的一大好处就是，每当我们点击时，在标签内就会自动帮我们添加 class 属性，而此时，我们就可以利用 class 属性，来定义样式：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">  <span class="token selector"><span class="token class">.router-link-active</span> </span><span class="token punctuation">{</span>    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>  <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><h3 id="11-3-动态路由匹配"><a href="#11-3-动态路由匹配" class="headerlink" title="11.3 动态路由匹配"></a>11.3 动态路由匹配</h3><p>假设有一个用户列表，想要删除某一个用户，需要获取用户的 id 传入组件内，如何实现呢？</p><p>此时可以通过路由传参来实现，具体步骤如下：</p><ol><li><p>通过 <router-link> 传参，在路径上传入具体的值</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/users/120<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>用户管理<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span></code></pre></li><li><p>路由规则中增加参数，在 path 最后增加 <strong>:id</strong></p><pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'users'</span><span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token string">'/users/:id'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> Users <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></li><li><p>在组件内部可以使用，<strong>this.$route</strong> 获取当前路由对象</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> Users <span class="token operator">=</span> <span class="token punctuation">{</span>  template<span class="token punctuation">:</span> <span class="token string">"&lt;div>这是用户管理内容 { { $rout e.params.id }}&lt;/div>"</span><span class="token punctuation">,</span>  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></li></ol><h2 id="第-12-章-构建一个项目"><a href="#第-12-章-构建一个项目" class="headerlink" title="第 12 章 构建一个项目"></a>第 12 章 构建一个项目</h2><h3 id="12-0-命令行工具-CLI"><a href="#12-0-命令行工具-CLI" class="headerlink" title="12.0 命令行工具 (CLI)"></a>12.0 命令行工具 (CLI)</h3><p><a href="https://cn.vuejs.org/v2/guide/installation.html#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-CLI" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/installation.html#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-CLI</a></p><p>Vue 提供了一个<a href="https://github.com/vuejs/vue-cli" target="_blank" rel="noopener">官方的 CLI</a>，为单页面应用 (SPA) 快速搭建繁杂的脚手架。它为现代前端工作流提供了 batteries-included 的构建设置。只需要几分钟的时间就可以运行起来并带有热重载、保存时 lint 校验，以及生产环境可用的构建版本。更多详情可查阅 <a href="https://cli.vuejs.org" target="_blank" rel="noopener">Vue CLI 的文档</a>。</p><h3 id="12-1-初始化项目"><a href="#12-1-初始化项目" class="headerlink" title="12.1 初始化项目"></a>12.1 初始化项目</h3><p>安装 cli 命令工具：<code>npm install -g @vue/cli @vue/cli-init</code></p><p>安装成功后，使用 <code>vue -V</code> 命令，查看版本号；</p><p>使用 <code>vue init webpack myapp</code> 构建一个名为 myapp 的项目：</p><p>Vue 依然使用询问的方式，让我们对项目有一个初始化的信息</p><ul><li>Project name：项目名</li><li>Project description: 项目描述</li><li>Author: 作者</li><li>Vue build：<ul><li>第一种：配合大部分的开发人员</li><li>第二种：仅仅中有 runtime</li></ul></li><li>Install vue-router? 是否安装 vue-router</li><li>Use ESLint to lint your code?是否使用 ESLint 来验证我们的语法。</li><li>Pick an ESLint preser:使用哪种语法规范来检查我们的代码：<ul><li>Standard: 标准规范</li><li>Airbnb: 爱彼迎规范</li></ul></li><li>Set up unit test: 设置单元测试</li><li>Setup e2e tests： 设置端对端测试</li><li>Should we run ‘npm install’:要不要帮忙你下载这个项目需要的第三方包<ul><li>使用 npm 来下载</li><li>使用 yarn 来下载</li></ul></li></ul><pre class=" language-shell"><code class="language-shell">To get started:  cd myapps  npm run dev   // 使用命令启动项目  -----  Your application is running here: http://localhost:8080  打开浏览器，访问 http://localhost:8080  看到浏览器的欢迎界面，表示项目运行成功</code></pre><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-21_03-11-42.png" alt=""></p><h3 id="12-2-项目结构介绍"><a href="#12-2-项目结构介绍" class="headerlink" title="12.2 项目结构介绍"></a>12.2 项目结构介绍</h3><pre><code>├── build                webpack打包相关配置文件目录├── config                webpack打包相关配置文件目录├── node_modules         第三方包├── src                    项目源码(主战场)│   ├── assets             存储静态资源，例如 css、img、fonts│   ├── components         存储所有公共组件│   ├── router             路由│   ├── App.vue             单页面应用程序的根组件│   └── main.js             程序入口，负责把根组件替换到根节点├── static                可以放一些静态资源│   └── .gitkeep         git提交的时候空文件夹不会提交，这个文件可以让空文件夹可以提交├── .babelrc             配置文件，es6转es5配置文件，给 babel 编译器用的├── .editorconfig         给编辑器看的├── .eslintignore          给eslint代码风格校验工具使用的，用来配置忽略代码风格校验的文件或是目录├── .eslintrc.js         给eslint代码风格校验工具使用的，用来配置代码风格校验规则├── .gitignore             给git使用的，用来配置忽略上传的文件├── index.html             单页面应用程序的单页├── package.json         项目说明，用来保存依赖项等信息├── package-lock.json      锁定第三方包的版本，以及保存包的下载地址├── .postcssrc.js          给postcss用的，postcss类似于 less、sass 预处理器└── README.md             项目说明文档</code></pre><h3 id="12-3-语法检查"><a href="#12-3-语法检查" class="headerlink" title="12.3 语法检查"></a>12.3 语法检查</h3><p>注意 ：如果我们在 构建项目时 选择了 <code>Use ESLint to lint your code</code> 那么我们在写代码时必须严格遵守 <a href="https://standardjs.com/" target="_blank" rel="noopener">JavaScript Standard Style</a> 代码风格的语法规则：</p><ul><li><strong>使用两个空格</strong> – 进行缩进</li><li><strong>字符串使用单引号</strong> – 需要转义的地方除外</li><li><strong>不再有冗余的变量</strong> – 这是导致 <em>大量</em> bug 的源头!</li><li><strong>无分号</strong> – <a href="http://blog.izs.me/post/2353458699/an-open-letter-to-javascript-leaders-regarding" target="_blank" rel="noopener">这</a><a href="http://inimino.org/~inimino/blog/javascript_semicolons" target="_blank" rel="noopener">没什么不好。</a><a href="https://www.youtube.com/watch?v=gsfbh17Ax9I" target="_blank" rel="noopener">不骗你！</a></li><li>行首不要以 <code>(</code>, <code>[</code>, or ``` 开头<ul><li>这是省略分号时<strong>唯一</strong>会造成问题的地方 – <em>工具里已加了自动检测！</em></li><li><a href="https://github.com/standard/standard/blob/master/docs/RULES-zhcn.md#semicolons" target="_blank" rel="noopener">详情</a></li></ul></li><li><strong>关键字后加空格</strong> <code>if (condition) { ... }</code></li><li><strong>函数名后加空格</strong> <code>function name (arg) { ... }</code></li><li>坚持使用全等 <code>===</code> 摒弃 <code>==</code> 一但在需要检查 <code>null || undefined</code> 时可以使用 <code>obj == null</code>。</li><li>一定要处理 Node.js 中错误回调传递进来的 <code>err</code> 参数。</li><li>使用浏览器全局变量时加上 <code>window</code> 前缀 – <code>document</code> 和 <code>navigator</code> 除外<ul><li>避免无意中使用到了这些命名看上去很普通的全局变量， <code>open</code>, <code>length</code>, <code>event</code> 还有 <code>name</code>。</li></ul></li></ul><p>说了那么多，看看<a href="https://github.com/expressjs/body-parser/blob/master/index.js" target="_blank" rel="noopener">这个遵循了 Standard 规范的示例文件</a> 中的代码吧。或者，这里还有<a href="https://raw.githubusercontent.com/standard/standard-packages/master/all.json" target="_blank" rel="noopener">一大波使用了此规范的项目</a> 代码可供参考。</p><blockquote><p>注意: 如果你不适应这些语法规则,可以在构建项目时不使用 ESLint 的语法检查</p></blockquote><h3 id="12-4-项目代码预览"><a href="#12-4-项目代码预览" class="headerlink" title="12.4 项目代码预览"></a>12.4 项目代码预览</h3><h4 id="12-4-1-知识储备"><a href="#12-4-1-知识储备" class="headerlink" title="12.4.1 知识储备"></a>12.4.1 知识储备</h4><h5 id="严格模式"><a href="#严格模式" class="headerlink" title="严格模式"></a>严格模式</h5><p><a href="http://javascript.ruanyifeng.com/advanced/strict.html" target="_blank" rel="noopener">http://javascript.ruanyifeng.com/advanced/strict.html</a></p><p>严格模式主要有以下限制。</p><ul><li><p>变量必须声明后再使用</p></li><li><p>函数的参数不能有同名属性，否则报错</p></li><li><p>不能使用<code>with</code>语句</p></li><li><p>不能对只读属性赋值，否则报错</p></li><li><p>不能使用前缀 0 表示八进制数，否则报错</p></li><li><p>不能删除不可删除的属性，否则报错</p></li><li><p>不能删除变量<code>delete prop</code>，会报错，只能删除属性<code>delete global[prop]</code></p></li><li><p><code>eval</code>不会在它的外层作用域引入变量</p></li><li><p><code>eval</code>和<code>arguments</code>不能被重新赋值</p></li><li><p><code>arguments</code>不会自动反映函数参数的变化</p></li><li><p>不能使用<code>arguments.callee</code></p></li><li><p>不能使用<code>arguments.caller</code></p></li><li><p>禁止<code>this</code>指向全局对象</p></li><li><p>不能使用<code>fn.caller</code>和<code>fn.arguments</code>获取函数调用的堆栈</p></li><li><p>增加了保留字（比如<code>protected</code>、<code>static</code>和<code>interface</code>）</p></li></ul><h5 id="ES6-模块化"><a href="#ES6-模块化" class="headerlink" title="ES6 模块化"></a>ES6 模块化</h5><p><a href="http://es6.ruanyifeng.com/#docs/module" target="_blank" rel="noopener">http://es6.ruanyifeng.com/#docs/module</a></p><p>总结：</p><ul><li>CommonJS 模块输出的是一个值的拷贝，ES6 模块输出的是值的引用；</li><li>CommonJS 模块是运行时加载，ES6 模块是编译时输出接口；</li><li>ES6 的模块自动采用严格模式，不管你有没有在模块头部加上<code>&quot;use strict&quot;;</code>；</li><li>ES6 模块之中，顶层的<code>this</code>指向<code>undefined</code>；CommonJS 模块的顶层<code>this</code>指向当前模块；</li></ul><h4 id="12-4-2-代码加载执行"><a href="#12-4-2-代码加载执行" class="headerlink" title="12.4.2 代码加载执行"></a>12.4.2 代码加载执行</h4><p>main.js</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 入口文件</span><span class="token comment" spellcheck="true">// 以es6模块的方式引入 vue APP router 三个模块;</span><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">"./App"</span><span class="token punctuation">;</span><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">"./router"</span><span class="token punctuation">;</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/* eslint-disable no-new */</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 获取节点对象</span>  el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 引入路由</span>  router<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 本实例的私有组件</span>  components<span class="token punctuation">:</span> <span class="token punctuation">{</span> App <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// el 与 template 在同一个实例中出现，</span>  <span class="token comment" spellcheck="true">// 根据生命周期的执行顺序可知，template中的内容会替换el选中的内容</span>  template<span class="token punctuation">:</span> <span class="token string">"&lt;App/>"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>roter/index.js</p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span><span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">"vue-router"</span><span class="token punctuation">;</span><span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">"@/components/HelloWorld"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Vue 中插件引入语法</span><span class="token comment" spellcheck="true">// https://cn.vuejs.org/v2/guide/plugins.html</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ES6模块导出语法</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  routes<span class="token punctuation">:</span> <span class="token punctuation">[</span>    <span class="token comment" spellcheck="true">// 定义一个路由规则</span>    <span class="token punctuation">{</span>      path<span class="token punctuation">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 请求路径</span>      name<span class="token punctuation">:</span> <span class="token string">"HelloWorld"</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 路由名称标识</span>      component<span class="token punctuation">:</span> HelloWorld <span class="token comment" spellcheck="true">//请求此路由时，使用的组件</span>    <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>components/HelloWorld.vue</p><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 模块名字</span>  name<span class="token punctuation">:</span> <span class="token string">"HelloWorld"</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 组件中 data 数据必须是一个有返回值的方法</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      msg<span class="token punctuation">:</span> <span class="token string">"Welcome to Your Vue.js App"</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><pre><code>(main.js-&gt;template: &#39;&lt;App/&gt;&#39;)替换 (index.html-&gt;div#app);(index.html-&gt;&lt;App/&gt;) --&gt; (components: { App })( components: { App }) --&gt; (import App from &#39;./App&#39; -&gt; src/App.vue)(App.vue -&gt; &lt;router-view/&gt; -&gt; 路由组件) --&gt; (main.js-&gt; router)========此项决定了页面展示那个组件内容 ========({path: &#39;/&#39;,name: &#39;HelloWorld&#39;, component: HelloWorld }) --&gt; (import HelloWorld from &#39;@/components/HelloWorld&#39;)(src/components/HelloWorld.vue) --&gt; &lt;router-view/&gt;</code></pre><h3 id="12-5-添加自己的路由组件"><a href="#12-5-添加自己的路由组件" class="headerlink" title="12.5 添加自己的路由组件"></a>12.5 添加自己的路由组件</h3><p>修改 router/index.js ，添加自己的路由</p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span><span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">"vue-router"</span><span class="token punctuation">;</span><span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">"@/components/HelloWorld"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 引入(导入) 组件</span><span class="token keyword">import</span> MyRouter <span class="token keyword">from</span> <span class="token string">"@/components/MyRouter"</span><span class="token punctuation">;</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ES6模块导出语法</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  routes<span class="token punctuation">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">"HelloWorld"</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> HelloWorld <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 添加自己的路由及组件</span>    <span class="token punctuation">{</span>      path<span class="token punctuation">:</span> <span class="token string">"/myrouter"</span><span class="token punctuation">,</span>      name<span class="token punctuation">:</span> <span class="token string">"MyRouter"</span><span class="token punctuation">,</span>      component<span class="token punctuation">:</span> MyRouter    <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在 components 文件夹中添加 MyRouter.vue 文件，写自己的组件代码：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mypage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    { {mydatas} }  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token comment" spellcheck="true">// 模块化导出</span>  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span> mydatas<span class="token punctuation">:</span> <span class="token string">"lksadjflks"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">  <span class="token selector"><span class="token class">.mypage</span> </span><span class="token punctuation">{</span>    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">50</span>px<span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> pink<span class="token punctuation">;</span>  <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><p>浏览器渲染效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-21_14-11-46.png" alt=""></p><h2 id="第-13-章-Vuex"><a href="#第-13-章-Vuex" class="headerlink" title="第 13 章 Vuex"></a>第 13 章 Vuex</h2><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/vuex.png" alt=""></p><p>流程：组件-&gt;Actions-&gt;Mutations-&gt;State-&gt;组件</p><h3 id="严格模式-1"><a href="#严格模式-1" class="headerlink" title="严格模式"></a>严格模式</h3><p>开启严格模式，仅需在创建 store 的时候传入 <code>strict: true</code>：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// ...</span>  strict<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在严格模式下，无论何时发生了状态变更且不是由 mutation 函数引起的，将会抛出错误。这能保证所有的状态变更都能被调试工具跟踪到。</p><h3 id="开发环境与发布环境"><a href="#开发环境与发布环境" class="headerlink" title="#开发环境与发布环境"></a><a href="https://vuex.vuejs.org/zh/guide/strict.html#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E4%B8%8E%E5%8F%91%E5%B8%83%E7%8E%AF%E5%A2%83" target="_blank" rel="noopener">#</a>开发环境与发布环境</h3><p><strong>不要在发布环境下启用严格模式</strong>！严格模式会深度监测状态树来检测不合规的状态变更——请确保在发布环境下关闭严格模式，以避免性能损失。</p><p>类似于插件，我们可以让构建工具来处理这种情况：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// ...</span>  strict<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">!==</span> <span class="token string">"production"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="基本使用-介绍"><a href="#基本使用-介绍" class="headerlink" title="基本使用/介绍"></a>基本使用/介绍</h3><p>state——存储、数据<br>mutation——修改数据、追踪；同步<br>action——封装：组合；异步</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//安装</span>npm install vuex<span class="token comment" spellcheck="true">//加载</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">"vuex"</span><span class="token comment" spellcheck="true">//也可以在vue-cli中单独添加一个文件类似vue-router一样，命名为store(脚手架环境)</span><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token keyword">import</span> Vuex form <span class="token string">'vuex'</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//基本使用/介绍</span><span class="token comment" spellcheck="true">//跟router一样，要new一个vuex</span><span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//1.strict是否开启严格模式，</span>    strice：<span class="token boolean">true</span>，<span class="token comment" spellcheck="true">//2.state 存放数据的属性 vuex核心</span>    state：<span class="token punctuation">{</span>      <span class="token operator">...</span>data    <span class="token punctuation">}</span>，<span class="token comment" spellcheck="true">//3.改变state时必须经过的属性</span>    muations<span class="token punctuation">:</span><span class="token punctuation">{</span>        <span class="token operator">...</span><span class="token keyword">function</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span><span class="token operator">...</span>参数<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">/*4.Action 类似于 mutation，不同在于：Action 提交的是 mutation，而不是直接变更状态。Action 可以包含任意异步操作。*/</span>    actions<span class="token punctuation">:</span><span class="token punctuation">{</span>        <span class="token operator">...</span><span class="token keyword">function</span><span class="token punctuation">(</span>state <span class="token operator">||</span> <span class="token punctuation">{</span>commit<span class="token punctuation">}</span><span class="token punctuation">,</span>参数<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//5.类似vue的计算computed，主要处理一些需要计算、总和的操作</span>    getters<span class="token punctuation">:</span><span class="token punctuation">{</span>        <span class="token operator">...</span><span class="token keyword">function</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token operator">?</span><span class="token operator">+</span>state<span class="token punctuation">.</span><span class="token operator">?</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//6.类似路由组件，可以分成很多个模块引入加载</span>    modules<span class="token punctuation">:</span><span class="token punctuation">{</span>        <span class="token operator">...</span>vuex模块    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="辅助方法"><a href="#辅助方法" class="headerlink" title="辅助方法"></a>辅助方法</h3><p>mapState state -&gt; computed<br>mapActions actions -&gt; methods<br>mapGetters getters -&gt; computed<br>mapMutations mutations -&gt; methods</p><p>映射</p><p>这 3 个方法可以实现自动把 vuex 的 state,actions,getters,加载到 vue 组件里使用，简化了中间手动繁琐的操作</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//使用之前必须从vuex里引入这些方法：import {mapState, mapActions, mapGetters} from 'vuex';</span>computed<span class="token punctuation">:</span><span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span>vuex里面的state<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span>vuex里面的getters<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>methods<span class="token punctuation">:</span><span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span>vuex里面的actions<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token punctuation">[</span>vuex里面的mutations<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//也可以传入一个对象，用于命别名</span>    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      a<span class="token punctuation">:</span><span class="token string">'fun'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="基本使用（综合案例）"><a href="#基本使用（综合案例）" class="headerlink" title="基本使用（综合案例）"></a>基本使用（综合案例）</h3><p>vuex 配置</p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">"vuex"</span><span class="token punctuation">;</span><span class="token keyword">import</span> ModA <span class="token keyword">from</span> <span class="token string">"./mod_a"</span><span class="token punctuation">;</span><span class="token keyword">import</span> ModB <span class="token keyword">from</span> <span class="token string">"./mod_b"</span><span class="token punctuation">;</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//vuex3-声明store对象</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  strict<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">!=</span> <span class="token string">"production"</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//严格模式：防止直接修改state</span>  state<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//核心：数据</span>    a<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>    b<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>    users<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  mutations<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token function">addA</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>      state<span class="token punctuation">.</span>a <span class="token operator">+</span><span class="token operator">=</span> n<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">addB</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>      state<span class="token punctuation">.</span>b <span class="token operator">+</span><span class="token operator">=</span> n<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">setOnline</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>      state<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>user <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>id <span class="token operator">==</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>          user<span class="token punctuation">.</span>online <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">setUsers</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>      state<span class="token punctuation">.</span>users <span class="token operator">=</span> users<span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  actions<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token function">addA</span><span class="token punctuation">(</span><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">"addA"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">addB</span><span class="token punctuation">(</span><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">"addB"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">setOnline</span><span class="token punctuation">(</span><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">"setOnline"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token keyword">async</span> <span class="token function">readUsers</span><span class="token punctuation">(</span><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8081/user.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">let</span> users <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">"setUsers"</span><span class="token punctuation">,</span> users<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  getters<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token function">count</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> state<span class="token punctuation">.</span>a <span class="token operator">+</span> state<span class="token punctuation">.</span>b<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">onlineUsers</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> state<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>user <span class="token operator">=</span><span class="token operator">></span> user<span class="token punctuation">.</span>online<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  modules<span class="token punctuation">:</span> <span class="token punctuation">{</span>    mod_a<span class="token punctuation">:</span> ModA<span class="token punctuation">,</span>    mod_b<span class="token punctuation">:</span> ModB  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>调用 vuex</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>a: { {a}}&lt; /div>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>b: { {b}}&lt; /div>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>count: { {count}}&lt; /div>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a+5<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>addA(5)<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>b+3<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>addB(3)<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    str: { {$stor e.state.str}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    a_str: { {str_a}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    b_str: { {str_b}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>设置A<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>set_a(<span class="token punctuation">'</span>aaa<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>设置B<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>set_b(<span class="token punctuation">'</span>bbb<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>张三出现<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setOnline(5)<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>user in onlineUsers<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        名字：{ {user.nam e}}        年龄：{ {user.ag e}}      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token keyword">import</span> Table <span class="token keyword">from</span> <span class="token string">'@/components/common/Table'</span><span class="token punctuation">;</span><span class="token keyword">import</span> Cmp1 <span class="token keyword">from</span> <span class="token string">'@/components/Cmp1'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">{</span>mapState<span class="token punctuation">,</span> mapActions<span class="token punctuation">,</span> mapGetters<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token punctuation">:</span> <span class="token string">'Index'</span><span class="token punctuation">,</span>  data <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      fields<span class="token punctuation">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'ID'</span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> <span class="token string">'ID'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'name'</span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> <span class="token string">'姓名'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'age'</span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> <span class="token string">'年龄'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>      datas<span class="token punctuation">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">25</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token keyword">async</span> <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">readUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//this.setStr('sdfasdfsdg');</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token function">del</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>datas<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>datas<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token operator">></span>data<span class="token punctuation">.</span>ID<span class="token operator">!=</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'addA'</span><span class="token punctuation">,</span> <span class="token string">'addB'</span><span class="token punctuation">,</span> <span class="token string">'setOnline'</span><span class="token punctuation">,</span> <span class="token string">'readUsers'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">//...mapActions(['setStr'])</span>    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      set_a<span class="token punctuation">:</span> <span class="token string">'mod_a.setStr'</span><span class="token punctuation">,</span>      set_b<span class="token punctuation">:</span> <span class="token string">'mod_b.setStr'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// set_a(){</span>    <span class="token comment" spellcheck="true">//   this.$store.dispatch('mod_a.setStr', 'aaa');</span>    <span class="token comment" spellcheck="true">// },</span>    <span class="token comment" spellcheck="true">// set_b(){</span>    <span class="token comment" spellcheck="true">//   this.$store.dispatch('mod_b.setStr', 'bbb');</span>    <span class="token comment" spellcheck="true">// }</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  components<span class="token punctuation">:</span> <span class="token punctuation">{</span>    Table<span class="token punctuation">,</span> Cmp1  <span class="token punctuation">}</span><span class="token punctuation">,</span>  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      str_a<span class="token punctuation">:</span> state<span class="token operator">=</span><span class="token operator">></span>state<span class="token punctuation">.</span>mod_a<span class="token punctuation">.</span>str<span class="token punctuation">,</span>      str_b<span class="token punctuation">:</span> state<span class="token operator">=</span><span class="token operator">></span>state<span class="token punctuation">.</span>mod_b<span class="token punctuation">.</span>str<span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token string">'onlineUsers'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style language-css"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><h1 id="Vue-前后端分离项目"><a href="#Vue-前后端分离项目" class="headerlink" title="Vue 前后端分离项目"></a>Vue 前后端分离项目</h1><h2 id="第-0-章-项目如何开始的"><a href="#第-0-章-项目如何开始的" class="headerlink" title="第 0 章 项目如何开始的"></a>第 0 章 项目如何开始的</h2><h3 id="0-1-总体流程"><a href="#0-1-总体流程" class="headerlink" title="0.1 总体流程"></a>0.1 总体流程</h3><p>需求调研–&gt;需求转为需求文档–&gt;将需求文档转为开发文档–&gt;前端文档–&gt;后台文档–&gt;项目测试–&gt;打包上线</p><h3 id="0-2-数据服务器构建"><a href="#0-2-数据服务器构建" class="headerlink" title="0.2 数据服务器构建"></a>0.2 数据服务器构建</h3><h4 id="0-2-1-技术栈"><a href="#0-2-1-技术栈" class="headerlink" title="0.2.1 技术栈"></a>0.2.1 技术栈</h4><p>Vue+elementUI+NodeJS+MySQL</p><h4 id="0-2-2-数据服务器准备"><a href="#0-2-2-数据服务器准备" class="headerlink" title="0.2.2 数据服务器准备"></a>0.2.2 数据服务器准备</h4><p>导入数据库数据：打开数据库服务器，新建名为 <code>itcast</code> 的库；</p><p>后台为我们提供了 <code>/api-server/db/mydb.sql</code> 数据文件，打开复制 sql 语句直接运行即可；</p><p>然后在 api-server 中执行 <code>npm install</code> 安装服务器所需扩展模块；</p><p><code>node app.js</code> 将服务器启动起来;</p><h3 id="0-3-接口测试"><a href="#0-3-接口测试" class="headerlink" title="0.3 接口测试"></a>0.3 接口测试</h3><h4 id="0-3-1-登录"><a href="#0-3-1-登录" class="headerlink" title="0.3.1 登录"></a>0.3.1 登录</h4><p>后台已经写好接口文档，根据文档中的表述，我们测试登录接口：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-21_15-34-13.png" alt=""></p><h4 id="0-3-2-获取用户信息"><a href="#0-3-2-获取用户信息" class="headerlink" title="0.3.2 获取用户信息"></a>0.3.2 获取用户信息</h4><p>请求用户列表数据；但是，并没有返回相应的数据；</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-21_15-42-57.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-21_15-44-14.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-21_15-45-34.png" alt=""></p><blockquote><p>使用 token 替换 cookie 的功能</p></blockquote><h3 id="0-4-Vue-项目初始化"><a href="#0-4-Vue-项目初始化" class="headerlink" title="0.4 Vue 项目初始化"></a>0.4 Vue 项目初始化</h3><p>使用 vue-cli 工具初始化项目：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-21_15-56-43.png" alt=""></p><p>初始化成功，使用 <code>npm run dev</code> 启动项目；</p><h3 id="0-5-项目预览"><a href="#0-5-项目预览" class="headerlink" title="0.5 项目预览"></a>0.5 项目预览</h3><p>解压 <code>my-project(Vue项目).rar</code> 后进入目录，使用 <code>npm run dev</code> 启动项目；</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-21_16-09-59.png" alt=""></p><h2 id="第-1-章-开始项目"><a href="#第-1-章-开始项目" class="headerlink" title="第 1 章 开始项目"></a>第 1 章 开始项目</h2><h3 id="1-1-添加用户登录路由组件"><a href="#1-1-添加用户登录路由组件" class="headerlink" title="1.1 添加用户登录路由组件"></a>1.1 添加用户登录路由组件</h3><p>添加路由：<code>myapp-code/src/router/index.js</code></p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span><span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">"vue-router"</span><span class="token punctuation">;</span><span class="token keyword">import</span> Login <span class="token keyword">from</span> <span class="token string">"@/components/login/login"</span><span class="token punctuation">;</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  routes<span class="token punctuation">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>      path<span class="token punctuation">:</span> <span class="token string">"/login"</span><span class="token punctuation">,</span>      name<span class="token punctuation">:</span> <span class="token string">"Login"</span><span class="token punctuation">,</span>      component<span class="token punctuation">:</span> Login    <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>添加组件：<code>myapp-code/src/components/login/login.vue</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>{ {msg}}&lt; /div><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>msg<span class="token punctuation">:</span><span class="token string">'我是登录页面'</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><p>修改 Vue 项目运行端口： myapp-code/config/index.js</p><h3 id="1-2-使用-ElementUI"><a href="#1-2-使用-ElementUI" class="headerlink" title="1.2 使用 ElementUI"></a>1.2 使用 ElementUI</h3><p><a href="http://element-cn.eleme.io/#/zh-CN" target="_blank" rel="noopener">http://element-cn.eleme.io/#/zh-CN</a></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-21_16-51-06.png" alt=""></p><p>修改 <code>src/main.js</code> 代码，全局引入 ElementUI ；</p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">"./App"</span><span class="token punctuation">;</span><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">"./router"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 引入 ElementUI</span><span class="token keyword">import</span> ElementUI <span class="token keyword">from</span> <span class="token string">"element-ui"</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">"element-ui/lib/theme-chalk/index.css"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 将 ElementUI 注册为 vue的全局组件</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElementUI<span class="token punctuation">)</span><span class="token punctuation">;</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>  router<span class="token punctuation">,</span>  components<span class="token punctuation">:</span> <span class="token punctuation">{</span> App <span class="token punctuation">}</span><span class="token punctuation">,</span>  template<span class="token punctuation">:</span> <span class="token string">"&lt;App/>"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在我们登录页面中尝试一下：<code>src/components/login/login.vue</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>success<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>成功按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>信息按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>warning<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>警告按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>danger<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>危险按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre><h3 id="1-3-搭建登录页面"><a href="#1-3-搭建登录页面" class="headerlink" title="1.3 搭建登录页面"></a>1.3 搭建登录页面</h3><p>把公共样式写到 <code>src/assets/css/style.css</code> ： <code>Form 表单</code></p><pre class=" language-css"><code class="language-css"><span class="token selector">html,body </span><span class="token punctuation">{</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">body </span><span class="token punctuation">{</span>  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>然后在 <code>src/main.js</code> 加载公共样式：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 代码略...</span><span class="token comment" spellcheck="true">// 引入我们的公共样式</span><span class="token keyword">import</span> <span class="token string">"./assets/css/style.css"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 代码略...</span></code></pre><p>为了让登陆组件的背景色撑满，所以我们需要让他们的父盒子 <code>div#app</code> 高度设置为 <code>100%</code>。</p><p>所以我们在 <code>src/App.vue</code> ：</p><pre class=" language-css"><code class="language-css"><span class="token selector">&lt;style><span class="token id">#app</span> </span><span class="token punctuation">{</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span><span class="token punctuation">}</span>&lt;/style></code></pre><p>接下来我们开始调整 <code>src/components/login/login.vue</code> 组件样式：</p><ul><li>注意：这里遵循一个原则，不要直接去使用 Element 组件自带的类名</li><li>如果你想为 Element 组件添加自定义样式，那么建议你给它加你自己的类名来控制</li></ul><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>login-wrap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span>      <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form<span class="token punctuation">"</span></span>      <span class="token attr-name">:label-position</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>labelPosition<span class="token punctuation">"</span></span>      <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form<span class="token punctuation">"</span></span>      <span class="token attr-name">label-width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>80px<span class="token punctuation">"</span></span>      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>login-from<span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>用户登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>用户名<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form.name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label-position</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>top<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>密码<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form.pwd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onSubmit<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>login-btn<span class="token punctuation">"</span></span>          <span class="token punctuation">></span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span>        <span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>        labelPosition<span class="token punctuation">:</span> <span class="token string">"top"</span><span class="token punctuation">,</span>        form<span class="token punctuation">:</span> <span class="token punctuation">{</span>          name<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>          pwd<span class="token punctuation">:</span> <span class="token string">""</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token function">onSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><pre class=" language-css"><code class="language-css"><span class="token selector">&lt;style><span class="token class">.login-wrap</span> </span><span class="token punctuation">{</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#324152</span><span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.login-wrap</span> <span class="token class">.login-from</span> </span><span class="token punctuation">{</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#fff</span><span class="token punctuation">;</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">400</span>px<span class="token punctuation">;</span>  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span>  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.login-wrap</span> <span class="token class">.login-from</span> <span class="token class">.login-btn</span> </span><span class="token punctuation">{</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span><span class="token punctuation">}</span>&lt;/style></code></pre><h3 id="1-4-完成登录功能"><a href="#1-4-完成登录功能" class="headerlink" title="1.4 完成登录功能"></a>1.4 完成登录功能</h3><h4 id="1-4-1-封装-axios"><a href="#1-4-1-封装-axios" class="headerlink" title="1.4.1 封装 axios"></a>1.4.1 封装 axios</h4><p>vue 插件语法： <a href="https://cn.vuejs.org/v2/guide/plugins.html" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/plugins.html</a></p><p>Axios : <a href="https://www.kancloud.cn/yunye/axios/234845" target="_blank" rel="noopener">https://www.kancloud.cn/yunye/axios/234845</a></p><p><code>npm install axios</code> ,将 axios 进行模块化封装，以 Vue 插件的方式，全局引入：</p><p>将插件的封装写入 <code>src/assets/js/myaxios.js</code></p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 引入axios</span><span class="token keyword">import</span> Axios <span class="token keyword">from</span> <span class="token string">"axios"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 自定义插件对象</span><span class="token keyword">var</span> myaxios <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>myaxios<span class="token punctuation">.</span>install <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 设置axios请求的URL，此后axios发送的请求全部执行本地址</span>  <span class="token keyword">var</span> axios_obj <span class="token operator">=</span> Axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    baseURL<span class="token punctuation">:</span> <span class="token string">"http://localhost:8888/api/private/v1/"</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 将设置好的axios对象赋值给Vue实例的原型</span>  <span class="token comment" spellcheck="true">// 之后可以在Vue中直接只用 this.$myHttp 使用axios发送请求</span>  vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$myHttp <span class="token operator">=</span> axios_obj<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 将插件以 模块 方式导出</span><span class="token keyword">export</span> <span class="token keyword">default</span> myaxios<span class="token punctuation">;</span></code></pre><p>在 main.js 引入 axios 插件，并注册为全局插件</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 导入 myaxios 模块</span><span class="token keyword">import</span> myaxios <span class="token keyword">from</span> <span class="token string">"@/assets/js/myaxios.js"</span><span class="token punctuation">;</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>myaxios<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 注册使用 axios 插件</span></code></pre><h4 id="1-4-2-完成登录功能"><a href="#1-4-2-完成登录功能" class="headerlink" title="1.4.2 完成登录功能"></a>1.4.2 完成登录功能</h4><p><strong>发送 post 请求</strong></p><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      labelPosition<span class="token punctuation">:</span> <span class="token string">"top"</span><span class="token punctuation">,</span>      form<span class="token punctuation">:</span> <span class="token punctuation">{</span>        username<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        password<span class="token punctuation">:</span> <span class="token string">""</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 修改组件中绑定的按钮名称为 onLogin</span>    <span class="token function">onLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 使用axios 发送post 请求，传入data中的form数据</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$myHttp<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>backdata <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 异步执行成功后</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>backdata<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><strong>继续修改代码，完成登录逻辑</strong>：</p><p>vue-router 编程式导航： <a href="https://router.vuejs.org/zh/guide/essentials/navigation.html" target="_blank" rel="noopener">https://router.vuejs.org/zh/guide/essentials/navigation.html</a></p><pre class=" language-js"><code class="language-js"><span class="token function">onLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 使用axios 发送post 请求，传入data中的form数据</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$myHttp<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>backdata<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 异步执行成功后</span>        <span class="token comment" spellcheck="true">//console.log(backdata.data);</span>        <span class="token comment" spellcheck="true">// 结构赋值，获取返回的数据</span>        <span class="token keyword">var</span> <span class="token punctuation">{</span>data<span class="token punctuation">,</span>meta<span class="token punctuation">}</span>  <span class="token operator">=</span> backdata<span class="token punctuation">.</span>data<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 判断数据状态</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>meta<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'登录成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 使用vue-router编程式导航跳转到home</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'home'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//注意：push会产生历史记录，因此可以返回，当一些操作不想让撤回时可以使用replace，同时也不会产生历史记录</span></code></pre><p><strong>修改提示弹窗</strong></p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> meta <span class="token punctuation">}</span> <span class="token operator">=</span> backdata<span class="token punctuation">.</span>data<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 判断数据状态</span><span class="token keyword">if</span> <span class="token punctuation">(</span>meta<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    message<span class="token punctuation">:</span> <span class="token string">"恭喜你，登录成功"</span><span class="token punctuation">,</span>    type<span class="token punctuation">:</span> <span class="token string">"success"</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 使用vue-router编程式导航跳转到home</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"home"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"错了哦"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h4 id="1-4-3-表单验证"><a href="#1-4-3-表单验证" class="headerlink" title="1.4.3 表单验证"></a>1.4.3 表单验证</h4><p>Form 组件提供了表单验证的功能，只需要通过 <code>rules</code> 属性传入约定的验证规则，并将 Form-Item 的 <code>prop</code> 属性设置为需校验的字段名即可。</p><pre class=" language-js"><code class="language-js"><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      labelPosition<span class="token punctuation">:</span> <span class="token string">"top"</span><span class="token punctuation">,</span>      form<span class="token punctuation">:</span> <span class="token punctuation">{</span>        username<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        password<span class="token punctuation">:</span> <span class="token string">""</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token comment" spellcheck="true">// 与 el-form 中的 :rules="rules"  对应</span>      rules<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//与 el-form-item 中的 prop="username" 对应</span>        username<span class="token punctuation">:</span> <span class="token punctuation">[</span>          <span class="token comment" spellcheck="true">// 验证规则  是否必须        提示信息            触发时机</span>          <span class="token punctuation">{</span> required<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string">"请输入用户名"</span><span class="token punctuation">,</span> trigger<span class="token punctuation">:</span> <span class="token string">"blur"</span> <span class="token punctuation">}</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        password<span class="token punctuation">:</span> <span class="token punctuation">[</span>          <span class="token punctuation">{</span> required<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string">"请输入密码"</span><span class="token punctuation">,</span> trigger<span class="token punctuation">:</span> <span class="token string">"blur"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">{</span> min<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> max<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string">"长度在 3 到 5 个字符"</span><span class="token punctuation">,</span> trigger<span class="token punctuation">:</span> <span class="token string">"blur"</span> <span class="token punctuation">}</span>        <span class="token punctuation">]</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-21_21-49-00.png" alt=""></p><h4 id="1-4-4-阻止数据提交"><a href="#1-4-4-阻止数据提交" class="headerlink" title="1.4.4 阻止数据提交"></a>1.4.4 阻止数据提交</h4><pre class=" language-js"><code class="language-js"><span class="token function">onLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 因为要获取form表单的节点对象，</span>    <span class="token comment" spellcheck="true">// 所以 el-form 中要加入 ref="ruleForm"</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>ruleForm<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>valid <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// elementUI 会将 validate 方法加入到节点对象，</span>        <span class="token comment" spellcheck="true">// 在提交是，如果表单的验证未通过，会将错误信息传入回调函数</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 如果有表单错误信息，则无反应</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"输入有误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 使用axios 发送post 请求，传入data中的form数据</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$myHttp<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>backdata <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 结构赋值，获取返回的数据</span>            <span class="token keyword">var</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> meta <span class="token punctuation">}</span> <span class="token operator">=</span> backdata<span class="token punctuation">.</span>data<span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 判断数据状态</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>meta<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span> <span class="token string">"恭喜你，登录成功"</span><span class="token punctuation">,</span>                    type<span class="token punctuation">:</span> <span class="token string">"success"</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// 使用vue-router编程式导航跳转到home</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"home"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"错了哦"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="1-5-首页"><a href="#1-5-首页" class="headerlink" title="1.5 首页"></a>1.5 首页</h3><h4 id="1-5-1-添加路由及页面布局"><a href="#1-5-1-添加路由及页面布局" class="headerlink" title="1.5.1 添加路由及页面布局"></a>1.5.1 添加路由及页面布局</h4><p>修改登录成功后逻辑，使用路由名称表示进行跳转：</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 使用vue-router编程式导航跳转到home</span><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"home"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>导入组件，添加路由 <code>src/router/index.js</code></p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">'@/components/home/home'</span> ……<span class="token punctuation">{</span>    path<span class="token punctuation">:</span><span class="token string">'/'</span><span class="token punctuation">,</span>    name<span class="token punctuation">:</span><span class="token string">'home'</span><span class="token punctuation">,</span>    component<span class="token punctuation">:</span>Home<span class="token punctuation">}</span></code></pre><p>添加一个 home 组件<code>src/components/home/home.vue</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>{ {msg}}&lt; /div><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span><span class="token punctuation">{</span>      msg<span class="token punctuation">:</span><span class="token string">'we'</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>修改一个 home 组件<code>src/components/home/home.vue</code> <code>Container 布局容器</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-container</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>height100<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-header</span><span class="token punctuation">></span></span>Header<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-header</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-container</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-aside</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>200px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Aside<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-aside</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-main</span><span class="token punctuation">></span></span>Main<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-main</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-container</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-container</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre><pre class=" language-css"><code class="language-css"><span class="token selector"><span class="token class">.height100</span> </span><span class="token punctuation">{</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.el-header</span> </span><span class="token punctuation">{</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#b3c0d1</span><span class="token punctuation">;</span>  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#333</span><span class="token punctuation">;</span>  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">60</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.el-aside</span> </span><span class="token punctuation">{</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#d3dce6</span><span class="token punctuation">;</span>  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#333</span><span class="token punctuation">;</span>  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.el-main</span> </span><span class="token punctuation">{</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#e9eef3</span><span class="token punctuation">;</span>  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#333</span><span class="token punctuation">;</span>  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">160</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h4 id="1-5-2-头部样式"><a href="#1-5-2-头部样式" class="headerlink" title="1.5.2 头部样式"></a>1.5.2 头部样式</h4><p><code>/src/components/home/home.vue</code></p><p><code>Layout 布局</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-header</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-row</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>grid-content bg-purple<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/static/logo.png<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>12<span class="token punctuation">"</span></span>      <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>grid-content bg-purple-light<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>电商后台管理系统<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span>    <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span>      <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>grid-content bg-purple<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>warning<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>退出<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span>    <span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-row</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-header</span><span class="token punctuation">></span></span>…… // 标题文本样式 .bg-purple-light { font-size: 25px; color: white; }</code></pre><h4 id="1-5-3-左侧样式"><a href="#1-5-3-左侧样式" class="headerlink" title="1.5.3 左侧样式"></a>1.5.3 左侧样式</h4><p><code>/src/components/home/home.vue</code></p><p><code>NavMenu 导航菜单</code> <code>Icon 图标</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-container</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-aside</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>200px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--         el-menu 侧边导航栏组件            unique-opened="true" 只保持一个导航开启            router="true" 开启导航路由        el-submenu 导航栏的顶级项        template 导航栏中需要展示的内容            i 图标            span 文字        el-menu-item-group 次级导航组 内容与导航的组标识 可直接删除        el-menu-item  导航栏选项          index属性 控制收起展开+路由标识:              在el-menu中加入router=“true”属性;              index="1-1" 点击时路由跳转到1-1 ;      --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-menu</span>      <span class="token attr-name">:unique-opened</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>      <span class="token attr-name">:router</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>      <span class="token attr-name">default-active</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span>      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-menu-vertical-demo<span class="token punctuation">"</span></span>      <span class="token attr-name">@open</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleOpen<span class="token punctuation">"</span></span>      <span class="token attr-name">@close</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleClose<span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-submenu</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-location<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>用户管理<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-menu-item</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1-1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-menu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>          用户列表        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-menu-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-submenu</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-submenu</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-location<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>权限管理<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-menu-item</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2-1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-menu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>          角色列表        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-menu-item</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-menu-item</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2-2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-menu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>          权限列表        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-menu-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-submenu</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-menu</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-aside</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-main</span><span class="token punctuation">></span></span>Main<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-main</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-container</span><span class="token punctuation">></span></span></code></pre><p>我们发现，大部分组件，在浏览器渲染后，都会在标签内部自动添加一个标签名为名字的 class 属性 ，我们可以利用这个属性，设置样式：</p><pre class=" language-css"><code class="language-css"><span class="token selector"><span class="token class">.el-menu</span> </span><span class="token punctuation">{</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.el-submenu</span> </span><span class="token punctuation">{</span>  <span class="token property">text-align</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h4 id="1-5-4-右侧内容"><a href="#1-5-4-右侧内容" class="headerlink" title="1.5.4 右侧内容"></a>1.5.4 右侧内容</h4><p>添加组件内容 <code>/src/components/home/home.vue</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-main</span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 路由组件 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-main</span><span class="token punctuation">></span></span></code></pre><p>添加组件：<code>src/components/index.vue</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>我是首页内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><p>添加路由：<code>/src/router/index.js</code></p><pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>    path<span class="token punctuation">:</span><span class="token string">'/index'</span><span class="token punctuation">,</span>    name<span class="token punctuation">:</span><span class="token string">'index'</span><span class="token punctuation">,</span>    component<span class="token punctuation">:</span>Index<span class="token punctuation">}</span></code></pre><blockquote><p>注意: 我们希望 index.vue 组件的内容,展示到 home 组件的 <router-view></router-view>中</p></blockquote><p><strong>知识补充：</strong></p><p>此时，我们需要借助嵌套路由: <a href="https://router.vuejs.org/zh/guide/essentials/nested-routes.html" target="_blank" rel="noopener">https://router.vuejs.org/zh/guide/essentials/nested-routes.html</a></p><p>嵌套路由(子路由的基本用法)：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue-router.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span>  // 1:定义路由组件  var login = {    template: `            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>我是登录页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/zi<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>子路由<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>                <span class="token comment" spellcheck="true">&lt;!--路由组件中继续使用路由组件--></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            `  };  var zi = {    template: "<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">></span></span>我是嵌套路由的组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">></span></span>"  };  // 2:获取路由对象  var router = new VueRouter({    // 定义路由规则    routes: [      {        name: "login",        path: "/login",        component: login,        // 路由中的 children 属性，定义嵌套路由(子路由)        children: [{ name: "zi", path: "/zi", component: zi }]      }    ]  });  var app = new Vue({    el: "#app",    router  });<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>*<em>再谈 代码加载流程 *</em></p><pre><code>(main.js-&gt;template: &#39;&lt;App/&gt;&#39;)替换 (index.html-&gt;div#app);(index.html-&gt;&lt;App/&gt;) --&gt; (components: { App })( components: { App }) --&gt; (import App from &#39;./App&#39; -&gt; src/App.vue)(App.vue -&gt; &lt;router-view/&gt; -&gt; 路由组件) --&gt; (main.js-&gt; router)========此项决定了页面展示那个组件内容 ========({path: &#39;/&#39;,name: &#39;HelloWorld&#39;, component: HelloWorld }) --&gt; (import HelloWorld from &#39;@/components/HelloWorld&#39;)(src/components/HelloWorld.vue) --&gt; &lt;router-view/&gt;</code></pre><p>因此，我们需要让 index 成为 home 的子路由组件 <code>src/router/index.js</code></p><pre class=" language-js"><code class="language-js">routes<span class="token punctuation">:</span> <span class="token punctuation">[</span>  <span class="token punctuation">{</span>    path<span class="token punctuation">:</span> <span class="token string">"/login"</span><span class="token punctuation">,</span>    name<span class="token punctuation">:</span> <span class="token string">"Login"</span><span class="token punctuation">,</span>    component<span class="token punctuation">:</span> Login  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">{</span>    path<span class="token punctuation">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span>    name<span class="token punctuation">:</span> <span class="token string">"home"</span><span class="token punctuation">,</span>    component<span class="token punctuation">:</span> Home<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 添加子路由</span>    children<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">"index"</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">"index"</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> Index <span class="token punctuation">}</span><span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><p>登录完成后，跳转到 home–&gt;index <code>src/components/login/login.vue</code></p><pre class=" language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>meta<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    message<span class="token punctuation">:</span> <span class="token string">"恭喜你，登录成功"</span><span class="token punctuation">,</span>    type<span class="token punctuation">:</span> <span class="token string">"success"</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 使用vue-router编程式导航跳转到home->index</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"index"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="1-6-验证首页登录"><a href="#1-6-验证首页登录" class="headerlink" title="1.6 验证首页登录"></a>1.6 验证首页登录</h3><p><code>src/components/login/login.vue</code></p><pre class=" language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>meta<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    message<span class="token punctuation">:</span> <span class="token string">"恭喜你，登录成功"</span><span class="token punctuation">,</span>    type<span class="token punctuation">:</span> <span class="token string">"success"</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 登录成功后，将token信息保存到 localStorage</span>  window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 使用vue-router编程式导航跳转到home->index</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"index"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>在 <code>src/components/home/home.vue</code> 验证登录</p><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 使用生命周期的钩子函数，判断token</span>  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 获取token</span>    <span class="token keyword">var</span> token <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 错误提示</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"请登录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// 跳转到登录页面</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"Login"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      msg<span class="token punctuation">:</span> <span class="token string">"we"</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h3 id="1-7-用户退出"><a href="#1-7-用户退出" class="headerlink" title="1.7 用户退出"></a>1.7 用户退出</h3><p>绑定点击事件</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span>  <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>grid-content bg-purple<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loginOut<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>warning<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>退出<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span></code></pre><pre class=" language-js"><code class="language-js">methods<span class="token punctuation">:</span><span class="token punctuation">{</span>    <span class="token function">loginOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 清楚token</span>        window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// 退出提示</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            message<span class="token punctuation">:</span> <span class="token string">"您已经退出，继续操作请重新登录"</span><span class="token punctuation">,</span>            type<span class="token punctuation">:</span> <span class="token string">"success"</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 页面路由跳转</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"Login"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="第-2-章-用户管理"><a href="#第-2-章-用户管理" class="headerlink" title="第 2 章 用户管理"></a>第 2 章 用户管理</h2><h3 id="2-1-路由及组件"><a href="#2-1-路由及组件" class="headerlink" title="2.1 路由及组件"></a>2.1 路由及组件</h3><p><code>/src/components/home/home.vue</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-menu-item</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>users<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-menu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>  用户列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-menu-item</span><span class="token punctuation">></span></span></code></pre><p><code>src/router/index.js</code></p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Users <span class="token keyword">from</span> <span class="token string">'@/components/users/users'</span>……children<span class="token punctuation">:</span><span class="token punctuation">[</span>    <span class="token punctuation">{</span>path<span class="token punctuation">:</span><span class="token string">'index'</span><span class="token punctuation">,</span>name<span class="token punctuation">:</span><span class="token string">'index'</span><span class="token punctuation">,</span>component<span class="token punctuation">:</span>Index<span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>path<span class="token punctuation">:</span><span class="token string">'users'</span><span class="token punctuation">,</span>name<span class="token punctuation">:</span><span class="token string">'users'</span><span class="token punctuation">,</span>component<span class="token punctuation">:</span>Users<span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre><p><code>src/components/users/users.vue</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>展示用户列表表格<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><h3 id="2-2-面包屑导航及搜索框"><a href="#2-2-面包屑导航及搜索框" class="headerlink" title="2.2 面包屑导航及搜索框"></a>2.2 面包屑导航及搜索框</h3><p><code>src/components/users/users.vue</code> <code>Card 卡片</code> <code>Breadcrumb 面包屑</code> <code>Input 输入框</code> <code>Button 按钮</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 面包鞋 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-card</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-breadcrumb</span> <span class="token attr-name">separator-class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-arrow-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-breadcrumb-item</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ path: <span class="token punctuation">'</span>/index<span class="token punctuation">'</span> }<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-breadcrumb-item</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-breadcrumb-item</span><span class="token punctuation">></span></span>用户管理<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-breadcrumb-item</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-breadcrumb-item</span><span class="token punctuation">></span></span>用户列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-breadcrumb-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-breadcrumb</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-card</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre><pre class=" language-html"><code class="language-html">……<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-card</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-row</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sou<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>请输入内容<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input5<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input-with-select<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>append<span class="token punctuation">"</span></span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-search<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sou<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>success<span class="token punctuation">"</span></span> <span class="token attr-name">plain</span><span class="token punctuation">></span></span>添加用户<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-row</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>……<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 不想看到报错</span>    <span class="token keyword">return</span><span class="token punctuation">{</span>input5<span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token selector"><span class="token class">.sou</span></span><span class="token punctuation">{</span>  <span class="token property">line-height</span><span class="token punctuation">:</span><span class="token number">30</span>px<span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><h3 id="2-3-展示用户列表"><a href="#2-3-展示用户列表" class="headerlink" title="2.3 展示用户列表"></a>2.3 展示用户列表</h3><h4 id="2-3-4-组件展示"><a href="#2-3-4-组件展示" class="headerlink" title="2.3.4 组件展示"></a>2.3.4 组件展示</h4><p><code>src/components/users/users.vue</code> <code>Table 表格-&gt;自定义索引</code></p><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 表格 自定义索引 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table</span>    <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tableData<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name">    <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100%</span> <span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span>      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span>      <span class="token attr-name">:index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>indexMethod<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span>      <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>date<span class="token punctuation">"</span></span>      <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>日期<span class="token punctuation">"</span></span>      <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>180<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span>      <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span>      <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>姓名<span class="token punctuation">"</span></span>      <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>180<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      input5<span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>      tableData<span class="token punctuation">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>          date<span class="token punctuation">:</span> <span class="token string">"2016-05-03"</span><span class="token punctuation">,</span>          name<span class="token punctuation">:</span> <span class="token string">"王小虎"</span>        <span class="token punctuation">}</span>      <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token selector"><span class="token class">.sou</span> </span><span class="token punctuation">{</span>  <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.el-main</span></span><span class="token punctuation">{</span>  <span class="token property">line-height</span><span class="token punctuation">:</span><span class="token number">30</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><h4 id="2-3-5-获取数据"><a href="#2-3-5-获取数据" class="headerlink" title="2.3.5 获取数据"></a>2.3.5 获取数据</h4><blockquote><p>出登录接口，其他接口发送 http 请求，必须携带 token 值</p></blockquote><p>Axios : <a href="https://www.kancloud.cn/yunye/axios/234845" target="_blank" rel="noopener">https://www.kancloud.cn/yunye/axios/234845</a> —&gt; 请求配置</p><pre class=" language-js"><code class="language-js"><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>        input5<span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 不想看到报错</span>        <span class="token comment" spellcheck="true">// 设置页码及条数</span>        pagenum<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>        pagesize<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">,</span>        tableData<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 利用钩子函数，获取数据</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 获取token</span>    <span class="token keyword">let</span> token <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 通过配置选项发送请求</span>    <span class="token comment" spellcheck="true">// 携带token</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$myHttp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 设置链接地址 es6新语法</span>        url<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`users?pagenum=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>pagenum<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;pagesize=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>pagesize<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span>        method<span class="token punctuation">:</span><span class="token string">'get'</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">// 配置token</span>        headers<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'Authorization'</span><span class="token punctuation">:</span> token<span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 修改数据  展示页面</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>tableData <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>users<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>修改组件参数，展示数据：</p><p><code>&lt;el-table-column prop=&quot;username&quot; label=&quot;姓名&quot; &gt; &lt;/el-table-column&gt;</code></p><h4 id="2-3-6-操作按钮"><a href="#2-3-6-操作按钮" class="headerlink" title="2.3.6 操作按钮"></a>2.3.6 操作按钮</h4><p><code>Button 按钮</code> <code>Table 表格-&gt;自定义列模板</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>操作<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>210<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-edit<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token attr-name">plain</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span>      <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-check<span class="token punctuation">"</span></span>      <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span>      <span class="token attr-name">plain</span>    <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span>      <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-delete<span class="token punctuation">"</span></span>      <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span>      <span class="token attr-name">plain</span>    <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span></code></pre><p>表格中加入按钮等元素时，需要使用 <code>template</code> 进行包裹：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>用户状态<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>210<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-switch</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>value2<span class="token punctuation">"</span></span> <span class="token attr-name">active-color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#13ce66<span class="token punctuation">"</span></span> <span class="token attr-name">inactive-color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#ff4949<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-switch</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span></code></pre><h4 id="2-3-7-状态显示"><a href="#2-3-7-状态显示" class="headerlink" title="2.3.7 状态显示"></a>2.3.7 状态显示</h4><p>而在<code>template</code> 标签中有一个 <code>slot-scope=&quot;scope&quot;</code> 属性，<code>scope</code> 的值就是本列中所有数据的值，参考： <code>Table 表格-&gt;固定列</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>用户状态<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>210<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 利用scope 中的值，争取显示用户状态 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-switch</span>      <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope.row.mg_state<span class="token punctuation">"</span></span>      <span class="token attr-name">active-color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#13ce66<span class="token punctuation">"</span></span>      <span class="token attr-name">inactive-color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#ff4949<span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-switch</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 测试事件，查看 scope 数据 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>showScope(scope)<span class="token punctuation">"</span></span>      <span class="token punctuation">></span></span>显示scope<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span>    <span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span></code></pre><pre class=" language-js"><code class="language-js">methods<span class="token punctuation">:</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 测试 方法 显示scope</span>    <span class="token function">showScope</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><h4 id="2-3-8-分页展示"><a href="#2-3-8-分页展示" class="headerlink" title="2.3.8 分页展示"></a>2.3.8 分页展示</h4><p><code>Pagination 分页-&gt;附加功能</code></p><pre class=" language-html"><code class="language-html">  <span class="token comment" spellcheck="true">&lt;!-- 分页 --></span>  <span class="token comment" spellcheck="true">&lt;!--      current-page  当前页码数      page-sizes  显示条数选项      page-size 当前每页条数  --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-pagination</span>      <span class="token attr-name">@size-change</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleSizeChange<span class="token punctuation">"</span></span>      <span class="token attr-name">@current-change</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleCurrentChange<span class="token punctuation">"</span></span>      <span class="token attr-name">:current-page</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pagenum<span class="token punctuation">"</span></span>      <span class="token attr-name">:page-sizes</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>[2, 20, 40]<span class="token punctuation">"</span></span>      <span class="token attr-name">:page-size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pagesize<span class="token punctuation">"</span></span>      <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>total, sizes, prev, pager, next, jumper<span class="token punctuation">"</span></span>      <span class="token attr-name">:total</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>total<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-pagination</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>……<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span>   ……data() {    return {      input5:'',// 不想看到报错      pagenum:1, //设置页码      pagesize:2, // 设置页条数      total:0,  //显示总条数      tableData: []    };  },      ……      ……         // 获取总条数 修改数据展示        this.total = res.data.data.total;</code></pre><p>但点击页码时，会触发 <code>size-change</code> 事件</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      input5<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 不想看到报错</span>      pagenum<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//设置页码</span>      pagesize<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 设置页条数</span>      total<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//显示总条数</span>      tableData<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 获取用户数据</span>    <span class="token function">getUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 获取token</span>      <span class="token keyword">let</span> token <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// 通过配置选项发送请求</span>      <span class="token comment" spellcheck="true">// 携带token</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$myHttp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 设置链接地址 es6新语法</span>        url<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`users?pagenum=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>pagenum<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;pagesize=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>pagesize<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span>        method<span class="token punctuation">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">// 配置token</span>        headers<span class="token punctuation">:</span> <span class="token punctuation">{</span> Authorization<span class="token punctuation">:</span> token <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 修改数据  展示页面</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>tableData <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>users<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 获取总条数 修改数据展示</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>total <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>total<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 点击页码触发</span>    <span class="token function">handleCurrentChange</span><span class="token punctuation">(</span>pages<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(pages);</span>        <span class="token comment" spellcheck="true">// 修改data数据，重新发送请求</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>pagenum <span class="token operator">=</span> pages<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 改变显示条数时触发</span>    <span class="token function">handleSizeChange</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>pagesize <span class="token operator">=</span> numbers<span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 利用钩子函数，获取数据</span>  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><h3 id="2-4-模糊搜索"><a href="#2-4-模糊搜索" class="headerlink" title="2.4 模糊搜索"></a>2.4 模糊搜索</h3><p>请求地址中加入 query 请求参数，获取条件结果</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>请输入内容<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input-with-select<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>    <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>append<span class="token punctuation">"</span></span>    <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>searchUsers<span class="token punctuation">"</span></span>    <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-search<span class="token punctuation">"</span></span>  <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span>……<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>        search<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 搜索关键字</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">// 请求地址中加入关键字</span>        url<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`users?pagenum=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>pagenum<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;pagesize=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>pagesize<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;query=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>search<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">// 点击搜索事件</span>        <span class="token function">searchUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="2-5-切换用户状态"><a href="#2-5-切换用户状态" class="headerlink" title="2.5 切换用户状态"></a>2.5 切换用户状态</h3><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 利用scope 中的值，争取显示用户状态 --></span><span class="token comment" spellcheck="true">&lt;!-- 组件自带change事件 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-switch</span>  <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope.row.mg_state<span class="token punctuation">"</span></span>  <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>change(scope)<span class="token punctuation">"</span></span>  <span class="token attr-name">active-color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#13ce66<span class="token punctuation">"</span></span>  <span class="token attr-name">inactive-color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#ff4949<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-switch</span><span class="token punctuation">></span></span></code></pre><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// Switch 开关 组件自带事件</span><span class="token function">change</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 接受本条全部信息</span>    <span class="token comment" spellcheck="true">// console.log(scope)</span>    <span class="token keyword">let</span> id <span class="token operator">=</span> scope<span class="token punctuation">.</span>row<span class="token punctuation">.</span>id<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 获取id</span>    <span class="token keyword">var</span> state <span class="token operator">=</span> scope<span class="token punctuation">.</span>row<span class="token punctuation">.</span>mg_state<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 获取修改后的状态</span>    <span class="token comment" spellcheck="true">// 请求接口</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$myHttp<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/state/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 修改失败，将状态改为原始值</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>tableData<span class="token punctuation">[</span>scope<span class="token punctuation">.</span>$index<span class="token punctuation">]</span><span class="token punctuation">.</span>mg_state <span class="token operator">=</span> <span class="token operator">!</span>state<span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"修改失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>修改失败是因为没有 token:</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// Switch 开关 组件自带事件</span><span class="token function">change</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 接受本条全部信息</span>    <span class="token comment" spellcheck="true">// console.log(scope)</span>    <span class="token keyword">let</span> id <span class="token operator">=</span> scope<span class="token punctuation">.</span>row<span class="token punctuation">.</span>id<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 获取id</span>    <span class="token keyword">var</span> state <span class="token operator">=</span> scope<span class="token punctuation">.</span>row<span class="token punctuation">.</span>mg_state<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 获取修改后的状态</span>    <span class="token comment" spellcheck="true">// 请求接口</span>    <span class="token comment" spellcheck="true">// 需要使用配置参数请求，设置token</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$myHttp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        url<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/state/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span>        method<span class="token punctuation">:</span><span class="token string">'put'</span><span class="token punctuation">,</span>        headers<span class="token punctuation">:</span> <span class="token punctuation">{</span> Authorization<span class="token punctuation">:</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 修改失败，将状态改为原始值</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>tableData<span class="token punctuation">[</span>scope<span class="token punctuation">.</span>$index<span class="token punctuation">]</span><span class="token punctuation">.</span>mg_state <span class="token operator">=</span> <span class="token operator">!</span>state<span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"修改失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h3 id="2-6-删除用户"><a href="#2-6-删除用户" class="headerlink" title="2.6 删除用户"></a>2.6 删除用户</h3><p><code>MessageBox 弹框-&gt;确认消息</code></p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 组件中绑定点击按钮</span><span class="token operator">&lt;</span>el<span class="token operator">-</span>button type<span class="token operator">=</span><span class="token string">"primary"</span> icon<span class="token operator">=</span><span class="token string">"el-icon-delete"</span> size<span class="token operator">=</span><span class="token string">"mini"</span> @click<span class="token operator">=</span><span class="token string">"deleteUser(scope.row.id)"</span> plain<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>button<span class="token operator">></span><span class="token comment" spellcheck="true">// 删除用户</span><span class="token function">deleteUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//   this.$myHttp({</span>    <span class="token comment" spellcheck="true">//     url: `users/${id}`,</span>    <span class="token comment" spellcheck="true">//     method: "delete",</span>    <span class="token comment" spellcheck="true">//     headers: { Authorization: window.localStorage.getItem("token") }</span>    <span class="token comment" spellcheck="true">//   }).then(res => {</span>    <span class="token comment" spellcheck="true">//     this.getUserData();</span>    <span class="token comment" spellcheck="true">//     this.$message({</span>    <span class="token comment" spellcheck="true">//       message: "删除成功",</span>    <span class="token comment" spellcheck="true">//       type: "success"</span>    <span class="token comment" spellcheck="true">//     });</span>    <span class="token comment" spellcheck="true">//   });</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$confirm</span><span class="token punctuation">(</span><span class="token string">"此操作将永久删除该用户, 是否继续?"</span><span class="token punctuation">,</span> <span class="token string">"提示"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>        confirmButtonText<span class="token punctuation">:</span> <span class="token string">"确定"</span><span class="token punctuation">,</span>        cancelButtonText<span class="token punctuation">:</span> <span class="token string">"取消"</span><span class="token punctuation">,</span>        type<span class="token punctuation">:</span> <span class="token string">"warning"</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$myHttp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            url<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span>            method<span class="token punctuation">:</span> <span class="token string">"delete"</span><span class="token punctuation">,</span>            headers<span class="token punctuation">:</span> <span class="token punctuation">{</span> Authorization<span class="token punctuation">:</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                message<span class="token punctuation">:</span> <span class="token string">"删除成功"</span><span class="token punctuation">,</span>                type<span class="token punctuation">:</span> <span class="token string">"success"</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            type<span class="token punctuation">:</span> <span class="token string">"info"</span><span class="token punctuation">,</span>            message<span class="token punctuation">:</span> <span class="token string">"已取消删除"</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="2-7-添加用户"><a href="#2-7-添加用户" class="headerlink" title="2.7 添加用户"></a>2.7 添加用户</h3><p><code>Dialog对话框-&gt;自定义内容-&gt;打开嵌套表单的 Dialog</code> <code>Form 表单</code></p><p>表单弹窗：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sou<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 绑定按钮点击事件 直接将 dialogFormVisible值设置为true显示窗口  --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>success<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialogFormVisible <span class="token punctuation">=</span> true<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>添加用户<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!--    :visible.sync属性 控制窗口显示隐藏    --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>收货地址<span class="token punctuation">"</span></span> <span class="token attr-name">:visible.sync</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialogFormVisible<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span> <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>活动名称<span class="token punctuation">"</span></span> <span class="token attr-name">:label-width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>formLabelWidth<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form.name<span class="token punctuation">"</span></span> <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>off<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialog-footer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token comment" spellcheck="true">&lt;!-- 点击取消或确定修改dialogFormVisible=false关闭窗口 --></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialogFormVisible <span class="token punctuation">=</span> false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>取 消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialogFormVisible <span class="token punctuation">=</span> false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>确 定<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-row</span><span class="token punctuation">></span></span></code></pre><p>修改表单</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sou<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 绑定按钮点击事件 直接将 dialogFormVisible值设置为true显示窗口  --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>success<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialogFormVisible <span class="token punctuation">=</span> true<span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span>添加用户<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span>  <span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!--     :visible.sync属性 控制窗口显示隐藏    --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>添加用户<span class="token punctuation">"</span></span> <span class="token attr-name">:visible.sync</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialogFormVisible<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span> <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>姓名<span class="token punctuation">"</span></span> <span class="token attr-name">label-width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>90px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form.username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>密码<span class="token punctuation">"</span></span> <span class="token attr-name">label-width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>90px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form.password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>邮箱<span class="token punctuation">"</span></span> <span class="token attr-name">label-width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>90px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form.email<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>电话<span class="token punctuation">"</span></span> <span class="token attr-name">label-width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>90px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form.mobile<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialog-footer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token comment" spellcheck="true">&lt;!-- 点击取消或确定修改dialogFormVisible=false关闭窗口 --></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialogFormVisible <span class="token punctuation">=</span> false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>取 消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>      <span class="token comment" spellcheck="true">&lt;!-- 修改点击事件，在数据入库成功后关闭窗口 --></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>addUser<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>确 定<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span></code></pre><p>添加数据及方法</p><pre class=" language-js"><code class="language-js"><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      dialogFormVisible<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>      form<span class="token punctuation">:</span> <span class="token punctuation">{</span>        username<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>        password<span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>        email<span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>        mobile<span class="token punctuation">:</span><span class="token string">''</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>……methods 方法 <span class="token comment" spellcheck="true">// 添加用户</span>    <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$myHttp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        url<span class="token punctuation">:</span><span class="token string">'users'</span><span class="token punctuation">,</span>        method<span class="token punctuation">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true">// post数据提交</span>        data<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">,</span>        headers<span class="token punctuation">:</span> <span class="token punctuation">{</span> Authorization<span class="token punctuation">:</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>          <span class="token keyword">let</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>          <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">{</span>              <span class="token comment" spellcheck="true">// 将数据更新到页面</span>              <span class="token keyword">this</span><span class="token punctuation">.</span>tableData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message<span class="token punctuation">:</span> <span class="token string">"添加用户成功"</span><span class="token punctuation">,</span>type<span class="token punctuation">:</span> <span class="token string">"success"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">// 关闭窗口</span>              <span class="token keyword">this</span><span class="token punctuation">.</span>dialogFormVisible <span class="token operator">=</span> <span class="token boolean">false</span>          <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><h3 id="2-8-修改用户信息"><a href="#2-8-修改用户信息" class="headerlink" title="2.8 修改用户信息"></a>2.8 修改用户信息</h3><p>绑定表单事件，传入 scope.row 以显示现有用户数据，做表单读入展示</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span>    <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-edit<span class="token punctuation">"</span></span>    <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span>    <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editUserShow(scope.row)<span class="token punctuation">"</span></span>    <span class="token attr-name">plain</span>  <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-check<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token attr-name">plain</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span>    <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-delete<span class="token punctuation">"</span></span>    <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span>    <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deleteUser(scope.row.id)<span class="token punctuation">"</span></span>    <span class="token attr-name">plain</span>  <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre><p>添加修改用户信息的弹窗，并在弹窗表单中展示用户信息</p><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 修改用户弹窗 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>添加用户<span class="token punctuation">"</span></span> <span class="token attr-name">:visible.sync</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editUser<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span> <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>edit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>姓名<span class="token punctuation">"</span></span> <span class="token attr-name">label-width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>90px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">disabled</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>edit.username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>邮箱<span class="token punctuation">"</span></span> <span class="token attr-name">label-width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>90px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>edit.email<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>电话<span class="token punctuation">"</span></span> <span class="token attr-name">label-width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>90px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>edit.mobile<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialog-footer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 点击取消或确定修改dialogFormVisible=false关闭窗口 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editUser <span class="token punctuation">=</span> false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>取 消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editUserPut<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>确 定<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">></span></span></code></pre><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 弹窗并显示用户数据 用于修改表单</span><span class="token function">editUserShow</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>editUser <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 弹窗</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>edit <span class="token operator">=</span> users<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 直接使用表单数据</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 修改用户信息 入库</span><span class="token function">editUserPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>edit<span class="token punctuation">.</span>id<span class="token punctuation">;</span>    <span class="token keyword">var</span> email <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>edit<span class="token punctuation">.</span>email<span class="token punctuation">;</span>    <span class="token keyword">var</span> mobile <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>edit<span class="token punctuation">.</span>mobile<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$myHttp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        url<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span>        method<span class="token punctuation">:</span> <span class="token string">"put"</span><span class="token punctuation">,</span>        data<span class="token punctuation">:</span><span class="token punctuation">{</span>email<span class="token punctuation">,</span>mobile<span class="token punctuation">}</span><span class="token punctuation">,</span>        headers<span class="token punctuation">:</span> <span class="token punctuation">{</span> Authorization<span class="token punctuation">:</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(res);</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>editUser <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 关闭窗口</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 重新获取数据</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message<span class="token punctuation">:</span> <span class="token string">"修改用户成功"</span><span class="token punctuation">,</span>type<span class="token punctuation">:</span> <span class="token string">"success"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h3 id="2-9-修改用户角色"><a href="#2-9-修改用户角色" class="headerlink" title="2.9 修改用户角色"></a>2.9 修改用户角色</h3><p><code>Select 选择器-&gt;基础用法</code> 下拉框</p><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 分配角色弹窗 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>分配角色<span class="token punctuation">"</span></span> <span class="token attr-name">:visible.sync</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>showRole<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span> <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>role<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>当前用户<span class="token punctuation">"</span></span> <span class="token attr-name">label-width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>90px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">disabled</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>role.username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>活动区域<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-select</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>roleId<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>请选择活动区域<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-option</span>          <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item in roleList<span class="token punctuation">"</span></span>          <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item.key<span class="token punctuation">"</span></span>          <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item.roleName<span class="token punctuation">"</span></span>          <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item.id<span class="token punctuation">"</span></span>        <span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-option</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-select</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialog-footer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    { {roleId} }    <span class="token comment" spellcheck="true">&lt;!-- 点击取消或确定修改dialogFormVisible=false关闭窗口 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>showRole <span class="token punctuation">=</span> false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>取 消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>roleUserPut<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>确 定<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">></span></span></code></pre><p>弹窗后，获取全部角色遍历到 <code>el-option</code> ，获取用户 id 及修改后的角色，请求接口即可；</p><h2 id="第-3-章-权限管理"><a href="#第-3-章-权限管理" class="headerlink" title="第 3 章 权限管理"></a>第 3 章 权限管理</h2><h3 id="3-1-权限列表"><a href="#3-1-权限列表" class="headerlink" title="3.1 权限列表"></a>3.1 权限列表</h3><p>添加路由及组件文件</p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Rights <span class="token keyword">from</span> <span class="token string">'@/components/rights/rights'</span><span class="token punctuation">{</span>path<span class="token punctuation">:</span><span class="token string">'rights'</span><span class="token punctuation">,</span>name<span class="token punctuation">:</span><span class="token string">'rights'</span><span class="token punctuation">,</span>component<span class="token punctuation">:</span>Rights<span class="token punctuation">}</span></code></pre><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table</span>      <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>850<span class="token punctuation">"</span></span>      <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>singleTable<span class="token punctuation">"</span></span>      <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tableData<span class="token punctuation">"</span></span>      <span class="token attr-name">highlight-current-row</span><span class="token style-attr language-css"><span class="token attr-name">      <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100%</span></span><span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>authName<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>权限名称<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>path<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>路径<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>一级<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>层级<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>        tableData<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getlist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token function">getlist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$myHttp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          url<span class="token punctuation">:</span> <span class="token string">"rights/list"</span><span class="token punctuation">,</span>          method<span class="token punctuation">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span>          headers<span class="token punctuation">:</span> <span class="token punctuation">{</span> Authorization<span class="token punctuation">:</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>backs <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">// console.log(backs);</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>tableData <span class="token operator">=</span> backs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">  <span class="token selector"><span class="token class">.el-main</span> </span><span class="token punctuation">{</span>    <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span>  <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><p>只要在<code>el-table</code>元素中定义了<code>height=500</code>属性，即可实现固定表头的表格，而不需要额外的代码。</p><p>修改层级展示</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>level<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>层级<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope.row.level<span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">'</span>0<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>一级<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope.row.level<span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">'</span>1<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>二级<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope.row.level<span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">'</span>2<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>三级<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span></code></pre><h3 id="3-2-角色列表"><a href="#3-2-角色列表" class="headerlink" title="3.2 角色列表"></a>3.2 角色列表</h3><p>添加路由及组件</p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Roles <span class="token keyword">from</span> <span class="token string">'@/components/roles/roles'</span><span class="token punctuation">{</span>path<span class="token punctuation">:</span><span class="token string">'roles'</span><span class="token punctuation">,</span>name<span class="token punctuation">:</span><span class="token string">'roles'</span><span class="token punctuation">,</span>component<span class="token punctuation">:</span>Roles<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table</span> <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tableData5<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100%</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 折叠内容 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>expand<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>props<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span> <span class="token attr-name">label-position</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>left<span class="token punctuation">"</span></span> <span class="token attr-name">inline</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>demo-table-expand<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>商品名称<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>{ { prop s.row.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>所属店铺<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>{ { prop s.row.shop }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 表头及折叠按钮 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>角色名称<span class="token punctuation">"</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>角色描述<span class="token punctuation">"</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>操作<span class="token punctuation">"</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>desc<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>        tableData5<span class="token punctuation">:</span> <span class="token punctuation">[</span>          <span class="token punctuation">{</span>            id<span class="token punctuation">:</span> <span class="token string">"12987122"</span><span class="token punctuation">,</span>            name<span class="token punctuation">:</span> <span class="token string">"好滋好味鸡蛋仔"</span><span class="token punctuation">,</span>            category<span class="token punctuation">:</span> <span class="token string">"江浙小吃、小吃零食"</span><span class="token punctuation">,</span>            desc<span class="token punctuation">:</span> <span class="token string">"荷兰优质淡奶，奶香浓而不腻"</span><span class="token punctuation">,</span>            address<span class="token punctuation">:</span> <span class="token string">"上海市普陀区真北路"</span><span class="token punctuation">,</span>            shop<span class="token punctuation">:</span> <span class="token string">"王小虎夫妻店"</span><span class="token punctuation">,</span>            shopId<span class="token punctuation">:</span> <span class="token string">"10333"</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">{</span>            id<span class="token punctuation">:</span> <span class="token string">"12987123"</span><span class="token punctuation">,</span>            name<span class="token punctuation">:</span> <span class="token string">"好滋好味鸡蛋仔"</span><span class="token punctuation">,</span>            category<span class="token punctuation">:</span> <span class="token string">"江浙小吃、小吃零食"</span><span class="token punctuation">,</span>            desc<span class="token punctuation">:</span> <span class="token string">"荷兰优质淡奶，奶香浓而不腻"</span><span class="token punctuation">,</span>            address<span class="token punctuation">:</span> <span class="token string">"上海市普陀区真北路"</span><span class="token punctuation">,</span>            shop<span class="token punctuation">:</span> <span class="token string">"王小虎夫妻店"</span><span class="token punctuation">,</span>            shopId<span class="token punctuation">:</span> <span class="token string">"10333"</span>          <span class="token punctuation">}</span>        <span class="token punctuation">]</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">  <span class="token selector"><span class="token class">.demo-table-expand</span> </span><span class="token punctuation">{</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector"><span class="token class">.demo-table-expand</span> label </span><span class="token punctuation">{</span>    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">90</span>px<span class="token punctuation">;</span>    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#99a9bf</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector"><span class="token class">.demo-table-expand</span> <span class="token class">.el-form-item</span> </span><span class="token punctuation">{</span>    <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">50%</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector"><span class="token class">.el-main</span> </span><span class="token punctuation">{</span>    <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>  <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 表头及折叠按钮 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>角色名称<span class="token punctuation">"</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>roleName<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>角色描述<span class="token punctuation">"</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>roleDesc<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>操作<span class="token punctuation">"</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>desc<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span>      <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-edit<span class="token punctuation">"</span></span>      <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span>      <span class="token attr-name">circle</span>    <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>success<span class="token punctuation">"</span></span>      <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-check<span class="token punctuation">"</span></span>      <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span>      <span class="token attr-name">circle</span>    <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span></code></pre><pre class=" language-js"><code class="language-js">  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      roleList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getrolelist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token function">getrolelist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$myHttp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        url<span class="token punctuation">:</span> <span class="token string">"roles"</span><span class="token punctuation">,</span>        method<span class="token punctuation">:</span> <span class="token string">"get"</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>back <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>roleList <span class="token operator">=</span> back<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span></code></pre><p><code>Tag 标签-&gt;可移除标签</code></p><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 折叠内容 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>expand<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>props<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tag</span> <span class="token attr-name">closable</span><span class="token punctuation">></span></span>可移除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tag</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span></code></pre><p>分析角色数据，<code>children</code> 为上级角色中的子级角色；</p><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 折叠内容 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>expand<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    { {scope.ro w.children}}    <span class="token comment" spellcheck="true">&lt;!-- &lt;el-tag closable>{ {scope.ro w.children}} &lt;/el-tag> --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-27_14-52-21.png" alt=""></p><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 折叠内容 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>expand<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- Layout 布局 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-row</span><span class="token punctuation">></span></span>      <span class="token comment" spellcheck="true">&lt;!-- 一级区域 --></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- 一级内容展示 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tag</span> <span class="token attr-name">closable</span><span class="token punctuation">></span></span>{ {scope.ro w.children[1].authName}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tag</span><span class="token punctuation">></span></span> >      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>18<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- 二级区域 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-row</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- 二级内容 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tag</span> <span class="token attr-name">closable</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>success<span class="token punctuation">"</span></span>              <span class="token punctuation">></span></span>{ {scope.ro w.children[0].children[0].authName}}            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tag</span><span class="token punctuation">></span></span>            >          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>18<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- 三级内容 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tag</span> <span class="token attr-name">closable</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>warning<span class="token punctuation">"</span></span>              <span class="token punctuation">></span></span>{ {scope.ro              w.children[1].children[0].children[0].authName}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tag</span>            <span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tag</span> <span class="token attr-name">closable</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>warning<span class="token punctuation">"</span></span>              <span class="token punctuation">></span></span>{ {scope.ro              w.children[1].children[0].children[1].authName}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tag</span>            <span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tag</span> <span class="token attr-name">closable</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>warning<span class="token punctuation">"</span></span>              <span class="token punctuation">></span></span>{ {scope.ro              w.children[1].children[0].children[2].authName}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tag</span>            <span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-row</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-row</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span></code></pre><p>循环遍历所有层级角色</p><pre class=" language-html"><code class="language-html">  <span class="token comment" spellcheck="true">&lt;!-- 折叠内容 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>expand<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- Layout 布局 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-row</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rowmargin<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item1 in scope.row.children<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item1.id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token comment" spellcheck="true">&lt;!-- 一级区域 --></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- 一级内容展示 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tag</span> <span class="token attr-name">closable</span><span class="token punctuation">></span></span>{ {item1.authNam e}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tag</span><span class="token punctuation">></span></span> >          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>18<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- 二级区域 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-row</span>  <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item2 in item1.children<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item2.id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                  <span class="token comment" spellcheck="true">&lt;!-- 二级内容 --></span>                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tag</span> <span class="token attr-name">closable</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>success<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{ {item2.authNam e}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tag</span><span class="token punctuation">></span></span> >              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>18<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                  <span class="token comment" spellcheck="true">&lt;!-- 三级内容 --></span>                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tag</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item3 in item2.children<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item3.id<span class="token punctuation">"</span></span> <span class="token attr-name">closable</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>warning<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{ {item3.authNam e}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tag</span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-row</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-row</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- 判断没有权限 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-row</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope.row.children.length<span class="token punctuation">=</span><span class="token punctuation">=</span>0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tag</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>danger<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>木有权限<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tag</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-row</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>…….el-tag{  margin-top: 10px;  margin-right:5px;}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span></code></pre><h3 id="3-3-删除角色权限"><a href="#3-3-删除角色权限" class="headerlink" title="3.3 删除角色权限"></a>3.3 删除角色权限</h3><p>绑定 close 事件</p><p>页面元素删除</p><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 三级内容 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tag</span>  <span class="token attr-name">@close</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>closeTag(item2,key3)<span class="token punctuation">"</span></span>  <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item3,key3) in item2.children<span class="token punctuation">"</span></span>  <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item3.id<span class="token punctuation">"</span></span>  <span class="token attr-name">closable</span>  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>warning<span class="token punctuation">"</span></span>  <span class="token punctuation">></span></span>{ {item3.authNam e}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tag</span><span class="token punctuation">></span></span></code></pre><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 删除角色权限</span><span class="token function">closeTag</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 数组引用传递，直接删除即可</span>    <span class="token comment" spellcheck="true">// console.log(item,key)</span>    item<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>服务器删除</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>18<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- 三级内容 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tag</span>    <span class="token attr-name">@close</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>closeTag(item2,key3,scope.row.id,item3.id)<span class="token punctuation">"</span></span>    <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item3,key3) in item2.children<span class="token punctuation">"</span></span>    <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item3.id<span class="token punctuation">"</span></span>    <span class="token attr-name">closable</span>    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>warning<span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span>{ {item3.authNam e}}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tag</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">></span></span></code></pre><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 删除角色权限</span><span class="token function">closeTag</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>key<span class="token punctuation">,</span>roleId<span class="token punctuation">,</span>rightId<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// item 要删除元素所在父级数组</span>    <span class="token comment" spellcheck="true">// key 要删除元素所在父级数组下标</span>    item<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// roleid 角色ID，rightId权限ID</span>    <span class="token comment" spellcheck="true">// console.log(roleId,rightId);</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$myHttp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        url<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`roles/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>roleId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/rights/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rightId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span>        method<span class="token punctuation">:</span><span class="token string">'delete'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>back<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token keyword">let</span> <span class="token punctuation">{</span>meta<span class="token punctuation">}</span>  <span class="token operator">=</span> back<span class="token punctuation">.</span>data<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// console.log(meta);</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>meta<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message<span class="token punctuation">:</span>meta<span class="token punctuation">.</span>msg<span class="token punctuation">,</span>type<span class="token punctuation">:</span><span class="token string">'success'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h3 id="3-4-修改角色权限"><a href="#3-4-修改角色权限" class="headerlink" title="3.4 修改角色权限"></a>3.4 修改角色权限</h3><p>展示面板：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-edit<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token attr-name">circle</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>success<span class="token punctuation">"</span></span>    <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-check<span class="token punctuation">"</span></span>    <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span>    <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rightsShow<span class="token punctuation">"</span></span>    <span class="token attr-name">circle</span>  <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 修改角色授权面板 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>修改角色权限<span class="token punctuation">"</span></span> <span class="token attr-name">:visible.sync</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>isrightsShow<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialog-footer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tree</span>      <span class="token attr-name">show-checkbox</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>      <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rightsList<span class="token punctuation">"</span></span>      <span class="token attr-name">:props</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>defaultProps<span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tree</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 点击取消或确定修改dialogFormVisible=false关闭窗口 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>isrightsShow <span class="token punctuation">=</span> false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>取 消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rightsPut<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>确 定<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">></span></span></code></pre><pre class=" language-js"><code class="language-js"><span class="token keyword">return</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 所有权限列表</span>    rightsList<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 设置展示内容</span>    defaultProps<span class="token punctuation">:</span> <span class="token punctuation">{</span>        children<span class="token punctuation">:</span> <span class="token string">'children'</span><span class="token punctuation">,</span>        label<span class="token punctuation">:</span> <span class="token string">'authName'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 展示修改角色权限面板</span><span class="token function">rightsShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 获取所有角色权限</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$myHttp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        url<span class="token punctuation">:</span><span class="token string">'rights/tree'</span><span class="token punctuation">,</span>        method<span class="token punctuation">:</span><span class="token string">'get'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>back<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token keyword">let</span> <span class="token punctuation">{</span>data<span class="token punctuation">,</span>meta<span class="token punctuation">}</span> <span class="token operator">=</span> back<span class="token punctuation">.</span>data<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>rightsList<span class="token operator">=</span> data<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>isrightsShow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>选中角色拥有的权限：</p><p>在点击按钮式，将所有角色的所有信息传入展示面板事件中：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-edit<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token attr-name">circle</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>    <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rightsShow(scope.row)<span class="token punctuation">"</span></span>    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>success<span class="token punctuation">"</span></span>    <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-check<span class="token punctuation">"</span></span>    <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span>    <span class="token attr-name">circle</span>  <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 修改角色授权面板 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>修改角色权限<span class="token punctuation">"</span></span> <span class="token attr-name">:visible.sync</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>isrightsShow<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialog-footer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--           default-expand-all 默认展开所有节点          node-key="id" 将id设置为节点的唯一主键          :default-checked-keys=[] 被选中主键的数组          :props="defaultProps" 设置显示的内容                      show-checkbox 节点可被选中          --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tree</span>      <span class="token attr-name">default-expand-all</span>      <span class="token attr-name">node-key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span>      <span class="token attr-name">:default-checked-keys</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>defaultChecked<span class="token punctuation">"</span></span>      <span class="token attr-name">show-checkbox</span>      <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rightsList<span class="token punctuation">"</span></span>      <span class="token attr-name">:props</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>defaultProps<span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tree</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 点击取消或确定修改dialogFormVisible=false关闭窗口 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>isrightsShow <span class="token punctuation">=</span> false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>取 消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rightsPut<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>确 定<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">></span></span></code></pre><pre class=" language-js"><code class="language-js"><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 所有权限列表</span>      rightsList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token comment" spellcheck="true">// 设置展示内容</span>      defaultProps<span class="token punctuation">:</span> <span class="token punctuation">{</span>        children<span class="token punctuation">:</span> <span class="token string">"children"</span><span class="token punctuation">,</span>        label<span class="token punctuation">:</span> <span class="token string">"authName"</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token comment" spellcheck="true">// 默认选中的节点数组</span>      defaultChecked<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token comment" spellcheck="true">// 控制角色权限面板</span>      isrightsShow<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>      <span class="token comment" spellcheck="true">// 所有角色数据列表</span>      roleList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>……<span class="token comment" spellcheck="true">// 展示修改角色权限面板</span>      <span class="token function">rightsShow</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">// 获取所有角色权限</span>          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$myHttp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>              url<span class="token punctuation">:</span> <span class="token string">"rights/tree"</span><span class="token punctuation">,</span>              method<span class="token punctuation">:</span> <span class="token string">"get"</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>back <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>              <span class="token keyword">let</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> meta <span class="token punctuation">}</span> <span class="token operator">=</span> back<span class="token punctuation">.</span>data<span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">// 显示所有权限</span>              <span class="token keyword">this</span><span class="token punctuation">.</span>rightsList <span class="token operator">=</span> data<span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// 遍历row,获取当前角色选中的所有权限，写入数组</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>defaultChecked <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// 在遍历赋值前，先清空数据，以免受其他数据影响</span>          <span class="token keyword">var</span> rr <span class="token operator">=</span> row<span class="token punctuation">.</span>children<span class="token punctuation">;</span>          rr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item1 <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>              item1<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item2<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>                  item2<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item3<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>                      <span class="token comment" spellcheck="true">// 只获取第三季选中即可</span>                      <span class="token keyword">this</span><span class="token punctuation">.</span>defaultChecked<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item3<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token punctuation">}</span><span class="token punctuation">)</span>              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>defaultChecked<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// 控制显示窗口</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>isrightsShow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>提交数据入库：</p><pre class=" language-js"><code class="language-js">    <span class="token comment" spellcheck="true">// 提交修改角色权限</span>    <span class="token function">rightsPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 在树形控件 中添加 ref="tree" 的属性，在此使用</span>      <span class="token comment" spellcheck="true">// elUI 中提供两个方法getCheckedKeys、getHalfCheckedKeys</span>      <span class="token comment" spellcheck="true">// 获取已选中的节点key</span>      <span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>tree<span class="token punctuation">.</span><span class="token function">getCheckedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">var</span> arr2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>tree<span class="token punctuation">.</span><span class="token function">getHalfCheckedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// concat() 合并两个数组的元素</span>      <span class="token comment" spellcheck="true">// join() 将数组的值以逗号隔开转为字符串</span>      <span class="token keyword">var</span> checkedKeys <span class="token operator">=</span> arr1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$myHttp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 点击打开窗口是，保存角色id,在此获取使用</span>        url<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`roles/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>roleId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/rights`</span></span><span class="token punctuation">,</span>        method<span class="token punctuation">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>        data<span class="token punctuation">:</span><span class="token punctuation">{</span>rids<span class="token punctuation">:</span>checkedKeys<span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>back<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token keyword">let</span> <span class="token punctuation">{</span>data<span class="token punctuation">,</span>meta<span class="token punctuation">}</span> <span class="token operator">=</span> back<span class="token punctuation">.</span>data<span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>meta<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>isrightsShow <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 关闭窗口</span>          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getrolelist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 刷新数据</span>          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message<span class="token punctuation">:</span>meta<span class="token punctuation">.</span>msg<span class="token punctuation">,</span>type<span class="token punctuation">:</span><span class="token string">'success'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 提示成功</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><h3 id="3-5-权限限制"><a href="#3-5-权限限制" class="headerlink" title="3.5 权限限制"></a>3.5 权限限制</h3><p>对角色分配了权限后，我们并没有做限制，其实接口文档中<code>左侧菜单权限</code> 已经提供了相应的接口：</p><p><code>src/components/home/home.vue</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-menu</span> <span class="token attr-name">unique-opened</span> <span class="token attr-name">:router</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-menu-vertical-demo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-submenu</span>    <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item in menusList<span class="token punctuation">"</span></span>    <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item.id<span class="token punctuation">"</span></span>    <span class="token attr-name">:index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item.id.toString()<span class="token punctuation">"</span></span>  <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-location<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>{ {item.authNam e}} { {item.i d}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-menu-item</span>      <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item2 in item.children<span class="token punctuation">"</span></span>      <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item2.id<span class="token punctuation">"</span></span>      <span class="token attr-name">:index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item2.path<span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>el-icon-menu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>      { {item2.authNam e}} { {item2.pat h}}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-menu-item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-submenu</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-menu</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 使用生命周期的钩子函数，判断token</span>    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 获取token</span>      <span class="token keyword">var</span> token <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 错误提示</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"请登录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 跳转到登录页面</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"Login"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 登录后，获取左侧菜单权限</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$myHttp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          url<span class="token punctuation">:</span> <span class="token string">"menus"</span><span class="token punctuation">,</span>          method<span class="token punctuation">:</span> <span class="token string">"get"</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>back <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          <span class="token keyword">let</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> meta <span class="token punctuation">}</span> <span class="token operator">=</span> back<span class="token punctuation">.</span>data<span class="token punctuation">;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>meta<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>menusList <span class="token operator">=</span> data<span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>        menusList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        msg<span class="token punctuation">:</span> <span class="token string">"we"</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token function">loginOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          message<span class="token punctuation">:</span> <span class="token string">"您已经退出，继续操作请重新登录"</span><span class="token punctuation">,</span>          type<span class="token punctuation">:</span> <span class="token string">"success"</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"Login"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="3-6-导航守卫"><a href="#3-6-导航守卫" class="headerlink" title="3.6 导航守卫"></a>3.6 导航守卫</h3><p>导航守卫: <a href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html" target="_blank" rel="noopener">https://router.vuejs.org/zh/guide/advanced/navigation-guards.html</a></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-27_22-15-01.png" alt=""></p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>……<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 配置路由的导航守卫</span>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 如果访问登录的路由地址，放过</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'Login'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 如果请求的不是登录页面，验证token</span>    <span class="token comment" spellcheck="true">// 1. 获取本地存储中的token</span>    <span class="token keyword">const</span> token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 2. 如果没有token，跳转到登录</span>      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        name<span class="token punctuation">:</span> <span class="token string">'Login'</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 3. 如果有token，继续往下执行</span>      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> router<span class="token punctuation">;</span></code></pre><h2 id="第-99-章-项目打包及加载优化"><a href="#第-99-章-项目打包及加载优化" class="headerlink" title="第 99 章 项目打包及加载优化"></a>第 99 章 项目打包及加载优化</h2><p>打包命令：<code>npm run build</code></p><p>打包完成后，直接将 dist 文件夹内容复制到服务器根目录即可；</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-27_11-43-51.png" alt=""></p><p>我们的项目是很多组件组成的页面，但是，每次发送请求不管请求的是哪个路由的那个组件，很明显的都会将所有内容一次性全部加载出来，影响网站加载速度；如果我们可以在用户请求不同路由时，根据请求加载不同的页面，就会很大程度上提高页面的加载速度；</p><p>路由懒加载： <a href="https://router.vuejs.org/zh/guide/advanced/lazy-loading.html" target="_blank" rel="noopener">https://router.vuejs.org/zh/guide/advanced/lazy-loading.html</a></p><p>路由懒加载的工作就是在打包时，将路由文件分离出来，在请求时，需要哪个路由，再去请求相关文件；</p><p>用法：将路由引入的组件分别打包到不同的 js 文件；</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-27_11-02-37.png" alt=""></p><p>打包完成后，很明显的在 JS 文件夹中多了一个 js 文件；</p><p>然后我们可以将所有的组件全部改为路由懒加载模式：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> Login <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@/components/login/login"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Home <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@/components/home/home"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> UserList <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@/components/userlist/user-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> RoleList <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@/components/rolelist/role-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> RightsList <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@/components/rightslist/rights-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> GoodsList <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@/components/goodslist/goods-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> GoodsCategories <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@/components/goodscategories/goods-categories"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> GoodsAdd <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@/components/goodsadd/goods-add"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Report <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@/components/report/report"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Order <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@/components/orders/orders"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Params <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@/components/params/params"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-27_11-44-17.png" alt=""></p><p>但这是不够的，我们知道，很多组件都是可以用 CDN 加载的；</p><p>1：找到 cdn 地址，直接在 index.html 中加入地址，注意，cdn 引入版本要和项目中的版本保持一致；</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/vue/2.5.2/vue.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- built files will be auto injected --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><p>2：修改 webpack 配置文件 <a href="https://www.webpackjs.com/configuration/externals/" target="_blank" rel="noopener">https://www.webpackjs.com/configuration/externals/</a></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-27_11-33-20.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-27_11-36-38.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-27_13-11-09.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Front </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 笔记 </tag>
            
            <tag> Vue </tag>
            
            <tag> Vuex </tag>
            
            <tag> VueRouter </tag>
            
            <tag> vue-cli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node</title>
      <link href="/posts/decd.html"/>
      <url>/posts/decd.html</url>
      
        <content type="html"><![CDATA[<h1 id="Nodejs编程"><a href="#Nodejs编程" class="headerlink" title="Nodejs编程"></a>Nodejs编程</h1><hr><h2 id="第0章-Node介绍"><a href="#第0章-Node介绍" class="headerlink" title="第0章 Node介绍"></a>第0章 Node介绍</h2><h3 id="0-0-回顾-JavaScript"><a href="#0-0-回顾-JavaScript" class="headerlink" title="0.0 回顾 JavaScript"></a>0.0 回顾 JavaScript</h3><ul><li><p>*<em>历史及发展 *</em></p><p>1995年 网景公司的布兰登开发；</p><p>1997年7月，ECMA组织发布ECMAScript 1.0版;</p><p>2007年10月发布3.1版本后不久，ECMAScript 3.1改名为 ECMAScript 5。</p><p>2008年，为Chrome浏览器而开发的V8编译器诞生</p><p>2011年6月，ECMAscript 5.1版发布，现在使用最为广泛的版本;</p><p>2015年6月，ECMAScript 6正式发布，并且更名为“ECMAScript 2015”;</p></li><li><p><strong>如何学习JavaScript</strong></p><p>JavaScript 的核心语法部分相当精简，也就是语言本身，只包括两个部分:</p><ul><li><p>基本的语法构造(比如操作符、控制结构、语句)</p></li><li><p>标准库(就是一系列具有各种功能的对象比如Array、Date、Math等)。</p></li></ul></li></ul><p>  想要实现其他复杂的操作和效果，都要依靠 <strong>宿主环境</strong> 提供API，目前，已经嵌入 JavaScript 的宿主环境有多种，最常见的环境就是 <strong>浏览器</strong> 和 <strong>操作系统</strong> ;</p><ul><li><strong>回顾 JavaScript 语法特性</strong><ul><li>变量、数据类型、流程控制</li><li>函数(基本声明参数，作用域，回调函数)、面向对象(原型，构造函数，this的指向，new的过程)</li></ul></li></ul><h3 id="0-1-Node是什么"><a href="#0-1-Node是什么" class="headerlink" title="0.1 Node是什么"></a>0.1 Node是什么</h3><p><code>Node</code>  是一个基于<code>Chrome V8</code> 引擎的<code>JavaScript</code> 运行环境。  </p><p><code>Node</code>  不是一种独立的语言、<code>Node</code>不是 <code>JavaScript</code> 框架，</p><p><code>Node</code>是一个<strong>除了浏览器之外的、可以让<code>JavaScript</code> 运行的环境</strong></p><p>Node.js 是一个让 JavaScript 运行在服务端的开发平台，是使用 事件驱动， 异步非阻塞I/O，单线程，跨平台的 JS 运行环境；</p><h3 id="0-2-为什么要学习-Node"><a href="#0-2-为什么要学习-Node" class="headerlink" title="0.2. 为什么要学习 Node"></a>0.2. 为什么要学习 Node</h3><ul><li>打开服务器的黑盒子</li><li>企业需求</li><li>大前端必备技能</li><li>为了更好的学习前端框架</li></ul><h3 id="0-3-Node-能做什么"><a href="#0-3-Node-能做什么" class="headerlink" title="0.3. Node 能做什么"></a>0.3. Node 能做什么</h3><p><a href="https://www.zhihu.com/question/20796866" target="_blank" rel="noopener">知乎 - Node.js能做什么，该做什么？</a></p><ul><li>Web 服务器(重点)</li><li>命令行工具</li><li>网络爬虫:是一种按照一定的规则，自动地抓取网站信息的程序</li><li>桌面应用程序开发</li></ul><h3 id="0-4-一些资源"><a href="#0-4-一些资源" class="headerlink" title="0.4. 一些资源"></a>0.4. 一些资源</h3><ol><li><p>文档</p><p><a href="https://nodejs.org/en/docs/" target="_blank" rel="noopener">Node.js 官方文档</a><br><a href="http://nodejs.cn/" target="_blank" rel="noopener">Node.js 中文文档（非官方）</a></p></li><li><p>书籍</p><p><a href="https://read.douban.com/ebook/12053349/" target="_blank" rel="noopener">深入浅出 Node.js</a><br><a href="https://book.douban.com/subject/25892704/" target="_blank" rel="noopener">Node.js 权威指南</a><br><a href="https://book.douban.com/subject/25870705/" target="_blank" rel="noopener">Node.js 实战</a><br><a href="https://book.douban.com/subject/26642320/" target="_blank" rel="noopener">Node.js实战（第2季）</a></p></li><li><p>github资源</p><p><a href="https://github.com/alsotang/node-lessons" target="_blank" rel="noopener">Node.js 包教不包会</a><br><a href="http://es6.ruanyifeng.com/" target="_blank" rel="noopener">ECMAScript 6 入门</a><br><a href="https://github.com/nqdeng/7-days-nodejs" target="_blank" rel="noopener">七天学会 NodeJS</a> </p></li><li><p>社区</p><p><strong><a href="https://cnodejs.org/" target="_blank" rel="noopener">Node.js 中文社区</a></strong> </p></li></ol><h3 id="0-5-Node-发展历史"><a href="#0-5-Node-发展历史" class="headerlink" title="0.5. Node 发展历史"></a>0.5. Node 发展历史</h3><p><a href="https://gitbook.cn/books/58e796fd09012f0a48761eae/index.html" target="_blank" rel="noopener">聊聊 Node.js 的历史</a><br><a href="https://cnodejs.org/topic/555d3d54e684c4c8088a0d78" target="_blank" rel="noopener">来自朴灵大大的 – Node.js 简史</a></p><h2 id="第1章-NodeJS起步"><a href="#第1章-NodeJS起步" class="headerlink" title="第1章 NodeJS起步"></a>第1章 NodeJS起步</h2><h3 id="1-1-下载安装"><a href="#1-1-下载安装" class="headerlink" title="1.1 下载安装"></a>1.1 下载安装</h3><ul><li>下载 <a href="https://nodejs.org/zh-cn/download/" target="_blank" rel="noopener">https://nodejs.org/zh-cn/download/</a></li></ul><ul><li>历史版本：<a href="https://nodejs.org/en/download/releases/" target="_blank" rel="noopener">https://nodejs.org/en/download/releases/</a></li></ul><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-16_18-20-26.png" alt=""></p><p>windows下安装过程：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-16_18-20-59.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-16_18-29-26.png" alt=""></p><p>对于已经装过的，重新安装就会升级</p><p>安装成功后，打开命令行，输入 </p><p>node –version 或者 node -v  (显示node的版本号)</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-16_18-31-59.png" alt=""></p><p>表示安装成功</p><p>其他平台的安装方式：</p><p><a href="https://nodejs.org/zh-cn/download/package-manager/" target="_blank" rel="noopener">https://nodejs.org/zh-cn/download/package-manager/</a></p><h3 id="1-2-REPL环境"><a href="#1-2-REPL环境" class="headerlink" title="1.2 REPL环境"></a>1.2 REPL环境</h3><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-16_18-40-26.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-16_18-41-36.png" alt=""></p><p>node中的REPL环境类似于浏览器中的 Console控制台 ，可以做一些代码测试。</p><p>按ctrl + 两次c 退出REPL环境</p><p>但是, 我们写代码肯定不是在控制台中写,而是写在一个单独的.js文件中.</p><h3 id="1-3-node运行js代码"><a href="#1-3-node运行js代码" class="headerlink" title="1.3 node运行js代码"></a>1.3 node运行js代码</h3><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-16_18-52-40.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-16_18-53-36.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-16_18-49-49.png" alt=""></p><h3 id="1-4-Node-中的模块"><a href="#1-4-Node-中的模块" class="headerlink" title="1.4 Node 中的模块"></a>1.4 Node 中的模块</h3><p><strong>浏览器(客户端)中的JS</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-16_18-53-39.png" alt=""></p><p><strong>Node中的JS</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-17_16-40-25.png" alt=""></p><h2 id="Buffer（二进制数据操作）"><a href="#Buffer（二进制数据操作）" class="headerlink" title="Buffer（二进制数据操作）"></a>Buffer（二进制数据操作）</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> buffer<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'abc\r\nddasdfafd\r\ndfaerewtwert'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> buffer2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'\r\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>buffer2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//Buffer.concat 可以传入一个装有buffer的数组，之后会自动拼接返回</span><span class="token comment" spellcheck="true">//buffer数据可以用toString、queryString模块的的parse 转换为看的懂的数据</span></code></pre><h2 id="第2章-核心模块的使用"><a href="#第2章-核心模块的使用" class="headerlink" title="第2章 核心模块的使用"></a>第2章 核心模块的使用</h2><h3 id="2-1-FS模块"><a href="#2-1-FS模块" class="headerlink" title="2.1 FS模块"></a>2.1 FS模块</h3><p>node核心模块之一，用于操作文件；</p><p>中文手册 : <a href="http://nodejs.cn/api/fs.html" target="_blank" rel="noopener">http://nodejs.cn/api/fs.html</a></p><ul><li>文件读写 </li></ul><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 引入模块</span><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// console.log(typeof fs); //object </span><span class="token comment" spellcheck="true">// 向文件中写入内容</span>fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./2.1.txt'</span><span class="token punctuation">,</span><span class="token string">'itcast'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span>cb2<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 回调函数 (写入成功后执行的函数)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cb2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 从文件中读取内容</span>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./2.1.txt'</span><span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>d<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 回调函数 (读取成功后执行的函数)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>追加内容</li></ul><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 引入模块</span><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 向文件中追加内容</span>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./2.1.txt'</span><span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>d<span class="token punctuation">)</span><span class="token punctuation">{</span>    d<span class="token operator">+</span><span class="token operator">=</span><span class="token string">'2344'</span><span class="token punctuation">;</span>    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./2.1.txt'</span><span class="token punctuation">,</span>d<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入失败'</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入成功'</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="Zilb模块"><a href="#Zilb模块" class="headerlink" title="Zilb模块"></a>Zilb模块</h4><h3 id="2-2-HTTP模块"><a href="#2-2-HTTP模块" class="headerlink" title="2.2 HTTP模块"></a>2.2 HTTP模块</h3><p>node核心模块之一，用于搭建HTTP服务器；</p><p>中文手册 <a href="http://nodejs.cn/api/http.html" target="_blank" rel="noopener">http://nodejs.cn/api/http.html</a></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-17_21-03-59.png" alt=""></p><h4 id="2-2-1-开启服务器"><a href="#2-2-1-开启服务器" class="headerlink" title="2.2.1 开启服务器"></a>2.2.1 开启服务器</h4><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 1. 导入http模块</span><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 2. 使用http这个模块中的createServer()创建一个服务器实例对象</span><span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 3. 绑定端口号,启动web服务器</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' 请访问http://localhost:8000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 4. 为这个服务器实例对象注册 request 请求处理函数</span><span class="token comment" spellcheck="true">// 请求处理函数function(形参1,形参2){}</span><span class="token comment" spellcheck="true">// 形参1:request请求对象 获取到当前请求的路径,方法等本次请求的所有信息</span><span class="token comment" spellcheck="true">// 形参2:response响应对象 发送响应数据</span>server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务端收到客户端的请求啦!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 向客户端页面返回字符串</span>    response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"hello node"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 结束响应</span>    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-17_21-18-39.png" alt=""></p><p>因为我们的服务器接受请求处理并响应数据时，并没有指定响应数据的类型，所以出现了乱码；</p><p>而在http中，我们可以通过服务器的响应头指定数据类型，在 <a href="http://nodejs.cn/api/http.html#http_class_http_serverresponse" target="_blank" rel="noopener">http.ServerResponse 类</a> 中为我们提供了setHeader 方法：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-17_21-34-56.png" alt=""></p><h4 id="2-2-2-响应-HTML-页面"><a href="#2-2-2-响应-HTML-页面" class="headerlink" title="2.2.2 响应 HTML 页面"></a>2.2.2 响应 HTML 页面</h4><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-17_21-41-23.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-17_21-45-00.png" alt=""></p><p>但是，我们不能一直将html代码写到服务器的方法中，而是需要建一个xx.html的文件，将html文件中的内容返回给客户端；</p><p>2.2.2 .html :</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>你好，我是jinghong<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>另外，我还很帅……<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>nodejs代码</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 1:引入文件操作模块</span><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 2：读取html文件中的内容</span>    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./2.2.2.html'</span><span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>html_data<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 设置响应头</span>        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 将html中的内容响应回客户端，结束响应</span>        response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html_data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="2-2-3-响应图片"><a href="#2-2-3-响应图片" class="headerlink" title="2.2.3 响应图片"></a>2.2.3 响应图片</h4><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>你好，我是jinghong<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>另外，我还很帅……<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./img/03.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>野生脆脆.jpg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><pre class=" language-js"><code class="language-js">server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// url 属性返回请求的URL字符串</span>    <span class="token keyword">var</span> urls <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span> urls <span class="token operator">==</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./2.2.2.html'</span><span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>html_data<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 设置响应头</span>            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 将html中的内容响应回客户端，结束响应</span>            response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html_data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>urls<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'jpg'</span><span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 判断请求图片</span>        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./img/03.jpg'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>html_data<span class="token punctuation">)</span><span class="token punctuation">{</span>            response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html_data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="2-2-4-响应其他静态资源"><a href="#2-2-4-响应其他静态资源" class="headerlink" title="2.2.4 响应其他静态资源"></a>2.2.4 响应其他静态资源</h4><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./public/h.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>你好，我是jinghong<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>另外，我还很帅……<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./img/03.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>野生脆脆.jpg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./public/h.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><pre class=" language-js"><code class="language-js">server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// url 属性返回请求的URL字符串</span>    <span class="token keyword">var</span> urls <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span> urls <span class="token operator">==</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./2.2.2.html'</span><span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>html_data<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 设置响应头</span>            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 将html中的内容响应回客户端，结束响应</span>            response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html_data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token operator">+</span>urls<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>html_data<span class="token punctuation">)</span><span class="token punctuation">{</span>            response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html_data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-3-服务器遍历文件及文件夹-案例"><a href="#2-3-服务器遍历文件及文件夹-案例" class="headerlink" title="2.3 服务器遍历文件及文件夹-案例"></a>2.3 服务器遍历文件及文件夹-案例</h3><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-22_16-03-32.png" alt=""></p><p>模仿Apache服务器，遍历文件及文件，显示时间及大小；</p><p>右键另存为，下载页面当作静态页面模板使用；</p><p>使用node载入静态页面：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img%5CSnipaste_2018-09-22_16-08-10.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-22_16-14-00.png" alt=""></p><p>使用ajax技术在页面中发送请求到后台，apache.html</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    xhr<span class="token punctuation">.</span>onreadystatechange<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span><span class="token string">'/file_list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>node：</p><pre class=" language-js"><code class="language-js">server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// url 属性返回请求的URL字符串</span>    <span class="token keyword">var</span> urls <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span> urls <span class="token operator">==</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./apache.html'</span><span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>html_data<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 设置响应头</span>            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 将html中的内容响应回客户端，结束响应</span>            response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html_data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>urls <span class="token operator">==</span> <span class="token string">'/file_list'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>files<span class="token punctuation">)</span><span class="token punctuation">{</span>            response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token operator">+</span>urls<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>html_data<span class="token punctuation">)</span><span class="token punctuation">{</span>            response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html_data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>apache.html –&gt; ajax</p><pre class=" language-js"><code class="language-js">xhr<span class="token punctuation">.</span>onreadystatechange<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">var</span> data <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> htmls <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            htmls<span class="token operator">+</span><span class="token operator">=</span><span class="token string">'&lt;tr>&lt;td valign="top">'</span><span class="token punctuation">;</span>            htmls<span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;img src="./img/layout.gif" alt="[   ]">&lt;/td>'</span><span class="token punctuation">;</span>            htmls<span class="token operator">+</span><span class="token operator">=</span><span class="token string">'&lt;td>&lt;a href="http://localhost/%e7%ac%94%e8%ae%b0-01.pdf">'</span><span class="token punctuation">;</span>            htmls<span class="token operator">+</span><span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'&lt;/a> &lt;/td>'</span><span class="token punctuation">;</span>            htmls<span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;td align="right">2018-04-26 10:31 &lt;/td>'</span><span class="token punctuation">;</span>            htmls<span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;td align="right">3.2M&lt;/td>&lt;td>&amp;nbsp;&lt;/td>&lt;/tr>'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">var</span> tb <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'tbody'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        tb<span class="token punctuation">.</span>innerHTML<span class="token operator">+</span><span class="token operator">=</span>htmls<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="2-4-动态展示文件的其他属性"><a href="#2-4-动态展示文件的其他属性" class="headerlink" title="2.4 动态展示文件的其他属性"></a>2.4 动态展示文件的其他属性</h3><p>获取文件的其他属性：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>files<span class="token punctuation">)</span><span class="token punctuation">{</span>    fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>er<span class="token punctuation">,</span>st<span class="token punctuation">)</span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span>mtime<span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>修改node代码</p><pre class=" language-js"><code class="language-js">server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// url 属性返回请求的URL字符串</span>    <span class="token keyword">var</span> urls <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>urls <span class="token operator">==</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./apache.html'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> html_data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 设置响应头</span>            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 将html中的内容响应回客户端，结束响应</span>            response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html_data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>urls <span class="token operator">==</span> <span class="token string">'/file_list'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// response.end(JSON.stringify(files));</span>            <span class="token keyword">var</span> file_obj <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//  判断条件：声明一个变量，这个变量用来记录两个数据的中数据的长度</span>            <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                file_obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// 利用自调用匿名函数，保留i的变量值</span>                <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>er<span class="token punctuation">,</span> st<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        count <span class="token operator">++</span><span class="token punctuation">;</span>                        file_obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            file_obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'file'</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                            file_obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'dir'</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        file_obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>mtime <span class="token operator">=</span> st<span class="token punctuation">.</span>mtime<span class="token punctuation">;</span>                        file_obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>size <span class="token operator">=</span> st<span class="token punctuation">.</span>size<span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">// 当读取的文件个数与所有文件个数相等时</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">==</span> files<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>                            response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>file_obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span>                    <span class="token comment" spellcheck="true">// console.log(file_obj);</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// console.log(files[i]);</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'.'</span> <span class="token operator">+</span> urls<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> html_data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html_data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>修改 ajax代码</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>xhr<span class="token punctuation">.</span>onreadystatechange<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">var</span> data <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> htmls <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            htmls<span class="token operator">+</span><span class="token operator">=</span><span class="token string">'&lt;tr>&lt;td valign="top">'</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                htmls<span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;img src="./img/layout.gif" alt="[   ]">&lt;/td>'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                htmls<span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;img src="./img/folder.gif" alt="[   ]">&lt;/td>'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            htmls<span class="token operator">+</span><span class="token operator">=</span><span class="token string">'&lt;td>&lt;a href="">'</span><span class="token punctuation">;</span>            htmls<span class="token operator">+</span><span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">'&lt;/a> &lt;/td>'</span><span class="token punctuation">;</span>            htmls<span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;td align="right">'</span><span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>mtime <span class="token operator">+</span><span class="token string">'&lt;/td>'</span><span class="token punctuation">;</span>            htmls<span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;td align="right">'</span><span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>size <span class="token operator">+</span><span class="token string">'&lt;/td>&lt;td>&amp;nbsp;&lt;/td>&lt;/tr>'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">var</span> tb <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'tbody'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        tb<span class="token punctuation">.</span>innerHTML<span class="token operator">+</span><span class="token operator">=</span>htmls<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span><span class="token string">'/file_list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>循环后 i 丢失的问题：</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// var arr = ['a', 'b', 'c'];</span><span class="token comment" spellcheck="true">// for (var i = 0; i &lt; arr.length; i++) {</span><span class="token comment" spellcheck="true">//     // 模拟延迟</span><span class="token comment" spellcheck="true">//     setTimeout(function () {</span><span class="token comment" spellcheck="true">//         console.log(arr[i]);</span><span class="token comment" spellcheck="true">//     }, 1000);</span><span class="token comment" spellcheck="true">// }</span><span class="token comment" spellcheck="true">/* * ******************************************* * 上面的代码 全部输出 undefined * ******************************************* */</span> <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 模拟延迟</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="path模块"><a href="#path模块" class="headerlink" title="path模块"></a>path模块</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> str<span class="token operator">=</span><span class="token string">'/root/a/b/1.txt'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 当前文件的上层目录console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 返回给定路径的最后一段console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 返回当前文件扩展名，没则空<span class="token comment" spellcheck="true">//console.log(path.resolve('/root/a/b', '../c', 'build', '..', 'strict'));</span><span class="token comment" spellcheck="true">//console.log(path.resolve(__dirname, 'build || 文件名'));</span>给定的路径序列从右到左进行处理，每个后续的 path 前置，直到构造出一个绝对路径。 例如，给定的路径片段序列：<span class="token operator">/</span>foo、 <span class="token operator">/</span>bar、 baz，调用 path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'/foo'</span><span class="token punctuation">,</span> <span class="token string">'/bar'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">)</span> 将返回 <span class="token operator">/</span>bar<span class="token operator">/</span>baz</code></pre><h2 id="process模块"><a href="#process模块" class="headerlink" title="process模块"></a>process模块</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> process<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//process能获取到本机的信息，方便于自动切换开发环境</span><span class="token keyword">let</span> mode<span class="token operator">=</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>OS<span class="token operator">==</span><span class="token string">'Windows_NT'</span><span class="token operator">?</span><span class="token string">'dev'</span><span class="token punctuation">:</span><span class="token string">'prod'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>  mode<span class="token punctuation">,</span>  <span class="token operator">...</span><span class="token punctuation">(</span>mode<span class="token operator">==</span><span class="token string">'dev'</span><span class="token operator">?</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./config.dev'</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./config.prod'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h2 id="第3章-包管理器npm"><a href="#第3章-包管理器npm" class="headerlink" title="第3章 包管理器npm"></a>第3章 包管理器npm</h2><h3 id="3-1-使用moment"><a href="#3-1-使用moment" class="headerlink" title="3.1 使用moment"></a>3.1 使用moment</h3><p>使用第三方包格式化时间</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-26_13-42-13.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-26_13-43-05.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img%5CSnipaste_2018-09-26_13-44-02.png" alt=""></p><h3 id="3-2-npm-命令的使用"><a href="#3-2-npm-命令的使用" class="headerlink" title="3.2 npm 命令的使用"></a>3.2 npm 命令的使用</h3><p>上面的代码，我们使用npm安装了moment来进行格式化时间的处理，这就是使用第三方模块；</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-26_13-51-35.png" alt=""></p><p>而我们使用的npm就是node中自带的包(模块)管理工具；</p><p>借助NPM可以帮助我们快速安装和管理依赖包，使Node与第三方模块之间形成了一个良好的生态系统；</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-26_14-05-00.png" alt=""></p><p>我们也可以直接输入npm，查看帮助引导：</p><pre class=" language-shell"><code class="language-shell">PS C:\xamp\htdocs\ceshi\09> npmUsage: npm <command>where <command> is one of:    access, adduser, audit, bin, bugs, c, cache, ci, cit,    completion, config, create, ddp, dedupe, deprecate,    dist-tag, docs, doctor, edit, explore, get, help,    help-search, hook, i, init, install, install-test, it, link,    list, ln, login, logout, ls, outdated, owner, pack, ping,    prefix, profile, prune, publish, rb, rebuild, repo, restart,    root, run, run-script, s, se, search, set, shrinkwrap, star,    stars, start, stop, t, team, test, token, tst, un,    uninstall, unpublish, unstar, up, update, v, version, view,    whoaminpm <command> -h  quick help on <command>npm -l            display full usage infonpm help <term>   search for help on <term>npm help npm      involved overviewSpecify configs in the ini-formatted file:    C:\Users\Administrator\.npmrcor on the command line via: npm <command> --key valueConfig info can be viewed via: npm help confignpm@6.4.1 C:\Program Files\nodejs\node_modules\npm</code></pre><h3 id="3-3-使用npm初始化项目"><a href="#3-3-使用npm初始化项目" class="headerlink" title="3.3 使用npm初始化项目"></a>3.3 使用npm初始化项目</h3><p>一个项目，不可能只是使用一个第三方包，而包越多，管理起来就越麻烦，</p><p>而 npm init 给我们提供了项目初始化的功能，也解决了多个包的管理问题：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-26_14-38-00.png" alt=""></p><pre><code>&quot;name&quot;: &quot;usenpm&quot;, // 项目名&quot;version&quot;: &quot;1.0.0&quot;, // 版本号&quot;description&quot;: &quot;这是我们第一次使用npm&quot;,  // 描述信息&quot;main&quot;: &quot;index.js&quot;, // 入口文件&quot;scripts&quot;: { // npm 设置的一些指令    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;},&quot;keywords&quot;: [ // 关键字    &quot;第一次&quot;],&quot;author&quot;: &quot;itheima6期&quot;, // 作者&quot;license&quot;: &quot;ISC&quot; // 当前项目的协议</code></pre><h3 id="补充-npm-install-几种方式-及-区别-s-和-d"><a href="#补充-npm-install-几种方式-及-区别-s-和-d" class="headerlink" title="补充 npm install 几种方式 及 区别 -s 和 -d"></a>补充 npm install 几种方式 及 区别 -s 和 -d</h3><p>“dependencies” : 依赖模块   -s<br>“devDependncies”: 开发环境  -d<br>npm install axios -s 表示安装到依赖模块</p><h3 id="3-4-解决-npm-被墙问题"><a href="#3-4-解决-npm-被墙问题" class="headerlink" title="3.4 解决 npm 被墙问题"></a>3.4 解决 npm 被墙问题</h3><p>npm 存储包文件的服务器在国外，有时候会被墙，速度很慢，所以我们需要解决这个问题。</p><p><a href="http://npm.taobao.org/" target="_blank" rel="noopener">http://npm.taobao.org/</a>  淘宝的开发团队把 npm 在国内做了一个备份。</p><p>安装淘宝的 cnpm：</p><pre class=" language-shell"><code class="language-shell"># 在任意目录执行都可以# --global 表示安装到全局，而非当前目录# --global 不能省略，否则不管用npm install --global cnpm</code></pre><p>接下来你安装包的时候把之前的 <code>npm</code> 替换成 <code>cnpm</code>。</p><p>举个例子：</p><pre class=" language-shell"><code class="language-shell"># 这里还是走国外的 npm 服务器，速度比较慢npm install jquery# 使用 cnpm 就会通过淘宝的服务器来下载 jquerycnpm install jquery</code></pre><p>如果不想安装 <code>cnpm</code> 又想使用淘宝的服务器来下载：</p><pre class=" language-shell"><code class="language-shell">npm install jquery --registry=https://registry.npm.taobao.org</code></pre><p>但是每一次手动这样加参数很麻烦，所我们可以把这个选项加入配置文件中：</p><pre class=" language-shell"><code class="language-shell"># 配置到淘宝服务器npm config set registry https://registry.npm.taobao.org# 查看 npm 配置信息npm config list</code></pre><p>只要经过了上面命令的配置，则你以后所有的 <code>npm install</code> 都会默认通过淘宝的服务器来下载。</p><h3 id="3-5-package-json-与-package-lock-json-文件"><a href="#3-5-package-json-与-package-lock-json-文件" class="headerlink" title="3.5 package.json 与 package-lock.json 文件"></a>3.5 package.json 与 package-lock.json 文件</h3><p>如果后期开发过程中，需要项目迁移，我们只需要将package.json文件迁移即可，在新项目下执行</p><p><code>npm install</code> ，所有第三方包会自动安装；</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-26_14-44-19.png" alt=""></p><p>package.json的作用就是用来记录当前项目及包的使用情况；<code>不能在package.json中添加注释</code></p><p>package-lock.json  保存第三方包的版本和下载路径等详细信息；</p><p>当我们使用npm管理包时，package.json 及package-lock.json 的内容都会自动更新</p><h3 id="3-6-服务端页面渲染"><a href="#3-6-服务端页面渲染" class="headerlink" title="3.6 服务端页面渲染"></a>3.6 服务端页面渲染</h3><p>之前的案例中，我们时通过前端浏览器发送ajax请求获取服务器数据的，前端获取数据后进行遍历展示；</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-26_22-10-44.png" alt=""></p><p>缺点就是发送多次请求、不利于搜索引擎查找；我们修改改为后端渲染数据；</p><p>art-template：  <a href="https://www.npmjs.com/package/art-template" target="_blank" rel="noopener">https://www.npmjs.com/package/art-template</a></p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> art <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'art-template'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>art<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token string">'./'</span><span class="token punctuation">;</span><span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token function">art</span><span class="token punctuation">(</span><span class="token string">'./art-test.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>data<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token number">123</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token number">345</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>a<span class="token punctuation">:</span><span class="token number">678</span><span class="token punctuation">,</span>b<span class="token punctuation">:</span><span class="token number">987</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>nihoa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{data[0].name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><p>1：重新创建目录，并初始化项目： <code>npm init</code></p><p>2：将之前写好的后台文件 http.js 和 前台模板页面 apache.html 复制到新项目目录中；</p><p>3：安装时间处理模块： <code>npm   install   moment</code></p><p>4：安装模板引擎模块:    <code>npm  install   art-template</code></p><p>5： 修改 后台文件 http.js 和 前台模板页面 apache.html  文件</p><p> http.js  ：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-26_20-56-03.png" alt=""></p><p>apache.html  ： </p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-26_20-57-11.png" alt=""></p><p>那么我们在项目中应该使用 客户端渲染还是服务端渲染：</p><p>答：两者都用，根据数据的不同作用而定；</p><blockquote><p>推举一个node开发时使用的小工具 nodemon</p><p>npm  install  nodemon  -g </p><p>安装成功后,使用 nodemon 运行代码,</p><p>代码一旦被保存,nodemon便会自动重新运行新代码</p></blockquote><h2 id="第4章-Node模块化及CommonJS规范"><a href="#第4章-Node模块化及CommonJS规范" class="headerlink" title="第4章 Node模块化及CommonJS规范"></a>第4章 Node模块化及CommonJS规范</h2><p>通过前面几个章节的学习, 我们基本掌握了NodeJS编程的基础知识, 但是我们也直观的发现了一个问题,和我们之前学习浏览器编程时JS, 差异还是很大的; 都是JavaScript编程, 为何有这种差异? 前面写过的防Apache服务器的案例中, 使用过内置fs模块, 使用过 moment 模块, 而这些模块都不是我们写的, 都是直接拿过来使用, 那么我们能不能自己写一个模块, 应该怎么写, 有哪些规矩, 如果我们自己写了一个模块, 能不能提供给其他编程人员直接使用, 应该怎么用? </p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-26_22-10-43.png" alt=""></p><blockquote><p>Electron  跨平台的桌面应用框架: <a href="https://electronjs.org/" target="_blank" rel="noopener">https://electronjs.org/</a></p></blockquote><h3 id="4-1-CommonJS规范的由来"><a href="#4-1-CommonJS规范的由来" class="headerlink" title="4.1 CommonJS规范的由来"></a>4.1 CommonJS规范的由来</h3><p>JS 的表现的表现能力取决于宿主环境提供的API, 在web1.0 时代, W3C 组织提供了浏览器的规范支持, 在web2.0 时代, 随着HTML5的发展, 更多的标准API 出现在了浏览器中, 但是, 在后端 JS 中标准的制定纹丝不动 ; </p><p>由 Mozilla 工程师Kevin Dangoor于2009年1月提出名为 <strong>ServerJS</strong> 的规范; 2009年8月，更名为<em>CommonJS，</em>以显示 API 的更广泛适用性。</p><blockquote><p>What I’m describing here is not a technical problem. It’s a matter of people getting together and making a decision to step forward and start building up something bigger and cooler together.      </p><p>我在这里描述的不是一个技术问题。这是一个人们聚在一起，决定向前一步，开始一起建立更大更酷的东西的问题。                                    </p><p>–Kevin Dangoor </p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img/Snipaste_2018-09-27_12-21-21.png" alt="深入浅出Node.js 图2-2"></p><h3 id="4-2-CommonJS-的模块规范"><a href="#4-2-CommonJS-的模块规范" class="headerlink" title="4.2 CommonJS 的模块规范"></a>4.2 CommonJS 的模块规范</h3><p>CommonJS对模块的定义十分简单，主要分为：</p><p>1、模块引用：</p><p>使用 <code>require()</code> 方法引入一个模块API ； </p><p>2、模块定义：</p><p>在模块中使用 exports 对象导出当前模块数据或方法；</p><p>在模块中还存在一个module对象，它代表模块自身，module对象有一个exports 属性，用于数据导出；</p><p> 其实exports 对象就是module.exports 的引用;   <code>exports === module.exports</code></p><p>3、模块标识：</p><p>其实就是模块的文件名，必须符合小驼峰法命名规则，使用<code>require()</code> 引入时使用 <code>. 或 ..</code> 开头的相对路径或绝对路径，引入时可以不写文件后缀名；</p><p><strong>重点注意</strong> ： 模块中的方法和变量的作用于尽在模块内部，每个模块具有独立的空间，互不干扰；</p><p>CommonJS 构建的模块机制中的引入与导出是我们完全不用考虑变量污染或者替换的问题，相比与<code>命名空间</code>的机制，简直就是天才和菜鸟的区别；</p><h3 id="4-3-Node对CommonJS的实现-Node模块化"><a href="#4-3-Node对CommonJS的实现-Node模块化" class="headerlink" title="4.3 Node对CommonJS的实现 (Node模块化)"></a>4.3 Node对CommonJS的实现 (Node模块化)</h3><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-27_13-34-04.png" alt=""></p><p>以上代码就是<strong>自定义模块</strong>的基本规则  这是<strong>重点</strong></p><h3 id="4-4-模块加载的顺序和规则"><a href="#4-4-模块加载的顺序和规则" class="headerlink" title="4.4 模块加载的顺序和规则"></a>4.4 模块加载的顺序和规则</h3><p>在 CommonJS 规范中，使用 <code>require()</code> 加载(引入) 模块时，模块标识必须使用相对路径或绝对路径指明模块位置，但是在node的实现中，我们可以不指明模块路径；如： <code>require(&#39;fs&#39;)、require(&#39;moment&#39;)</code> ;</p><p>如果没有指明路径，那就是加载核心模块或第三方模块，指明加载路径一般就是加载自定义模块；</p><p>不管加载什么模块，都是优先从缓存中加载：</p><blockquote><p> Node 加载模块时，如果这个模块已经被加载过了，则会直接缓存起来，将来再次引用时不会再次加加载这个模块（即：如果一个模块被加载两次，则模块中的代码只会被执行一次）</p></blockquote><p>而核心模块和第三方模块的的加载顺序就是：</p><blockquote><p>先加载核心模块，核心模块的内容都是在安装node时已经编译好的可执行的二进制代码，加载执行的速度，仅次于缓存加载，如果核心模块中没有，则加载第三方模块</p></blockquote><p>第三方模块的加载规则：</p><blockquote><ul><li>先在当前文件的模块所属目录去找 node_modules目录</li><li>如果找到，则去该目录中找 模块名的目录  如 : moment </li><li>如果找到 moment 目录， 则找该目录中的 package.json文件</li><li>如果找到 package.json 文件，则找该文件中的 main属性</li><li>如果找到main 属性，则拿到该属性对应的文件</li><li>如果找到 moment 目录之后，<ul><li>没有package.json</li><li>或者有 package.json 没有 main 属性</li><li>或者有 main 属性，但是指向的路径不存在 </li><li>则 node 会默认去看一下 moment 目录中有没有 index.js –&gt; index.json–&gt; index.node 文件</li></ul></li><li>如果找不到index 或者 找不到 moment 或者找不到 node_modules </li><li>则进入上一级目录找 node_moudles 查找（规则同上）</li><li>如果上一级还找不到，继续向上，一直到当前文件所属磁盘的根目录</li><li>如果到磁盘概目录还没有找到，直接报错</li></ul></blockquote><h3 id="4-5-模块化封装案例"><a href="#4-5-模块化封装案例" class="headerlink" title="4.5 模块化封装案例"></a>4.5 模块化封装案例</h3><p>修改 http.js — 服务器模块</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> luyou <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./luyou'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>luyou<span class="token punctuation">.</span><span class="token function">server</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请访问 127.0.0.1:8000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>添加自定义模块  luyou.js  – 路由模块 </p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> contrllor <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./contrllor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">server</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span> <span class="token punctuation">{</span>    server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> urls <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>urls <span class="token operator">==</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">var</span> html <span class="token operator">=</span> contrllor<span class="token punctuation">.</span>html<span class="token punctuation">;</span>            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token punctuation">{</span>            fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'.'</span> <span class="token operator">+</span> urls<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>                response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// response.end('123');</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>exports<span class="token punctuation">.</span>server <span class="token operator">=</span> server<span class="token punctuation">;</span></code></pre><p>contrllor.js — 业务模块</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'moment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> template <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'art-template'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>template<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token string">'./'</span><span class="token punctuation">;</span>fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> file_arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> cont <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        file_arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// console.log(files[i]);</span>        <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>            fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>                cont<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// 闭包  </span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    file_arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'file'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    file_arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'dir'</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                file_arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                file_arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>size <span class="token operator">=</span> data<span class="token punctuation">.</span>size<span class="token punctuation">;</span>                file_arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>mtime <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>mtime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD hh:mm'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>cont <span class="token operator">==</span> files<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token string">'./apache.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>data<span class="token punctuation">:</span>file_arr<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    exports<span class="token punctuation">.</span>html <span class="token operator">=</span> html<span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h2 id="第5章-用户管理系统–项目"><a href="#第5章-用户管理系统–项目" class="headerlink" title="第5章 用户管理系统–项目"></a>第5章 用户管理系统–项目</h2><h3 id="5-1-连接MySQL数据库"><a href="#5-1-连接MySQL数据库" class="headerlink" title="5.1 连接MySQL数据库"></a>5.1 连接MySQL数据库</h3><h4 id="5-1-1-mysql基本CURD"><a href="#5-1-1-mysql基本CURD" class="headerlink" title="5.1.1 mysql基本CURD"></a>5.1.1 mysql基本CURD</h4><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>users<span class="token punctuation">`</span> <span class="token keyword">WHERE</span> <span class="token number">1</span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>users<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">value</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token keyword">value</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">UPDATE</span> <span class="token punctuation">`</span>users<span class="token punctuation">`</span> <span class="token keyword">SET</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'value'</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>users<span class="token punctuation">`</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token keyword">value</span></code></pre><h4 id="5-1-2-安装连接MySQL"><a href="#5-1-2-安装连接MySQL" class="headerlink" title="5.1.2  安装连接MySQL"></a>5.1.2  安装连接MySQL</h4><p><code>npm install mysql</code></p><p>mysql.js :  </p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    host<span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>    user<span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>    password<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>    database<span class="token punctuation">:</span> <span class="token string">'onepiece'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 查找操作</span><span class="token keyword">var</span> select <span class="token operator">=</span> <span class="token string">'select * from users'</span><span class="token punctuation">;</span>connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>select<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> results<span class="token punctuation">,</span> fields<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>results<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 添加操作</span><span class="token keyword">var</span> ins <span class="token operator">=</span> <span class="token string">"INSERT INTO users (`name`, `nengli`, `jituan`, `img`) VALUES ('娜美', '雷电', '草帽海贼团', '')"</span><span class="token punctuation">;</span>connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>ins<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>results<span class="token punctuation">,</span>field<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">.</span>insertId<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>connection<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="mysql-连接池"><a href="#mysql-连接池" class="headerlink" title="mysql 连接池"></a>mysql 连接池</h4><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//连接池相比于上面的单次连接，更快速和更好管理，连接池可以设置并发连接数，一旦达到这个数，后续的连接只能等前面的连接执行完才能进行</span><span class="token keyword">var</span> Pool <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    host<span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>    user<span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>    password<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>    database<span class="token punctuation">:</span> <span class="token string">'onepiece'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//池选项</span><span class="token comment" spellcheck="true">//connectionLimit要同时创建的最大连接数。(默认：10)</span><span class="token comment" spellcheck="true">//queueLimit：  排队最大数  在返回错误之前，池将排队的最大连接请求数getConnection..如果设置为0，对排队的连接请求的数量没有限制。(0不做限制)</span></code></pre><h4 id="co-mysql-异步执行"><a href="#co-mysql-异步执行" class="headerlink" title="co-mysql  异步执行"></a>co-mysql  异步执行</h4><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//把所有mysql语句变为异步执行 可以使用 async\await  返回Promise对象</span><span class="token keyword">const</span> mysql<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> co<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'co-mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token punctuation">{</span>DB_HOST<span class="token punctuation">,</span> DB_PORT<span class="token punctuation">,</span> DB_USER<span class="token punctuation">,</span> DB_PASS<span class="token punctuation">,</span> DB_NAME<span class="token punctuation">}</span><span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> conn<span class="token operator">=</span>mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  host<span class="token punctuation">:</span> DB_HOST<span class="token punctuation">,</span>  port<span class="token punctuation">:</span> DB_PORT<span class="token punctuation">,</span>  user<span class="token punctuation">:</span> DB_USER<span class="token punctuation">,</span>  password<span class="token punctuation">:</span> DB_PASS<span class="token punctuation">,</span>  database<span class="token punctuation">:</span> DB_NAME<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token function">co</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// promise</span>p<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'SELECT 1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//如：await db.query(`SELECT ID FROM user_table WHERE username='${username}'`);</span></code></pre><h3 id="5-2-项目初始化及安装第三方模块"><a href="#5-2-项目初始化及安装第三方模块" class="headerlink" title="5.2 项目初始化及安装第三方模块"></a>5.2 项目初始化及安装第三方模块</h3><p>新建目录 <code>haizei</code>  , 打开命令行执行 <code>npm init</code> 初始化项目;</p><p>一次性安装项目所需的所有模块;</p><p><code>npm install art-template mysql bootstrap jquery</code></p><h3 id="5-3-启动项目"><a href="#5-3-启动项目" class="headerlink" title="5.3 启动项目"></a>5.3 启动项目</h3><h4 id="5-3-1-创建http服务器并加载静态页面"><a href="#5-3-1-创建http服务器并加载静态页面" class="headerlink" title="5.3.1 创建http服务器并加载静态页面"></a>5.3.1 创建http服务器并加载静态页面</h4><p>http.js</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> http<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 加载路由模块</span><span class="token keyword">var</span> luyou <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./luyou'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>luyou<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'8080'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请打开浏览器访问 http://127.0.0.1:8080'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>luyou.js</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 引入业务模块使用模板引擎加载页面</span><span class="token keyword">var</span> yewu <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./yewu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>exports<span class="token punctuation">.</span>bind <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>server<span class="token punctuation">)</span> <span class="token punctuation">{</span>    server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> urls <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>urls <span class="token operator">==</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">var</span> data <span class="token operator">=</span> yewu<span class="token punctuation">.</span>html_data<span class="token punctuation">;</span>            response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'.'</span> <span class="token operator">+</span> urls<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>                response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>yewu.js</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> template <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'art-template'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>template<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token string">'./'</span><span class="token punctuation">;</span><span class="token keyword">var</span> html_data <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>data<span class="token punctuation">:</span><span class="token number">123</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>exports<span class="token punctuation">.</span>html_data <span class="token operator">=</span> html_data<span class="token punctuation">;</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-09-27_22-36-36.png" alt=""></p><h4 id="5-3-2-动态获取数据"><a href="#5-3-2-动态获取数据" class="headerlink" title="5.3.2 动态获取数据"></a>5.3.2 动态获取数据</h4><p>yewu.js</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> linkdb <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./linkdb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> template <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'art-template'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>template<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token string">'./'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>linkdb<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> html_data <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>data<span class="token punctuation">:</span>linkdb<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>exports<span class="token punctuation">.</span>html_data <span class="token operator">=</span> html_data<span class="token punctuation">;</span></code></pre><p>linkdb.js</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    host<span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>    user<span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>    password<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>    database<span class="token punctuation">:</span> <span class="token string">'onepiece'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>connection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> sql <span class="token operator">=</span> <span class="token string">"select * from users "</span><span class="token punctuation">;</span>connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>data<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    exports<span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>connection<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>通过连接数据查找到的数据，对外导出时，导不出去，引入linkdb的业务模块，接不到数据；</p><p>关键：这个问题出现的原因很重；</p><h4 id="5-3-3-解决问题"><a href="#5-3-3-解决问题" class="headerlink" title="5.3.3 解决问题"></a>5.3.3 解决问题</h4><p>yewu.js</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> linkdb <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./linkdb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> template <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'art-template'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>template<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token string">'./'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 使用linkdb模块导出的方法</span>linkdb<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 利用回调函数获取数据</span>    <span class="token keyword">var</span> html_data <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>data<span class="token punctuation">:</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    exports<span class="token punctuation">.</span>html_data <span class="token operator">=</span> html_data<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>linkdb.js</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    host<span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>    user<span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>    password<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>    database<span class="token punctuation">:</span> <span class="token string">'onepiece'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>connection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 将原来导出数据的方式改为导出方法，供模块加载者调用</span>exports<span class="token punctuation">.</span>query <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> sql <span class="token operator">=</span> <span class="token string">"select * from users "</span><span class="token punctuation">;</span>    connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>data<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(data);</span>        <span class="token comment" spellcheck="true">// 数据是通过回调函数的方式返回</span>        <span class="token function">callback</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    connection<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>根据模板引擎语法 修改静态页面 </p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tbody<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    {{each data}}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>{{$value.id}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>{{$value.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>{{$value.nengli}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>{{$value.jituan}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>查看<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>修改<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    {{/each}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span></code></pre><h3 id="5-4-获取单个用户信息"><a href="#5-4-获取单个用户信息" class="headerlink" title="5.4 获取单个用户信息"></a>5.4 获取单个用户信息</h3><h4 id="5-4-1-接受前台请求"><a href="#5-4-1-接受前台请求" class="headerlink" title="5.4.1 接受前台请求"></a>5.4.1 接受前台请求</h4><p>修改 luyou.js 路由模块，获取单个用户信息</p><pre class=" language-js"><code class="language-js">server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> urls <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>urls<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>urls <span class="token operator">==</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> data <span class="token operator">=</span> yewu<span class="token punctuation">.</span>html_data<span class="token punctuation">;</span>        response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>urls <span class="token operator">==</span> <span class="token string">'/getuser'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'getsssss'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'.'</span> <span class="token operator">+</span> urls<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>但是，luyou模块，无法处理前台不同类型的请求, 需要我们在服务器端接受并处理客户端发送的 <strong>get 及 post</strong> 请求；</p><h4 id="5-4-2-获取请求类型及参数"><a href="#5-4-2-获取请求类型及参数" class="headerlink" title="5.4.2  获取请求类型及参数"></a>5.4.2  获取请求类型及参数</h4><p>GET 请求把所有的内容编码到访问路径中，POST  请求的内容全部都在请求体中。<br>http.ServerRequest   并没有一个属性内容为请求体，原因是等待请求体传输可能是一件<br>耗时的工作，譬如上传文件。而很多时候我们可能并不需要理会请求体的内容，恶意的 POST<br>请求会大大消耗服务器的资源。所以 Node.js  默认是不会解析请求体的，当我们需要的时候，<br>只能手动来做</p><blockquote><p>网络调试工具Postman，可以帮助我们发送各种HTTP请求，并接受服务器返回的数据；</p><p><a href="https://www.getpostman.com/" target="_blank" rel="noopener">https://www.getpostman.com/</a></p></blockquote><p><strong>获取请求类型</strong></p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 获取请求类型</span>    <span class="token keyword">var</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span>method<span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' 请访问http://localhost:8000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>获取 GET 的请求参数</strong></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/Snipaste_2018-10-07_12-56-34.png" alt=""></p><p><strong>获取Post请求参数</strong></p><pre class=" language-js"><code class="language-js"><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// url_obj = url.parse(request.url,true);</span>        <span class="token comment" spellcheck="true">// console.log(url_obj.query); </span>        <span class="token comment" spellcheck="true">//以上代码 无内容，失败</span>        <span class="token comment" spellcheck="true">// POST请求的内容全部都在请求体中 </span><span class="token punctuation">}</span></code></pre><p>手册中明确说明：</p><p>为了支持各种可能的 HTTP 应用，Node.js 的 HTTP API 是非常底层的。 它只涉及流处理与消息解析。 它把一个消息解析成消息头和消息主体，但不解析具体的消息头或消息主体。</p><p>因此我们需要查找更底层的网络实现，node中的基础网络模块net模块： <a href="http://nodejs.cn/api/net.html：" target="_blank" rel="noopener">http://nodejs.cn/api/net.html：</a></p><pre class=" language-js"><code class="language-js"><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// url_obj = url.parse(request.url,true);</span>    <span class="token comment" spellcheck="true">// console.log(url_obj.query); </span>    <span class="token comment" spellcheck="true">//以上代码 无内容，失败</span>    <span class="token comment" spellcheck="true">// POST请求的内容全部都在请求体中 </span>    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// net 模块中的 net.Socket 提供的data及end事件 </span>    <span class="token comment" spellcheck="true">// 绑定data事件获取数据</span>    request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>che<span class="token punctuation">)</span> <span class="token punctuation">{</span>        data <span class="token operator">+</span><span class="token operator">=</span> che<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// 绑定end事件，监听数据接受完成</span>    request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(data);</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h3 id="5-5-获取单个用户信息"><a href="#5-5-获取单个用户信息" class="headerlink" title="5.5 获取单个用户信息"></a>5.5 获取单个用户信息</h3><p><strong>1： 修改路由逻辑，优先判断请求类型：</strong></p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 引入业务模块使用模板引擎加载页面</span><span class="token keyword">var</span> yewu <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./yewu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>exports<span class="token punctuation">.</span>bind <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>server<span class="token punctuation">)</span> <span class="token punctuation">{</span>    server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 优先判断请求方式</span>        <span class="token keyword">var</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span>method<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 解析URL参数</span>        <span class="token keyword">var</span> url_obj <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// console.log(url_obj.query);//参数</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>url_obj<span class="token punctuation">.</span>pathname <span class="token operator">==</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> data <span class="token operator">=</span> yewu<span class="token punctuation">.</span>html_data<span class="token punctuation">;</span>                response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 判断 获取单个用户信息路由 </span>            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>url_obj<span class="token punctuation">.</span>pathname <span class="token operator">==</span> <span class="token string">'/getuser'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>                fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'.'</span> <span class="token operator">+</span> url_obj<span class="token punctuation">.</span>pathname<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p><strong>2： 修改静态模板，添加查看连接</strong></p><pre class=" language-html"><code class="language-html"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/getuser?id<span class="token punctuation">=</span>{{$value.id}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>查看<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>修改<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span></code></pre><p><strong>3：修改路由，获取get请求参数，并将id参数传入业务模块</strong></p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 判断 获取单个用户信息路由 </span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>url_obj<span class="token punctuation">.</span>pathname <span class="token operator">==</span> <span class="token string">'/getuser'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 获取id参数</span>    <span class="token keyword">var</span> id <span class="token operator">=</span> url_obj<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 在yewu模块中封装方法，传递id参数。</span>    <span class="token comment" spellcheck="true">// 使用回掉函数获取数据</span>    yewu<span class="token punctuation">.</span><span class="token function">gets</span><span class="token punctuation">(</span>url_obj<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>        response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p><strong>4：修改业务模块，添加gets方法</strong></p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 封装gets方法并导出,接受id参数及回调函数</span>exports<span class="token punctuation">.</span>gets <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 调用数据库模块的getone方法,并传入id参数</span>    linkdb<span class="token punctuation">.</span><span class="token function">getone</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 利用回调函数获取数据</span>        <span class="token keyword">var</span> user_data <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token string">'./users.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>data<span class="token punctuation">:</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">callback</span><span class="token punctuation">(</span>user_data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p><strong>5：添加users.html静态模板</strong></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    {{data[0].name}}    {{data[0].nengli}}    {{data[0].jituan}}    {{data[0].name}}    {{data[0].name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><p><strong>6：修改数据库模块，添加getone方法</strong></p><pre class=" language-js"><code class="language-js">exports<span class="token punctuation">.</span>getone <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> sql <span class="token operator">=</span> <span class="token string">"select * from users where id="</span><span class="token operator">+</span>id<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// console.log(sql);</span>    connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>data<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 数据是通过回调函数的方式返回</span>        <span class="token function">callback</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// connection.end();</span><span class="token punctuation">}</span></code></pre><blockquote><p>注意：将数据库模块中的所有 connection.end(); 删除，因为我们有多个方法，不能在方法调用中停止数据库的连接，否则，其他方法在后续调用中无法连接数据；</p></blockquote><h3 id="5-6-链式操作原理解析"><a href="#5-6-链式操作原理解析" class="headerlink" title="5.6 链式操作原理解析"></a>5.6 链式操作原理解析</h3><p><strong>链式操作的核心原理：</strong></p><p>test.js</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./chained1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// c.select();</span>c<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id=2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>chained.js</p><pre class=" language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    where<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>wh<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>whe <span class="token operator">=</span> wh<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 链式操作的核心就是保存数据并返回本对象</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    select<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>whe <span class="token operator">==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">var</span> sql <span class="token operator">=</span> <span class="token string">"select * from users "</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">var</span> sql <span class="token operator">=</span> <span class="token string">"select * from users where "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>whe<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>whe <span class="token operator">=</span> undefined<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    update<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>whe <span class="token operator">==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'更新数据时，请填写where条件'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">var</span> sql <span class="token operator">=</span> <span class="token string">"update xx from  set () where "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>whe<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>whe <span class="token operator">=</span> undefined<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="5-7-使用链式操作灵活操作数据库"><a href="#5-7-使用链式操作灵活操作数据库" class="headerlink" title="5.7 使用链式操作灵活操作数据库"></a>5.7 使用链式操作灵活操作数据库</h3><p><strong>1：新建数据操作模块 db.js</strong></p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    host<span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>    user<span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>    password<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>    database<span class="token punctuation">:</span> <span class="token string">'onepiece'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    that<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>    where<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>wh<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>whe <span class="token operator">=</span> wh<span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    select<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>whe <span class="token operator">==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">var</span> sql <span class="token operator">=</span> <span class="token string">"select * from users "</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">var</span> sql <span class="token operator">=</span> <span class="token string">"select * from users where "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>whe<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 用完后重置where条件，以免后续操作的数据重复</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>whe <span class="token operator">=</span> undefined<span class="token punctuation">;</span>        connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> results<span class="token punctuation">,</span> fields<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token function">callback</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><strong>2：修改业务模块(yewu.js)的调用</strong></p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// var linkdb = require('./linkdb');</span><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./db'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> template <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'art-template'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>template<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token string">'./'</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    getall<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>        db<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 利用回调函数获取数据</span>            <span class="token keyword">var</span> html_data <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">callback</span><span class="token punctuation">(</span>html_data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    getone<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>        db<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id='</span><span class="token operator">+</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">var</span> user_data <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token string">'./users.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>data<span class="token punctuation">:</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">callback</span><span class="token punctuation">(</span>user_data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><strong>3：修改路由模块(luyou.js)的调用</strong></p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 引入业务模块使用模板引擎加载页面</span><span class="token keyword">var</span> yewu <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./yewu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>exports<span class="token punctuation">.</span>bind <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>server<span class="token punctuation">)</span> <span class="token punctuation">{</span>    server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 优先判断请求方式</span>        <span class="token keyword">var</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span>method<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 解析URL参数</span>        <span class="token keyword">var</span> url_obj <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// console.log(url_obj.query);//参数</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>url_obj<span class="token punctuation">.</span>pathname <span class="token operator">==</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                yewu<span class="token punctuation">.</span><span class="token function">getall</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">// 判断 获取单个用户信息路由 </span>            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>url_obj<span class="token punctuation">.</span>pathname <span class="token operator">==</span> <span class="token string">'/getuser'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// 获取id参数</span>                <span class="token keyword">var</span> id <span class="token operator">=</span> url_obj<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// 在yewu模块中封装方法，传递id参数。</span>                <span class="token comment" spellcheck="true">// 使用回掉函数获取数据</span>                yewu<span class="token punctuation">.</span><span class="token function">getone</span><span class="token punctuation">(</span>url_obj<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>                fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'.'</span> <span class="token operator">+</span> url_obj<span class="token punctuation">.</span>pathname<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h3 id="5-8-修改用户信息"><a href="#5-8-修改用户信息" class="headerlink" title="5.8 修改用户信息"></a>5.8 修改用户信息</h3><h4 id="5-8-1-修改模板代码，添加链接"><a href="#5-8-1-修改模板代码，添加链接" class="headerlink" title="5.8.1 修改模板代码，添加链接"></a>5.8.1 修改模板代码，添加链接</h4><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tbody<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    {{each data}}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>{{$value.id}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>{{$value.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>{{$value.nengli}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>{{$value.jituan}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/getuser?id<span class="token punctuation">=</span>{{$value.id}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>查看<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/upuser?id<span class="token punctuation">=</span>{{$value.id}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>修改<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    {{/each}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span></code></pre><h4 id="5-8-2-获取用户信息并填入表单"><a href="#5-8-2-获取用户信息并填入表单" class="headerlink" title="5.8.2 获取用户信息并填入表单"></a>5.8.2 获取用户信息并填入表单</h4><p><strong>1：添加路由判断(luyou.js)</strong></p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 修改用户信息，先获取用户信息    </span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>url_obj<span class="token punctuation">.</span>pathname <span class="token operator">==</span> <span class="token string">'/upuser'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 获取id参数</span>    <span class="token keyword">var</span> id <span class="token operator">=</span> url_obj<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 在yewu模块中封装方法，传递id参数。</span>    <span class="token comment" spellcheck="true">// 使用回掉函数获取数据</span>    yewu<span class="token punctuation">.</span><span class="token function">upuser_get</span><span class="token punctuation">(</span>url_obj<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>        response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span></code></pre><p><strong>2：添加业务逻辑（yewu.js），获取用户信息</strong></p><pre class=" language-js"><code class="language-js">upuser_get<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>    db<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id='</span><span class="token operator">+</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">var</span> user_data <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token string">'./upuser.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>data<span class="token punctuation">:</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">callback</span><span class="token punctuation">(</span>user_data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p><strong>3：添加表单模板（upuser.html）</strong></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">    <span class="token selector">table </span><span class="token punctuation">{</span>        <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span> auto<span class="token punctuation">;</span>        <span class="token property">border-collapse</span><span class="token punctuation">:</span> collapse<span class="token punctuation">;</span>        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">800</span>px<span class="token punctuation">;</span>        <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">500</span>px<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token selector">td </span><span class="token punctuation">{</span>        <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid <span class="token hexcode">#ccc</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/upuser?id<span class="token punctuation">=</span>{{data[0].id}}<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>姓名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{data[0].name}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>能力<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>nengli<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{data[0].nengli}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>团体<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tuanti<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{data[0].jituan}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>上传图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>修改<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><h4 id="5-8-3-获取并处理post提交数据，修改数据库"><a href="#5-8-3-获取并处理post提交数据，修改数据库" class="headerlink" title="5.8.3 获取并处理post提交数据，修改数据库"></a>5.8.3 获取并处理post提交数据，修改数据库</h4><p><strong>路由模块(luyou.js)</strong></p><pre class=" language-js"><code class="language-js"> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment" spellcheck="true">// 只要是POST请求，则优先获取数据</span>     <span class="token comment" spellcheck="true">// 后处理路由逻辑</span>     <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>     request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>che<span class="token punctuation">)</span> <span class="token punctuation">{</span>         data <span class="token operator">+</span><span class="token operator">=</span> che<span class="token punctuation">;</span>     <span class="token punctuation">}</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true">// 绑定end事件，监听数据接受完成</span>     request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token comment" spellcheck="true">// console.log(data);</span>         <span class="token comment" spellcheck="true">// 获取Post传输的数据</span>         <span class="token keyword">var</span> post_data <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// 路由判断</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>url_obj<span class="token punctuation">.</span>pathname <span class="token operator">==</span> <span class="token string">'/upuser'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>             <span class="token comment" spellcheck="true">// 调用业务层方法</span>             yewu<span class="token punctuation">.</span><span class="token function">upuser_post</span><span class="token punctuation">(</span>url_obj<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">,</span> post_data<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>                 response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>     <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></code></pre><p><strong>业务模块（yewu.js）</strong></p><pre class=" language-js"><code class="language-js">upuser_post<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>data<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 调用数据模块修改用户信息</span>    db<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id='</span><span class="token operator">+</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>changedRows<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// http服务器相应要求必须是字符串</span>        <span class="token function">callback</span><span class="token punctuation">(</span>changedRows<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p><strong>数据库模块（db.js）</strong></p><pre class=" language-js"><code class="language-js">update<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 没where条件，则停止所有操作</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>where <span class="token operator">==</span> undefined<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 拼接sql语句的set部分</span>    <span class="token keyword">var</span> <span class="token keyword">set</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>v <span class="token keyword">in</span> data<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">set</span> <span class="token operator">+</span><span class="token operator">=</span> v <span class="token operator">+</span><span class="token string">"='"</span><span class="token operator">+</span> data<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"',"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">var</span> sets <span class="token operator">=</span> <span class="token keyword">set</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">set</span><span class="token punctuation">.</span>length<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> sql <span class="token operator">=</span> <span class="token string">"UPDATE `users` SET "</span><span class="token operator">+</span>sets <span class="token operator">+</span> <span class="token string">' where '</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>whe<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// console.log(sql);</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>whe <span class="token operator">=</span> undefined<span class="token punctuation">;</span>    connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>res<span class="token punctuation">,</span>fields<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(error)</span>        <span class="token comment" spellcheck="true">// 返回受影响行数</span>        <span class="token function">callback</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>changedRows<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><blockquote><p>作业： 自己完成添加及删除操作</p></blockquote><h2 id="第7章-express-框架"><a href="#第7章-express-框架" class="headerlink" title="第7章 express 框架"></a>第7章 express 框架</h2><h3 id="7-1-简介"><a href="#7-1-简介" class="headerlink" title="7.1 简介"></a>7.1 简介</h3><p>Express 是基于  Node.js  平台，快速、开放、极简的 Web 开发框架, 提供一系列强大特性帮助你创建各种Web应用。Express 不对 node.js 已有的特性进行二次抽象，我们只是在它之上扩展了Web应用所需的功能。丰富的HTTP工具以及来自Connect框架的中间件随取随用，创建强健、友好的API变得快速又简单</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="/./img/Snipaste_2018-10-12_08-38-02.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img/Snipaste_2018-10-12_08-38-13.png" alt=""></p><h3 id="7-2-安装使用"><a href="#7-2-安装使用" class="headerlink" title="7.2 安装使用"></a>7.2 安装使用</h3><p>就像一个普通的第三方模块一样安装即可；</p><p><code>npm init</code>   <code>npm install express</code>  </p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello world !'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'8000'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1：8000'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>其中 <a href="http://www.expressjs.com.cn/4x/api.html" target="_blank" rel="noopener">Request、Response – API</a>   我们需要重点关注</p><h2 id="第8章-项目的重构"><a href="#第8章-项目的重构" class="headerlink" title="第8章 项目的重构"></a>第8章 项目的重构</h2><p>将我们之前的海贼王项目使用express框架进行重写，重写过程中，学习框架提供的各种API，并完善项目功能；</p><h3 id="8-1-启动服务器"><a href="#8-1-启动服务器" class="headerlink" title="8.1 启动服务器"></a>8.1 启动服务器</h3><p>创建http.js </p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'8000'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1：8000'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="8-2-重写路由模块"><a href="#8-2-重写路由模块" class="headerlink" title="8.2 重写路由模块"></a>8.2 重写路由模块</h3><p>之前我们写了一个独立的模块（luyou.js）来处理请求，而在 express 中已经帮我们写好了路由的请求处理规则，不需要我们进行判断；</p><p><strong><em>路由</em></strong> 是指确定应用程序如何响应对特定端点的客户端请求，该请求是URI（或路径）和特定HTTP请求方法（GET，POST等）。</p><p>每个路由都可以有一个或多个处理函数，这些函数在路由匹配时执行。</p><h4 id="8-2-1-express-中的基本路由"><a href="#8-2-1-express-中的基本路由" class="headerlink" title="8.2.1 express 中的基本路由"></a>8.2.1 express 中的基本路由</h4><p>路径定义采用以下结构：</p><pre class=" language-javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> handler<span class="token punctuation">)</span></code></pre><p>以下示例定义了简单路由。</p><p><code>Hello World!</code>在主页上回复：</p><pre class=" language-javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>在根路由（<code>/</code>），应用程序的主页上响应POST请求：</p><pre class=" language-javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Got a POST request'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>响应对<code>/user</code>路由的PUT请求：</p><pre class=" language-javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Got a PUT request at /user'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>响应对<code>/user</code>路由的DELETE请求：</p><pre class=" language-javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Got a DELETE request at /user'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h4 id="8-2-2-外置路由"><a href="#8-2-2-外置路由" class="headerlink" title="8.2.2. 外置路由"></a>8.2.2. 外置路由</h4><p>设置 外置路由 rout.js </p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/edit'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'post_edit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 导出 router</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><p>写好路由规则，一定要记得将 路由对象(router) 导出</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 引入外置路由</span><span class="token keyword">var</span> rout <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./rout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>rout<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 使用引入外置的路由</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'8000'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1：8000'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>将外置路由引入后，使用 app.use() 进行加载使用； </p><h4 id="8-2-3-使用外置路由修改项目"><a href="#8-2-3-使用外置路由修改项目" class="headerlink" title="8.2.3 使用外置路由修改项目"></a>8.2.3 使用外置路由修改项目</h4><p>在 luyou.js 中，注释以前的代码，添加新代码</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> yewu <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./yewu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    yewu<span class="token punctuation">.</span><span class="token function">getall</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><p>在 http.js 中，使用 express 启动服务，并引入使用新修改的 luyou.js 模块</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> luyou <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./luyou'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>luyou<span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'8080'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1:8080'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p> <img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img/Snipaste_2018-10-12_11-03-13.png" alt=""></p><h4 id="8-2-4-使用链式操作添加路由"><a href="#8-2-4-使用链式操作添加路由" class="headerlink" title="8.2.4 使用链式操作添加路由"></a>8.2.4 使用链式操作添加路由</h4><p>luyou.js</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> yewu <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./yewu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// express的路由支持链式操作</span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    yewu<span class="token punctuation">.</span><span class="token function">getall</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/getuser'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// req 提供了query属性获取请求参数</span>    <span class="token keyword">var</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 在yewu模块中封装方法，传递id参数。</span>    <span class="token comment" spellcheck="true">// 使用回掉函数获取数据</span>    yewu<span class="token punctuation">.</span><span class="token function">getone</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><h4 id="8-2-5-优化路由模块"><a href="#8-2-5-优化路由模块" class="headerlink" title="8.2.5 优化路由模块"></a>8.2.5 优化路由模块</h4><p>路由模块 (luyou.js) 中只负责调用，调用时，将req  res 传入业务模块</p><pre class=" language-js"><code class="language-js">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    yewu<span class="token punctuation">.</span><span class="token function">getall</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// yewu.getall(function (data) {</span>    <span class="token comment" spellcheck="true">//     res.end(data);</span>    <span class="token comment" spellcheck="true">// })</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/getuser'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    yewu<span class="token punctuation">.</span><span class="token function">getone</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// req 提供了query属性获取请求参数</span>    <span class="token comment" spellcheck="true">// var id = req.query.id;</span>    <span class="token comment" spellcheck="true">// // 在yewu模块中封装方法，传递id参数。</span>    <span class="token comment" spellcheck="true">// // 使用回掉函数获取数据</span>    <span class="token comment" spellcheck="true">// yewu.getone(id, function (data) {</span>    <span class="token comment" spellcheck="true">//     res.end(data);</span>    <span class="token comment" spellcheck="true">// });</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>业务模块接受 req  res  负责处理请求并响应数据</p><pre class=" language-js"><code class="language-js">getall<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    db<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 利用回调函数获取数据</span>        <span class="token keyword">var</span> html_data <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// console.log(html_data);</span>        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html_data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>getone<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>    db<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id='</span><span class="token operator">+</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">var</span> user_data <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token string">'./users.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>data<span class="token punctuation">:</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>user_data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p><strong>继续简化路由模块</strong></p><pre class=" language-js"><code class="language-js">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span>yewu<span class="token punctuation">.</span>getall<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/getuser'</span><span class="token punctuation">,</span>yewu<span class="token punctuation">.</span>getone<span class="token punctuation">)</span></code></pre><p>原理：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token function">callback</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> pros <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">pros</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// fn(pros);</span></code></pre><h3 id="8-3-重写模板引擎"><a href="#8-3-重写模板引擎" class="headerlink" title="8.3 重写模板引擎"></a>8.3 重写模板引擎</h3><p><a href="https://github.com/aui/art-template/issues/369" target="_blank" rel="noopener">art-template@4 新特性</a></p><p><a href="https://github.com/aui/express-art-template" target="_blank" rel="noopener">express-art-template</a> </p><p>安装：</p><pre class=" language-shell"><code class="language-shell">npm install --save art-templatenpm install --save express-art-template</code></pre><p>官方示例：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">engine</span><span class="token punctuation">(</span><span class="token string">'art'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-art-template'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'view options'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    debug<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index.art'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>        user<span class="token punctuation">:</span> <span class="token punctuation">{</span>            name<span class="token punctuation">:</span> <span class="token string">'aui'</span><span class="token punctuation">,</span>            tags<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'art'</span><span class="token punctuation">,</span> <span class="token string">'template'</span><span class="token punctuation">,</span> <span class="token string">'nodejs'</span><span class="token punctuation">]</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>修改 http.js 将 express-art-template 注册为express框架的模板引擎，并设置模板后缀为 html</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img/Snipaste_2018-10-12_13-52-28.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img/Snipaste_2018-10-12_13-54-53.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img/Snipaste_2018-10-12_14-03-20.png" alt=""></p><p>在项目中新建views目录，将所有静态页面放入views目录</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img/Snipaste_2018-10-12_14-05-30.png" alt=""></p><h3 id="8-4-利用-Express-托管静态文件"><a href="#8-4-利用-Express-托管静态文件" class="headerlink" title="8.4 利用 Express 托管静态文件"></a>8.4 利用 Express 托管静态文件</h3><p><a href="http://www.expressjs.com.cn/starter/static-files.html" target="_blank" rel="noopener">http://www.expressjs.com.cn/starter/static-files.html</a></p><p>在项目中新建 public 文件夹并将bootstrap.css移入， 修改 index.html 加载 css  静态文件 ，在http.js中引入并设置静态资源加载路径：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img/Snipaste_2018-10-12_14-25-19.png" alt=""></p><p>如果要使用多个静态资源目录，请多次调用 <code>express.static</code> 函数：</p><pre class=" language-javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">'files'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>访问静态资源文件时，<code>express.static</code> 函数会根据目录的添加顺序查找所需的文件。</p><h3 id="8-5-完成项目重构"><a href="#8-5-完成项目重构" class="headerlink" title="8.5 完成项目重构"></a>8.5 完成项目重构</h3><p>修改所有路由及业务模块代码</p><p>luyou.js</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> yewu <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./yewu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span>yewu<span class="token punctuation">.</span>getall<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/getuser'</span><span class="token punctuation">,</span>yewu<span class="token punctuation">.</span>getone<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/upuser'</span><span class="token punctuation">,</span>yewu<span class="token punctuation">.</span>upuser_get<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upuser'</span><span class="token punctuation">,</span>yewu<span class="token punctuation">.</span>upuser_post<span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><p>yewu.js</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// var linkdb = require('./linkdb');</span><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./db'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// template.defaults.root = './';</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    getall<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        db<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    getone<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        db<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id='</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'./users.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    upuser_get<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        db<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id='</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'./upuser.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    upuser_post<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>che<span class="token punctuation">)</span> <span class="token punctuation">{</span>            data <span class="token operator">+</span><span class="token operator">=</span> che<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// 绑定end事件，监听数据接受完成</span>        req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// console.log(data);</span>            <span class="token comment" spellcheck="true">// 获取Post传输的数据</span>            <span class="token keyword">var</span> post_data <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 调用数据模块修改用户信息</span>            db<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id='</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>post_data<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>changedRows<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// http服务器相应要求必须是字符串</span>                res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>changedRows<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="8-6-展示用户头像"><a href="#8-6-展示用户头像" class="headerlink" title="8.6 展示用户头像"></a>8.6 展示用户头像</h3><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img/Snipaste_2018-10-12_14-57-04.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img/Snipaste_2018-10-12_14-57-40.png" alt=""></p><h3 id="8-7-修改用户头像"><a href="#8-7-修改用户头像" class="headerlink" title="8.7 修改用户头像"></a>8.7 修改用户头像</h3><h4 id="8-7-1-测试文件上传"><a href="#8-7-1-测试文件上传" class="headerlink" title="8.7.1 测试文件上传"></a>8.7.1 测试文件上传</h4><p>创建服务器：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upfile'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>che<span class="token punctuation">)</span> <span class="token punctuation">{</span>        data <span class="token operator">+</span><span class="token operator">=</span> che<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 直接打印post传过来的数据</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'8000'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1：8000'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>使用postman工具上传文件：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img/Snipaste_2018-10-12_15-39-27.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img/Snipaste_2018-10-12_15-42-24.png" alt=""></p><h4 id="8-7-2-借助第三方插件处理文件上传"><a href="#8-7-2-借助第三方插件处理文件上传" class="headerlink" title="8.7.2 借助第三方插件处理文件上传"></a>8.7.2 借助第三方插件处理文件上传</h4><p><a href="https://www.npmjs.com/package/formidable" target="_blank" rel="noopener">https://www.npmjs.com/package/formidable</a></p><p>安装模块  <code>npm install formidable</code></p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> formidable <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'formidable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upfile'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> form <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">formidable<span class="token punctuation">.</span>IncomingForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// form.uploadDir = './img'; // 设置上传路径</span>    <span class="token comment" spellcheck="true">// form.keepExtensions = true; // 保留文件扩展名</span>    form<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> fields<span class="token punctuation">,</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> times <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 组装上传路径</span>        <span class="token keyword">var</span> file_path <span class="token operator">=</span> <span class="token string">'./img/'</span><span class="token operator">+</span>times<span class="token operator">+</span>files<span class="token punctuation">.</span>imgs<span class="token punctuation">.</span>name<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 将缓存文件移动至制定目录</span>        fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span>files<span class="token punctuation">.</span>imgs<span class="token punctuation">.</span>path<span class="token punctuation">,</span>file_path<span class="token punctuation">,</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'8000'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1：8000'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h4 id="8-7-3-在项目中实现文件上传"><a href="#8-7-3-在项目中实现文件上传" class="headerlink" title="8.7.3 在项目中实现文件上传"></a>8.7.3 在项目中实现文件上传</h4><p>修改 upuser.html</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img/Snipaste_2018-10-12_17-23-49.png" alt=""></p><p>修改业务模块 yewu.js 使用 formidable 获取 post 数据，实现文件上传 </p><pre class=" language-js"><code class="language-js">upuser_post<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> form <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">formidable<span class="token punctuation">.</span>IncomingForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    form<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> fields<span class="token punctuation">,</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> times <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 组装上传路径</span>        <span class="token keyword">var</span> file_path <span class="token operator">=</span> <span class="token string">'./public/img/'</span> <span class="token operator">+</span> times <span class="token operator">+</span> files<span class="token punctuation">.</span>imgs<span class="token punctuation">.</span>name<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 将缓存文件移动至指定的public目录</span>        fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span>files<span class="token punctuation">.</span>imgs<span class="token punctuation">.</span>path<span class="token punctuation">,</span> file_path<span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// 因为设置静态资源时，已经时public文件夹，写入数据库时，不要加public</span>                fields<span class="token punctuation">.</span>img <span class="token operator">=</span> <span class="token string">'./img/'</span> <span class="token operator">+</span> times <span class="token operator">+</span> files<span class="token punctuation">.</span>imgs<span class="token punctuation">.</span>name<span class="token punctuation">;</span>                db<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id='</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>fields<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>changedRows<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// http服务器相应要求必须是字符串</span>                    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>changedRows<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件上传失败'</span><span class="token operator">+</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="8-8-用户登陆"><a href="#8-8-用户登陆" class="headerlink" title="8.8 用户登陆"></a>8.8 用户登陆</h3><h4 id="8-8-1-登陆逻辑及cookie-session-的使用"><a href="#8-8-1-登陆逻辑及cookie-session-的使用" class="headerlink" title="8.8.1 登陆逻辑及cookie-session 的使用"></a>8.8.1 登陆逻辑及cookie-session 的使用</h4><p>express官方资源中，为我们提供了一个中间件，<a href="http://www.expressjs.com.cn/en/resources/middleware/cookie-session.html" target="_blank" rel="noopener">cookie-session</a> </p><p> <code>npm install cookie-session</code> </p><p>测试代码：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> cookieSession <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-session'</span><span class="token punctuation">)</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 注册中间件 </span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieSession</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    name<span class="token punctuation">:</span> <span class="token string">'session'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 客户端cookie的名称</span>    keys<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'ss'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// 用于加密的关键字</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 获取并判断session</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>sess_data<span class="token punctuation">)</span><span class="token punctuation">{</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'已经登陆'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 如果没有session,跳转到登陆页面</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'&lt;script>alert("没登陆");window.location.href="/up"&lt;/script>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/up'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 展示登陆页面，获取用户数据并写入session </span>    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>sess_data <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token number">89</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'已写入session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="8-8-2-完成项目登陆功能"><a href="#8-8-2-完成项目登陆功能" class="headerlink" title="8.8.2 完成项目登陆功能"></a>8.8.2 完成项目登陆功能</h4><p><strong>修改http模块，注册 cookie-session 中间件；</strong></p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> cookieSession <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 注册中间件 </span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieSession</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    name<span class="token punctuation">:</span> <span class="token string">'session'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 客户端cookie的名称</span>    keys<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'xilingzuishuai'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// 用于加密的关键字</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><strong>在业务模块 (yewu.js) 中 添加逻辑判断，只有登陆后才能展示首页：</strong></p><pre class=" language-js"><code class="language-js">getall<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 获取并判断session</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>sess_data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        db<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>            res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 如果没有session,跳转到登陆页面</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'&lt;script>alert("没登陆");window.location.href="/upload"&lt;/script>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// res.send('没登陆');</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p><strong>在路由模块(luyou.js) 中添加以下两个路由，get 展示静态登陆页面，post 获取用户提交的数据并写入 session ,写入成功后，跳转到首页；在业务模块(yewu.js)中添加响应的方法</strong></p><p><code>.get(&#39;/upload&#39;,yewu.upload_get)</code>  <code>.post(&#39;/upload&#39;,yewu.upload_post)</code></p><pre class=" language-js"><code class="language-js">upload_get<span class="token punctuation">:</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 展示登陆页面</span>    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'./upload.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>upload_post<span class="token punctuation">:</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> form <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">formidable<span class="token punctuation">.</span>IncomingForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    form<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> fields<span class="token punctuation">,</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// console.log(fields);</span>        <span class="token comment" spellcheck="true">// 获取用户提交数据，判断用户名密码是否正确</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fields<span class="token punctuation">.</span>userName <span class="token operator">==</span> <span class="token string">"admin"</span> <span class="token operator">&amp;&amp;</span> fields<span class="token punctuation">.</span>pwd <span class="token operator">==</span> <span class="token string">"123"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 数据正确，写入session</span>            req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>sess_data <span class="token operator">=</span> fields<span class="token punctuation">;</span>            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'&lt;script>alert("登陆成功");window.location.href="/"&lt;/script>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 数据错误，重新跳回登陆页面</span>            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'&lt;script>alert("登陆失败");window.location.href="/upload"&lt;/script>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h3 id="express另外附加使用技巧"><a href="#express另外附加使用技巧" class="headerlink" title="express另外附加使用技巧"></a>express另外附加使用技巧</h3><ol><li>处理get数据，使用express自带的req.query()</li><li>处理post数据，除了原生自带的，还可以借助第三方模块body-parser(在第三方模块中有介绍)，作为中间加工步骤来处理post请求</li><li>处理文件请求，原生处理起来比较乏力，借助第三方可以快速便捷，如：formidable 在以上案例（用户头像中有介绍使用，文件请求和字段都可以一并处理）、multiparty(在第三方模块中有介绍,同样文件请求和字段都可以一并处理)、multer（在第三方模块中有介绍）只能处理文件，可以做为中间件使用</li><li>cookie和seesion，可以使用第三方模块cookie-session（在用户登录中有介绍）、cookie-parser（在第三方模块中有介绍） 专门用来处理cookie,可以用来加密cookie，以上都可以作为中间件使用</li></ol><h2 id="第9章-Express的中间件"><a href="#第9章-Express的中间件" class="headerlink" title="第9章 Express的中间件"></a>第9章 Express的中间件</h2><h3 id="9-1-什么是中间件"><a href="#9-1-什么是中间件" class="headerlink" title="9.1 什么是中间件"></a>9.1 什么是中间件</h3><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="./img/Snipaste_2018-10-12_22-08-40.png" alt=""></p><p>在一个整体的流程中的某个环节，因为某些原因加入了额外的处理环节；</p><h3 id="9-2-中间件的使用"><a href="#9-2-中间件的使用" class="headerlink" title="9.2    中间件的使用"></a>9.2    中间件的使用</h3><h4 id="9-2-1-应用中间件"><a href="#9-2-1-应用中间件" class="headerlink" title="9.2.1 应用中间件"></a>9.2.1 应用中间件</h4><p>语法：</p><blockquote><ul><li><p>app.use()</p><ul><li><p>app.use(function(){}) </p><p>无论发送任何请求都会执行的中间件</p></li><li><p>app.use(‘/path’, function(){})</p><p>只要在请求path路由时才会执行的中间件（无论GET/POST）</p></li></ul></li><li><p>app.method()</p><ul><li><p>app.get()</p><p>在get请求时会执行的中间件</p></li><li><p>app.post()</p><p>在post请求时会执行的中间件</p></li></ul></li></ul></blockquote><p><strong>app.use() 的用法</strong></p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 在中间件之前，不受中间件影响</span>app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 应用中间件</span><span class="token comment" spellcheck="true">// 请求 '/user' 时，会先调用中间件</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 调用之前先调用中间件</span>app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'8000'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1：8000'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><strong>app.method() 的用法</strong></p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 在中间件之前，不受中间件影响</span>app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 应用中间件</span><span class="token comment" spellcheck="true">// 只有在 post 请求user 时才起作用</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 调用之前先调用中间件</span><span class="token comment" spellcheck="true">// 接受所有请求方式请求user</span>app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'8000'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1：8000'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h4 id="9-2-2-路由中间件"><a href="#9-2-2-路由中间件" class="headerlink" title="9.2.2 路由中间件"></a>9.2.2 路由中间件</h4><p>路由器层中间件的工作方式与应用层中间件基本相同，差异之处在于它绑定到 <code>express.Router()</code> 的实例。</p><p>使用 <code>router.use()</code> 和 <code>router.METHOD()</code> 函数装入路由器层中间件；</p><p>我们之前项目的代码，就是在使用路由中间件：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span>yewu<span class="token punctuation">.</span>getall<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/getuser'</span><span class="token punctuation">,</span>yewu<span class="token punctuation">.</span>getone<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/upuser'</span><span class="token punctuation">,</span>yewu<span class="token punctuation">.</span>upuser_get<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upuser'</span><span class="token punctuation">,</span>yewu<span class="token punctuation">.</span>upuser_post<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span>yewu<span class="token punctuation">.</span>upload_get<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span>yewu<span class="token punctuation">.</span>upload_post<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="9-2-3-内置中间件"><a href="#9-2-3-内置中间件" class="headerlink" title="9.2.3 内置中间件"></a>9.2.3 内置中间件</h4><p> 除 <code>express.static</code> 外，先前 Express 随附的所有中间件函数现在以单独模块的形式提供：<a href="https://github.com/senchalabs/connect#middleware" target="_blank" rel="noopener">中间件函数的列表</a></p><p>Express 中唯一内置的中间件函数是 <code>express.static</code>。此函数基于 <a href="https://github.com/expressjs/serve-static" target="_blank" rel="noopener">serve-static</a>，负责提供 Express 应用程序的静态资源。</p><p>对于每个应用程序，可以有多个静态目录：</p><pre class=" language-javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">'uploads'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">'files'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="9-2-4-第三方中间件"><a href="#9-2-4-第三方中间件" class="headerlink" title="9.2.4 第三方中间件"></a>9.2.4 第三方中间件</h4><p>使用第三方中间件向 Express 应用程序添加功能。</p><p>安装具有所需功能的 Node.js 模块，然后在应用层或路由器层的应用程序中将其加装入。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> cookieSession <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 注册中间件 </span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieSession</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    name<span class="token punctuation">:</span> <span class="token string">'session'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 客户端cookie的名称</span>    keys<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'xilingzuishuai'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// 用于加密的关键字</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="第10章-Koa-框架"><a href="#第10章-Koa-框架" class="headerlink" title="第10章 Koa 框架"></a>第10章 Koa 框架</h2><blockquote><p>Koa框架是express原帮人马打造，小且精干，express有的Koa都有，甚至比express还更有优势，如：在express中回调是必不可少的，语法大多停止在ES5版本，而Koa则使用generator、async等新特性解决了回调套回调，语法上也紧跟ECMAScript版本，是当下流行的框架</p></blockquote><h3 id="安装使用"><a href="#安装使用" class="headerlink" title="安装使用"></a>安装使用</h3><p>1.安装 koa框架</p><p>npm   init    </p><p>npm install koa </p><p>提示：在express中路由自带，koa中没有自带路由，需自行下载（koa-router）</p><h3 id="嵌套路由："><a href="#嵌套路由：" class="headerlink" title="嵌套路由："></a>嵌套路由：</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> koa<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//加载koa</span><span class="token keyword">const</span> Router<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//加载koa路由框架</span><span class="token keyword">let</span> server<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//在koa中可以嵌套路由</span><span class="token keyword">let</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//最顶级</span>UserRouter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//用户路由</span>    <span class="token comment" spellcheck="true">//用户路由中子路由</span> HomeRouter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> AdminRouter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//路由函数有两个参数 一个是ctx上下文（什么都有） next中间函数（可以省略）</span><span class="token comment" spellcheck="true">//函数前都加async,使用next也同样要加await</span>HomeRouter<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/a'</span><span class="token punctuation">,</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'前台用户'</span><span class="token punctuation">)</span>    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'前台用户'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>AdminRouter<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/a'</span><span class="token punctuation">,</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'后台用户'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'后台用户'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>UserRouter<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">async</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span>next<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'用户模块'</span><span class="token punctuation">)</span>    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'User'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//用户路由添加两个子路由</span>UserRouter<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/home'</span><span class="token punctuation">,</span>HomeRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>UserRouter<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">,</span>AdminRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//最顶级的路由添加用户路由作为子路由</span>router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span>UserRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//最后添加到服务器上</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*当前嵌套路由层级router=>         UserRouter => HomeRouter                     AdminRouter*/</span><span class="token comment" spellcheck="true">//上面是把路由写在一个文件，正常情况是分开写然后引入</span></code></pre><h3 id="嵌套路由（分开版）图片展示："><a href="#嵌套路由（分开版）图片展示：" class="headerlink" title="嵌套路由（分开版）图片展示："></a>嵌套路由（分开版）图片展示：</h3><p>1.服务器页面（总页面）</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/koa1.PNG" alt=""></p><p>2.路由文件：router/user/index.js</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/koa5.PNG" alt=""></p><p>3.路由目录</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/koa2.PNG" alt=""></p><p>4.子路由页面</p><p> 4.1 admin</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/koa3.PNG" alt=""></p><p>4.2 company</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/koa4.PNG" alt=""></p><p><strong>提示：可以在总页面上添加和user同级的多个路由</strong></p><h3 id="路由传参："><a href="#路由传参：" class="headerlink" title="路由传参："></a>路由传参：</h3><p><strong>koa路由传参新方式</strong>（也可以使用旧方式）</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> Koa<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Router<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> server<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> router<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//路由传参   :字段 想传多少传多少 </span><span class="token comment" spellcheck="true">//也可以  ?字段=值方式传值，只不过获取方式不同</span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/news/:id/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token keyword">let</span> <span class="token punctuation">{</span>id<span class="token punctuation">}</span><span class="token operator">=</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// :字段方式传参的数据在ctx.params中</span><span class="token comment" spellcheck="true">//启动后，访问/news/34 id就是34</span>  ctx<span class="token punctuation">.</span>body<span class="token operator">=</span><span class="token string">'新闻id='</span><span class="token operator">+</span>id<span class="token punctuation">;</span>  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/news/1/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> ctx<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token keyword">let</span> <span class="token punctuation">{</span>id<span class="token punctuation">}</span><span class="token operator">=</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">;</span>  ctx<span class="token punctuation">.</span>body<span class="token operator">+</span><span class="token operator">=</span><span class="token string">'aaa'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//当定义的函数像以上情况有点混淆的时候，谁在前，谁先执行，和express一样从上往下执行</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*用?id=xxx传参和/:id有什么区别？倾向于用/:id吗？urlencoded      http://aaa.com/user?a=12&amp;b=5params          http://aaa.com/user/12/5    urlencoded      params    顺序灵活         死的    可省略           死的    不利于SEO        利于SEO*/</span></code></pre><h3 id="ctx对象属性介绍"><a href="#ctx对象属性介绍" class="headerlink" title="ctx对象属性介绍"></a>ctx对象属性介绍</h3><pre class=" language-js"><code class="language-js">ctx<span class="token punctuation">.</span>params  <span class="token comment" spellcheck="true">//获取路由 ：字段方式的数据</span>ctx<span class="token punctuation">.</span>query    <span class="token comment" spellcheck="true">//获取路由 ？字段 = 值 方式的数据</span>ctx<span class="token punctuation">.</span>method <span class="token comment" spellcheck="true">//请求方式</span>ctx<span class="token punctuation">.</span>url<span class="token comment" spellcheck="true">//请求地址url</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>server<span class="token punctuation">.</span>context：<span class="token comment" spellcheck="true">// 相当于ctx的prototype</span>server<span class="token punctuation">.</span>coconst Koa<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Router<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> server<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span>context<span class="token punctuation">.</span>a<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//在ctx原型添加属性</span><span class="token keyword">let</span> router<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/news/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> ctx<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token keyword">let</span> <span class="token punctuation">{</span>id<span class="token punctuation">}</span><span class="token operator">=</span>ctx<span class="token punctuation">.</span>query<span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>  ctx<span class="token punctuation">.</span>body<span class="token operator">=</span><span class="token string">'bbb'</span><span class="token operator">+</span>ctx<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//实例里获取</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>ctx<span class="token punctuation">.</span>request <span class="token comment" spellcheck="true">//请求</span>ctx<span class="token punctuation">.</span>response<span class="token comment" spellcheck="true">//响应</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>ctx<span class="token punctuation">.</span>path        <span class="token comment" spellcheck="true">//路径</span>ctx<span class="token punctuation">.</span>ip         <span class="token comment" spellcheck="true">// 客户端的IP</span>ctx<span class="token punctuation">.</span>headers     <span class="token comment" spellcheck="true">//请求头</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>ctx<span class="token punctuation">.</span><span class="token keyword">throw</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>   ctx<span class="token punctuation">.</span><span class="token function">assert</span><span class="token punctuation">(</span>条件<span class="token punctuation">,</span> code<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>ctx<span class="token punctuation">.</span><span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">'username is required'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ctx<span class="token punctuation">.</span><span class="token function">assert</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>query<span class="token punctuation">.</span>pass<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">'password is required'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//一旦触发，会把错误信息响应到客户端</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>ctx<span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token number">305</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//状态码</span>ctx<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//重定向</span>ctx<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//下载文件</span></code></pre><h3 id="koa-static管理静态文件"><a href="#koa-static管理静态文件" class="headerlink" title="koa-static管理静态文件"></a>koa-static管理静态文件</h3><p>koa-static 需自行下载，不自带</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> Koa<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Router<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">static</span><span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> server<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> router<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> ctx<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//可以配合koa-router使用</span><span class="token keyword">let</span> staticRouter<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>staticRouter<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token regex">/(\.jpg|\.png|\.gif)$/i</span><span class="token punctuation">,</span> <span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">'./static'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>  maxage<span class="token punctuation">:</span> <span class="token number">60</span><span class="token operator">*</span><span class="token number">86400</span><span class="token operator">*</span><span class="token number">1000</span> <span class="token comment" spellcheck="true">//静态文件缓存时间  这里2个月</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>staticRouter<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token regex">/(\.css)$/i</span><span class="token punctuation">,</span> <span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">'./static'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>  maxage<span class="token punctuation">:</span> <span class="token number">1</span><span class="token operator">*</span><span class="token number">86400</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>staticRouter<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token regex">/(\.html|\.htm|\.shtml)$/i</span><span class="token punctuation">,</span> <span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">'./static'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>  maxage<span class="token punctuation">:</span> <span class="token number">20</span><span class="token operator">*</span><span class="token number">86400</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>staticRouter<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">'./static'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>  maxage<span class="token punctuation">:</span> <span class="token number">30</span><span class="token operator">*</span><span class="token number">86400</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//加载static中间件</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>staticRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//类似express的方式</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//指定文件</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    index<span class="token punctuation">:</span><span class="token string">'index.html'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h3 id="koa-better-body处理post请求和文件请求（可以一并处理，需自行下载）"><a href="#koa-better-body处理post请求和文件请求（可以一并处理，需自行下载）" class="headerlink" title="koa-better-body处理post请求和文件请求（可以一并处理，需自行下载）"></a>koa-better-body处理post请求和文件请求（可以一并处理，需自行下载）</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> Koa<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Router<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> body<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-better-body'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> server<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  uploadDir<span class="token punctuation">:</span> <span class="token string">'./static/upload'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> ctx<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//文件和post数据</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>fields<span class="token punctuation">)</span><span class="token punctuation">;</span>  ctx<span class="token punctuation">.</span>body<span class="token operator">=</span><span class="token string">'aaa'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="koa中的-cookie、session"><a href="#koa中的-cookie、session" class="headerlink" title="koa中的 cookie、session"></a>koa中的 cookie、session</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//在koa中cookie自带，session则没有，需要下载一个叫：koa-session模块</span><span class="token comment" spellcheck="true">//----------cookie  注意：如果在设置cookie的时候设置了签名，获取的时候也要开签名  (signed) 否则被串改，服务器获取的数据将会是被串改的</span>server<span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'sadasdasdasdasdvvvvvvvvvsadasdasd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//设置cookie签名的循环密匙</span><span class="token comment" spellcheck="true">//设置和获取cookie在ctx上下文对象中</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span><span class="token string">'xuyuxin'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>    signed<span class="token punctuation">:</span><span class="token boolean">true</span>  <span class="token comment" spellcheck="true">//开启签名 </span>    <span class="token comment" spellcheck="true">//cookie中可以设置的属性，在这就可以设置如：domain、maxAge</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>signed<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//---------------------session</span><span class="token keyword">const</span> Koa<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Router<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> session<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> server<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span>keys<span class="token operator">=</span><span class="token punctuation">[</span>    <span class="token comment" spellcheck="true">//跟cookie相同</span>  <span class="token string">'asdfasdfasdfasdfasdf'</span><span class="token punctuation">,</span>  <span class="token string">'hghjfgjghjkyggfytyurt'</span><span class="token punctuation">,</span>  <span class="token string">'hjghjkfguig8ygyi8t78i8'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  maxAge<span class="token punctuation">:</span> <span class="token number">20</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">,</span>   <span class="token comment" spellcheck="true">//有效期</span>  renew<span class="token punctuation">:</span> <span class="token boolean">true</span>           <span class="token comment" spellcheck="true">//自动续期</span><span class="token punctuation">}</span><span class="token punctuation">,</span> server<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> ctx<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ctx<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">'view'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    ctx<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">'view'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  ctx<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">'view'</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>  ctx<span class="token punctuation">.</span>body<span class="token operator">=</span><span class="token template-string"><span class="token string">`欢迎你第</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>view<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">次来访`</span></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="koa中的mysql"><a href="#koa中的mysql" class="headerlink" title="koa中的mysql"></a>koa中的mysql</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//一般在koa中，会把常用的模块或中间件放在 ctx.prototype(server.context)中，以便在任何地方使用</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>database<span class="token punctuation">.</span>js<span class="token keyword">const</span> mysql<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> co<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'co-mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> conn<span class="token operator">=</span>mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  host<span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>  user<span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>  password<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  database<span class="token punctuation">:</span> <span class="token string">'20181101'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> db<span class="token operator">=</span><span class="token function">co</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports<span class="token operator">=</span>db<span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>引入<span class="token keyword">const</span> Koa<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Router<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> server<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span>context<span class="token punctuation">.</span>db<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./libs/database'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//引入后，就可在ctx中使用</span>server<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">async</span> ctx<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>   <span class="token keyword">let</span> data <span class="token operator">=</span>  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * FROM tbale'</span><span class="token punctuation">)</span>；   ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="在koa中如何处理错误"><a href="#在koa中如何处理错误" class="headerlink" title="在koa中如何处理错误"></a>在koa中如何处理错误</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> Koa<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Router<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> server<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//以中间件方式处理</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token keyword">try</span><span class="token punctuation">{</span>    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>    ctx<span class="token punctuation">.</span>body<span class="token operator">=</span><span class="token string">'错了'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//也可以用Router方式处理  * 代表全部，只要请求就会触发</span><span class="token keyword">let</span> router<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> ctx<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token keyword">try</span><span class="token punctuation">{</span>    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>    ctx<span class="token punctuation">.</span>body<span class="token operator">=</span><span class="token string">'错了-router'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/a'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> ctx<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  ctx<span class="token punctuation">.</span>body<span class="token operator">=</span>div<span class="token punctuation">.</span>title<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="koa-ejs模板引擎"><a href="#koa-ejs模板引擎" class="headerlink" title="koa-ejs模板引擎"></a>koa-ejs模板引擎</h3><p> <a href="https://ejs.bootcss.com/" target="_blank" rel="noopener">ejs 文档</a></p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">=</span> user<span class="token punctuation">.</span>name <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>用法<span class="token keyword">var</span> template <span class="token operator">=</span> ejs<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">template</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// => 输出绘制后的 HTML 字符串</span>ejs<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> data<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// => 输出绘制后的 HTML 字符串</span>ejs<span class="token punctuation">.</span><span class="token function">renderFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> data<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// str => 输出绘制后的 HTML 字符串</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>你可能需要能够输出原始内容的标签 <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">-</span><span class="token punctuation">)</span> 用于 include 指令，避免对输出的 HTML 代码做转义处理。<span class="token operator">&lt;</span>ul<span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">%</span> users<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">-</span> <span class="token function">include</span><span class="token punctuation">(</span><span class="token string">'user/show'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>user<span class="token punctuation">:</span> user<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>自定义分隔符可针对单个模板或全局使用自定义分隔符：<span class="token keyword">var</span> ejs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'geddy'</span><span class="token punctuation">,</span> <span class="token string">'neil'</span><span class="token punctuation">,</span> <span class="token string">'alex'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 单个模板文件</span>ejs<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'&lt;?- users.join(" | "); ?>'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>users<span class="token punctuation">:</span> users<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>delimiter<span class="token punctuation">:</span> <span class="token string">'?'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// => 'geddy | neil | alex'</span><span class="token comment" spellcheck="true">// 全局</span>ejs<span class="token punctuation">.</span>delimiter <span class="token operator">=</span> <span class="token string">'?'</span><span class="token punctuation">;</span>ejs<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'&lt;?- users.join(" | ");?>'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>users<span class="token punctuation">:</span> users<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// => 'geddy | neil | alex'</span><span class="token comment" spellcheck="true">//语法大多跟js一样</span></code></pre><ul><li><p>参数<br>cache 缓存编译后的函数，需要提供 filename<br>filename 被 cache 参数用做键值，同时也用于 include 语句<br>context 函数执行时的上下文环境<br>compileDebug 当为 false 时不编译调试语句<br>client 返回独立的编译后的函数<br>delimiter 放在角括号中的字符，用于标记标签的开与闭<br>debug 将生成的函数体输出<br>_with 是否使用 with() {} 结构。如果为 false，所有局部数据将存储在 locals 对象上。<br>localsName 如果不使用 with ，localsName 将作为存储局部变量的对象的名称。默认名称是 locals<br>rmWhitespace 删除所有可安全删除的空白字符，包括开始与结尾处的空格。对于所有标签来说，它提供了一个更安全版本的 -%&gt; (在一行的中间并不会剔除标签后面的换行符)。<br>escape 为 &lt;%= 结构设置对应的转义（escape）函数。它被用于输出结果以及在生成的客户端函数中通过 .toString() 输出。(默认转义 XML)。</p></li><li><p>标签含义<br>&lt;% ‘脚本’ 标签，用于流程控制，无输出。<br>&lt;%_ 删除其前面的空格符<br>&lt;%= 输出数据到模板（输出是转义 HTML 标签）<br>&lt;%- 输出非转义的数据到模板<br>&lt;%# 注释标签，不执行、不输出内容<br>&lt;%% 输出字符串 ‘&lt;%’<br>%&gt; 一般结束标签<br>-%&gt; 删除紧随其后的换行符<br>_%&gt; 将结束标签后面的空格符删除<br>包含（include）<br>通过 include 指令将相对于模板路径中的模板片段包含进来。(需要提供 ‘filename’ 参数。) 例如，如果存在 “./views/users.ejs” 和 “./views/user/show.ejs” 两个模板文件，你可以通过 &lt;%- include(‘user/show’); %&gt; 代码包含后者。</p></li></ul><h4 id="在koa中使用"><a href="#在koa中使用" class="headerlink" title="在koa中使用"></a>在koa中使用</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> Koa<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> ejs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> server<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//语法</span><span class="token function">ejs</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> <span class="token punctuation">{</span>  root<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'template'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//根路径  文件夹名称</span>  layout<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//模板在根目录中是否要再封装一个文件夹， 是的话写对应的文件名，否则放在根目录指定位置 默认是 true 自动在根目录加上一层文件夹 </span>  viewExt<span class="token punctuation">:</span> <span class="token string">'ejs'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//模板后缀</span>  cache<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//是否缓存</span>  debug<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment" spellcheck="true">// 是否将渲染好文件展示</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="附加章-第三方模块"><a href="#附加章-第三方模块" class="headerlink" title="附加章 第三方模块"></a>附加章 第三方模块</h2><h3 id="forever：node启动器-，发生错误时也会重启，挂在后台"><a href="#forever：node启动器-，发生错误时也会重启，挂在后台" class="headerlink" title="forever：node启动器 ，发生错误时也会重启，挂在后台"></a>forever：node启动器 ，发生错误时也会重启，挂在后台</h3><pre class=" language-js"><code class="language-js">npm i forever <span class="token operator">-</span>g  npm安装<span class="token comment" spellcheck="true">//语法</span>forever start xxx<span class="token punctuation">.</span>js   开启forever restart xxx<span class="token punctuation">.</span>js 重启forever stop xxx<span class="token punctuation">.</span>js  停止forever stopall  停止全部forever start xxx<span class="token punctuation">.</span>js <span class="token operator">-</span>l c<span class="token punctuation">:</span><span class="token operator">/</span>a<span class="token punctuation">.</span>log <span class="token operator">-</span>e c<span class="token punctuation">:</span><span class="token operator">/</span>err<span class="token punctuation">.</span>log <span class="token operator">-</span>a </code></pre><h3 id="body-parser：用来处理post数据的模块之一"><a href="#body-parser：用来处理post数据的模块之一" class="headerlink" title="body-parser：用来处理post数据的模块之一"></a>body-parser：用来处理post数据的模块之一</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> express<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> body<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> server<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//在express中作为中间件使用</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  extended<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//最后在req的body中</span>server<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/reg'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//注意，此模块不能处理上传文件请求</span><span class="token comment" spellcheck="true">//用原生node封装一个类似body-parser的简易版</span><span class="token keyword">const</span> express<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> server<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> querystring<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//跟以上相同</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token keyword">let</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> buffer<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    <span class="token keyword">let</span> post<span class="token operator">=</span>querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span>body<span class="token operator">=</span>post<span class="token punctuation">;</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/reg'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//把以上的中间件函数封装</span><span class="token keyword">const</span> express<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> body<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./libs/body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> server<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/reg'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//即可自己实现一个简易的中间件</span></code></pre><h3 id="multiparty：处理post中文件上传请求和字段请求（可以一并处理也可单一）"><a href="#multiparty：处理post中文件上传请求和字段请求（可以一并处理也可单一）" class="headerlink" title="multiparty：处理post中文件上传请求和字段请求（可以一并处理也可单一）"></a>multiparty：处理post中文件上传请求和字段请求（可以一并处理也可单一）</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> http<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> multiparty<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'multiparty'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token keyword">let</span> form<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">multiparty<span class="token punctuation">.</span>Form</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    uploadDir<span class="token punctuation">:</span> <span class="token string">'./upload'</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  form<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>  form<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'field'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'字段：'</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  form<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件：'</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  form<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'表单解析完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//请求到响应，中间如果出错，就算文件已经上传成功也会被删除</span></code></pre><h3 id="multer：专门用来处理文件的模块，其他不行"><a href="#multer：专门用来处理文件的模块，其他不行" class="headerlink" title="multer：专门用来处理文件的模块，其他不行"></a>multer：专门用来处理文件的模块，其他不行</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> express<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> multer<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'multer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> server<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//作为中间件使用</span><span class="token keyword">let</span> obj<span class="token operator">=</span><span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>dest<span class="token punctuation">:</span> <span class="token string">'./static/upload'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//最后处理完的数据存在req的files中</span>server<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/reg'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'upload successed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="cookie-parser-专门处理cookie的模块"><a href="#cookie-parser-专门处理cookie的模块" class="headerlink" title="cookie-parser:专门处理cookie的模块"></a>cookie-parser:专门处理cookie的模块</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> express<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> cookieParser<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> server<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//签名加密</span>server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span>  <span class="token string">'fasdgfhsrtyredfbfd56te5645sdter76tytutyi456ythgfgerrhdfghfdg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/a'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'cookie:'</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//未签名的</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'signed:'</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>signedCookies<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//签名的</span>  res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'amount'</span><span class="token punctuation">,</span> <span class="token number">99.8</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//httpOnly: true,   是否只能在服务端使用</span>    maxAge<span class="token punctuation">:</span> <span class="token number">14</span><span class="token operator">*</span><span class="token number">86400</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">//secure: true,         只有https</span>    signed<span class="token punctuation">:</span> <span class="token boolean">true</span>     <span class="token comment" spellcheck="true">//是否启用签名</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="uuid生成唯一标识符"><a href="#uuid生成唯一标识符" class="headerlink" title="uuid生成唯一标识符"></a>uuid生成唯一标识符</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//注意：此模块不能使用require('uuid')直接引入，uuid有很多个版本，因此直接引入会出错，需要指定对应版本引入 require('uuid/[v1|v3|v4|v5]')</span>版本<span class="token number">1</span>（时间戳）：<span class="token keyword">const</span>  uuidv1  <span class="token operator">=</span>  require（<span class="token string">' uuid / v1 '</span>）<span class="token punctuation">;</span>uuidv1（）<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ⇨'2c5ea4c0-4067-11e9-8bad-9b1deb4d3b7d'</span>版本<span class="token number">3</span>（命名空间）：<span class="token keyword">const</span>  uuidv3  <span class="token operator">=</span>  require（<span class="token string">' uuid / v3 '</span>）<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ...使用预定义的DNS命名空间（域名）</span>uuidv3（ <span class="token string">' hello.example.com '</span>， uuidv3。 DNS）<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ⇨'9125a8dc-52ee-365b-a5aa-81b0b3681cf6'</span><span class="token comment" spellcheck="true">// ...使用预定义的URL命名空间（，好了，URL）的</span>uuidv3（ <span class="token string">' http://example.com/hello '</span>， uuidv3。网址）<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ⇨'c6235813-3ba4-3801-ae84-e0a6ebb7d138'</span><span class="token comment" spellcheck="true">// ...使用自定义名称空间</span><span class="token comment" spellcheck="true">// // </span><span class="token comment" spellcheck="true">//注意：自定义名称空间应为特定于您的应用程序的UUID字符串！</span><span class="token comment" spellcheck="true">//例如，这里的一个是使用uuid CLI模块生成的。</span><span class="token keyword">const</span>  MY_NAMESPACE  <span class="token operator">=</span>  <span class="token string">' 1b671a64-40d5-491e-99b0-da01ff1f3341 '</span> <span class="token punctuation">;</span>uuidv3（ <span class="token string">' Hello，World！'</span>， MY_NAMESPACE）<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ⇨'e8b5a51d-11c8-3310-a6ab-367563f20686'</span>版本<span class="token number">4</span>（随机）：<span class="token keyword">const</span>  uuidv4  <span class="token operator">=</span>  require（<span class="token string">' uuid / v4 '</span>）<span class="token punctuation">;</span>uuidv4（）<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ⇨'1b9d6bcd-bbfd-4b2d-9b5d-ab8dfbbd4bed'</span>版本<span class="token number">5</span>（命名空间）：<span class="token keyword">const</span>  uuidv5  <span class="token operator">=</span>  require（<span class="token string">' uuid / v5 '</span>）<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ...使用预定义的DNS命名空间（域名）</span>uuidv5（ <span class="token string">' hello.example.com '</span>， uuidv5。 DNS）<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ⇨'fdda765f-fc57-5604-a269-52a7df8164ec'</span><span class="token comment" spellcheck="true">// ...使用预定义的URL命名空间（，好了，URL）的</span>uuidv5（ <span class="token string">' http://example.com/hello '</span>， uuidv5。网址）<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ⇨'3bbcee75-cecc-5b56-8031-b6641c1ed1f1'</span><span class="token comment" spellcheck="true">// ...使用自定义名称空间</span><span class="token comment" spellcheck="true">// // </span><span class="token comment" spellcheck="true">//注意：自定义名称空间应为特定于您的应用程序的UUID字符串！</span><span class="token comment" spellcheck="true">//例如，这里的一个是使用uuid CLI模块生成的。</span><span class="token keyword">const</span>  MY_NAMESPACE  <span class="token operator">=</span>  <span class="token string">' 1b671a64-40d5-491e-99b0-da01ff1f3341 '</span> <span class="token punctuation">;</span>uuidv5（ <span class="token string">' Hello，World！'</span>， MY_NAMESPACE）<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ⇨'630eb68f-e0fa-5ecc-887a-7c7a62614681'</span></code></pre><h3 id="jsonwebtoken-检验-生成token"><a href="#jsonwebtoken-检验-生成token" class="headerlink" title="jsonwebtoken 检验/生成token"></a>jsonwebtoken 检验/生成token</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Token <span class="token operator">=</span> <span class="token punctuation">{</span>  encrypt<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>time<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//data加密数据，time过期时间</span>    <span class="token keyword">return</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'token'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>expiresIn<span class="token punctuation">:</span>time<span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  decrypt<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> data <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>        token<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>        id<span class="token punctuation">:</span>data<span class="token punctuation">.</span>id      <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>        token<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>        data<span class="token punctuation">:</span>e      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Token<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//1. 首先安装jsonwebtoken  </span>npm install jsonwebtoken<span class="token comment" spellcheck="true">//2. 引入jsonwebtoken</span><span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//3. encrypt加密函数</span><span class="token comment" spellcheck="true">//jsonwebtoken提供了一个函数sign用于加密生成jwt,格式jwt.sign(data,str,options)</span><span class="token comment" spellcheck="true">//参数data 表示要加密的数据</span><span class="token comment" spellcheck="true">//参数str 自定义字符串，这个字符串在解密时需要用到，在这里我随便写了一个‘token’。这相当于一个密钥secret，服务器端需要妥善保管。</span><span class="token comment" spellcheck="true">//参数options 其他内容，可以设置令牌有效时间{expiresIn:time}。time的取值，'15d'表示15天,'2h'表示2小时，……</span><span class="token comment" spellcheck="true">//4.decrypt解密函数</span><span class="token comment" spellcheck="true">//jsonwebtoken提供了一个函数verify用于解密jwt,格式jwt.verify(token,str)</span><span class="token comment" spellcheck="true">//参数token 表示需要解密的令牌 </span><span class="token comment" spellcheck="true">//参数str 表示加密时用到的自定义字符串，即密钥</span><span class="token comment" spellcheck="true">//5.用法</span><span class="token keyword">const</span> Token <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils/token'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//code……</span><span class="token keyword">const</span> token <span class="token operator">=</span> Token<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span>user<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">'15d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//将user.id加密，设置有效期15天，返回token</span><span class="token comment" spellcheck="true">//code……</span><span class="token comment" spellcheck="true">//解密</span><span class="token keyword">let</span> data <span class="token operator">=</span> Token<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>header<span class="token punctuation">.</span>authorization<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//将请求头的token取出解密</span><span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//有效token</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//无效token</span><span class="token punctuation">}</span></code></pre><blockquote><p>参考资源相关列表:</p><p><a href="https://nodejs.org/zh-cn/" target="_blank" rel="noopener">https://nodejs.org/zh-cn/</a>   node.js官网 </p><p><a href="http://nodejs.cn/" target="_blank" rel="noopener">http://nodejs.cn/</a>  node.js中文网 </p><p>《深入浅出Node.js》  朴灵著 ，人民邮电出版社</p><p><a href="https://en.wikipedia.org/wiki/CommonJS" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/CommonJS</a>  维基百科 </p><p><a href="http://es6.ruanyifeng.com/" target="_blank" rel="noopener">《ECMAScript 6 入门》(第三版)</a>  阮一峰著 ，电子工业出版社</p><p>《你不知道的JavaScript》(上、中、下卷)   [美] Kyle Simpson 著 ，人民邮电出版社</p><p><a href="http://www.expressjs.com.cn/" target="_blank" rel="noopener">http://www.expressjs.com.cn/</a>   express中文网</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Back </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Node </tag>
            
            <tag> 笔记 </tag>
            
            <tag> express </tag>
            
            <tag> Koa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Canvas</title>
      <link href="/posts/7c26.html"/>
      <url>/posts/7c26.html</url>
      
        <content type="html"><![CDATA[<h1 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h1><blockquote><p>canvas 是HTML5新出的标签，可以用来做小游戏，特效，作图等，自己并没有作画能力，只能通过Javascript脚本来操控</p></blockquote><h2 id="Canvas标准"><a href="#Canvas标准" class="headerlink" title="Canvas标准"></a>Canvas标准</h2><p><a href="http://www.w3c.org/TR/2dcontext/" target="_blank" rel="noopener">http://www.w3c.org/TR/2dcontext/</a><br><a href="https://html.spec.whatwg.org/" target="_blank" rel="noopener">https://html.spec.whatwg.org/</a></p><h2 id="创建Canvas"><a href="#创建Canvas" class="headerlink" title="创建Canvas"></a>创建Canvas</h2><p>创建canvas几个主要的问题：</p><p>1.不能通过CSS设置画布的大小，否则会造成画布拉伸变形等问题，只能设置本身自带width、height属性,也可以在js里设置</p><p>2.兼容性：对一些不支持的浏览器，可以在标签内输入提示，不支持的浏览器会显示此提示、支持的浏览器会自动忽略掉</p><p>3.创建并设置好宽高后，通过js获取，还要设置其getContext，成功返回一个对象后即可作画，这里用js也可判断其是否支持canvas</p><p>语法格式：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1024<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>570<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvas<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>由于您的浏览器版本过低，此图片不能加载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token keyword">var</span> ctx <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".canvas"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d|3d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p><a href="http://www.w3school.com.cn/tags/html_ref_canvas.asp" target="_blank" rel="noopener">手册参考网址</a></p><h2 id="线"><a href="#线" class="headerlink" title="线"></a>线</h2><p>画布的x、y起点默认在右上角的位置（0，0）， 分别对应的最大值是画布的宽和高</p><p>绘制线条的函数：</p><p>moveTo(x,y) ： 开始位置</p><p>lineTo(x,y)：结束位置</p><p>stroke ：准备好后，开始画线条</p><p>设置线条样式的函数：</p><p>lineWidth：设置线条粗细</p><p>strokeStyle：设置线条的颜色</p><p>lineCap：设置线条首尾处的形状  俗称帽子</p><p>lineJoin：设置连接处的样式</p><p>miterLimit：内角与外角的距离。默认值是10，此属性只有在lineJoin = “miter”并且有设置线条粗细情况下才有效，且斜接长度大于miterLimit ，线条连接处自动斜切（lineJoin =”bevel”)</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/miterlimit.gif" alt=""></p><p>另起一条路径的函数： </p><p>beginPath：起始一条路径，或重置当前路径</p><p>closePath：创建从当前点回到起始点的路径</p><p>语法格式：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1024<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>760<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvas<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>由于您的浏览器版本过低，此图片不能加载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">   <span class="token keyword">var</span> ctx <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".canvas"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d|3d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">,</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">"green"</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span>lineCap <span class="token operator">=</span> <span class="token string">"round"</span> <span class="token comment" spellcheck="true">//butt(default) round圆头 square方头</span>    <span class="token comment" spellcheck="true">//lineCap 有时可以填补连接处的空缺</span>    ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">"yellow"</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>===============================================================ctx.lineWidth = 15;DrawStart(ctx, 100, 20, 400, 400, -30);      ctx.lineJoin = "miter"; //可以设置的样式有：miter(default)、 bevel斜接、 round圆角      ctx.miterLimit = 7; //如果斜接长度超过 miterLimit 的值，边角会以 lineJoin 的 "bevel" 类型来显示。,这里等于7时,边角会以lineJoin的bevel显示，等于8时则会以miter显示    //斜接长度指的是在两条线交汇处内角和外角之间的距离。      ctx.stroke();      function DrawStart(context, R, r, x, y, rotate) {        //绘画对象 大圆的半径 小圆半径  x轴 y轴        ctx.beginPath();        for (var i = 0; i &lt; 5; i++) {          ctx.lineTo(            Math.cos(((18 + 72 * i - rotate) / 180) * Math.PI) * R + x,            -Math.sin(((18 + 72 * i - rotate) / 180) * Math.PI) * R + y          );          ctx.lineTo(            Math.cos(((54 + 72 * i - rotate) / 180) * Math.PI) * r + x,            -Math.sin(((54 + 72 * i - rotate) / 180) * Math.PI) * r + y          );        }        ctx.closePath();      }</code></pre><h2 id="填充"><a href="#填充" class="headerlink" title="填充"></a>填充</h2><p>填充函数：</p><p>fill ：填充当前路径 （注意：如果路径未关闭，那么 fill() 方法会从路径结束点到开始点之间添加一条线，以关闭该路径，然后填充该路径）</p><p>填充样式：</p><p>fillStyle：填充颜色</p><p>语法格式：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1024<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>760<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvas<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>由于您的浏览器版本过低，此图片不能加载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">   <span class="token keyword">var</span> ctx <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".canvas"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d|3d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">,</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">"green"</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">"yellow"</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h2 id="案例：四个正方形组成的大方形"><a href="#案例：四个正方形组成的大方形" class="headerlink" title="案例：四个正方形组成的大方形"></a>案例：四个正方形组成的大方形</h2><pre class=" language-html"><code class="language-html">   var ctx = document.querySelector(".canvas").getContext("2d");let box = [        {p:[{x:0,y:0},{x:512,y:0},{x:512,y:380},{x:0,y:380},{x:0,y:0}],color:"red"},        {p:[{x:512,y:0},{x:1024,y:0},{x:1024,y:380},{x:512,y:380},{x:512,y:0}],color:"green"},        {p:[{x:0,y:380},{x:512,y:380},{x:512,y:760},{x:0,y:760},{x:0,y:380}],color:"blue"},        {p:[{x:512,y:380},{x:1024,y:380},{x:1024,y:760},{x:512,y:760},{x:512,y:380}],color:"yellow"},      ]      for(let i=0;i&lt;box.length;i++)      {        draw(box[i],ctx);      }      function draw(p,c)      {        c.beginPath();          c.moveTo(p.p[0].x,p.p[0].y);          for(let i=1;i&lt;p.p.length;i++)          {            c.lineTo(p.p[i].x,p.p[i].y);          }          c.lineWidth = 5;          c.strokeStyle = p.color;          c.fillStyle = p.color;        c.stroke();        c.fill();        c.closePath();      }</code></pre><p>注意点：</p><ol><li>closePath可以解决闭合图形的空隙问题，也有自动闭合的作用。</li><li>当边框或者填充被遮挡掉的时候，这时可以先填充在画边框，或者先画边框再画线</li><li>后绘制的图形会顶替掉前面的图形</li></ol><h2 id="圆"><a href="#圆" class="headerlink" title="圆"></a>圆</h2><p>画圆的函数：</p><p>arc(x,y,r,start,end,true|false)：画圆\弧</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5b21faf60001e79412800720.jpg" alt=""></p><p>arcTo(x1,y1,x2,y2,r)：绘制圆弧</p><p>语法格式：</p><pre class=" language-html"><code class="language-html"> var ctx = document.querySelector(".canvas").getContext("2d");      var i = 0;      setInterval(() => {        i++;        ctx.fillStyle = "yellow";        ctx.strokeStyle = "red";        ctx.beginPath();                               ctx.arc(512, 380, 100, 0, Math.PI * 2 - (Math.PI * 2 * i / 30), true);            //  x    y  半径 开始位置  结束位置                      是否逆时针旋转        ctx.lineWidth = 10;        ctx.stroke();        ctx.fill();      }, 1);//顺时针：Math.PI * 2 * i / 30//逆时针：Math.PI * 2 - (Math.PI * 2 * i / 30)//使用arcTo绘圆角矩形var ctx = document.querySelector("canvas").getContext("2d");      // ctx.translate(200,200)      // ctx.beginPath();      // ctx.moveTo(100,0);      // ctx.arcTo(400,0,400,800,100);      // ctx.lineTo(400,400);      // ctx.arcTo(400,500,350,500,100);      // ctx.lineTo(100,500);      // ctx.arcTo(0,500,0,450,100);      // ctx.lineTo(0,100);      // ctx.arcTo(0,0,100,0,100)      // ctx.closePath();      function RoundRect(ctx, width, height, r)       {        ctx.beginPath();        ctx.moveTo(r, 0);        ctx.arcTo(width, 0, width, height - r, r);        ctx.lineTo(width, height);        ctx.arcTo(width, height + r, width - 50, height + r, r);        ctx.lineTo(r, height + r);        ctx.arcTo(0, height + r, 0, height - 50, r);        ctx.lineTo(0, r);        ctx.arcTo(0, 0, r, 0, r);        ctx.closePath();      }      RoundRect(ctx, 200, 100, 10);      ctx.stroke();</code></pre><h2 id="矩形"><a href="#矩形" class="headerlink" title="矩形"></a>矩形</h2><p>矩形函数：</p><p>reac：绘制矩形附带填充和边框</p><p>fillRect：绘制只填充的矩形</p><p>strokeRect：绘制只带边框的矩形</p><p>语法格式：</p><pre class=" language-html"><code class="language-html">//  参数：  x ， y ， width ， height  var ctx = document.querySelector(".canvas").getContext("2d");      ctx.fillStyle = "red";      ctx.strokeStyle = "yellow";      ctx.lineWidth = 5;      var x = 0;      ctx.beginPath();      ctx.rect(100, 100, 300, 300);      ctx.stroke();      ctx.fill();      ctx.beginPath();      ctx.fillStyle = "rgba(0,255,155,0.5)";      ctx.strokeStyle = "yellow";      ctx.fillRect(150, 150, 300, 300);      ctx.strokeRect(100, 100, 400, 400);</code></pre><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="案例：绘制五角星"><a href="#案例：绘制五角星" class="headerlink" title="案例：绘制五角星"></a>案例：绘制五角星</h2><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>800<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>800<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">      <span class="token keyword">var</span> ctx <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>      ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>          Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">18</span> <span class="token operator">+</span> <span class="token number">72</span> <span class="token operator">*</span> i<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">200</span><span class="token punctuation">,</span>                    <span class="token comment" spellcheck="true">//步骤：先求出角度在转弧度</span>                    <span class="token comment" spellcheck="true">//cos(18deg)*R   sin(18deg)*R</span>                    <span class="token comment" spellcheck="true">//角度转弧度公式：角度/180*r</span>                    <span class="token comment" spellcheck="true">//由于数学中的坐标系与canvas的坐标不同所以y轴要为负</span>          <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">18</span> <span class="token operator">+</span> <span class="token number">72</span> <span class="token operator">*</span> i<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">200</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>          Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">54</span> <span class="token operator">+</span> <span class="token number">72</span> <span class="token operator">*</span> i<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">50</span> <span class="token operator">+</span> <span class="token number">200</span><span class="token punctuation">,</span>          <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">54</span> <span class="token operator">+</span> <span class="token number">72</span> <span class="token operator">*</span> i<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">50</span> <span class="token operator">+</span> <span class="token number">200</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span>         <span class="token comment" spellcheck="true">//五角星封装函数</span>      <span class="token function">DrawStart</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">400</span> <span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">function</span> <span class="token function">DrawStart</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> R<span class="token punctuation">,</span> r<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span>rotate<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment" spellcheck="true">//绘画对象 大圆的半径 小圆半径  x轴 y轴  旋转角度</span>        ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>            Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">18</span> <span class="token operator">+</span> <span class="token number">72</span> <span class="token operator">*</span> i <span class="token operator">-</span>rotate<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI<span class="token punctuation">)</span> <span class="token operator">*</span> R <span class="token operator">+</span> x<span class="token punctuation">,</span>            <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">18</span> <span class="token operator">+</span> <span class="token number">72</span> <span class="token operator">*</span> i <span class="token operator">-</span>rotate<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI<span class="token punctuation">)</span> <span class="token operator">*</span> R <span class="token operator">+</span> y          <span class="token punctuation">)</span><span class="token punctuation">;</span>          ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>            Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">54</span> <span class="token operator">+</span> <span class="token number">72</span> <span class="token operator">*</span> i <span class="token operator">-</span>rotate<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI<span class="token punctuation">)</span> <span class="token operator">*</span> r <span class="token operator">+</span> x<span class="token punctuation">,</span>            <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">54</span> <span class="token operator">+</span> <span class="token number">72</span> <span class="token operator">*</span> i <span class="token operator">-</span>rotate<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI<span class="token punctuation">)</span> <span class="token operator">*</span> r <span class="token operator">+</span> y          <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>参考链接：<a href="">https://www.baidu.com/link?url=3j7UmP9XbkLh0ww6tMOChL_7CATbIoQ15GBatuaJdx2_yCn-jcdshTRF9-l6kMmbONf5cgLEviZEpV4QhjLf2q&amp;wd=&amp;eqid=e9fcd7b0000436fd000000065d2e7488</a></p><h3 id="随机不重复、不切边五角星"><a href="#随机不重复、不切边五角星" class="headerlink" title="随机不重复、不切边五角星"></a>随机不重复、不切边五角星</h3><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;canvas width=&quot;800&quot; height=&quot;800&quot; class=&quot;canvas&quot;&gt;&lt;/canvas&gt;    &lt;script src=&quot;../node/jquery.js&quot;&gt;&lt;/script&gt;    &lt;script&gt;      var ctx = document.querySelector(&quot;canvas&quot;).getContext(&quot;2d&quot;);      ctx.fillStyle = &quot;black&quot;;      ctx.fillRect(        0,        0,        document.querySelector(&quot;canvas&quot;).width,        document.querySelector(&quot;canvas&quot;).height      );      ctx.fillStyle = &quot;#fc1&quot;;      ctx.strokeStyle = &quot;#fb5&quot;;      ctx.lineWidth = 5;      ctx.lineJoin = &quot;round&quot;;      var ele = [];      start(ele);      end(ele);      function start(arr) {        for (var i = 0; i &lt; 200; i++) {          var flag = true,            ran = Math.random() * 10 + 10,            x =              Math.random() *                (document.querySelector(&quot;canvas&quot;).width - ran * 2) +              ran,            y =              Math.random() *                (document.querySelector(&quot;canvas&quot;).height - ran * 2) +              ran,            rotate = Math.random() * 360;          for (var j = 0; j &lt; ele.length; j++) {            var oldx = Math.pow(x - arr[j][1], 2);            var oldy = Math.pow(y - arr[j][2], 2);            var oldr = Math.pow(ran + arr[j][0], 2);            if (oldx + oldy &lt; oldr) {              flag = false;            }          }          flag ? arr.push([ran, x, y, rotate]) : i--;        }      }      function end(arr) {        for (var i = 0; i &lt; arr.length; i++) {          DrawStart(            ctx,            arr[i][0],            arr[i][0] / 2,            arr[i][1],            arr[i][2],            arr[i][3]          );          ctx.fill();          ctx.stroke();        }      }      function DrawStart(context, R, r, x, y, rotate) {        //绘画对象 大圆的半径 小圆半径  x轴 y轴        ctx.beginPath();        for (var i = 0; i &lt; 5; i++) {          ctx.lineTo(            Math.cos(((18 + 72 * i - rotate) / 180) * Math.PI) * R + x,            -Math.sin(((18 + 72 * i - rotate) / 180) * Math.PI) * R + y          );          ctx.lineTo(            Math.cos(((54 + 72 * i - rotate) / 180) * Math.PI) * r + x,            -Math.sin(((54 + 72 * i - rotate) / 180) * Math.PI) * r + y          );        }        ctx.closePath();      }    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="绘画状态保存与还原"><a href="#绘画状态保存与还原" class="headerlink" title="绘画状态保存与还原"></a>绘画状态保存与还原</h2><blockquote><p>状态的保存与还原可以使操作更加简便，快速，主要作用于将绘画的状态来回快速切换，状态保存，可以保存如：线条的样式、颜色、填充、图形变换等，特别是配合图形变换，两者可以互补长短</p></blockquote><p>状态保存和还原的对应函数：</p><p>save：保存当前的状态，以便restore还原</p><p>restore：还原到之前sava保存的状态</p><p>语法格式：</p><pre><code>//这里配合图形变换来演示//图形变换系列的函数，重复使用是叠加效果，而不是替换，所以使用图形变换+状态保存还原可以更快速简便//正常方式  var ctx = document.querySelector(&quot;.canvas&quot;).getContext(&quot;2d&quot;);      ctx.beginPath();      ctx.fillStyle = &quot;red&quot;;      ctx.translate(100, 100);      ctx.fillRect(0, 0, 400, 400);      ctx.translate(-100, -100);      ctx.fillStyle = &quot;red&quot;;      ctx.fillRect(400, 400, 400, 400);      ctx.closePath();      //图形变换函数连续使用会进行叠加效果，会影响到下面绘制的图形，为了不影响，必须再次使用变换函数来还原//这里运用了canvas的状态保存还原后，可以更方便使用变换函数var ctx = document.querySelector(&quot;.canvas&quot;).getContext(&quot;2d&quot;);      ctx.beginPath();      ctx.fillStyle = &quot;red&quot;;      ctx.save();      ctx.translate(100, 100);      ctx.fillRect(0, 0, 400, 400);      ctx.restore();      ctx.fillRect(400, 400, 400, 400);      ctx.closePath();</code></pre><h2 id="图形变换"><a href="#图形变换" class="headerlink" title="图形变换"></a>图形变换</h2><p>图形变换系列函数：</p><p>translate(x,y)：偏移、移动</p><p>rotate(?deg)：旋转</p><p>scale(sx,sy)：缩放</p><p>变换矩阵：</p><p>transform(a,b,c,d,e,f)：图形变换矩阵函数是一个把所有变换效果结于一身的函数，连续使用会造成链集和叠加效果</p><p>setTransform(a,b,c,d,e,f)：可以重置transform函数，使之前的失效</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5ca8747e0001734712800720.jpg" alt=""></p><p>语法格式：</p><pre><code>//改用图形变换函数 translate rotate scale 后的无重复五角星//scale 会有许多副作用如：边框将会变大、长宽比也好增大、x、y也会随之增大&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;canvas width=&quot;800&quot; height=&quot;800&quot; class=&quot;canvas&quot;&gt;&lt;/canvas&gt;    &lt;script src=&quot;../node/jquery.js&quot;&gt;&lt;/script&gt;    &lt;script&gt;      var ctx = document.querySelector(&quot;canvas&quot;).getContext(&quot;2d&quot;);      ctx.fillStyle = &quot;black&quot;;      ctx.fillRect(        0,        0,        document.querySelector(&quot;canvas&quot;).width,        document.querySelector(&quot;canvas&quot;).height      );      ctx.fillStyle = &quot;#fc1&quot;;      ctx.strokeStyle = &quot;#fb5&quot;;      ctx.lineWidth = 5;      ctx.lineJoin = &quot;round&quot;;      var ele = [];      start(ele);      end(ele);      function start(arr) {        for (var i = 0; i &lt; 200; i++) {          var flag = true,            ran = Math.random() * 10 + 10,            x =              Math.random() *                (document.querySelector(&quot;canvas&quot;).width - ran * 2) +              ran,            y =              Math.random() *                (document.querySelector(&quot;canvas&quot;).height - ran * 2) +              ran,            rotate = Math.random() * 360;          for (var j = 0; j &lt; ele.length; j++) {            var oldx = Math.pow(x - arr[j][1], 2);            var oldy = Math.pow(y - arr[j][2], 2);            var oldr = Math.pow(ran + arr[j][0], 2);            if (oldx + oldy &lt; oldr) {              flag = false;            }          }          flag ? arr.push([ran, x, y, rotate]) : i--;        }      }      function end(arr) {        for (var i = 0; i &lt; arr.length; i++) {          ctx.save();          ctx.beginPath();          ctx.translate(arr[i][1], arr[i][2]);          ctx.rotate(arr[i][3]);          ctx.scale(0.5,0.5)          DrawStart(ctx, arr[i][0]);          ctx.fill();          ctx.stroke();          ctx.closePath();          ctx.restore();        }      }      function DrawStart(context, r) {        //绘画对象 大圆的半径 小圆半径  x轴 y轴        for (var i = 0; i &lt;= 5; i++) {          ctx.lineTo(            Math.cos(((18 + 72 * i) / 180) * Math.PI) * r,            -Math.sin(((18 + 72 * i) / 180) * Math.PI) * r          );          ctx.lineTo(            (Math.cos(((54 + 72 * i) / 180) * Math.PI) * r) / 2,            (-Math.sin(((54 + 72 * i) / 180) * Math.PI) * r) / 2          );        }      }    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;//transform var ctx = document.querySelector(&quot;.canvas&quot;).getContext(&quot;2d&quot;);      ctx.beginPath();      ctx.fillStyle = &quot;red&quot;;      ctx.save();      ctx.transform(1.5,0,0,1.5,200,100);                  a：水平缩放 b：水平倾斜 c:垂直倾斜 d:垂直缩放 e:水平位移 f：垂直位移      ctx.fillRect(0, 0, 400, 400);      ctx.restore();      ctx.fillRect(400, 400, 400, 400);      ctx.closePath();</code></pre><h2 id="渐变"><a href="#渐变" class="headerlink" title="渐变"></a>渐变</h2><p>渐变系列函数：</p><p>createLinearGradient（x,y,EndX,EndY）：创建渐变</p><p>addColorStop(0-1,color) ：添加颜色</p><p>createRadialGradient（x1，y1，r1，x2，y2，r2）：创建一个径向的渐变，整个径向渐变发生在俩个圆中间</p><p>语法格式：</p><pre><code>var ctx = document.querySelector(&quot;canvas&quot;).getContext(&quot;2d&quot;);      document.querySelector(&quot;canvas&quot;).width = document.body.clientWidth;      document.querySelector(&quot;canvas&quot;).height = document.body.clientHeight;      //创建渐变对象      var grd = ctx.createLinearGradient(        0,   //x        0,    //y        0,    //endX        document.querySelector(&quot;canvas&quot;).height //endY        //这里的渐变方向是从上往下      );      //下面的是径向渐变，在定义的两个圆之间产生渐变      //第一个圆是外圆，内圆则是第二个      //var grd =             ctx.createRadialGradient(document.querySelector(&quot;canvas&quot;).width/2,document.querySelector(&quot;canvas&quot;).height/2,400,document.querySelector(&quot;canvas&quot;).width/2,document.querySelector(&quot;canvas&quot;).height/2,0)      //添加颜色，取值范围（0,1），必须有起点，终点      grd.addColorStop(0, &quot;black&quot;);      grd.addColorStop(1, &quot;#035&quot;);      //最后把渐变对象添加到要应用的样式填充上      ctx.fillStyle = grd;      ctx.fillRect(        0,        0,        document.querySelector(&quot;canvas&quot;).width,        document.querySelector(&quot;canvas&quot;).height      );</code></pre><h2 id="三角函数讲解"><a href="#三角函数讲解" class="headerlink" title="三角函数讲解"></a>三角函数讲解</h2><p>绘制圆形</p><p>1角度 = 1* Math.PI/ 180弧度</p><p>1弧度 = 1* 180 / Math.PI 角度</p><p>arc(x,y,r,0,360,false) </p><p>x,y  圆心坐标位置</p><p> r 圆半径 </p><p>0,360 </p><p>从0度到360度所对应的弧度 (弧度: 角度值*Math.PI/180)      true/false 逆时针/顺时针绘图</p><h2 id="添加图片、视频、canvas"><a href="#添加图片、视频、canvas" class="headerlink" title="添加图片、视频、canvas"></a>添加图片、视频、canvas</h2><p>相关函数：</p><p>createPattern(ele，repeat|repeat-x|repeat-y|no-repeat)：添加图片、视频、画布到指定的场景</p><p>语法格式：</p><pre><code>//添加图片 var ctx = document.querySelector(&quot;canvas&quot;).getContext(&quot;2d&quot;);      var img = new Image();      img.src = &quot;../newIMg.png&quot;;      img.onload = () =&gt; {        var createImg = ctx.createPattern(img, &quot;repeat&quot;);        ctx.fillStyle = createImg;        ctx.fillRect(0, 0, 800, 800);      }; //添加图片时注意：必须图片加载完后在载入createPattern，否则载入失败 //添加画布 function createImgCanvas() {        var c = document.createElement(&quot;canvas&quot;);        var ctx = c.getContext(&quot;2d&quot;);        c.width = 400;        c.height = 400;        ctx.fillStyle = &quot;yellow&quot;;        ctx.transform(1, 0, 0, 1, c.width / 2, c.height / 2);        DrawStart(ctx, 200);        ctx.fill();        return c;      }      var ctx = document.querySelector(&quot;canvas&quot;).getContext(&quot;2d&quot;);      document.querySelector(&quot;canvas&quot;).width = 1400;      document.querySelector(&quot;canvas&quot;).height = 1400;      ctx.fillStyle = ctx.createPattern(createImgCanvas(), &quot;repeat&quot;);      ctx.fillRect(0, 0, 1400, 1400);</code></pre><h2 id="案例：绘制圆角矩形"><a href="#案例：绘制圆角矩形" class="headerlink" title="案例：绘制圆角矩形"></a>案例：绘制圆角矩形</h2><pre><code>      /*          把圆分为4份，顺时针顺序绘制           Math.PI / 2 半圆分1为2          Math.PI 一个圆中的一半          Math.PI*3/2 || Math.PI*1.5  1个半圆加一个1分为2的半圆          Math.PI*2 完整的圆       */var ctx = document.querySelector(&quot;canvas&quot;).getContext(&quot;2d&quot;);      ctx.beginPath();      ctx.arc(400 - 50, 400 - 50, 50, 0, Math.PI / 2);      ctx.lineTo(50, 400);      ctx.arc(50, 400 - 50, 50, Math.PI / 2, Math.PI);      ctx.lineTo(0, 50);      ctx.arc(50, 50, 50, Math.PI, (Math.PI * 3) / 2);      ctx.lineTo(400 - 50, 0);      ctx.arc(400 - 50, 50, 50, (Math.PI * 3) / 2, Math.PI * 2);      ctx.closePath();      ctx.stroke();  //封装函数  function PathRoundRect(ctx, width, height, r)       {        ctx.beginPath();        ctx.arc(width - r, height - r, r, 0, Math.PI / 2);        ctx.lineTo(r, height);        ctx.arc(r, height - r, r, Math.PI / 2, Math.PI);        ctx.lineTo(0, r);        ctx.arc(r, r, r, Math.PI, Math.PI * 1.5);        ctx.lineTo(width - r, 0);        ctx.arc(width - r, r, r, (Math.PI * 3) / 2, Math.PI * 2);        ctx.closePath();      }  //升级版  function PathRoundRect(ctx, width, height, r,optionColor,optionStyle)      {        if(r*2&gt;width||r*2&gt;height)return;        if(optionStyle)        {        optionStyle.stroke === true ? (optionColor.stroke ? (ctx.strokeStyle =optionColor.stroke ):null) : null;        optionStyle.fill === true ?(optionColor.fill ? (ctx.fillStyle =optionColor.fill):null) : null;        }        ctx.beginPath();        ctx.arc(width - r, height - r, r, 0, Math.PI / 2);        ctx.lineTo(r, height);        ctx.arc(r, height - r, r, Math.PI / 2, Math.PI);        ctx.lineTo(0, r);        ctx.arc(r, r, r, Math.PI, Math.PI * 1.5);        ctx.lineTo(width - r, 0);        ctx.arc(width - r, r, r, (Math.PI * 3) / 2, Math.PI * 2);        ctx.closePath();      }   //最终版    function RoundRect(ctx, width, height, r, optionColor, optionStyle) {        var flagfill,flagstroke;        if (r*2 &gt; width || r*2 &gt; height) return;        if (optionStyle) {          optionStyle.stroke === true            ? optionColor.stroke              ? (ctx.strokeStyle = optionColor.stroke)              : null            : null;          optionStyle.fill === true            ? optionColor.fill              ? (ctx.fillStyle = optionColor.fill)              : null            : null;          flagfill = optionColor.fill ?true:false;          flagstroke = optionColor.stroke ?true:false;        }        ctx.beginPath();        ctx.arc(width - r, height - r, r, 0, Math.PI / 2);        ctx.lineTo(r, height);        ctx.arc(r, height - r, r, Math.PI / 2, Math.PI);        ctx.lineTo(0, r);        ctx.arc(r, r, r, Math.PI, Math.PI * 1.5);        ctx.lineTo(width - r, 0);        ctx.arc(width - r, r, r, (Math.PI * 3) / 2, Math.PI * 2);        ctx.closePath();        flagstroke ? ctx.stroke() : null;        flagfill ? ctx.fill() : null;      }</code></pre><h2 id="案例：2048九宫格"><a href="#案例：2048九宫格" class="headerlink" title="案例：2048九宫格"></a>案例：2048九宫格</h2><pre><code> var ctx = document.querySelector(&quot;canvas&quot;).getContext(&quot;2d&quot;);      ctx.translate(800/4,800/4)      RoundRect(        ctx,        480,        470,        10,        { fill: &quot;red&quot;, stroke: &quot;green&quot; },        { fill: true, stroke: true }      );      for (var i = 0; i &lt; 4; i++) {        ctx.save();        ctx.translate(10, i * 15);        for (var j = 0; j &lt; 4; j++) {          ctx.save();          ctx.translate(j * 120, i * 100 +15);          RoundRect(            ctx,            100,            100,            10,            { fill: &quot;green&quot;, stroke: &quot;green&quot; },            { fill: true, stroke: true }          );          ctx.restore();        }        ctx.restore();      }      function RoundRect(ctx, width, height, r, optionColor, optionStyle) {        var flagfill, flagstroke;        if (r &gt; width || r &gt; height) return;        if (optionStyle) {          optionStyle.stroke === true            ? optionColor.stroke              ? (ctx.strokeStyle = optionColor.stroke)              : null            : null;          optionStyle.fill === true            ? optionColor.fill              ? (ctx.fillStyle = optionColor.fill)              : null            : null;          flagfill = optionColor.fill ? true : false;          flagstroke = optionColor.stroke ? true : false;        }        ctx.beginPath();        ctx.arc(width - r, height - r, r, 0, Math.PI / 2);        ctx.lineTo(r, height);        ctx.arc(r, height - r, r, Math.PI / 2, Math.PI);        ctx.lineTo(0, r);        ctx.arc(r, r, r, Math.PI, Math.PI * 1.5);        ctx.lineTo(width - r, 0);        ctx.arc(width - r, r, r, (Math.PI * 3) / 2, Math.PI * 2);        ctx.closePath();        flagstroke ? ctx.stroke() : null;        flagfill ? ctx.fill() : null;      }</code></pre><h2 id="案例：绘制弯月"><a href="#案例：绘制弯月" class="headerlink" title="案例：绘制弯月"></a>案例：绘制弯月</h2><pre><code> pathMoon(ctx, 2, 300, 300, 200);      function pathMoon(ctx, d, x, y, r, deg, color) {        ctx.save();        ctx.translate(x, y);        ctx.scale(r, r);        ctx.rotate(deg || 0);        ctx.beginPath();        Moon(d, ctx);        ctx.fillStyle = color ? color : &quot;yellow&quot;;        ctx.fill();        ctx.closePath();        ctx.restore();        function Moon(d, ctx) {          ctx.arc(0, 0, 1, Math.PI * 0.5, Math.PI * 1.5, true);          ctx.moveTo(0, -1);          ctx.arcTo(d, 0, 0, 1, dis(0, -1, d, 0) / d);        }        function dis(x1, y1, x2, y2) {          return Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));        }      }</code></pre><h2 id="贝塞尔曲线"><a href="#贝塞尔曲线" class="headerlink" title="贝塞尔曲线"></a>贝塞尔曲线</h2><p>贝塞尔曲线相关函数：</p><p>quadraticCurveTo(x1,y1,x2,y2)：二次贝塞尔曲线  一个控制点 1</p><p>bezierCurveTo(x1,y1,x2,y2,x3,y3)：三次贝塞尔曲线  两个控制点 1 2</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5d08c7450001a8de12800720.jpg" alt=""></p><pre><code>//起始点不由函数来定，可以用moveTo等画路径的函数来定//二次贝塞尔曲线        ctx.moveTo(0, 0);          ctx.quadraticCurveTo(800,400,400,800)          ctx.stroke()&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;    &lt;style&gt;      html,      body {        width: 100%;        height: 100%;      }    &lt;/style&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;canvas class=&quot;canvas&quot;&gt;&lt;/canvas&gt;    &lt;script src=&quot;../node/jquery.js&quot;&gt;&lt;/script&gt;    &lt;script&gt;      var ctx = document.querySelector(&quot;canvas&quot;).getContext(&quot;2d&quot;);      document.querySelector(&quot;canvas&quot;).width = document.body.clientWidth;      document.querySelector(&quot;canvas&quot;).height = document.body.clientHeight;        ctx.save();        var grd = ctx.createLinearGradient(0,0,0,document.querySelector(&quot;canvas&quot;).height);        grd.addColorStop(0,&quot;black&quot;);        grd.addColorStop(1,&quot;#035&quot;);        ctx.fillStyle = grd;        ctx.fillRect(0,0,document.querySelector(&quot;canvas&quot;).width,document.querySelector(&quot;canvas&quot;).height);        ctx.restore();      ctx.fillStyle = &quot;#fc1&quot;;      ctx.strokeStyle = &quot;#fb5&quot;;      ctx.lineWidth = 5;      ctx.lineJoin = &quot;round&quot;;      var ele = [];      start(ele,200);      end(ele);      pathMoon(ctx, 2, document.querySelector(&quot;canvas&quot;).width*0.85, document.querySelector(&quot;canvas&quot;).height/4,80,0,&quot;#fc1&quot;);      RectLoda(ctx);      function RectLoda(ctx)      {        ctx.save();        ctx.beginPath();        ctx.moveTo(0,document.querySelector(&quot;canvas&quot;).height*0.65);//三次贝塞尔曲线应用       ctx.bezierCurveTo(document.querySelector(&quot;canvas&quot;).width/2,650,document.querySelector(&quot;canvas&quot;).width/2,document.querySelector(&quot;canvas&quot;).height/3,document.querySelector(&quot;canvas&quot;).width,document.querySelector(&quot;canvas&quot;).height-200);        ctx.lineTo(document.querySelector(&quot;canvas&quot;).width,document.querySelector(&quot;canvas&quot;).height)        ctx.lineTo(0,document.querySelector(&quot;canvas&quot;).height)       var bgcolor = ctx.createLinearGradient(0,document.querySelector(&quot;canvas&quot;).height,0,0);        bgcolor.addColorStop(0,&quot;#030&quot;);        bgcolor.addColorStop(1,&quot;#580&quot;);        ctx.fillStyle = bgcolor;        ctx.fill();        ctx.closePath();        ctx.restore();      }      function pathMoon(ctx, d, x, y, r, deg, color) {        ctx.save();        ctx.translate(x, y);        ctx.scale(r, r);        ctx.rotate(deg || 0);        ctx.beginPath();        Moon(d, ctx);        ctx.fillStyle = color ? color : &quot;yellow&quot;;        ctx.fill();        ctx.closePath();        ctx.restore();        function Moon(d, ctx) {          ctx.arc(0, 0, 1, Math.PI * 0.5, Math.PI * 1.5, true);          ctx.moveTo(0, -1);          ctx.arcTo(d, 0, 0, 1, dis(0, -1, d, 0) / d);        }        function dis(x1, y1, x2, y2) {          return Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));        }      }      function start(arr,num) {        for (var i = 0; i &lt; num; i++) {          var flag = true,            ran = Math.random() * 10 + 5,            x =              Math.random() *                (document.querySelector(&quot;canvas&quot;).width - ran * 2) +              ran,            y =              (Math.random() *                (document.querySelector(&quot;canvas&quot;).height - ran * 2) +                ran) *              0.65,            rotate = Math.random() * 360;          for (var j = 0; j &lt; ele.length; j++) {            var oldx = Math.pow(x - arr[j][1], 2);            var oldy = Math.pow(y - arr[j][2], 2);            var oldr = Math.pow(ran + arr[j][0], 2);            if (oldx + oldy &lt; oldr) {              flag = false;            }            if(x&gt;document.querySelector(&quot;canvas&quot;).width*0.85&amp;&amp;x&lt;document.querySelector(&quot;canvas&quot;).width*0.85+80*1.15)            {              flag = false;            }          }          flag ? arr.push([ran, x, y, rotate]) : i--;        }      }      function end(arr) {        for (var i = 0; i &lt; arr.length; i++) {          ctx.save();          ctx.beginPath();          ctx.translate(arr[i][1], arr[i][2]);          ctx.rotate(arr[i][3]);          ctx.scale(0.7, 0.7);          DrawStart(ctx, arr[i][0]);          ctx.fill();          ctx.stroke();          ctx.closePath();          ctx.restore();        }      }      function DrawStart(ctx, r) {        //绘画对象 大圆的半径 小圆半径  x轴 y轴        for (var i = 0; i &lt;= 5; i++) {          ctx.lineTo(            Math.cos(((18 + 72 * i) / 180) * Math.PI) * r,            -Math.sin(((18 + 72 * i) / 180) * Math.PI) * r          );          ctx.lineTo(            (Math.cos(((54 + 72 * i) / 180) * Math.PI) * r) / 2,            (-Math.sin(((54 + 72 * i) / 180) * Math.PI) * r) / 2          );        }      }    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h2><p>字体绘制相关函数：</p><p>font：设置字体样式属性  五个参数依次是font-style(italic oblique)、font-variant(small-caps)、font-weight(bold lighter bolder)、font-size、font-family</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5d08d16c0001026b12800720.jpg" alt=""></p><p>fillText(string,x,y,length)：绘制带填充字体</p><p>strokeText(string,x,y,length)：绘制带边框的字体</p><p>textAlign：设置字体水平对齐 参数有：right    center   left</p><p>textBaseline：设置字体垂直对齐 参数有：top   middle bottom  alphabetic(defalut)  ideographic  hanging</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5d08fdb00001fe6512800720.jpg" alt=""></p><p>measureText(String).width：获取文本宽度（会根据font设置的字体、字号来决定）</p><p>语法格式：</p><pre><code> var ctx = document.querySelector(&quot;.canvas&quot;).getContext(&quot;2d&quot;);    var grd = ctx.createLinearGradient(0,0,800,0);    grd.addColorStop(0,&quot;red&quot;);    grd.addColorStop(0.5,&quot;yellow&quot;);    grd.addColorStop(1,&quot;green&quot;);    ctx.fillStyle = grd;    ctx.font = &quot;bold 40px 微软雅黑 &quot;;    ctx.fillText(&quot;How are you!&quot;,100,100,300);    //字体可以填充渐变色、图形纹理、另一个画布  ===================================================================  //只带边框的字体   var ctx = document.querySelector(&quot;.canvas&quot;).getContext(&quot;2d&quot;);    var grd = ctx.createLinearGradient(0,0,800,0);    grd.addColorStop(0,&quot;red&quot;);    grd.addColorStop(0.5,&quot;yellow&quot;);    grd.addColorStop(1,&quot;green&quot;);    ctx.lineWidth =2;    ctx.strokeStyle = grd;    ctx.font = &quot;bold 40px 微软雅黑 &quot;;    ctx.strokeText(&quot;How are you!&quot;,100,100,300);    ===============================================   //带纹理的字体    var ctx = document.querySelector(&quot;.canvas&quot;).getContext(&quot;2d&quot;);      // var grd = ctx.createLinearGradient(0,0,800,0);      // grd.addColorStop(0,&quot;red&quot;);      // grd.addColorStop(0.5,&quot;yellow&quot;);      // grd.addColorStop(1,&quot;green&quot;);      var img = new Image();      img.src = &quot;../newIMg.png&quot;;      img.onload = function() {        var pattern = ctx.createPattern(img, &quot;repeat&quot;);        ctx.fillStyle = pattern;        ctx.strokeStyle = &quot;red&quot;;        ctx.lineWidth =1;        ctx.font = &quot;bold 40px 微软雅黑 &quot;;        ctx.strokeText(&quot;How are you!&quot;, 100, 100, 300);        ctx.fillText(&quot;How are you!&quot;, 100, 100, 300);      };</code></pre><p>水平对齐效果：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/59f31bf70001286f12800720.jpg" alt=""></p><p>垂直对齐效果：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/59992ffd0001f1dd12800720.jpg" alt=""></p><h2 id="案例：水平垂直居中"><a href="#案例：水平垂直居中" class="headerlink" title="案例：水平垂直居中"></a>案例：水平垂直居中</h2><pre><code> var ctx = document.querySelector(&quot;.canvas&quot;).getContext(&quot;2d&quot;);      ctx.fillStyle = &quot;red&quot;;      ctx.strokeStyle = &quot;red&quot;;      ctx.moveTo(400, 0);      ctx.lineTo(400, 800);      ctx.moveTo(0, 400);      ctx.lineTo(800, 400);      ctx.stroke();      ctx.textAlign = &quot;center&quot;;      ctx.textBaseline = &quot;middle&quot;;      ctx.font = &quot;bold 100px 微软雅黑 &quot;;      ctx.strokeText(&quot;How are you!&quot;, 400, 400);</code></pre><h2 id="阴影"><a href="#阴影" class="headerlink" title="阴影"></a>阴影</h2><p>阴影相关属性：</p><p>shadowColor：设置阴影颜色</p><p>shadowOffsetX：设置阴影X偏移</p><p>shadowOffsetY：设置阴影Y偏移</p><p>shadowBlur：设置阴影模糊扩散程度</p><p>语法格式：</p><pre><code>  var ctx = document.querySelector(&quot;canvas&quot;).getContext(&quot;2d&quot;);      ctx.shadowColor = &quot;black&quot;;     ctx.fillStyle = &quot;red&quot;      var num = 0;      var flag = true;      setInterval(function() {        ctx.shadowOffsetX = -20+num;      ctx.shadowOffsetY = -20+num;        num == 100 ? (flag = false) : num == 0 ? (flag = true) : null;        flag ? num++ : num--;        ctx.shadowBlur = num;        ctx.clearRect(0, 0, 800, 800);        ctx.fillRect(100, 100, 400, 400);      }, 50);</code></pre><h2 id="透明"><a href="#透明" class="headerlink" title="透明"></a>透明</h2><p>透明相关函数：</p><p>在canvas中要实现透明，可以使用rgba颜色，也可以使用以下方法</p><p>globalAlpha：设置透明度   范围（1-0） 全局透明</p><p>语法格式：</p><pre><code>  var ctx = document.querySelector(&quot;canvas&quot;).getContext(&quot;2d&quot;);      var color = [&quot;red&quot;,&quot;green&quot;,&quot;yellow&quot;,&quot;blue&quot;,&quot;black&quot;]     for(var i=0;i&lt;200;i++)     {       var randomX = Math.random()*800;       var randomY = Math.random()*800;       var randomR = Math.random()*30;      var R = Math.floor(Math.random()*255),G = Math.floor(Math.random()*255),B = Math.floor(Math.random()*255);       ctx.save();       ctx.beginPath();       ctx.globalAlpha = 0.7;       ctx.fillStyle = `rgb(${R},${G},${B})`;       ctx.arc(randomX,randomY,randomR,0,Math.PI*2);       ctx.fill();       ctx.closePath();       ctx.restore();     }</code></pre><h2 id="遮盖顺序"><a href="#遮盖顺序" class="headerlink" title="遮盖顺序"></a>遮盖顺序</h2><blockquote><p>xx.globalCompositeOperation = “source-over” (默认，后绘制的图形会压在先绘制的图形上) / “destination-over”(先绘制的图形压在后绘制的图形上)</p></blockquote><p>相关属性：</p><p>globalCompositeOperation ：改变元素显示效果与遮盖顺序</p><p>各个参数的实现效果可以参考菜鸟，或有canvas手册的网址，或以下链接</p><p><a href="">https://blog.csdn.net/fe_dev/article/details/81985367</a></p><p>此链接，有水滴扩散、刮刮卡案例参考</p><p>参数：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/59f24de30001e3ab12800720.jpg" alt=""></p><p>语法格式：</p><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;    &lt;style&gt;      html,      body {        width: 100%;        height: 100%;      }    &lt;/style&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;canvas class=&quot;canvas&quot; width=&quot;800&quot; height=&quot;800&quot;&gt;&lt;/canvas&gt;    &lt;script src=&quot;../node/jquery.js&quot;&gt;&lt;/script&gt;    &lt;script&gt;      var ctx = document.querySelector(&quot;canvas&quot;).getContext(&quot;2d&quot;);      var color = [&quot;red&quot;,&quot;green&quot;,&quot;yellow&quot;,&quot;blue&quot;,&quot;black&quot;]      var Balls = [];     for(var i=0;i&lt;200;i++)     {      var randomR = Math.random()*30+10;       var randomX = Math.random()*(800-randomR*2)+randomR;       var randomY = Math.random()*(800-randomR*2)+randomR;      var R = Math.floor(Math.random()*255),G = Math.floor(Math.random()*255),B = Math.floor(Math.random()*255);        let balls ={          x:randomX,          y:randomY,          r:randomR,          color:`rgb(${R},${G},${B})`,          vx:(Math.random()*5+5)*(Math.pow(-1,Math.floor(Math.random()*100))),          vy:(Math.random()*5+5)*(Math.pow(-1,Math.floor(Math.random()*100))),        }      Balls.push(balls);     }     setInterval(()=&gt;{       draw(ctx)     },50)     function draw(ctx)     {       ctx.clearRect(0,0,800,800)       for(let i=0;i&lt;Balls.length;i++)       {       ctx.save();       ctx.beginPath();      ctx.globalCompositeOperation = &quot;xor&quot;;       ctx.fillStyle = Balls[i].color;       ctx.arc(Balls[i].x,Balls[i].y,Balls[i].r,0,Math.PI*2);       ctx.fill();       ctx.closePath();       ctx.restore();       Balls[i].x+=Balls[i].vx;       Balls[i].y+=Balls[i].vy;       if(Balls[i].x-Balls[i].r&lt;=0)       {         Balls[i].vx = -Balls[i].vx;          Balls[i].x = Balls[i].r;       }       if(Balls[i].x+Balls[i].r &gt;= 800)       {         Balls[i].vx = -Balls[i].vx;         Balls[i].x = 800-Balls[i].r;       }       if(Balls[i].y-Balls[i].r&lt;=0)       {         Balls[i].vy = -Balls[i].vy;         Balls[i].y = Balls[i].r;       }       if(Balls[i].y+Balls[i].r&gt;=800)       {         Balls[i].vy = -Balls[i].vy;         Balls[i].y = 800-Balls[i].r;       }       }     }    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="剪切"><a href="#剪切" class="headerlink" title="剪切"></a>剪切</h2><p>相关函数：</p><p>clip：相对于上个填充路径做剪切效果</p><p>语法格式：</p><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;    &lt;style&gt;      html,      body {        width: 100%;        height: 100%;      }    &lt;/style&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;canvas class=&quot;canvas&quot; width=&quot;800&quot; height=&quot;800&quot;&gt;&lt;/canvas&gt;    &lt;script src=&quot;../node/jquery.js&quot;&gt;&lt;/script&gt;    &lt;script&gt;      var ctx = document.querySelector(&quot;canvas&quot;).getContext(&quot;2d&quot;);      var r = 150;      ctx.fillStyle = &quot;black&quot;;      ctx.fillRect(0, 0, 800, 800);      ctx.canvas.onmousemove = e =&gt; {        ctx.clearRect(0, 0, 800, 800);        ctx.beginPath();        ctx.fillStyle = &quot;black&quot;;        ctx.fillRect(0, 0, 800, 800);        ctx.closePath();        ctx.save();        ctx.beginPath();        ctx.fillStyle = &quot;rgba(255,255,255,1)&quot;;        var x = e.pageX - r &lt;= 0 ? r : e.pageX;        var y = e.pageY - r &lt;= 0 ? r : e.pageY;        x = e.pageX + r &gt; 800 ? 800 - r : x;        y = e.pageY + r &gt; 800 ? 800 - r : y;        ctx.arc(x, y, r, 0, Math.PI * 2);        ctx.fill();        ctx.clip();        ctx.closePath();        ctx.beginPath();        ctx.fillStyle = &quot;red&quot;;        ctx.font = &quot;200px bold 微软雅黑&quot;;        ctx.textAlign = &quot;center&quot;;        ctx.textBaseline = &quot;middle&quot;;        ctx.fillText(&quot;Canvas&quot;, 400, 400);        ctx.closePath();        ctx.restore();        document.onkeyup = ev =&gt; {          ev.keyCode === 38 ? (r += 20) : null;          ev.keyCode === 40 ? (r -= 20) : null;          if (r &gt;= 390) r = 390;          ctx.canvas.onmousemove(e);          return false;        };      };      ctx.canvas.onmouseout = () =&gt; {        ctx.fillStyle = &quot;black&quot;;        ctx.fillRect(0, 0, 800, 800);        document.onkeyup = null;      };    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="实现剪纸效果"><a href="#实现剪纸效果" class="headerlink" title="实现剪纸效果"></a>实现剪纸效果</h2><blockquote><p>剪纸效果参考非零环绕原侧，自动识别里、外、面，一个面不同时出现顺时针和逆时针就填充，如果同时出现顺时针和逆时针就不填充，这也就说明了图形的绘制方向，会影响其是否填充</p></blockquote><p>语法格式：</p><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;    &lt;style&gt;      html,      body {        width: 100%;        height: 100%;      }    &lt;/style&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;canvas class=&quot;canvas&quot; width=&quot;800&quot; height=&quot;800&quot;&gt;&lt;/canvas&gt;    &lt;script src=&quot;../node/jquery.js&quot;&gt;&lt;/script&gt;    &lt;script&gt;      var ctx = document.querySelector(&quot;canvas&quot;).getContext(&quot;2d&quot;);      ctx.beginPath();      ctx.rect(200, 200, 400, 200);      drawRect(ctx, 220, 220, 100, 100);      ctx.arc(400, 270, 50, Math.PI * 2, 0, true);      Triangle(ctx, 510, 220, 460, 320, 560, 320);      ctx.closePath();      ctx.fillStyle = &quot;red&quot;;      ctx.shadowColor = &quot;black&quot;;      ctx.shadowOffsetX = 10;      ctx.shadowOffsetY = 10;      ctx.fill();      function drawRect(ctx, x, y, w, h) {        ctx.moveTo(x, y);        ctx.lineTo(x, y + h);        ctx.lineTo(x + w, y + h);        ctx.lineTo(x + w, y);        ctx.lineTo(x, y);      }      function Triangle(ctx, x1, y1, x2, y2, x3, y3) {        ctx.moveTo(x1, y1);        ctx.lineTo(x2, y2);        ctx.lineTo(x3, y3);        ctx.lineTo(x1, y1);      }    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="交互"><a href="#交互" class="headerlink" title="交互"></a>交互</h2><p>canvas交互相关函数：</p><p>isPointInPath(x,y)：检测指定的坐标是否在绘制元素内，<strong>只能判断最后一个绘制的封闭路径</strong></p><p>语法格式：</p><pre><code>//点击填充颜色&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;    &lt;style&gt;      * {        padding: 0;        margin: 0;      }      html,      body {        width: 100%;        height: 100%;      }    &lt;/style&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;canvas class=&quot;canvas&quot; width=&quot;800&quot; height=&quot;800&quot;&gt;&lt;/canvas&gt;    &lt;script src=&quot;../node/jquery.js&quot;&gt;&lt;/script&gt;    &lt;script&gt;      var ctx = document.querySelector(&quot;canvas&quot;).getContext(&quot;2d&quot;);      var Balls = [];      for (var i = 0; i &lt; 10; i++) {        ctx.beginPath();        Balls.push({          x: Math.random() * 800,          y: Math.random() * 800,          r: Math.random() * 100        });      }      Draw(ctx);      function Draw(ctx) {        for (let i = 0; i &lt; Balls.length; i++) {          ctx.beginPath();          ctx.arc(Balls[i].x, Balls[i].y, Balls[i].r, 0, Math.PI * 2);          ctx.stroke();        }        ctx.canvas.addEventListener(&quot;click&quot;, function(event) {          for (let i = 0; i &lt; Balls.length; i++) {            ctx.beginPath();            ctx.arc(Balls[i].x, Balls[i].y, Balls[i].r, 0, Math.PI * 2);            if (ctx.isPointInPath(event.pageX, event.pageY)) {              ctx.fillStyle = &quot;yellow&quot;;              ctx.fill();            }          }        });      }    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;//鼠标滑入填充颜色，滑出清空颜色&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;    &lt;style&gt;      * {        padding: 0;        margin: 0;      }      html,      body {        width: 100%;        height: 100%;      }    &lt;/style&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;canvas class=&quot;canvas&quot; width=&quot;800&quot; height=&quot;800&quot;&gt;&lt;/canvas&gt;    &lt;script src=&quot;../node/jquery.js&quot;&gt;&lt;/script&gt;    &lt;script&gt;      var ctx = document.querySelector(&quot;canvas&quot;).getContext(&quot;2d&quot;);      var Balls = [];      for (var i = 0; i &lt; 10; i++) {        ctx.beginPath();        Balls.push({          x: Math.random() * 800,          y: Math.random() * 800,          r: Math.random() * 100        });      }      Draw(ctx);      function Draw(ctx) {        for (let i = 0; i &lt; Balls.length; i++) {          ctx.beginPath();          ctx.arc(Balls[i].x, Balls[i].y, Balls[i].r, 0, Math.PI * 2);          ctx.stroke();        }        ctx.canvas.addEventListener(&quot;mousemove&quot;, function(event) {          ctx.clearRect(0, 0, 800, 800);          for (let i = 0; i &lt; Balls.length; i++) {            ctx.beginPath();            ctx.arc(Balls[i].x, Balls[i].y, Balls[i].r, 0, Math.PI * 2);            if (ctx.isPointInPath(event.pageX, event.pageY)) {              ctx.fillStyle =                &quot;rgb(&quot; +                Math.random() * 255 +                &quot;,&quot; +                Math.random() * 255 +                &quot;,&quot; +                Math.random() * 255 +                &quot;)&quot;;              ctx.fill();            } else ctx.stroke();          }        });      }    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="案例：小球滚动（面向对象-控制面板）"><a href="#案例：小球滚动（面向对象-控制面板）" class="headerlink" title="案例：小球滚动（面向对象+控制面板）"></a>案例：小球滚动（面向对象+控制面板）</h2><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;    &lt;style&gt;      html,      body {        width: 100%;        height: 100%;      }      .canvasBox {        width: 800px;        height: 800px;        position: relative;      }      .canvasBox &gt; .SetupPanel {        width: 300px;        height: 200px;        background: #99b4e487;        border-radius: 30px;        position: absolute;        left: 0;        top: 0;        color: white;      }      .canvasBox &gt; .SetupPanel &gt; h1 {        text-align: center;        line-height: 25px;      }      .canvasBox &gt; .SetupPanel &gt; a {        float: left;        color: #478aff87;        background: #e5eeff;        border-radius: 5px;        padding: 10px 0;        margin: 3px 0;        text-decoration: none;        text-align: center;        line-height: 15px;        width: 100%;      }    &lt;/style&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;div class=&quot;canvasBox&quot;&gt;      &lt;canvas class=&quot;canvas&quot; width=&quot;800&quot; height=&quot;800&quot;&gt;&lt;/canvas&gt;      &lt;div class=&quot;SetupPanel&quot;&gt;        &lt;h1&gt;控制面板&lt;/h1&gt;        &lt;a href=&quot;javascript:void(0)&quot;&gt;点击停止&lt;/a&gt;        &lt;a href=&quot;javascript:void(0)&quot;&gt;点击切换背景颜色&lt;/a&gt;        &lt;a href=&quot;javascript:void(0)&quot;&gt;点击切换覆盖模式&lt;/a&gt;      &lt;/div&gt;    &lt;/div&gt;    &lt;script src=&quot;../node/jquery.js&quot;&gt;&lt;/script&gt;    &lt;script&gt;      class Animate {        constructor(canvas) {          this.canvas = document.querySelector(canvas);          this.ctx = this.canvas.getContext(&quot;2d&quot;);          this.initAttr();          this.initDraw();          this.initEvent();        }        initAttr() {          this.color = [&quot;red&quot;, &quot;green&quot;, &quot;yellow&quot;, &quot;blue&quot;, &quot;black&quot;];          this.bgcolor = null;          this.Balls = [];          this.flag = true;          this.module = [&quot;xor&quot;, &quot;lighter&quot;, null];          this.option = null;          this.time = null;        }        initEvent() {          document.querySelectorAll(            &quot;.canvasBox&gt;.SetupPanel&gt;a&quot;          )[0].onclick = () =&gt; {            if (this.flag) {              clearInterval(this.time);              this.flag = false;              document.querySelectorAll(                &quot;.canvasBox&gt;.SetupPanel&gt;a&quot;              )[0].innerHTML = &quot;点击开始&quot;;              document.querySelectorAll(                &quot;.canvasBox&gt;.SetupPanel&gt;a&quot;              )[0].style.background = &quot;red&quot;;            } else {              this.time = setInterval(() =&gt; {                this.draw(this.bgcolor);              }, 50);              this.flag = true;              document.querySelectorAll(                &quot;.canvasBox&gt;.SetupPanel&gt;a&quot;              )[0].innerHTML = &quot;点击停止&quot;;              document.querySelectorAll(                &quot;.canvasBox&gt;.SetupPanel&gt;a&quot;              )[0].style.background = &quot;&quot;;            }          };          document.querySelectorAll(            &quot;.canvasBox&gt;.SetupPanel&gt;a&quot;          )[1].onclick = () =&gt; {            this.bgcolor = this.color[              parseInt(Math.random() * this.color.length - 1)            ];          };          document.querySelectorAll(            &quot;.canvasBox&gt;.SetupPanel&gt;a&quot;          )[2].onclick = () =&gt; {            this.option = this.module[              Math.ceil(Math.random() * this.module.length - 1)            ];          };        }        initDraw() {          for (let i = 0; i &lt; 200; i++) {            let randomR = Math.random() * 30 + 10;            let randomX = Math.random() * (800 - randomR * 2) + randomR;            let randomY = Math.random() * (800 - randomR * 2) + randomR;            let R = Math.floor(Math.random() * 255),              G = Math.floor(Math.random() * 255),              B = Math.floor(Math.random() * 255);            let balls = {              x: randomX,              y: randomY,              r: randomR,              color: `rgb(${R},${G},${B})`,              vx:                (Math.random() * 5 + 5) *                Math.pow(-1, Math.floor(Math.random() * 100)),              vy:                (Math.random() * 5 + 5) *                Math.pow(-1, Math.floor(Math.random() * 100))            };            this.Balls.push(balls);          }        }        draw(bgcolor) {          this.ctx.clearRect(0, 0, 800, 800);          this.bgDraw(bgcolor);          for (let i = 0; i &lt; this.Balls.length; i++) {            this.ctx.save();            this.ctx.beginPath();            this.ctx.globalCompositeOperation = this.option;            this.ctx.fillStyle = this.Balls[i].color;            this.ctx.arc(              this.Balls[i].x,              this.Balls[i].y,              this.Balls[i].r,              0,              Math.PI * 2            );            this.ctx.fill();            this.ctx.closePath();            this.ctx.restore();            this.Balls[i].x += this.Balls[i].vx;            this.Balls[i].y += this.Balls[i].vy;            if (this.Balls[i].x - this.Balls[i].r &lt;= 0) {              this.Balls[i].vx = -this.Balls[i].vx;              this.Balls[i].x = this.Balls[i].r;            }            if (this.Balls[i].x + this.Balls[i].r &gt;= 800) {              this.Balls[i].vx = -this.Balls[i].vx;              this.Balls[i].x = 800 - this.Balls[i].r;            }            if (this.Balls[i].y - this.Balls[i].r &lt;= 0) {              this.Balls[i].vy = -this.Balls[i].vy;              this.Balls[i].y = this.Balls[i].r;            }            if (this.Balls[i].y + this.Balls[i].r &gt;= 800) {              this.Balls[i].vy = -this.Balls[i].vy;              this.Balls[i].y = 800 - this.Balls[i].r;            }          }        }        bgDraw(bgcolor) {          this.ctx.beginPath();          this.ctx.fillStyle = bgcolor;          this.ctx.fillRect(0, 0, 800, 800);          this.ctx.closePath();        }      }      //初始化对象      let animate = new Animate(&quot;canvas&quot;);      var ctx = animate.ctx;      //开始执行动画      animate.time = setInterval(() =&gt; {        animate.draw(animate.bgcolor);      }, 50);    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="清除"><a href="#清除" class="headerlink" title="清除"></a>清除</h2><blockquote><p>清除也称重绘，在动画应用当中是不可分割的，动画是一帧一帧的播放，中间少不了清除的步骤，否则将达不到动画的播放帧数标准</p></blockquote><p>清除画布相关函数：</p><p>clearRect(startX,startY,endX,endY)：清除参数指定范围内绘制的元素</p><p>语法格式：</p><pre><code>ctx.clearRect(0,0,canvas.width,canvas.height);</code></pre><h2 id="扩充Canvas-2d方法"><a href="#扩充Canvas-2d方法" class="headerlink" title="扩充Canvas 2d方法"></a>扩充Canvas 2d方法</h2><blockquote><p>在有些时候，我们自定义的函数，不能像canvas自带的函数一样，不用传入绘制上下午对象，而我们自定义的必须把绘制对象传入函数里才可以使用，那么有没有方法可以解决呢，在canvas实例对象的原型上添加方法即可</p></blockquote><p>语法格式：</p><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;    &lt;style&gt;      html,      body {        width: 100%;        height: 100%;      }      .canvasBox {        width: 800px;        height: 800px;        position: relative;      }      .canvasBox &gt; .SetupPanel {        width: 300px;        height: 200px;        background: #99b4e487;        border-radius: 30px;        position: absolute;        left: 0;        top: 0;        color: white;      }      .canvasBox &gt; .SetupPanel &gt; h1 {        text-align: center;        line-height: 25px;      }      .canvasBox &gt; .SetupPanel &gt; a {        float: left;        color: #478aff87;        background: #e5eeff;        border-radius: 5px;        padding: 10px 0;        margin: 3px 0;        text-decoration: none;        text-align: center;        line-height: 15px;        width: 100%;      }    &lt;/style&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;div class=&quot;canvasBox&quot;&gt;      &lt;canvas class=&quot;canvas&quot; width=&quot;800&quot; height=&quot;800&quot;&gt;&lt;/canvas&gt;    &lt;/div&gt;    &lt;script src=&quot;../node/jquery.js&quot;&gt;&lt;/script&gt;    &lt;script&gt;      let ctx = document.querySelector(&quot;.canvas&quot;).getContext(&quot;2d&quot;);      ctx.__proto__.fillStar = function(r)        //ctx.__proto__ === CanvasRenderingContext2D.prototype      {          this.beginPath();        for(let i=0;i&lt;=5;i++)        {          this.lineTo(            Math.cos((18+i*72)/180*Math.PI)*r+this.lastMoveTo.x,            -Math.sin((18+i*72)/180*Math.PI)*r+this.lastMoveTo.y          );          this.lineTo(            Math.cos((54+i*72)/180*Math.PI)*r/2+this.lastMoveTo.x,            -Math.sin((54+i*72)/180*Math.PI)*r/2+this.lastMoveTo.y          );        }          this.closePath();          this.fill();      }      ctx.lastMoveTo = {};      CanvasRenderingContext2D.prototype.oldMoveTo = CanvasRenderingContext2D.prototype.moveTo;      CanvasRenderingContext2D.prototype.moveTo = function(x,y)      {        this.oldMoveTo(x,y);        this.lastMoveTo.x = x;        this.lastMoveTo.y = y;      }      ctx.moveTo(400,400)      ctx.fillStar(100);    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="图像处理"><a href="#图像处理" class="headerlink" title="图像处理"></a>图像处理</h2><blockquote><p>图像不同于图形，图像是位图是由无数个彩色像素点组成，图形是点线面结合而成，两者的处理方式也不相同，所干涉的区域也不相同</p></blockquote><p>图形处理相关函数：</p><p>drawImage(img,sx,sy,sw,sh,dx,dy,dw,dh)  ：导入指定图片到canvas当中。 九个参数  首个是图片资源，s开头的是原图像的参数，d开头的是指在canvas绘制的参数</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5c7d480800018e1a12800720.jpg" alt=""></p><p>语法格式：</p><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;canvas      class=&quot;canvas&quot;      width=&quot;800&quot;      height=&quot;800&quot;      style=&quot;border:1px solid blue&quot;    &gt;&lt;/canvas&gt;    &lt;script&gt;      var ctx = document.querySelector(&quot;.canvas&quot;).getContext(&quot;2d&quot;);      var img = new Image();      img.src = &quot;../PHP操作MySQL.png&quot;;      img.onload = () =&gt; {        ctx.drawImage(img, 740, 450, 260, 70, 0, 0, 800, 800);      };    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="案例：图像放大"><a href="#案例：图像放大" class="headerlink" title="案例：图像放大"></a>案例：图像放大</h2><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;    &lt;style&gt;      body,      html {        background: black;      }input[type=range] {    -webkit-appearance: none;    width: 300px;    border-radius: 10px; /*这个属性设置使填充进度条时的图形为圆角*/    margin-top: 10px;}input[type=range]::-webkit-slider-thumb {    -webkit-appearance: none;} input[type=range]::-webkit-slider-runnable-track {    height: 10px;    border-radius: 10px; /*将轨道设为圆角的*/    box-shadow: 0 1px 1px #def3f8, inset 0 .125em .125em #0d1112; /*轨道内置阴影效果*/}input[type=range]::-webkit-slider-thumb {    -webkit-appearance: none;    height: 25px;    width: 25px;    margin-top: -5px; /*使滑块超出轨道部分的偏移量相等*/    background: #ffffff;     border-radius: 50%; /*外观设置为圆形*/    border: solid 0.125em rgba(205, 224, 230, 0.5); /*设置边框*/    box-shadow: 0 .125em .125em #3b4547; /*添加底部阴影*/}    &lt;/style&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;canvas      class=&quot;canvas&quot;      style=&quot;border:1px solid blue;margin: 0 auto;display: block&quot;    &gt;&lt;/canvas&gt;    &lt;input      type=&quot;range&quot;      style=&quot;display:block;width:100%;&quot;      max=&quot;3.0&quot;      min=&quot;0.5&quot;      step=&quot;0.1&quot;      value=&quot;1&quot;      class=&quot;scale&quot;    /&gt;    &lt;script&gt;      var ctx = document.querySelector(&quot;.canvas&quot;).getContext(&quot;2d&quot;);      var img = new Image();      var scale = document.querySelector(&quot;.scale&quot;);      img.src = &quot;../1.jpg&quot;;      img.onload = () =&gt; {        ctx.canvas.width = img.width;        ctx.canvas.height = img.height;        drawImageByScale(ctx, scale.value, img.width, img.height);        // scale.onchange = function() {        //   ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);        //   drawImageByScale(ctx, scale.value, img.width, img.height);        // };        scale.onmousemove = function() {          ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);          drawImageByScale(ctx, scale.value, img.width, img.height);        };      };      function drawImageByScale(ctx, scale, w, h) {        var imageWidth = w * scale;        var imageHeight = h * scale;        let x = ctx.canvas.width / 2 - imageWidth / 2,          y = ctx.canvas.height / 2 - imageHeight / 2;        ctx.drawImage(img, x, y, imageWidth, imageHeight);      }    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;//水印版&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;    &lt;style&gt;      body,      html {        background: black;      }      .bottom {        width: 100%;        position: fixed;        bottom: 30px;      }      input[type=&quot;range&quot;] {        -webkit-appearance: none;        width: 300px;        border-radius: 10px; /*这个属性设置使填充进度条时的图形为圆角*/        margin-top: 10px;        position: relative;      }      input[type=&quot;range&quot;]::-webkit-slider-thumb {        -webkit-appearance: none;      }      input[type=&quot;range&quot;]::-webkit-slider-runnable-track {        height: 10px;        border-radius: 10px; /*将轨道设为圆角的*/        box-shadow: 0 1px 1px #def3f8, inset 0 0.125em 0.125em #0d1112; /*轨道内置阴影效果*/      }      input[type=&quot;range&quot;]::-webkit-slider-thumb {        -webkit-appearance: none;        height: 25px;        width: 25px;        margin-top: -5px; /*使滑块超出轨道部分的偏移量相等*/        background: #ffffff;        border-radius: 50%; /*外观设置为圆形*/        border: solid 0.125em rgba(205, 224, 230, 0.5); /*设置边框*/        box-shadow: 0 0.125em 0.125em #3b4547; /*添加底部阴影*/      }    &lt;/style&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;canvas      class=&quot;canvas&quot;      style=&quot;border:1px solid blue;margin: 0 auto;display: block&quot;    &gt;&lt;/canvas&gt;    &lt;div class=&quot;bottom&quot;&gt;      &lt;input        type=&quot;range&quot;        style=&quot;display:block;width:100%;&quot;        max=&quot;3.0&quot;        min=&quot;0.5&quot;        step=&quot;0.1&quot;        value=&quot;1&quot;        class=&quot;scale&quot;      /&gt;    &lt;/div&gt;    &lt;script&gt;      var ctx = document.querySelector(&quot;.canvas&quot;).getContext(&quot;2d&quot;);      var img = new Image();      var scale = document.querySelector(&quot;.scale&quot;);      img.src = &quot;./img.jpg&quot;;      var shuiying = document.createElement(&quot;canvas&quot;).getContext(&quot;2d&quot;);      shuiying.canvas.width = 400;      shuiying.canvas.height = 100;      shuiying.font = &quot;bold 50px 微软雅黑&quot;;      shuiying.fillStyle = &quot;white&quot;;      shuiying.textAlign = &quot;center&quot;;      shuiying.textBaseline = &quot;middle&quot;;      shuiying.fillText(&quot;xuyuxin&quot;, 200, 50, 400);      img.onload = () =&gt; {        ctx.canvas.width = img.width;        ctx.canvas.height = img.height;        drawImageByScale(ctx, scale.value, img.width, img.height,shuiying);        // scale.onchange = function() {        //   ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);        //   drawImageByScale(ctx, scale.value, img.width, img.height);        // };        scale.onmousemove = function() {          ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);          drawImageByScale(ctx, scale.value, img.width, img.height, shuiying);        };      };      function drawImageByScale(ctx, scale, w, h, c) {        var imageWidth = w * scale;        var imageHeight = h * scale;        let x = ctx.canvas.width / 2 - imageWidth / 2,          y = ctx.canvas.height / 2 - imageHeight / 2;        ctx.drawImage(img, x, y, imageWidth, imageHeight);        if(scale&gt;=1)        {        ctxdrawImage(c.canvas, -40, ctx.canvas.height - 100);        }        else        {        ctx.drawImage(c.canvas, x, imageHeight-50);        }      }    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="案例：放大镜"><a href="#案例：放大镜" class="headerlink" title="案例：放大镜"></a>案例：放大镜</h2><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;    &lt;style&gt;      body,      html {        background: black;      }      .bottom {        width: 100%;        position: fixed;        bottom: 30px;      }      input[type=&quot;range&quot;] {        -webkit-appearance: none;        width: 300px;        border-radius: 10px; /*这个属性设置使填充进度条时的图形为圆角*/        margin-top: 10px;        position: relative;      }      input[type=&quot;range&quot;]::-webkit-slider-thumb {        -webkit-appearance: none;      }      input[type=&quot;range&quot;]::-webkit-slider-runnable-track {        height: 10px;        border-radius: 10px; /*将轨道设为圆角的*/        box-shadow: 0 1px 1px #def3f8, inset 0 0.125em 0.125em #0d1112; /*轨道内置阴影效果*/      }      input[type=&quot;range&quot;]::-webkit-slider-thumb {        -webkit-appearance: none;        height: 25px;        width: 25px;        margin-top: -5px; /*使滑块超出轨道部分的偏移量相等*/        background: #ffffff;        border-radius: 50%; /*外观设置为圆形*/        border: solid 0.125em rgba(205, 224, 230, 0.5); /*设置边框*/        box-shadow: 0 0.125em 0.125em #3b4547; /*添加底部阴影*/      }    &lt;/style&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;canvas      class=&quot;canvas&quot;      style=&quot;border:1px solid blue;margin: 0 auto;display: block&quot;    &gt;&lt;/canvas&gt;    &lt;script&gt;      var ctx = document.querySelector(&quot;.canvas&quot;).getContext(&quot;2d&quot;);      var offsetCanvas = document.createElement(&quot;canvas&quot;).getContext(&quot;2d&quot;);      var img = new Image();      var scale;      img.src = &quot;./img-lg.jpg&quot;;      img.onload = () =&gt; {        ctx.canvas.width = 1152;        ctx.canvas.height = 768;        offsetCanvas.canvas.width = img.width;        offsetCanvas.canvas.height = img.height;        scale = offsetCanvas.canvas.width / ctx.canvas.width;        ctx.drawImage(img, 0, 0, ctx.canvas.width, ctx.canvas.height);        offsetCanvas.drawImage(img, 0, 0);      };      ctx.canvas.onmousedown = function(e) {        var x = e.clientX - this.getBoundingClientRect().left,            y = e.clientY - this.getBoundingClientRect().top;          Draw(ctx, true, x, y);        this.onmousemove = e =&gt; {          var x = e.clientX - this.getBoundingClientRect().left,            y = e.clientY - this.getBoundingClientRect().top;          Draw(ctx, true, x, y);        };        this.onmouseup = () =&gt; {          ctx.canvas.onmousemove = null;          Draw(ctx, false);        };        this.onmouseout = () =&gt; {          ctx.canvas.onmousemove = null;          Draw(ctx, false);        };      };      function Draw(ctx, flag, x, y) {        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);        ctx.drawImage(img, 0, 0, ctx.canvas.width, ctx.canvas.height);        if (flag) {          drawImageRect(ctx, x, y);        }      }      function drawImageRect(ctx, x, y) {        var imageLgX = x * scale,          imageLgY = y * scale;        var r = 200;        var sx = imageLgX - r,          sy = imageLgY - r;        var dx = x - r,          dy = y - r;        ctx.save();        ctx.beginPath();        ctx.arc(x,y,r,0,Math.PI*2);        ctx.stroke();        ctx.clip()        ctx.drawImage(offsetCanvas.canvas, sx, sy, r * 2, r * 2, dx, dy, r * 2, r * 2);        ctx.closePath();        ctx.restore();      }    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="像素处理"><a href="#像素处理" class="headerlink" title="像素处理"></a>像素处理</h2><p>相关函数：</p><p>getImageData(x,y,w,h)：获取指定图像像素数据   返回一个对象，里面有 data像素数据  </p><p>putImageData(img,dx,dy,dirtx,dirty,dirtw,dirth)：输出处理后的图像到指定位置</p><p>createImageData(w,h)：创建一个空的图像</p><p>像素处理算法：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5c06264f0001f9fe12800720.jpg" alt=""></p><p>语法格式：</p><pre><code>//像素自动变紫&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;    &lt;style&gt;      body,      html {        /* background: black; */        height: 2000px;      }    &lt;/style&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;canvas      class=&quot;canvas&quot;      style=&quot;border:1px solid blue;float:left&quot;      width=&quot;500&quot;      height=&quot;500&quot;    &gt;&lt;/canvas&gt;    &lt;canvas      class=&quot;canvas&quot;      style=&quot;border:1px solid blue;float:right&quot;      width=&quot;500&quot;      height=&quot;500&quot;    &gt;&lt;/canvas&gt;    &lt;div class=&quot;btnbox&quot; style=&quot;display: block;&quot;&gt;      &lt;a href=&quot;javascript:void(0)&quot; onclick=&quot;fillter()&quot;&gt;fillter&lt;/a&gt;    &lt;/div&gt;    &lt;script&gt;      var ctx1 = document.querySelectorAll(&quot;.canvas&quot;)[0].getContext(&quot;2d&quot;);      var ctx2 = document.querySelectorAll(&quot;.canvas&quot;)[1].getContext(&quot;2d&quot;);var n =0;      var imageData;      var data;      var img = new Image();      img.src = &quot;./img.jpg&quot;;      img.onload = function() {        ctx1.drawImage(img, 0, 0, 500, 500);      };      function fillter() {        imageData = ctx1.getImageData(0, 0, 500, 500);        data = imageData.data;        for (let i = 0; i &lt; ctx2.canvas.width * ctx2.canvas.height; i++) {          data[4 * i + 0] += n;          // data[4 * i + 1] += n;          data[4 * i + 2] += n;          // data[4 * i + 3] = Math.ceil(Math.random()*255);        }        ctx2.putImageData(imageData, 0, 0, 0, 0, 500, 500);      }      setInterval(function(){        n++;        if(n===255)        {          n=Math.ceil(Math.random()*255)        }        fillter(n);      },1);    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="案例：像素滤镜"><a href="#案例：像素滤镜" class="headerlink" title="案例：像素滤镜"></a>案例：像素滤镜</h2><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;    &lt;style&gt;      body,      html {        /* background: black; */        height: 2000px;      }      .btnbox &gt; a {        float: left;        margin: 10px 20px;      }    &lt;/style&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;canvas class=&quot;canvas&quot; style=&quot;float:left&quot; width=&quot;500&quot; height=&quot;500&quot;&gt;&lt;/canvas&gt;    &lt;canvas      class=&quot;canvas&quot;      style=&quot;float:right&quot;      width=&quot;500&quot;      height=&quot;500&quot;    &gt;&lt;/canvas&gt;    &lt;div class=&quot;btnbox&quot; style=&quot;display: block;&quot;&gt;      &lt;a href=&quot;javascript:void(0)&quot; onclick=&quot;grey()&quot;&gt;灰度 Grey Effect&lt;/a&gt;      &lt;a href=&quot;javascript:void(0)&quot; onclick=&quot;black()&quot;&gt;黑白 black&amp;white Effect&lt;/a&gt;      &lt;a href=&quot;javascript:void(0)&quot; onclick=&quot;revers()&quot;&gt;反色 revers Effect&lt;/a&gt;      &lt;a href=&quot;javascript:void(0)&quot; onclick=&quot;Blur()&quot;&gt;模糊 blur Effect&lt;/a&gt;      &lt;a href=&quot;javascript:void(0)&quot; onclick=&quot;mosaice()&quot;&gt;马赛克 mosaice Effect&lt;/a&gt;    &lt;/div&gt;    &lt;script&gt;      var ctx1 = document.querySelectorAll(&quot;.canvas&quot;)[0].getContext(&quot;2d&quot;);      var ctx2 = document.querySelectorAll(&quot;.canvas&quot;)[1].getContext(&quot;2d&quot;);      var imageData;      var data;      var img = new Image();      img.src = &quot;../1.jpg&quot;;      img.onload = function() {        ctx1.drawImage(img, 0, 0, 500, 500);      };      function mosaice() {        var imgData = ctx1.getImageData(0, 0, 500, 500);        var data = imgData.data;        var tmpimgData = ctx1.getImageData(0, 0, 500, 500);        var tmpData = tmpimgData.data;        var size = 16,          totalnum = Math.pow(size, 2);        for (var i = 0; i &lt; ctx2.canvas.height; i += size) {          for (var j = 0; j &lt; ctx2.canvas.width; j += size) {            var totalr = 0,              totalg = 0,              totalb = 0;            for (var dx = 0; dx &lt; size; dx++) {              for (var dy = 0; dy &lt; size; dy++) {                let x = i + dx,                  y = j + dy;                let p = x * ctx2.canvas.width + y;                totalr += tmpData[p * 4 + 0];                totalg += tmpData[p * 4 + 1];                totalb += tmpData[p * 4 + 2];              }            }            var p = i * ctx2.canvas.width + j;            var resr = totalr / totalnum;            var resg = totalg / totalnum;            var resb = totalb / totalnum;            for (var dx = 0; dx &lt; size; dx++) {              for (var dy = 0; dy &lt; size; dy++) {                var x = dx + i,                  y = dy + j;                var p = x * ctx2.canvas.width + y;                data[4 * p + 0] = resr;                data[4 * p + 1] = resg;                data[4 * p + 2] = resb;              }            }          }        }        ctx2.putImageData(imgData, 0, 0, 0, 0, 500, 500);      }      function revers() {        imageData = ctx1.getImageData(0, 0, 500, 500);        data = imageData.data;        for (let i = 0; i &lt; ctx2.canvas.width * ctx2.canvas.height; i++) {          let r = 255 - data[4 * i + 0],            g = 255 - data[4 * i + 1],            b = 255 - data[4 * i + 2];          data[4 * i + 0] = r;          data[4 * i + 1] = g;          data[4 * i + 2] = b;        }        ctx2.putImageData(imageData, 0, 0, 0, 0, 500, 500);      }      function Blur() {        var imgData = ctx1.getImageData(0, 0, 500, 500);        var data = imgData.data;        var tmpimgData = ctx1.getImageData(0, 0, 500, 500);        var tmpData = tmpimgData.data;        var blurR = 2,          totalnum = Math.pow(2 * blurR + 1, 2);        for (var i = blurR; i &lt; ctx2.canvas.height - blurR; i++) {          for (var j = blurR; j &lt; ctx2.canvas.width - blurR; j++) {            var totalr = 0,              totalg = 0,              totalb = 0;            for (var dx = -blurR; dx &lt;= blurR; dx++) {              for (var dy = -blurR; dy &lt;= blurR; dy++) {                let x = i + dx,                  y = j + dy;                let p = x * ctx2.canvas.width + y;                totalr += tmpData[p * 4 + 0];                totalg += tmpData[p * 4 + 1];                totalb += tmpData[p * 4 + 2];              }            }            var p = i * ctx2.canvas.width + j;            data[p * 4 + 0] = totalr / totalnum;            data[p * 4 + 1] = totalg / totalnum;            data[p * 4 + 2] = totalb / totalnum;          }        }        ctx2.putImageData(imgData, 0, 0, 0, 0, 500, 500);      }      function grey() {        imageData = ctx1.getImageData(0, 0, 500, 500);        data = imageData.data;        for (let i = 0; i &lt; ctx2.canvas.width * ctx2.canvas.height; i++) {          let r = data[4 * i + 0],            g = data[4 * i + 1],            b = data[4 * i + 2];          let grey = r * 0.3 + g * 0.59 + b * 0.11;          data[4 * i + 0] = grey;          data[4 * i + 1] = grey;          data[4 * i + 2] = grey;        }        ctx2.putImageData(imageData, 0, 0, 0, 0, 500, 500);      }      function black() {        imageData = ctx1.getImageData(0, 0, 500, 500);        data = imageData.data;        for (let i = 0; i &lt; ctx2.canvas.width * ctx2.canvas.height; i++) {          let r = data[4 * i + 0],            g = data[4 * i + 1],            b = data[4 * i + 2];          let grey = r * 0.3 + g * 0.59 + b * 0.11;          if (grey &gt; 255 / 2) {            v = 255;          } else {            v = 0;          }          data[4 * i + 0] = v;          data[4 * i + 1] = v;          data[4 * i + 2] = v;        }        ctx2.putImageData(imageData, 0, 0, 0, 0, 500, 500);      }    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="案例：颜色板"><a href="#案例：颜色板" class="headerlink" title="案例：颜色板"></a>案例：颜色板</h2><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;    &lt;title&gt;Document&lt;/title&gt;    &lt;style&gt;      body,      html {        /* background: black; */        height: 2000px;      }      .btnbox &gt; a {        float: left;        margin: 10px 20px;      }    &lt;/style&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;canvas class=&quot;canvas&quot; style=&quot;float:left&quot; width=&quot;800&quot; height=&quot;800&quot;&gt;&lt;/canvas&gt;    &lt;div class=&quot;btnbox&quot; style=&quot;display: block;&quot;&gt;&lt;/div&gt;    &lt;script&gt;      var ctx = document.querySelectorAll(&quot;.canvas&quot;)[0].getContext(&quot;2d&quot;);      var img = ctx.createImageData(800, 800);      var data = img.data;      for (var i = 0; i &lt; ctx.canvas.height; i++) {        for (var j = 0; j &lt; ctx.canvas.width; j++) {          var p = i * ctx.canvas.width + j;          data[4 * p + 0] = parseInt(            Math.pow(Math.cos(Math.atan2(j - 400, i - 400) / 2), 2) * 255          );          data[4 * p + 1] = parseInt(            Math.pow(              Math.cos(                Math.atan2(j - 400, i - 400) / 2 - (2 * Math.acos(-1)) / 3              ),              2            ) * 255          );          data[4 * p + 2] = parseInt(            Math.pow(              Math.cos(                Math.atan2(j - 400, i - 400) / 2 + (2 * Math.acos(-1)) / 3              ),              2            ) * 255          );          data[4 * p + 3] = 255;        }      }      ctx.putImageData(img, 0, 0, 0, 0, 800, 800);    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h1 id="什么是Ajax？"><a href="#什么是Ajax？" class="headerlink" title="什么是Ajax？"></a>什么是Ajax？</h1><blockquote><p>Ajax是一种可以与服务器交换数据并更新部分页面内容，同时可以在不让整个网页重新加载的情况下更新网页的一种技术</p></blockquote><h2 id="Ajax请求过程："><a href="#Ajax请求过程：" class="headerlink" title="Ajax请求过程："></a><strong>Ajax请求过程：</strong></h2><h5 id="1：创建一个异步对象"><a href="#1：创建一个异步对象" class="headerlink" title="1：创建一个异步对象"></a>1：创建一个异步对象</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> xmlHttp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h5 id="2：设置请求方式和请求地址"><a href="#2：设置请求方式和请求地址" class="headerlink" title="2：设置请求方式和请求地址"></a>2：设置请求方式和请求地址</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/*    参数顺序，描述    （1）method：请求的类型；GET 或 POST    （2）url：文件在服务器上的位置    （3）async：true（异步）或 false（同步） （一般为true，因ajax的精髓就是异步）*/</span>    xmlHttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"GET||POST"</span><span class="token punctuation">,</span><span class="token string">"url 如（./ajax.php）"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//注意点：url中不能出现中文，只能数字、字母、ASCII码、下划线</span><span class="token comment" spellcheck="true">//  GET方式的 url格式：./ajax.php?t=123&amp;321......</span><span class="token comment" spellcheck="true">//如果出现中文也可以用encodeURIComponent方法转换</span><span class="token comment" spellcheck="true">//  POST方式的url不能在后面接字符串传递参数</span>xmlHttp<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">"Content-type"</span><span class="token punctuation">,</span><span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//setRequestHeader 必须放在设置请求与发送请求之间</span><span class="token comment" spellcheck="true">//下一步在发送请求send中传递参数即可</span>xmlHttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"name=xuyuxin&amp;age=18"</span><span class="token punctuation">)</span></code></pre><h5 id="3：发送请求"><a href="#3：发送请求" class="headerlink" title="3：发送请求"></a>3：发送请求</h5><pre class=" language-javascript"><code class="language-javascript"> xmlHttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h5 id="4-监听状态变化"><a href="#4-监听状态变化" class="headerlink" title="4.监听状态变化"></a>4.监听状态变化</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//监听事件： onreadystatechange 每当请求状态发生变化，就会触发此函数</span>xmlHttp<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ev2<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/*    readyState 状态变化有以下5种    0：请求未初始化    1：服务器连接已建立    2：请求已接收    3：请求处理中    4：请求已完成，且响应已就绪*/</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>xmlHttp<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//请求已完成，并不代表请求成功，因此还需判断是否请求成功</span>        <span class="token comment" spellcheck="true">//status是专门判断请求是否成功的状态码</span>        <span class="token comment" spellcheck="true">// 状态码大于或等于200并且不能超过300以上，300以上除了304以外全都是请求失败</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>xmlHttp<span class="token punctuation">.</span>status <span class="token operator">>=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xmlHttp<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span> <span class="token operator">||</span> xmlHttp<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求成功'</span><span class="token punctuation">)</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求失败'</span><span class="token punctuation">)</span>                <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><a href="http://baike.baidu.com/link?url=LarF3FUBzX-IU1BMZbwbxaC8oJPUSGOj3seQRNVSVbZ2F9A6BiE-Je0sxFwsQK8dFJkKH6VP_ghpK66p8C2Zvkdl9nABXBR8mIqZGJj_D59q6NJQwmw3GqjIx2bzAsEG" target="_blank" rel="noopener">http请求成功或失败状态码资料查询</a></p><h2 id="IE低版本浏览器兼容问题"><a href="#IE低版本浏览器兼容问题" class="headerlink" title="IE低版本浏览器兼容问题"></a>IE低版本浏览器兼容问题</h2><blockquote><p>由于在IE6-IE5以下不支持XMLHttpRequest这个属性，因此会产生错误，在低级浏览器中可以使用ActiveXObject来实现同样的效果</p></blockquote><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> xmlHttp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">"Microsoft.XMLHTTP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>在IE低版本中ajax还有缓存的问题，解决这个问题，要url地址不断改变，不能为常量，即可解决</p></blockquote><pre class=" language-javascript"><code class="language-javascript">xmlhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span><span class="token string">"ajax.php?"</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span></code></pre><h2 id="解决兼容性通用方法"><a href="#解决兼容性通用方法" class="headerlink" title="解决兼容性通用方法"></a>解决兼容性通用方法</h2><blockquote><p>由于在Ajax中浏览器支持的属性不同，单一方案不能支持全部浏览器，有两种解决方案，因此可以把这两种方案合成一种，以便使用</p></blockquote><pre class=" language-javascript"><code class="language-javascript">  <span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>XMLHttpRuquest<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">var</span> xmlHttp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>           <span class="token keyword">var</span> xmlHttp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">"Microsoft.XMLHTTP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span>    <span class="token keyword">var</span> xmlHttp <span class="token operator">=</span> window<span class="token punctuation">.</span>XMLHttpRequest <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">new</span>                     <span class="token class-name">ActiveXOject</span><span class="token punctuation">(</span><span class="token string">"Microsoft.XMLHTTP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="封装Ajax"><a href="#封装Ajax" class="headerlink" title="封装Ajax"></a>封装Ajax</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * @param {请求的类型}option.type * @param {发送请求的地址} option.url * @param {发送请求的数据}option.data * @param {超时时间} option.timeout * @param {请求成功后执行的函数*} option.sucess * @param {请求失败后执行的函数*} option.error */</span><span class="token keyword">function</span> <span class="token function">createAjax</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//0.把传入对象处理成字符串，服务器才可接收</span>  <span class="token keyword">var</span> toStringObj <span class="token operator">=</span> <span class="token function">objToString</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//1.创建ajax对象，并判断游览器支持那个属性</span>  <span class="token keyword">var</span> xmlHttp <span class="token operator">=</span> window<span class="token punctuation">.</span>XMLHttpRequest    <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">"Microsoft.XMLHTTP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> timer<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>option<span class="token punctuation">.</span>type<span class="token punctuation">.</span>toloworCase <span class="token operator">===</span> <span class="token string">"get"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//2.设置请求方式和地址</span>    xmlHttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> option<span class="token punctuation">.</span>url <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> toStringObj<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//3.发送请求</span>    xmlHttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//4.监听请求状态</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// POST请求方式</span>    xmlHttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>type<span class="token punctuation">,</span> option<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    xmlHttp<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span>      <span class="token string">"Content-type"</span><span class="token punctuation">,</span>      <span class="token string">"application/x-www-form-urlencoded"</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    xmlHttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>toStringObj<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  xmlHttp<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//请求完成，并不代表请求成功</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>xmlHttp<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//判断请求是否成功</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>        <span class="token punctuation">(</span>xmlHttp<span class="token punctuation">.</span>status <span class="token operator">>=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xmlHttp<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span>        xmlHttp<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span>      <span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>        option<span class="token punctuation">.</span><span class="token function">sucess</span><span class="token punctuation">(</span>xmlHttp<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        option<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>xmlHttp<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//判断外界是否传入超时时间</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>option<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>    timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//超时时间到后执行停止此次发送请求，默认为失败</span>      xmlHttp<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> option<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//把obj转为字符串</span><span class="token keyword">function</span> <span class="token function">objToString</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  data<span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//encodeURLComponent函数对，对象名和属性进行转换，以防出现url中不能出现的字符而出错</span>    res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//调用方式</span>    <span class="token function">createAjax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                    data<span class="token punctuation">:</span><span class="token punctuation">{</span>                       name<span class="token punctuation">:</span> that<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    type<span class="token punctuation">:</span><span class="token string">"POST"</span><span class="token punctuation">,</span>                    timeout<span class="token punctuation">:</span><span class="token number">3000</span><span class="token punctuation">,</span>                    url<span class="token punctuation">:</span><span class="token string">"./ajaxLesson2.php"</span><span class="token punctuation">,</span>                    sucess<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>xml<span class="token punctuation">)</span><span class="token punctuation">{</span>                         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    error<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>xml<span class="token punctuation">)</span><span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"请求失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>；</code></pre><h2 id="获取服务器响应数据方式"><a href="#获取服务器响应数据方式" class="headerlink" title="获取服务器响应数据方式"></a>获取服务器响应数据方式</h2><blockquote><ol><li>responseText 可以获取服务器以字符串形式返回的数据</li><li>responseXML 可以获取服务器以XML形式返回的数据</li></ol></blockquote><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//调用方式</span><span class="token comment" spellcheck="true">// ajax对象.要获取的方式</span>xmlHttp<span class="token punctuation">.</span>responseText</code></pre><h2 id="通过XML传输数据"><a href="#通过XML传输数据" class="headerlink" title="通过XML传输数据"></a>通过XML传输数据</h2><h4 id="XML数据基本格式"><a href="#XML数据基本格式" class="headerlink" title="XML数据基本格式"></a>XML数据基本格式</h4><p>​        1.开头前缀指定版本和编码（必要）</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span></code></pre><p>​        2.根目录（必要 和html标签一样要闭合）</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><p>​        3.之后标签名不受限制，完整版</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nz</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>甜美女装<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>des</span><span class="token punctuation">></span></span>人见人爱,花间花开,甜美系列<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>des</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">></span></span>images/1.jpg<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nz</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bb</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>奢华驴包<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>des</span><span class="token punctuation">></span></span>送女友,送情人,送学妹,一送一个准系列<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>des</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">></span></span>images/2.jpg<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bb</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tx</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>键盘拖鞋<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>des</span><span class="token punctuation">></span></span>程序员专属拖鞋, 屌丝气息浓郁, 你值得拥有<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>des</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">></span></span>images/3.jpg<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tx</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><h4 id="PHP基本XML配置格式"><a href="#PHP基本XML配置格式" class="headerlink" title="PHP基本XML配置格式"></a>PHP基本XML配置格式</h4><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token comment" spellcheck="true">//向客户端发送原始的 HTTP 报头。</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"content-type:text/xml;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//file_get_contents() 函数是用于将文件的内容读入到一个字符串中的首选方法。如果操作系统支持，还会使用    内存映射技术来增强性能。</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">"xml文件地址如（./ajax.xml）"</span><span class="token punctuation">)</span>    <span class="token delimiter">?></span></code></pre><h4 id="Ajax获取XML数据格式"><a href="#Ajax获取XML数据格式" class="headerlink" title="Ajax获取XML数据格式"></a>Ajax获取XML数据格式</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//获取XML传输而来的数据要使用 responseXML方式获取</span><span class="token keyword">var</span> Data <span class="token operator">=</span> xml<span class="token punctuation">.</span>responseXML<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//返回的是一个document文档对象</span><span class="token comment" spellcheck="true">//接着使用javascript获取遍历DOM元素</span> <span class="token keyword">var</span> titleinfo <span class="token operator">=</span> Data<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>name<span class="token operator">+</span><span class="token string">'>title'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> des <span class="token operator">=</span> Data<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>name<span class="token operator">+</span><span class="token string">'>des'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> image <span class="token operator">=</span> Data<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>name<span class="token operator">+</span><span class="token string">'>image'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//最后就可以对DOM里面存储的数据进行操作了</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>des<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="通过JSON传输数据"><a href="#通过JSON传输数据" class="headerlink" title="通过JSON传输数据"></a>通过JSON传输数据</h2><blockquote><p><a href="https://baike.baidu.com/item/JSON/2462549?fr=aladdin" target="_blank" rel="noopener">JSON资料</a></p></blockquote><h4 id="JSON数据基本格式"><a href="#JSON数据基本格式" class="headerlink" title="JSON数据基本格式"></a>JSON数据基本格式</h4><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"nz"</span><span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"甜美女装"</span><span class="token punctuation">,</span>        <span class="token property">"des"</span><span class="token operator">:</span><span class="token string">"人见人爱,花间花开,甜美系列"</span><span class="token punctuation">,</span>        <span class="token property">"image"</span><span class="token operator">:</span><span class="token string">"./images/1.jpg"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"bb"</span><span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"奢华驴包"</span><span class="token punctuation">,</span>        <span class="token property">"des"</span><span class="token operator">:</span><span class="token string">"送女友,送情人,送学妹,一送一个准系列"</span><span class="token punctuation">,</span>        <span class="token property">"image"</span><span class="token operator">:</span><span class="token string">"./images/2.jpg"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"tx"</span><span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"键盘拖鞋"</span><span class="token punctuation">,</span>        <span class="token property">"des"</span><span class="token operator">:</span><span class="token string">"程序员专属拖鞋, 屌丝气息浓郁, 你值得拥有"</span><span class="token punctuation">,</span>        <span class="token property">"image"</span><span class="token operator">:</span><span class="token string">"./images/3.jpg"</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>//在 JS 语言中，一切都是对象。因此，任何支持的类型都可以通过 JSON 来表示，例如字符串、数字、对象、数组等。但是对象和数组是比较特殊且常用的两种类型：//JSON 键/值对//JSON 键值对是用来保存 JS 对象的一种方式，和 JS 对象的写法也大同小异，键/值对组合中的键名写在前面并用双引号 <span class="token string">""</span> 包裹，使用冒号 <span class="token operator">:</span> 分隔，然后紧接着值："<span class="token punctuation">{</span><span class="token property">"firstName"</span><span class="token operator">:</span> <span class="token string">"Json"</span><span class="token punctuation">}</span><span class="token string">"这很容易理解，等价于这条 JavaScript 语句：{firstName : "</span>Json"<span class="token punctuation">}</span>//JSON 与 JS 对象的关系//很多人搞不清楚 JSON 和 Js 对象的关系，甚至连谁是谁都不清楚。其实，可以这么理解：//JSON 是 JS 对象的字符串表示法，它使用文本表示一个 JS 对象的信息，本质是一个字符串。//如<span class="token operator">:</span>var obj = <span class="token punctuation">{</span>a<span class="token operator">:</span> 'Hello'<span class="token punctuation">,</span> b<span class="token operator">:</span> 'World'<span class="token punctuation">}</span><span class="token punctuation">;</span> //这是一个对象，注意键名也是可以使用引号包裹的var json = '<span class="token punctuation">{</span><span class="token property">"a"</span><span class="token operator">:</span> <span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token property">"b"</span><span class="token operator">:</span> <span class="token string">"World"</span><span class="token punctuation">}</span>'<span class="token punctuation">;</span> //这是一个 JSON 字符串，本质是一个字符串</code></pre><h4 id="JSON和JS对象互转"><a href="#JSON和JS对象互转" class="headerlink" title="JSON和JS对象互转"></a>JSON和JS对象互转</h4><pre class=" language-json"><code class="language-json">//要实现从JSON对象转换为JS字符串，使用 JSON.parse(<span class="token punctuation">)</span> 方法：var obj = JSON.parse('<span class="token punctuation">{</span><span class="token property">"a"</span><span class="token operator">:</span> <span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token property">"b"</span><span class="token operator">:</span> <span class="token string">"World"</span><span class="token punctuation">}</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span> //结果是 <span class="token punctuation">{</span>a<span class="token operator">:</span> 'Hello'<span class="token punctuation">,</span> b<span class="token operator">:</span> 'World'<span class="token punctuation">}</span>//要实现从JS对象转换为JSON字符串，使用 JSON.stringify(<span class="token punctuation">)</span> 方法：var json = JSON.stringify(<span class="token punctuation">{</span>a<span class="token operator">:</span> 'Hello'<span class="token punctuation">,</span> b<span class="token operator">:</span> 'World'<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> //结果是 '<span class="token punctuation">{</span><span class="token property">"a"</span><span class="token operator">:</span> <span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token property">"b"</span><span class="token operator">:</span> <span class="token string">"World"</span><span class="token punctuation">}</span>'//当从服务器返回的数据不是标准json字符串时是无法使用parse的，那么可以试试用eval(<span class="token punctuation">)</span>强制转化和为js对象</code></pre><h4 id="非标准json转js对象"><a href="#非标准json转js对象" class="headerlink" title="非标准json转js对象"></a>非标准json转js对象</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//当从服务器返回的数据不是标准json字符串时是无法使用parse的，那么可以试试用eval()强制转化和为js对象</span><span class="token comment" spellcheck="true">//注意点： 转js对象必须加 "("+data+")"</span><span class="token keyword">var</span> Data <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"("</span><span class="token operator">+</span>data<span class="token operator">+</span><span class="token string">")"</span><span class="token punctuation">)</span></code></pre><h4 id="JSON兼容性问题"><a href="#JSON兼容性问题" class="headerlink" title="JSON兼容性问题"></a>JSON兼容性问题</h4><blockquote><p> 在低版本的IE中, 不可以使用原生的JSON.parse方法, 但是可以使用json2.js这个框架来兼容</p><p><a href="https://github.com/douglascrockford/JSON-js" target="_blank" rel="noopener">json2.js下载地址：</a></p></blockquote><h4 id="PHP基本JSON格式"><a href="#PHP基本JSON格式" class="headerlink" title="PHP基本JSON格式"></a>PHP基本JSON格式</h4><pre class=" language-php"><code class="language-php"><span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">" JSON文件地址 如(./json.txt)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h2><blockquote><p>ajax的请求过程：ajax发送请求–浏览器–服务器</p><p>响应过程则是请求过程的颠倒</p><p>当ajax发送请求到浏览器，浏览器发送到服务器，处理并响应后，原路返回到浏览器，此时会验证其请求来源的域名跟发送请求时是否一样，是则过，否则会被浏览器截止并提示错误，这正是跨域所造成的，想要解决此问题，并不能从前端入手，应该从后端，只有在后端响应并返回后告诉浏览器是自己人即可。</p><p>那怎么告诉浏览器是自己人呢？ 只要设置其响应头部信息+（<strong>Access-Control-Allow-Origin</strong>：域名）告诉浏览器即可,允许多个、单个、全部 （*）。</p></blockquote><h3 id="PHP-方式"><a href="#PHP-方式" class="headerlink" title="PHP 方式"></a>PHP 方式</h3><pre class=" language-php"><code class="language-php"><span class="token comment" spellcheck="true">/*    1、允许单个域名访问*/</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin:(域名)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*    2、允许多个域名访问*/</span>    <span class="token variable">$origin</span> <span class="token operator">=</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'HTTP_ORIGIN'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'HTTP_ORIGIN'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token variable">$option</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>        <span class="token punctuation">(</span><span class="token string">'域名1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span><span class="token string">'域名2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$origin</span><span class="token punctuation">,</span><span class="token variable">$option</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin:$origin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*    3、允许全部域名访问*/</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin:*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="node方式"><a href="#node方式" class="headerlink" title="node方式"></a>node方式</h3><pre><code>/*    1、允许单个域名访问*/    http.createServer(req,res)    {        res.setHeader(&quot;Access-Control-Allow-Origin&quot;,&quot;（域名）&quot;);    }/*    2、允许多个域名访问*/        let option = [        (域名1),        (域名2),        ...    ];    http.createServer(req,res)    {      let {origin} =  req.headers;      let ori = option[&quot;origin&quot;] ? option[&quot;origin&quot;] ： null；      res.setHeader(&quot;Access-Control-Allow-Origin&quot;,ori);    }/*    3、允许全部域名访问*/    http.createServer(req,res)    {        res.setHeader(&quot;Access-Control-Allow-Origin&quot;,&quot;*&quot;);    }</code></pre><h2 id="FormData"><a href="#FormData" class="headerlink" title="FormData"></a>FormData</h2><blockquote><p>FormData是ajax2.0新添加的功能，其作用是让表单也能异步发送</p></blockquote><h3 id="语法格式："><a href="#语法格式：" class="headerlink" title="语法格式："></a>语法格式：</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//必须要new 一个FormData对象 参数是要应用的表单元素 </span><span class="token comment" spellcheck="true">//禁止表单默认行为</span><span class="token comment" spellcheck="true">//其请求方式、请求地址跟随表单元素</span><span class="token comment" spellcheck="true">//最后发送formdata对象即可</span><span class="token comment" spellcheck="true">//原生方式</span>         <span class="token keyword">let</span> form <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"form"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"form"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onsubmit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> formdata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span>method<span class="token punctuation">,</span>form<span class="token punctuation">.</span>action<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formdata<span class="token punctuation">)</span><span class="token punctuation">;</span>        xhr<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>          <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>          <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span>          <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token keyword">else</span>          <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token punctuation">}</span>          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//jQuery方式 </span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"form"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"submit"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">let</span> formdata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>              url<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>action<span class="token punctuation">,</span>              type<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>method<span class="token punctuation">,</span>              data<span class="token punctuation">:</span>formdata<span class="token punctuation">,</span>                <span class="token comment" spellcheck="true">//由于jq在发送请求时，会把请求数据自动处理为适合发送的数据格式，但是formdata对象本事就不用处理，系统识别会自动处理数据，如果被jq格式化后，数据就会出错，所以要关闭其数据格式化，以及发送的头部信息。</span>              processData<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>                  contentType<span class="token punctuation">:</span><span class="token boolean">false</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>             console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//如果不使用表单提交，可以使用以下另门方式</span><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span> dir<span class="token operator">=</span><span class="token string">"ltr"</span><span class="token operator">></span>  <span class="token operator">&lt;</span>head<span class="token operator">></span>    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>  <span class="token operator">&lt;</span>body<span class="token operator">></span>    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"div1"</span><span class="token operator">></span>      用户：<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> id<span class="token operator">=</span><span class="token string">"user"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span>br<span class="token operator">></span>      密码：<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"password"</span> id<span class="token operator">=</span><span class="token string">"pass"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span>br<span class="token operator">></span>      文件：<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"file"</span> id<span class="token operator">=</span><span class="token string">"f1"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span>br<span class="token operator">></span>      <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">"btn1"</span> type<span class="token operator">=</span><span class="token string">"button"</span> value<span class="token operator">=</span><span class="token string">"提交"</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>  <span class="token operator">&lt;</span>script<span class="token operator">></span>  <span class="token keyword">let</span> oBtn<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#btn1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  oBtn<span class="token punctuation">.</span>onclick<span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">let</span> formdata<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    formdata<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    formdata<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#pass'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    formdata<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'f1'</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#f1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//</span>    <span class="token keyword">let</span> xhr<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'post'</span><span class="token punctuation">,</span> <span class="token string">'http://localhost:8080/'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formdata<span class="token punctuation">)</span><span class="token punctuation">;</span>    xhr<span class="token punctuation">.</span>onreadystatechange<span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState<span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token operator">==</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre><h2 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a>fetch</h2><blockquote><p>fetch是官方用来解决原生js的ajax的繁杂步骤问题的一门新语法，大大简化了ajax操作，原理基于ajax</p></blockquote><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// get txt</span> window<span class="token punctuation">.</span>onload<span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">let</span> oBtn<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      oBtn<span class="token punctuation">.</span>onclick<span class="token operator">=</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//1.请求</span>        <span class="token keyword">let</span> res<span class="token operator">=</span><span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'data/1.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//2.解析</span>        <span class="token keyword">let</span> str<span class="token operator">=</span><span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">alert</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//get json</span> window<span class="token punctuation">.</span>onload<span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">let</span> oBtn<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      oBtn<span class="token punctuation">.</span>onclick<span class="token operator">=</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//1.请求</span>        <span class="token keyword">let</span> res<span class="token operator">=</span><span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'data/1.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//2.解析</span>        <span class="token keyword">let</span> json<span class="token operator">=</span><span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//get blod</span>window<span class="token punctuation">.</span>onload<span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">let</span> oImg<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'img1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">let</span> oBtn<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      oBtn<span class="token punctuation">.</span>onclick<span class="token operator">=</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//1.请求</span>        <span class="token keyword">let</span> res<span class="token operator">=</span><span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'data/1.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//2.解析</span>        <span class="token keyword">let</span> data<span class="token operator">=</span><span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> url<span class="token operator">=</span>URL<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        oImg<span class="token punctuation">.</span>src<span class="token operator">=</span>url<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Front </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 笔记 </tag>
            
            <tag> Canvas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTML5</title>
      <link href="/posts/17f6.html"/>
      <url>/posts/17f6.html</url>
      
        <content type="html"><![CDATA[<h2 id="一、H5-拖拽"><a href="#一、H5-拖拽" class="headerlink" title="一、H5 拖拽"></a>一、H5 拖拽</h2><p>JS 里拖拽三事件， onmousedown onmousemove onmouseup 是实现交互性效果，根据鼠标的移动位置让标签元素联动</p><p>而 H5 拖拽也可以实现但更简单，实际例子： 百度图片识别，qq 邮箱文件提交，百度网盘文件上传，并可以获取到文件的 名称，大小，修改时间</p><p>标签元素默认是不可以拖拽的，<code>draggable=&quot;true&quot;</code>才能够被拖拽</p><ul><li><p><code>js</code>和<code>h5</code>拖拽的对比</p></li><li><p><code>drag</code>七事件的理解</p><ul><li>只是简单的拖拽而没有数据交换是没有什么用的</li></ul></li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 拖拽元素</span>drag<span class="token punctuation">.</span>ondragstart <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 拖拽的一瞬间</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">'pink'</span><span class="token punctuation">}</span>drag<span class="token punctuation">.</span>ondrag <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 连续触发</span>  document<span class="token punctuation">.</span>title <span class="token operator">=</span> n<span class="token operator">++</span><span class="token punctuation">}</span>drag<span class="token punctuation">.</span>ondragend <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 目标元素</span>box<span class="token punctuation">.</span>ondragenter <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 监听拖拽元素进入到目标元素区域内</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">'skyblue'</span><span class="token punctuation">}</span>box<span class="token punctuation">.</span>ondragover <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 在目标元素身上 连续触发</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> n<span class="token operator">++</span><span class="token punctuation">}</span>box<span class="token punctuation">.</span>ondragleave <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 在目标元素身上离开</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">}</span>box<span class="token punctuation">.</span>ondrop <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 将拖动的元素放置在目标元素上时触发</span><span class="token punctuation">}</span></code></pre><ul><li><code>drag</code>兼容处理方式</li><li>捕获<code>dataTransfer</code>对象里的数据</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> li <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span>li<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  item<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'draggable'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span>  item<span class="token punctuation">.</span>ondragstart <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// console.log(e.dataTransfer.setData())</span>    e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>  e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span>  e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">,</span>  e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lastModified<span class="token punctuation">,</span>  e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lastModifiedDate<span class="token punctuation">.</span><span class="token function">toLocaleDateString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lastModifiedDate<span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lastModifiedDate<span class="token punctuation">.</span><span class="token function">toDateString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><ul><li><p><code>Blog</code>对象与<code>URL</code>对象读取数据</p><p>Blob 对象代表了一段二进制数据，提供了一系列操作接口</p><pre><code>file对象的父类型是Blob对象</code></pre><p>​ 对象 URL 也被称为 blob URL，指的是引用保存在 File 或 Blob 中数据的 URL，使用对象 URL 的好处是没必要把内容读取到 js 中，而直接使用文件内容，能生成一个链接，例如 Img 的 src = URL</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 拖拽图片预览</span><span class="token keyword">let</span> oFile <span class="token operator">=</span> e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token keyword">let</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>oFile<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 第一参数一定是个数组 第二个mime类型</span><span class="token keyword">let</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>img<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">300</span>img<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">150</span>img<span class="token punctuation">.</span>src <span class="token operator">=</span> urlimg<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre></li><li><p><code>FileReader</code>读取数据</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 拖拽图片预览</span><span class="token keyword">let</span> oFile <span class="token operator">=</span> e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">// 创建文件读取对象</span><span class="token keyword">let</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>oFile<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 分析oFile 文件对象</span>reader<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 返回data: base64数据  A-Z a-z 0~9 + / = 64位字符</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span>  <span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  img<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">300</span>  img<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">150</span>  img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>result  img<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre></li><li><p>mime 类型</p><pre><code>application/envoy    evyapplication/fractals    fifapplication/futuresplash    splapplication/hta    htaapplication/internet-property-stream    acxapplication/mac-binhex40    hqxapplication/msword    docapplication/msword    dotapplication/octet-stream    *application/octet-stream    binapplication/octet-stream    classapplication/octet-stream    dmsapplication/octet-stream    exeapplication/octet-stream    lhaapplication/octet-stream    lzhapplication/oda    odaapplication/olescript    axsapplication/pdf    pdfapplication/pics-rules    prfapplication/pkcs10    p10application/pkix-crl    crlapplication/postscript    aiapplication/postscript    epsapplication/postscript    psapplication/rtf    rtfapplication/set-payment-initiation    setpayapplication/set-registration-initiation    setregapplication/vnd.ms-excel    xlaapplication/vnd.ms-excel    xlcapplication/vnd.ms-excel    xlmapplication/vnd.ms-excel    xlsapplication/vnd.ms-excel    xltapplication/vnd.ms-excel    xlwapplication/vnd.ms-outlook    msgapplication/vnd.ms-pkicertstore    sstapplication/vnd.ms-pkiseccat    catapplication/vnd.ms-pkistl    stlapplication/vnd.ms-powerpoint    potapplication/vnd.ms-powerpoint    ppsapplication/vnd.ms-powerpoint    pptapplication/vnd.ms-project    mppapplication/vnd.ms-works    wcmapplication/vnd.ms-works    wdbapplication/vnd.ms-works    wksapplication/vnd.ms-works    wpsapplication/winhlp    hlpapplication/x-bcpio    bcpioapplication/x-cdf    cdfapplication/x-compress    zapplication/x-compressed    tgzapplication/x-cpio    cpioapplication/x-csh    cshapplication/x-director    dcrapplication/x-director    dirapplication/x-director    dxrapplication/x-dvi    dviapplication/x-gtar    gtarapplication/x-gzip    gzapplication/x-hdf    hdfapplication/x-internet-signup    insapplication/x-internet-signup    ispapplication/x-iphone    iiiapplication/x-javascript    jsapplication/x-latex    latexapplication/x-msaccess    mdbapplication/x-mscardfile    crdapplication/x-msclip    clpapplication/x-msdownload    dllapplication/x-msmediaview    m13application/x-msmediaview    m14application/x-msmediaview    mvbapplication/x-msmetafile    wmfapplication/x-msmoney    mnyapplication/x-mspublisher    pubapplication/x-msschedule    scdapplication/x-msterminal    trmapplication/x-mswrite    wriapplication/x-netcdf    cdfapplication/x-netcdf    ncapplication/x-perfmon    pmaapplication/x-perfmon    pmcapplication/x-perfmon    pmlapplication/x-perfmon    pmrapplication/x-perfmon    pmwapplication/x-pkcs12    p12application/x-pkcs12    pfxapplication/x-pkcs7-certificates    p7bapplication/x-pkcs7-certificates    spcapplication/x-pkcs7-certreqresp    p7rapplication/x-pkcs7-mime    p7capplication/x-pkcs7-mime    p7mapplication/x-pkcs7-signature    p7sapplication/x-sh    shapplication/x-shar    sharapplication/x-shockwave-flash    swfapplication/x-stuffit    sitapplication/x-sv4cpio    sv4cpioapplication/x-sv4crc    sv4crcapplication/x-tar    tarapplication/x-tcl    tclapplication/x-tex    texapplication/x-texinfo    texiapplication/x-texinfo    texinfoapplication/x-troff    roffapplication/x-troff    tapplication/x-troff    trapplication/x-troff-man    manapplication/x-troff-me    meapplication/x-troff-ms    msapplication/x-ustar    ustarapplication/x-wais-source    srcapplication/x-x509-ca-cert    cerapplication/x-x509-ca-cert    crtapplication/x-x509-ca-cert    derapplication/ynd.ms-pkipko    pkoapplication/zip    zipaudio/basic    auaudio/basic    sndaudio/mid    midaudio/mid    rmiaudio/mpeg    mp3audio/x-aiff    aifaudio/x-aiff    aifcaudio/x-aiff    aiffaudio/x-mpegurl    m3uaudio/x-pn-realaudio    raaudio/x-pn-realaudio    ramaudio/x-wav    wavimage/bmp    bmpimage/cis-cod    codimage/gif    gifimage/ief    iefimage/jpeg    jpeimage/jpeg    jpegimage/jpeg    jpgimage/pipeg    jfifimage/svg+xml    svgimage/tiff    tifimage/tiff    tiffimage/x-cmu-raster    rasimage/x-cmx    cmximage/x-icon    icoimage/x-portable-anymap    pnmimage/x-portable-bitmap    pbmimage/x-portable-graymap    pgmimage/x-portable-pixmap    ppmimage/x-rgb    rgbimage/x-xbitmap    xbmimage/x-xpixmap    xpmimage/x-xwindowdump    xwdmessage/rfc822    mhtmessage/rfc822    mhtmlmessage/rfc822    nwstext/css    csstext/h323    323text/html    htmtext/html    htmltext/html    stmtext/iuls    ulstext/plain    bastext/plain    ctext/plain    htext/plain    txttext/richtext    rtxtext/scriptlet    scttext/tab-separated-values    tsvtext/webviewhtml    htttext/x-component    htctext/x-setext    etxtext/x-vcard    vcfvideo/mpeg    mp2video/mpeg    mpavideo/mpeg    mpevideo/mpeg    mpegvideo/mpeg    mpgvideo/mpeg    mpv2video/quicktime    movvideo/quicktime    qtvideo/x-la-asf    lsfvideo/x-la-asf    lsxvideo/x-ms-asf    asfvideo/x-ms-asf    asrvideo/x-ms-asf    asxvideo/x-msvideo    avivideo/x-sgi-movie    moviex-world/x-vrml    flrx-world/x-vrml    vrmlx-world/x-vrml    wrlx-world/x-vrml    wrzx-world/x-vrml    xafx-world/x-vrml    xof</code></pre></li></ul><h2 id="二、新增方法及历史管理"><a href="#二、新增方法及历史管理" class="headerlink" title="二、新增方法及历史管理"></a>二、新增方法及历史管理</h2><ul><li>通过<code>classList</code>对象对<code>class</code>类名增删改查</li><li>通过<code>dataset</code>对象对<code>data-Attr</code>格式的数据增删改查</li><li><code>parse</code>与<code>stringify</code>函数对数据类型解析和编码类型</li><li><code>decodeURL</code>与<code>encodeURL</code>函数对 url 数据进行解码和编码</li><li><code>atob</code>与<code>btoa</code>函数对<code>base64</code>数据进行解码和编码</li><li><code>history</code>操作数据布局</li><li><code>history</code>实现历史管理功能</li><li><code>history</code>对象下的<code>back</code>-<code>forward</code>-<code>go</code></li></ul><h2 id="三、Ajax-数据交互及文件上传功能"><a href="#三、Ajax-数据交互及文件上传功能" class="headerlink" title="三、Ajax 数据交互及文件上传功能"></a>三、Ajax 数据交互及文件上传功能</h2><ul><li>文件下载方式</li><li><code>ajax</code>和<code>php</code>数据交互</li><li>真实服务器数据交互演示及跨域访问</li><li><code>jsonp</code>跨域访问的核心本质</li><li><code>ajax</code> 和 <code>原生node</code> 数据交互</li><li><code>ajax</code> 和 <code>express框架</code> 数据交互</li><li><code>ajax</code> 和 <code>koa2框架</code> 数据交互</li><li>通过表单控件及<code>FormData</code>对象上传文件到服务器</li><li>通过 H5 拖拽及<code>FormData</code>对象上传文件到服务器</li><li>通过<code>onprogress</code>事件及<code>loaded</code>与<code>total</code>属性真实显示上传进度</li><li>同源同域名下跨文档操作</li></ul><h2 id="四、H5-本地存储-localStorage-webWorker-多线程-Server-Sent-Event-服务器发送事件-离线存储-cache-应用"><a href="#四、H5-本地存储-localStorage-webWorker-多线程-Server-Sent-Event-服务器发送事件-离线存储-cache-应用" class="headerlink" title="四、H5 本地存储 localStorage-webWorker 多线程-Server-Sent-Event 服务器发送事件-离线存储 cache 应用"></a>四、H5 本地存储 localStorage-webWorker 多线程-Server-Sent-Event 服务器发送事件-离线存储 cache 应用</h2><ul><li><code>setItem</code>与<code>getItem</code>存储和获取数据</li><li><code>webWorker</code>多线程原理</li><li>SSE 服务器消息推送</li><li>真实服务器演示 <code>cache离线存储设计</code></li></ul><pre><code>var source=new EventSource(&quot;demo_sse.php&quot;);source.onmessage=function(event)  {  document.getElementById(&quot;result&quot;).innerHTML+=event.data + &quot;&lt;br /&gt;&quot;;  };  &lt;?phpheader(&#39;Content-Type: text/event-stream&#39;);header(&#39;Cache-Control: no-cache&#39;);$time = date(&#39;r&#39;);echo &quot;data: The server time is: {$time}\n\n&quot;;flush();    //刷新缓冲区的内容,输出?&gt;</code></pre><h2 id="五、canvas-技术"><a href="#五、canvas-技术" class="headerlink" title="五、canvas 技术"></a>五、canvas 技术</h2><ul><li>canvas 认识</li><li>4 种矩形用法</li><li>样式属性</li><li>线条函数</li><li>路径问题</li><li>边界和端点样式</li><li>圆形函数用法</li><li>变换函数用法</li><li>保存和释放路径</li><li>图片绘制</li><li>视频绘制</li><li>填充背景方式</li><li>线性渐变</li><li>径向渐变</li><li>曲线函数</li><li>贝赛尔曲线画法</li><li>绘制文字</li><li>时钟表盘数字算法</li><li>图形阴影</li><li>像素操作</li><li>处理图片像素</li><li>图像合成</li><li>canvas 画面导出</li></ul><h2 id="七、video-和-audio"><a href="#七、video-和-audio" class="headerlink" title="七、video 和 audio"></a>七、video 和 audio</h2><ul><li><p>视频格式和音频格式</p></li><li><p>标签属性</p><ul><li>src</li><li>autoplay</li><li>controls</li><li>width</li><li>height</li><li>loop</li><li>preload</li><li>poster</li></ul></li><li><p>方法</p><ul><li>play( )</li><li>pause( )</li></ul></li><li><p>事件</p><ul><li>onplay</li><li>onpause</li><li>ontimeupdate</li><li>onended</li><li>progress</li><li></li></ul></li><li><p>属性</p><ul><li>currentTime</li><li>duration</li><li>ended</li><li>volume</li><li>height</li><li>width</li><li>currentSrc</li><li>videoWidth</li><li>videoHeight</li></ul></li></ul><h2 id="八、地理位置信息与高德地图-API"><a href="#八、地理位置信息与高德地图-API" class="headerlink" title="八、地理位置信息与高德地图 API"></a>八、地理位置信息与高德地图 API</h2><ul><li>原生 API 经纬度获取</li><li>高德地图 JS-API 调用</li></ul><h2 id="九、移动端"><a href="#九、移动端" class="headerlink" title="九、移动端"></a>九、移动端</h2><ul><li><p>移动端事件</p><ul><li><p>搭建真机测试</p></li><li><p>触屏三事件</p><ul><li>touchstart</li><li>touchmove</li><li>touchend</li></ul></li><li><p>手指信息对象</p></li></ul></li><li><p>三种适配方案</p><ul><li>百分比</li><li>自适应</li><li>rem</li><li>less 语法及编译</li></ul></li></ul><p>​</p>]]></content>
      
      
      <categories>
          
          <category> Front </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 笔记 </tag>
            
            <tag> H5 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WebAudio API</title>
      <link href="/posts/3a3a.html"/>
      <url>/posts/3a3a.html</url>
      
        <content type="html"><![CDATA[<h1 id="webAudio-API"><a href="#webAudio-API" class="headerlink" title="webAudio  API"></a>webAudio  API</h1><blockquote><p>webAudio API接口可以用来实现音乐可视化、音频剪辑、修声、语音、去声等等强大的操作</p></blockquote><p>webAudioAPI接口关系图：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5d50eef100016c9212800720.jpg" alt=""></p><h2 id="AudioContext"><a href="#AudioContext" class="headerlink" title="AudioContext"></a>AudioContext</h2><blockquote><p>AudioContext是所有音频操作的前提，一个类似Canvas的ctx的上下文对象</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5d50eb23000143f212800720.jpg" alt=""></p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>AudioContext <span class="token operator">||</span>  window<span class="token punctuation">.</span>webkitAudioContext <span class="token operator">||</span> window<span class="token punctuation">.</span>mozAudioContext <span class="token operator">||</span> window<span class="token punctuation">.</span>msAudioContext<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//由于API兼容性问题，需要在创建时加上后缀</span></code></pre><h2 id="AudioBufferSourceNode"><a href="#AudioBufferSourceNode" class="headerlink" title="AudioBufferSourceNode"></a>AudioBufferSourceNode</h2><blockquote><h3 id="创建音频源-方法（1）"><a href="#创建音频源-方法（1）" class="headerlink" title="创建音频源    方法（1）"></a>创建音频源    方法（1）</h3><p>这种方式是通过请求方式播放音乐</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5d50eea80001ad1a12800720.jpg" alt=""></p><pre class=" language-js"><code class="language-js"> <span class="token keyword">var</span> ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>AudioContext <span class="token operator">||</span>  window<span class="token punctuation">.</span>webkitAudioContext <span class="token operator">||</span> window<span class="token punctuation">.</span>mozAudioContext <span class="token operator">||</span> window<span class="token punctuation">.</span>msAudioContext<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">'./Kalimba.mp3'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//通过 fetch请求本地文件，返回样式设置为arraybuffer</span>        <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>            responseType<span class="token punctuation">:</span><span class="token string">'arraybuffer'</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">//将返回的数据转成arrayBuffer数据，并返回</span>          <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//使用ac.decodeAudioData(arrayBuffer, succ(buffer), err)方法音频解码，获取成功后调用第一个回调并返回buffer解码数据，失败则调用最后个回调</span>            ac<span class="token punctuation">.</span><span class="token function">decodeAudioData</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//创建bufferSource</span>                <span class="token keyword">let</span> BufferSource <span class="token operator">=</span> ac<span class="token punctuation">.</span><span class="token function">createBufferSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//将返回的数据给它</span>                BufferSource<span class="token punctuation">.</span>buffer <span class="token operator">=</span> buffer<span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//直接连接音频聚集地</span>                BufferSource<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>ac<span class="token punctuation">.</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//开始播放</span>                BufferSource<span class="token punctuation">[</span>BufferSource<span class="token punctuation">.</span>start <span class="token operator">?</span> <span class="token string">'start'</span> <span class="token punctuation">:</span> <span class="token string">'noteOn'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="MediaElementAudioSourceNode"><a href="#MediaElementAudioSourceNode" class="headerlink" title="MediaElementAudioSourceNode"></a>MediaElementAudioSourceNode</h3><blockquote><p><strong>创建音频源  方法（2）</strong></p><p>这种方式是通过 DOM元素 播放音乐</p></blockquote><pre class=" language-js"><code class="language-js">    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"button"</span> value<span class="token operator">=</span><span class="token string">"播放"</span> onclick<span class="token operator">=</span><span class="token string">'music.play()'</span><span class="token operator">></span>  <span class="token comment" spellcheck="true">//点击播放音乐   </span>    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"button"</span> value<span class="token operator">=</span><span class="token string">"停止"</span> onclick<span class="token operator">=</span><span class="token string">"music.pause()"</span><span class="token operator">></span> <span class="token comment" spellcheck="true">//点击停止音乐</span>    <span class="token operator">&lt;</span>script<span class="token operator">></span>        <span class="token keyword">var</span> ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>AudioContext <span class="token operator">||</span>  window<span class="token punctuation">.</span>webkitAudioContext <span class="token operator">||</span> window<span class="token punctuation">.</span>mozAudioContext <span class="token operator">||</span> window<span class="token punctuation">.</span>msAudioContext<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//创建音乐DOM元素</span>        <span class="token keyword">let</span> music <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Audio</span><span class="token punctuation">(</span><span class="token string">'./Kalimba.mp3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//通过 DOM元素创建音频源</span>        <span class="token keyword">let</span> source <span class="token operator">=</span> ac<span class="token punctuation">.</span><span class="token function">createMediaElementSource</span><span class="token punctuation">(</span>music<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//直接连接音频聚集地</span>        source<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>ac<span class="token punctuation">.</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><h3 id="使用input-type-file-创建-（可以本地获取）"><a href="#使用input-type-file-创建-（可以本地获取）" class="headerlink" title="使用input[type=file]创建 （可以本地获取）"></a>使用input[type=file]创建 （可以本地获取）</h3><pre class=" language-js"><code class="language-js"> <span class="token keyword">var</span> audioCtx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>AudioContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">var</span> audioInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"uploader"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//HTML语句：&lt;input type="file" id="uploader" /></span>      audioInput<span class="token punctuation">.</span>onchange <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//文件长度不为0则真的选中了文件，因为用户点击取消也会触发onchange事件。</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>audioInput<span class="token punctuation">.</span>files<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          files <span class="token operator">=</span> audioInput<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//得到用户选取的文件 //文件选定之后，马上用FileReader进行读入</span>          fr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          fr<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">var</span> fileResult <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//文件读入完成，进行解码</span>            audioCtx<span class="token punctuation">.</span><span class="token function">decodeAudioData</span><span class="token punctuation">(</span>              fileResult<span class="token punctuation">,</span>              <span class="token keyword">function</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">let</span> source <span class="token operator">=</span> audioCtx<span class="token punctuation">.</span><span class="token function">createBufferSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                source<span class="token punctuation">.</span>buffer <span class="token operator">=</span> buffer<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将解码出来的数据放入source中 //转到播放和分析环节</span>                source<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>audioCtx<span class="token punctuation">.</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>                source<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span><span class="token punctuation">,</span>              <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"!Fail to decode the file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//解码出错</span>              <span class="token punctuation">}</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">;</span>          fr<span class="token punctuation">.</span>onerror <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"!Fail to read the file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//文件读入出错</span>          <span class="token punctuation">}</span><span class="token punctuation">;</span>          fr<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//同样的，ArrayBuffer方式读取</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h2 id="GainNode"><a href="#GainNode" class="headerlink" title="GainNode"></a>GainNode</h2><blockquote><p>gain是在音乐播放之前处理声音大小的中间件</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5d50efb100011b9612800718.jpg" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/gain.PNG" alt=""></p><p>这里使用DOM元素方式来演示 ， 请求方式的设置也和它一样</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"button"</span> value<span class="token operator">=</span><span class="token string">"播放"</span> onclick<span class="token operator">=</span><span class="token string">'music.play()'</span><span class="token operator">></span>  <span class="token comment" spellcheck="true">//点击播放音乐   </span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"button"</span> value<span class="token operator">=</span><span class="token string">"停止"</span> onclick<span class="token operator">=</span><span class="token string">"music.pause()"</span><span class="token operator">></span> <span class="token comment" spellcheck="true">//点击停止音乐</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"range"</span> max<span class="token operator">=</span><span class="token string">"100"</span> min<span class="token operator">=</span><span class="token string">"0"</span> value<span class="token operator">=</span><span class="token string">"60"</span> oninput<span class="token operator">=</span><span class="token string">"setGain(this)"</span><span class="token operator">></span> <span class="token comment" spellcheck="true">//控制音乐播放声音</span>    <span class="token operator">&lt;</span>script<span class="token operator">></span>        <span class="token keyword">var</span> ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>AudioContext <span class="token operator">||</span>  window<span class="token punctuation">.</span>webkitAudioContext <span class="token operator">||</span> window<span class="token punctuation">.</span>mozAudioContext <span class="token operator">||</span> window<span class="token punctuation">.</span>msAudioContext<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//创建音乐DOM元素</span>        <span class="token keyword">let</span> music <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Audio</span><span class="token punctuation">(</span><span class="token string">'./Kalimba.mp3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//通过 DOM元素创建音频源</span>        <span class="token keyword">let</span> source <span class="token operator">=</span> ac<span class="token punctuation">.</span><span class="token function">createMediaElementSource</span><span class="token punctuation">(</span>music<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//Gain连接destination</span>        <span class="token keyword">let</span> gain <span class="token operator">=</span> ac<span class="token punctuation">.</span><span class="token function">createGain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gain<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>ac<span class="token punctuation">.</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//必须连接Gain ， 不再是连接destination了，否则音频没有经过gain处理，效果不会生效</span>        source<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>gain<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//设置gain.gain.value 的值，跟随input的value改变，实现改变声音大小</span>        <span class="token keyword">function</span> <span class="token function">setGain</span><span class="token punctuation">(</span>that<span class="token punctuation">)</span>        <span class="token punctuation">{</span>               gain<span class="token punctuation">.</span>gain<span class="token punctuation">.</span>value <span class="token operator">=</span> that<span class="token punctuation">.</span>value<span class="token operator">/</span>that<span class="token punctuation">.</span>max<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><h2 id="analyserNode"><a href="#analyserNode" class="headerlink" title="analyserNode"></a>analyserNode</h2><blockquote><p>这个节点可以实现音频的可视化，是一个可视化中必不可少的重要步骤</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/5d50eff8000127e612800718.jpg" alt=""></p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//创建Analyser</span><span class="token keyword">var</span> analyser <span class="token operator">=</span> ac<span class="token punctuation">.</span><span class="token function">createAnalyser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//设置fftSize大小</span>analyser<span class="token punctuation">.</span>fftSize <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//链接destination Gain节点，随之Gain节点到终点去</span>analyser<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>gain<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//创建Uint8Array数据，并运用frequencyBinCount 来获取fft的一半</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>analyser<span class="token punctuation">.</span>frequencyBinCount<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//然后使用getByFrequencyData来获取范围频域</span>analyser<span class="token punctuation">.</span><span class="token function">getByteFrequencyData</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//最后配合Canvas和requestAnimationFrame(callback)动画函数来实现可视化;</span></code></pre><pre class=" language-js"><code class="language-js"> <span class="token keyword">var</span> ctx <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      ctx<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>      <span class="token keyword">var</span> width <span class="token operator">=</span> ctx<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span>        height <span class="token operator">=</span> ctx<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>      window<span class="token punctuation">.</span>onresize <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        ctx<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>        width <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>        <span class="token keyword">let</span> line <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createLinearGradient</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>        line<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        line<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        line<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> line<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token keyword">let</span> line <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createLinearGradient</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>      line<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      line<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      line<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> line<span class="token punctuation">;</span>      <span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span>Data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> w <span class="token operator">=</span> width <span class="token operator">/</span> <span class="token number">128</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>            w <span class="token operator">*</span> i<span class="token punctuation">,</span>            height <span class="token operator">-</span> <span class="token punctuation">(</span>Data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">256</span><span class="token punctuation">)</span> <span class="token operator">*</span> height<span class="token punctuation">,</span>            <span class="token punctuation">(</span>width <span class="token operator">/</span> Data<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">,</span>            Data<span class="token punctuation">[</span>i<span class="token punctuation">]</span>          <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>      <span class="token keyword">var</span> ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>AudioContext <span class="token operator">||</span>        window<span class="token punctuation">.</span>webkitAudioContext <span class="token operator">||</span>        window<span class="token punctuation">.</span>mozAudioContext <span class="token operator">||</span>        window<span class="token punctuation">.</span>msAudioContext<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//创建gain 来控制声音大小</span>      <span class="token keyword">let</span> gain <span class="token operator">=</span> ac<span class="token punctuation">.</span><span class="token function">createGain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//链接音频终点</span>      gain<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>ac<span class="token punctuation">.</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//创建analyser 来实现可视化</span>      <span class="token keyword">let</span> analyser <span class="token operator">=</span> ac<span class="token punctuation">.</span><span class="token function">createAnalyser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      analyser<span class="token punctuation">.</span>fftSize <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//链接gain</span>      analyser<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>gain<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//获取音乐数据</span>      <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"./music/Kalimba.mp3"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>        responseType<span class="token punctuation">:</span> <span class="token string">"arraybuffer"</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> res<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          ac<span class="token punctuation">.</span><span class="token function">decodeAudioData</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> buffer <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">let</span> bufferSource <span class="token operator">=</span> ac<span class="token punctuation">.</span><span class="token function">createBufferSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bufferSource<span class="token punctuation">.</span>buffer <span class="token operator">=</span> buffer<span class="token punctuation">;</span>            bufferSource<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>analyser<span class="token punctuation">)</span><span class="token punctuation">;</span>            bufferSource<span class="token punctuation">[</span>bufferSource<span class="token punctuation">.</span>start <span class="token operator">?</span> <span class="token string">"start"</span> <span class="token punctuation">:</span> <span class="token string">"noteOn"</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//创建数据</span>        <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>analyser<span class="token punctuation">.</span>frequencyBinCount<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//解决各浏览器的兼容性问题</span>        requestAnimationFrame <span class="token operator">=</span>          window<span class="token punctuation">.</span>requestAnimationFrame <span class="token operator">||</span>          window<span class="token punctuation">.</span>webkitRequestAnimationFrame <span class="token operator">||</span>          window<span class="token punctuation">.</span>mozRequestAnimationFrame<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//创建动画函数</span>        <span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">//获取频域</span>          analyser<span class="token punctuation">.</span><span class="token function">getByteFrequencyData</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">draw</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">//循环</span>          <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//启动动画函数</span>        <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">function</span> <span class="token function">setGain</span><span class="token punctuation">(</span>that<span class="token punctuation">)</span> <span class="token punctuation">{</span>        gain<span class="token punctuation">.</span>gain<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token operator">+</span>that<span class="token punctuation">.</span>value <span class="token operator">/</span> <span class="token operator">+</span>that<span class="token punctuation">.</span>max<span class="token punctuation">;</span>      <span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Front </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> webAudio API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS中Buffer数据详解</title>
      <link href="/posts/bd7.html"/>
      <url>/posts/bd7.html</url>
      
        <content type="html"><![CDATA[<h1 id="元数据处理"><a href="#元数据处理" class="headerlink" title="元数据处理"></a>元数据处理</h1><h2 id="序言"><a href="#序言" class="headerlink" title="序言"></a><strong>序言</strong></h2><p>随着WebSocket、WebAudio、Ajax2等广泛应用，前端方面只要是处理大数据或者想提高数据处理性能，那一定是少不了 ArrayBuffer对象</p><p>同时在浏览器当中处理二进制数据的需求也在不断的增加，有时需要字节数组、8位、16位、32位整数型数组，所以对于JS中处理二进制迟早学习比较好</p><p>现今世界上几乎所有的计算机体系结构都是以字节（byte）为二进制数据的基本单位，所以二进制常常以字节数组的形式存在于程序当中</p><p>众所周知，JS是弱类型语言i，并且JS设计之初似乎根本没想过要处理二进制的东西，对于字节的概念可以说是非常非常的模糊。如果要表达字节数组，那么似乎只能用一个普通数组来表示</p><p>那么H5的诞生及标准的发布，对技术的革新起了非常大的作用，深入地研究H5，会渐渐发现，很多时候都会对二进制数据进行处理，结合JS的ArrayBuffer和 Typed Array去获取及处理音频数据、XHR2上传或下载二进制内容等等</p><h2 id="arrayBuffer"><a href="#arrayBuffer" class="headerlink" title="arrayBuffer"></a>arrayBuffer</h2><p><code>ArrayBuffer</code>表示二进制数据的原始缓冲区，该缓冲区用于存储各种类型化数组的数据。是最基础的原始数据容器，无法直接读取或写入， 需要通过其他方式来读写。 但可根据需要将其传递到类型化数组或 DataView 对象来解释原始缓冲区。</p><p>也就是说他是一个二进制数据的原始缓冲区，虽然 JavaScript 是弱类型语言，但是他本身是对数据的类型和大小都有限制的，我们<code>需要通过某种数据结构将缓冲区的内容有序的读取出来或写进去</code></p><pre class=" language-css"><code class="language-css">例如：Int<span class="token number">8</span>Array             <span class="token number">8</span>位有符号整数Uint<span class="token number">8</span>Array            <span class="token number">8</span>位无符号整数Uint<span class="token number">8</span>ClampedArray      同上，像素操作Int<span class="token number">16</span>Array            Uint<span class="token number">16</span>ArrayInt<span class="token number">32</span>ArrayUint<span class="token number">32</span>ArrayFloat<span class="token number">32</span>ArrayFloat<span class="token number">64</span>Array以上是Typed Array类型化数组，类型化数组类型表示可编制索引和操纵的 ArrayBuffer 对象 的各种视图。 所有数组类型的长度均固定。而DataView视图对象对数据的操作更加细致</code></pre><p><code>ArrayBuffer</code>是一个固定长度的字节序列，通过<code>new ArrayBuffer(length)</code>来得到一片空间，内部实现与数组应该是不一样（内存分配和布局与Array不一样），<code>ArrayBuffer</code>是连续内存，因此对于高密度的访问（如音频数据）操作而言它比JS中的Array速度会快很多</p><p><code>ArrayBuffer</code>是不能直接被访问的，因此需要借助Typed Array</p><p>Typed Array的背后是一个<code>ArrayBuffer</code>，也就是说，事实上的数据是存在<code>ArrayBuffer</code>里面的，而Typed Array只是给你提供了一个某种类型的读写接口</p><p>总结一句话:    Typed Array不直接存放任何数据，所有对Typed Array进行读写的操作，最终都会落实到它背后所持有的<code>ArrayBuffer</code>的身上。 <code>ArrayBuffer</code>才是真正的元始数据字节，而Typed Array只是一个操作窗口/操作视图（View）</p><h2 id="获取二进制数据"><a href="#获取二进制数据" class="headerlink" title="获取二进制数据"></a>获取二进制数据</h2><p>常见的在网页里获取二进制数据有三种:</p><blockquote><p>-[x] XMLHttpRequest2<br>-[x] File<br>-[x] Blob</p></blockquote><p>​    <strong>通过XMLHttpRequest 2</strong></p><p>​    <code>XHR2</code> 的接口跟 <code>XHR</code> 几乎是一样的，当制定<code>xhr.responseType = &#39;arraybuffer&#39;</code>以后，在成功获取数据的回调里就可以通过<code>xhr.response</code>来得到请求结果的<code>ArrayBuffer</code>了，然后就可以按照你的意愿来构造各种Typed Array进行访问。</p><p><code>responseType</code>还可以有<code>blob</code>取值，可以用<code>xhr.response</code>获得<a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" target="_blank" rel="noopener">Blob</a>对象。</p><p>​    <strong>通过File和Blob</strong></p><p>​    在H5的表单File控件中，通过files对象来获取一个<code>FileList</code> ，此列表对象中的每一个都是files对象</p><p>​    也可以通过H5的拖拽drop事件捕获到files对象或blob对象</p><p>​    <code>File</code>继承了<code>Blob</code>，并提供了<code>name</code>  ， <code>lastModifiedDate</code>， <code>size</code> ，<code>type</code> 等基础元数据</p><p>​    <code>Blob</code> 与<code>ArrayBuffer</code>的区别是除了 原始字节 以外它还提供了mime type作为元数据</p><p>​    它们都可以借助 FileReader将<code>Blob</code>读取为更为实用的数据类型去使用</p><pre class=" language-css"><code class="language-css"><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">readAsBinaryString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>readAsData<span class="token url">URL()</span><span class="token function">readAsText</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="各种类型"><a href="#各种类型" class="headerlink" title="各种类型"></a>各种类型</h2><p>上节课中，我们讲过在火狐下拖拽元素需要用setData函数设置键值对，同时用getData函数可以获取key的value值，那么IE定义了 text和url 这两种有效的数据类型，可以获取本网页上文本和图片路径</p><blockquote><p>e.dataTransfer.getData(‘url’)    获取 url</p></blockquote><blockquote><p>e.dataTransfer.getData(‘Text’)        获取文本</p></blockquote><p>H5对此也支持，并扩展了各种 <code>MIME</code> 类型，这两种类型会被映射为 ‘text/plain’和’text/uri-list’</p><p>所以可以兼容一下:</p><pre class=" language-css"><code class="language-css">兼容var dataTransfer = e<span class="token number">.</span>dataTransfer获取 URLvar url = dataTransfer<span class="token number">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span> || dataTransfer<span class="token number">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">'text/uri-list'</span><span class="token punctuation">)</span>获取 文本var url = dataTransfer<span class="token number">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">'Text'</span><span class="token punctuation">)</span> || dataTransfer<span class="token number">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">'text/plain'</span><span class="token punctuation">)</span></code></pre><pre class=" language-css"><code class="language-css">MIME 类型MIME <span class="token punctuation">(</span>Multipurpose Internet Mail Extensions<span class="token punctuation">)</span> 是描述消息内容类型的因特网标准。MIME 消息能包含文本、图像、音频、视频以及其他应用程序专用的数据。不同的应用程序支持不同的 MIME 类型。MIME 类型大约有<span class="token number">191</span>种类型，是的没错，<span class="token number">191</span>种^<span class="token number">.</span>^</code></pre><pre class=" language-css"><code class="language-css">Base<span class="token number">64</span> 类型Base<span class="token number">64</span>是网络上最常见的用于传输<span class="token number">8</span>Bit字节码的编码方式之一，Base<span class="token number">64</span>就是一种基于<span class="token number">64</span>个可打印字符来表示二进制数据的方法Base<span class="token number">64</span>编码是从二进制到字符的过程中，可用于在HTTP环境下传递较长的标识信息</code></pre><p><strong>FileReader文件对象</strong></p><pre class=" language-css"><code class="language-css">FileReader API 用于读取文件，即把文件内容读入内存，是一种异步文件读取机制，它的参数是 File 对象或 Blob 对象。对于不同类型的文件，FileReader 提供不同的方法读取文件。</code></pre><pre class=" language-css"><code class="language-css">创建读取文件的对象var reader = new <span class="token function">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    readAsData<span class="token url">URL(Blob|File)</span> 读取文件并将文件以数据URI的形式保存在result属性中，返回一个基于 Base<span class="token number">64</span> 编码的 data-uri 对象reader<span class="token number">.</span>readAsData<span class="token url">URL(files[0])</span><span class="token function">readAsText</span><span class="token punctuation">(</span>Blob|File, opt_encoding<span class="token punctuation">)</span>返回文本字符串。默认情况下，文本编码格式是 UTF-<span class="token number">8</span>，可以通过可选的格式参数，指定其他编码格式的文本以纯文本形式读取文件，将读取到的文本保存在result属性中，第二个参数用于指定编码类型，可选的reader<span class="token number">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span> files[<span class="token number">0</span>],encoding <span class="token punctuation">)</span><span class="token function">readAsBinaryString</span><span class="token punctuation">(</span>Blob|File<span class="token punctuation">)</span>    IE可能不支持返回二进制字符串，该字符串每个字节包含一个 <span class="token number">0</span> 到 <span class="token number">255</span> 之间的整数。（已废弃）读取文件并将一个字符保存在result属性中，字符串的每个字符表示一字节reader<span class="token number">.</span><span class="token function">readAsBinaryString</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>Blob|File<span class="token punctuation">)</span>    IE可能不支持返回一个 ArrayBuffer 对象读取文件并将一个包含文件内容的ArrayBuffer保存在result属性中reader<span class="token number">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span></code></pre><h2 id="具体用法"><a href="#具体用法" class="headerlink" title="具体用法"></a>具体用法</h2><p><strong>FileList</strong> 对象 </p><p>​        当用户通过 <strong><em>file 控件</em></strong> 选取文件后，这个控件的 this.files 属性值就是 FileList 对象。是个<strong><em>类数组</em></strong>，带上multiple 属性用户可选取多个文件，否则只能选择一个元素。</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">'file'</span> multiple id<span class="token operator">=</span><span class="token string">'oInput'</span><span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span>script<span class="token operator">></span>    oInput<span class="token punctuation">.</span>onchange <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>​        拖拽也可以获取  FileList 对象</p><pre class=" language-js"><code class="language-js">oInput<span class="token punctuation">.</span>ondrop <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">var</span> files <span class="token operator">=</span> e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>​        <em>在表单选择文件或者拖拽文件中，用户通过事件触发，只能被动地读取FileList 文件列表</em></p><p><strong>Blob</strong> 对象 </p><p>​        file对象的父类型是Blob对象， Blob对象代表了一段二进制数据，提供了一系列操作接口</p><p>​        生成 Blob 对象有两种方法：</p><blockquote><ul><li><input checked="" disabled="" type="checkbox"> 使用 Blob 构造函数</li><li><input checked="" disabled="" type="checkbox"> 另一种是对现有的 Blob 对象使用 slice 方法切出一部分</li></ul></blockquote><pre class=" language-js"><code class="language-js">Blob 构造函数，接受两个参数。第一个参数是一个包含实际数据的数组第二个参数是数据的类型这两个参数都不是必需的<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"world"</span><span class="token punctuation">]</span><span class="token keyword">var</span> Blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">"type"</span> <span class="token punctuation">:</span> <span class="token string">"text/xml"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Blob<span class="token punctuation">)</span></code></pre><pre class=" language-js"><code class="language-js">Blob 对象的 slice 方法，将二进制数据按照字节分块，返回一个新的 Blob 对象<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"world"</span><span class="token punctuation">]</span><span class="token keyword">var</span> Blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">"type"</span> <span class="token punctuation">:</span> <span class="token string">"text/xml"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">var</span> newBlob <span class="token operator">=</span> Blob<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 用在分片文件 ，后台接收把这些片段检验并组合一个文件</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newBlob<span class="token punctuation">)</span>Blob 对象有两个只读属性：size：二进制数据的大小，单位为字节。（文件上传时可以在前端判断文件大小是否合适）type：二进制数据的 MIME 类型，全部为小写，如果类型未知，则该值为空字符串。（文件上传时可以在前端判断文件类型是否合适）gbk编码：    数字字母 一字节 1KB<span class="token operator">=</span> <span class="token number">1024</span>字节 一中文汉字是 <span class="token number">2</span>字节UTF<span class="token number">-8</span>编码： 数字字母 一字节 1KB<span class="token operator">=</span> <span class="token number">1024</span>字节 一个中文汉字是 <span class="token number">3</span>字节</code></pre><p>​    <strong>Silce</strong> <em>读取部分内容</em></p><p>​        有时候我们读取一部分而不是全部内容，Filereader对象支持一个slice( )方法，在火狐中用mozSlice( )，在chrome中webkitSilde( )</p><pre class=" language-css"><code class="language-css">    > <span class="token function">silce</span><span class="token punctuation">(</span> start,end <span class="token punctuation">)</span>    >    > start 开始索引，默认为<span class="token number">0</span>    >    > end    截取结束索引（不包括end）    > contentType    新Blob的MIME类型，默认为空字符串</code></pre><p>​        这个方法返回一个Blob实例，Blog是File类型的父类型，Blog类型有一个size属性和一个type属性，它也支持slice方法，以便进一步切割数据，通过FileReader也可以从Blob中读取数据</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">blogSlice</span><span class="token punctuation">(</span> blob<span class="token punctuation">,</span>start<span class="token punctuation">,</span>end <span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span> blog<span class="token punctuation">.</span>slice <span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> blob<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span>end<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> blob<span class="token punctuation">.</span>webkitSlice <span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">return</span> blob<span class="token punctuation">.</span><span class="token function">webkitSlice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span>end<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> blob<span class="token punctuation">.</span>mozSlice <span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> blob<span class="token punctuation">.</span><span class="token function">mozSlice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span>end<span class="token punctuation">)</span>             <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>          <span class="token keyword">return</span> <span class="token keyword">null</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>​    blob类型读取FileReader的20B内容 </p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token function">blogSlice</span><span class="token punctuation">(</span> e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">20</span> <span class="token punctuation">)</span>reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span> blob <span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span> blob <span class="token punctuation">)</span><span class="token punctuation">{</span>       reader<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        box<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>result    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'no data'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>​    只读取文件的一部分可以节省时间，非常适合只关注数据中某个特定部分（如文件文件）的情况</p><p>​    <strong>对象URL</strong>    </p><p>​        对象URL也被称为 blob URL，指的是引用保存在File或Blob中数据的URL，使用对象URL的好处是没必要把内容读取到js中，而直接使用文件内容，能生成一个链接，例如 Img的src = URL</p><p>​        创建对象URL，用 window.URL.createObjectURL( blob )方法，并传入flle或Blob对象，对二进制数据生成一个 临时的URL，这个 URL 可以放置于任何通常可以放置 URL 的地方，比如 img 标签的 src 属性，出于一些特殊的需要，也可以使URL失效，调用 URL.revokeObjectURL( url ) 方法，使 URL 失效</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createObject</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">if</span><span class="token punctuation">(</span> window<span class="token punctuation">.</span>URL <span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">return</span> window<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> window<span class="token punctuation">.</span>webkitURL <span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">return</span> window<span class="token punctuation">.</span>webkitURL<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>          <span class="token keyword">return</span> <span class="token keyword">null</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>​    createObject函数的返回值是一个字符串，指向一块<strong><em>内存地址</em></strong>。因为这个字符串是URL，所 以在DOM中也能使用，例如下用法 </p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">createObject</span><span class="token punctuation">(</span> files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span> url <span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token regex">/image/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>         box<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'&lt;img src="'</span><span class="token operator">+</span>url<span class="token operator">+</span><span class="token string">'" />'</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>          <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'no img'</span> <span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>      <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'no data'</span> <span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>​    直接把对象URL放在img标签中，就省去了把数据先读取js中，另一方面img标签则会找到相应的内存地址，直接读取数据并将图像显示到页面中</p>]]></content>
      
      
      <categories>
          
          <category> Front </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Buffer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Chrome Devtools</title>
      <link href="/posts/c9c3.html"/>
      <url>/posts/c9c3.html</url>
      
        <content type="html"><![CDATA[<h1 id="Chrome-Devtools-使用技巧"><a href="#Chrome-Devtools-使用技巧" class="headerlink" title="Chrome Devtools 使用技巧"></a>Chrome Devtools 使用技巧</h1><h2 id="1-网页可编辑"><a href="#1-网页可编辑" class="headerlink" title="1.网页可编辑"></a>1.网页可编辑</h2><p>(1)document.designMode = ‘on’<br>(2)打开任何网站，在网址栏输入:可手机端<br>javascdy.setAttribute(‘contentEditable’,’true’);</p><h2 id="2-chrome-网页全屏、元素截图"><a href="#2-chrome-网页全屏、元素截图" class="headerlink" title="2.chrome 网页全屏、元素截图"></a>2.chrome 网页全屏、元素截图</h2><p>（1）移动端 点击右上角三个点 里面的full即可全屏截图<br>（2）pc端 打开devtools ctrl+shift+p 打开命令行 输入full即可<br>（3） 截图单个元素  选择一个元素，MAC下按cmd+shift+p、windows下按ctrl+shift+p来打开命令菜单，然后输入Capture node screenshot</p><h2 id="3-条件断点"><a href="#3-条件断点" class="headerlink" title="3.条件断点"></a>3.条件断点</h2><p>（1）在断点的地方右键，选择“Edit breakpoint”就可以写上你想出现调试的条件表达式<br>（2）在sources面板 现在要断点的代码 ctrl+shift+e 在控制台运行当前选中的代码片段</p><h2 id="4-将修改后的CSS保存到文件"><a href="#4-将修改后的CSS保存到文件" class="headerlink" title="4.将修改后的CSS保存到文件"></a>4.将修改后的CSS保存到文件</h2><p>（1）点击你编辑的CSS文件的名称，进入到Sources面板，你会发现你的修改已经在里面了。然后你可以对你实时的编辑进行保存。<br>这个修改不适用于添加的新选择器，也不适用于element.style属性，仅仅适用于原有选择器。</p><h2 id="5-轻松获取某个审查元素的引用"><a href="#5-轻松获取某个审查元素的引用" class="headerlink" title="5.轻松获取某个审查元素的引用"></a>5.轻松获取某个审查元素的引用</h2><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/359230521-5daf0156210a6_articlex.gif" alt=""><br>（1）打开控制台，在 Elements 界面下，对着某个 dom 标签点击右键，选择 Store as global variable。</p><h2 id="6-创建并钉住一个动态表达式"><a href="#6-创建并钉住一个动态表达式" class="headerlink" title="6.创建并钉住一个动态表达式"></a>6.创建并钉住一个动态表达式</h2><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/3286822154-5daf0152c665f_articlex.gif" alt=""></p><h2 id="7-禁用缓存和保存日志"><a href="#7-禁用缓存和保存日志" class="headerlink" title="7.禁用缓存和保存日志"></a>7.禁用缓存和保存日志</h2><p>（1）缓存有时候会造成很多难以排查的 bug，为了排除这个因素，你可以勾选Network 界面下的 Disable cache 选项（它只在 DevTools 窗口打开时生效）。</p><h2 id="8-Chrome-Workspace"><a href="#8-Chrome-Workspace" class="headerlink" title="8.Chrome Workspace"></a>8.Chrome Workspace</h2><p>（1） 在sources面板中, 通过 Workspace，你可以把本地服务器的资源映射为硬盘上的文件，实现调试 JS 和 CSS 的同时自动保存文件，比如 Elements 面板中的样式变更会自动保存到文件中。</p>]]></content>
      
      
      <categories>
          
          <category> Front </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Chrome Devtools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6新特性</title>
      <link href="/posts/33ad.html"/>
      <url>/posts/33ad.html</url>
      
        <content type="html"><![CDATA[<h1 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a><strong>ES6</strong></h1><h2 id="变量声明扩展"><a href="#变量声明扩展" class="headerlink" title="变量声明扩展"></a>变量声明扩展</h2><h3 id="变量声明的特性比较"><a href="#变量声明的特性比较" class="headerlink" title="变量声明的特性比较"></a>变量声明的特性比较</h3><hr><table><thead><tr><th>语法格式</th><th>声明类型</th><th>是否可重复声明</th><th>是否声明提升</th><th>特性</th></tr></thead><tbody><tr><td>var</td><td>变量</td><td>YES</td><td>YES</td><td>无块级作用域、限制性太弱</td></tr><tr><td>let</td><td>变量</td><td>NO</td><td>NO</td><td>有块级作用域、不可重复、无声明提升、限制性强</td></tr><tr><td>const</td><td>常量</td><td>NO</td><td>NO</td><td>不可修改、有块级作用域、限制性强</td></tr></tbody></table><hr><h3 id="块级作用域："><a href="#块级作用域：" class="headerlink" title="块级作用域："></a>块级作用域：</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>    <span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> a2 <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> a3 <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//在括号内使用即可正常使用、由内向外、不可从外向内</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//10</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//20</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//20</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//或</span><span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//在以上带{}语法中用let、const声明时都具有块级作用域</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ERROR</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//20</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//ERROR</span></code></pre><h3 id="暂时性死区："><a href="#暂时性死区：" class="headerlink" title="暂时性死区："></a>暂时性死区：</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//由于let和const 无变量提升，在声明前调用将会出错 var 会出现undefined，不会报错</span><span class="token comment" spellcheck="true">//未被let、const声明的变量、执行操作反而没事，而使用了这两者未在规定的范围内使用将会直接出错。</span><span class="token keyword">var</span> STR <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>STR<span class="token punctuation">)</span>            <span class="token keyword">let</span> STR<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//去掉这句，即可正常执行</span>        <span class="token punctuation">}</span></code></pre><h2 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h2><p>语法格式：</p><ol><li>左右两边类型相同、一样。</li><li>右边必须是个可使用的东西或者是容器，不一定要相同的格数</li><li>若相同可简写，注意区分</li><li>右边可设置默认值</li><li>可嵌套 如：数组、对象</li></ol><hr><p>用法：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//解构不一定要相同</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token string">"string"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//若相同可简写，注意区分</span><span class="token punctuation">{</span>m<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>m<span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//等价于</span><span class="token punctuation">{</span>m<span class="token punctuation">:</span>m<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>m<span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//可默认值</span><span class="token punctuation">{</span>j<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">}</span><span class="token operator">=</span><span class="token punctuation">{</span>c<span class="token punctuation">:</span><span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//输出 {j:200,b:299,c:300};</span><span class="token comment" spellcheck="true">//在一些传参发面时可以使用以下这种方法</span><span class="token punctuation">{</span>type<span class="token operator">=</span><span class="token string">'GET'</span><span class="token punctuation">,</span>dataType<span class="token operator">=</span><span class="token string">'json'</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//没传参 默认使用对应的参数</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>type<span class="token operator">=</span><span class="token string">'GET'</span><span class="token punctuation">,</span>dataType<span class="token operator">=</span><span class="token string">'json'</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//没传对象时使用默认的对象</span></code></pre><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><hr><h3 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h3><ol><li>可以固定this的指向</li><li>语法格式比较与ES5时有一定的改变和缩简</li><li>在特定情况可以极大缩简</li></ol><hr><p>语法格式：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> f1 <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//特定情况:指当参数和执行语句只有一条时即可</span><span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token operator">></span>a<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword">let</span> f2 <span class="token operator">=</span> a<span class="token operator">=</span><span class="token operator">></span>a<span class="token punctuation">;</span><span class="token function">f2</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span></code></pre><h2 id="扩展运算符-参数展开"><a href="#扩展运算符-参数展开" class="headerlink" title="扩展运算符(参数展开)"></a>扩展运算符(参数展开)</h2><ol><li>用于函数参数、数组、对象、对多个变量操作时</li><li>参数使用时必须放在最后</li><li>可以连接数组</li><li>当连接合成时，名相同的，将被最后个替换合并</li><li>作用：当不知道有多少个参数时，可以使用像数组一样，的传入参数</li></ol><p>语法格式：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// ...变量名</span><span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> a2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> a1A2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>a1<span class="token punctuation">,</span><span class="token operator">...</span>a2<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 数组连接</span><span class="token keyword">let</span> o1 <span class="token operator">=</span> <span class="token punctuation">{</span>        a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>        a2<span class="token punctuation">:</span><span class="token number">3</span>    <span class="token punctuation">}</span>    <span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">{</span>        c<span class="token punctuation">:</span><span class="token number">3</span>    <span class="token punctuation">}</span>    <span class="token keyword">let</span> os <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>a1<span class="token punctuation">,</span>        <span class="token operator">...</span>o1    <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//对象合并 相同的属性将被最后的替换合并</span></code></pre><h2 id="系统自带对象方法扩展"><a href="#系统自带对象方法扩展" class="headerlink" title="系统自带对象方法扩展"></a>系统自带对象方法扩展</h2><h3 id="Array对象"><a href="#Array对象" class="headerlink" title="Array对象"></a>Array对象</h3><ul><li><p>map</p></li><li><p>forEach</p></li><li><p>filter</p></li><li><p>reduce</p><h3 id="map语法格式："><a href="#map语法格式：" class="headerlink" title="map语法格式："></a><strong>map语法格式：</strong></h3><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//参数 Array.map((item，index)=>{}) 当前值，索引</span><span class="token comment" spellcheck="true">//return 新数组</span><span class="token comment" spellcheck="true">// 作用：1对1执行代码快 简称映射</span><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    <span class="token keyword">return</span> item <span class="token operator">>=</span> <span class="token number">5</span> <span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//[false,false,false,false,true]</span></code></pre><p><strong>forEach语法格式：</strong></p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//参数 Array.forEach((item,index,array)=>{}) 当前值，索引，当前数组</span><span class="token comment" spellcheck="true">//retrun 无</span><span class="token comment" spellcheck="true">//作用：跟ES5的foreach一样都是遍历数组</span><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>index<span class="token punctuation">,</span>array<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="filter语法格式："><a href="#filter语法格式：" class="headerlink" title="filter语法格式："></a><strong>filter语法格式：</strong></h3><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//参数Array.filter((item)=>{}) 当前值 </span><span class="token comment" spellcheck="true">//retrun 过滤后的数组</span><span class="token comment" spellcheck="true">//作用：过滤</span><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token operator">></span><span class="token number">3</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//过滤条件</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//[4,5]</span></code></pre><h3 id="roduce语法格式："><a href="#roduce语法格式：" class="headerlink" title="roduce语法格式："></a>roduce语法格式：</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//参数Array.roduce((tmp,item,index)=>{}) 临时值（中间值）,当前值 ,索引</span><span class="token comment" spellcheck="true">//retrun 处理后只有一个变量的数组</span><span class="token comment" spellcheck="true">//作用：多对1 可以用来求平均值、某项数据</span><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">roduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span>item<span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>     <span class="token keyword">return</span> index <span class="token operator">===</span> arr<span class="token punctuation">.</span>length<span class="token number">-1</span> <span class="token operator">?</span><span class="token punctuation">(</span>tmp<span class="token operator">+</span>item<span class="token punctuation">)</span><span class="token operator">/</span>arr<span class="token punctuation">.</span>length <span class="token punctuation">:</span> tmp<span class="token operator">+</span><span class="token operator">=</span>item<span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></li></ul><h3 id="String对象"><a href="#String对象" class="headerlink" title="String对象"></a>String对象</h3><ul><li>字符串模板</li><li>startsWith</li><li>endsWith</li></ul><p>字符串模板使用方式：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//字符串模板`${a}和${b}` 按此格式里面的变量会被识别</span></code></pre><p>startsWith和endsWith 语法格式：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//参数 String.starts\ends With(str) 字符串</span><span class="token comment" spellcheck="true">// return boolean</span><span class="token comment" spellcheck="true">//作用：字符串检索 starts 开头 ends结尾 可以多个字符</span>str <span class="token operator">=</span> <span class="token string">"https://www.baidu.com"</span><span class="token punctuation">;</span>str<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"https://"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//true</span>str<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">".com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//true</span></code></pre><h2 id="新增数据类型"><a href="#新增数据类型" class="headerlink" title="新增数据类型"></a>新增数据类型</h2><h3 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h3><p>作用：作为对象（唯一不重复）属性名、唯一的值…….等</p><p>声明语法格式：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//Symbol由Symbol函数生成，不需要new 参数：是一个描述 ，生成一模一样Symbol，其返回值不相等 可以转字符串、布尔，不能转数值</span><span class="token comment" spellcheck="true">//其作用可以用来生成独一无二的属性名、函数名等</span><span class="token comment" spellcheck="true">//注意：再用Symbol生成对象属性名时 属性名格式不能用 . 而是用[content]，访问Symbol的属性名必须用[];</span><span class="token keyword">let</span> attr <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"Arak"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> fun <span class="token operator">=</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token punctuation">[</span><span class="token string">"attr"</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token number">1000</span>    <span class="token punctuation">[</span><span class="token string">"fun"</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>；obj<span class="token punctuation">[</span><span class="token string">'attr'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// 1000</span>obj<span class="token punctuation">.</span>attr<span class="token comment" spellcheck="true">//undefined</span><span class="token comment" spellcheck="true">//获取方式还可以用以下方法</span><span class="token comment" spellcheck="true">//获取对象属性的两种方法</span><span class="token comment" spellcheck="true">//Object.getOwnPropertySymbols()方法</span><span class="token comment" spellcheck="true">//返回只包含Symbol类型的属性名的数组</span><span class="token comment" spellcheck="true">//Object.getOwnPropertyNames()方法</span><span class="token comment" spellcheck="true">//返回只包含字符串类型的属性名的数组</span><span class="token comment" spellcheck="true">//Symbol.for()和Symbol.keyFor()方法</span><span class="token comment" spellcheck="true">//Symbol.for()类似于单例模式，首先在全局中搜索有没有以该参数为名称的Symbol值，如果有则返回该Symbol值，否则新建并返回一个以该参数为名称的Symbol值</span><span class="token keyword">var</span> symbol1 <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token string">'Alice'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> symbol2 <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token string">'Alice'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>symbol1 <span class="token operator">===</span> symbol2<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 输出：true</span><span class="token comment" spellcheck="true">//Symbol.keyFor()返回一个已创建的Symbol类型值的key，实质是检测该Symbol是否已创建。</span><span class="token keyword">var</span> symbol1 <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">.</span><span class="token function">keyFor</span><span class="token punctuation">(</span>symbol1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 输出："Alice"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">.</span><span class="token function">keyFor</span><span class="token punctuation">(</span>symbol2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 输出：undefined</span></code></pre><h2 id="兼容性解决"><a href="#兼容性解决" class="headerlink" title="兼容性解决"></a>兼容性解决</h2><p>由于ES6在一些低版本的浏览器上无法运行，需转成ES5之前的版本兼容，以下有几种方案可以自动转换</p><h3 id="babel"><a href="#babel" class="headerlink" title="babel"></a>babel</h3><p>使用方法：</p><p>1.导入方式</p><pre><code>需下载babel的browser.min.js包  在官网下载即可导入页面，然后在需转换的script标签上 加 type=&quot;text/babel&quot; 即可自动转换</code></pre><p>2.编译方式（推荐）</p><pre><code>安装node.js  进入cmd到要编译的目录 cd符号进入  输入 npm init-y 调出node配置文件          输入 npm i @babel/core @babel/cli @babel/preset-env 安装babel  package.json =&gt; scripts中添加脚本 &quot;test&quot;:&quot;babel js -d dest&quot;                                    名 要编译的文件目录  存放文件的目录  添加.babelrc文件——声明preset 格式为：{   &quot;preset&quot;:[&quot;@babel/preset-env&quot;]  }  执行命令：nmp run test（package中scripts名设置的什么就是什么）</code></pre><h2 id="ES6对象"><a href="#ES6对象" class="headerlink" title="ES6对象"></a>ES6对象</h2><p>面向对象 机器语言 -&gt; 汇编 -&gt; 低级语言(面向过程) -&gt; 高级语言(面向对象) -&gt; 模块 -&gt; 框架 -&gt; API</p><p>面向对象： 1.封装性<br>2.继承性<br>3.多态性</p><hr><h3 id="类"><a href="#类" class="headerlink" title="类"></a>类</h3><p>ES6类的添加可以覆盖之前构造函数传统的方式，更便捷，更系统</p><p>注意的是：以前<strong>proto</strong>只能访问不能修改，ES6后可修改指向也可访问</p><p>关于类的关键字和方法</p><ul><li>class 类</li><li>constructor  构造函数</li><li>extends  继承</li><li>super（）  替代之前借用构造函数来初始化继承的函数</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>   <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>sex<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">showInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sex<span class="token punctuation">)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">?</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>age<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="闭包理解"><a href="#闭包理解" class="headerlink" title="闭包理解"></a>闭包理解</h2><p>首先，我们所声明的变量，都是在运行完程序后自动执行垃圾回收，如果某个变量正在使用未释放，那么这个变量的生命周期将会延长，也就达成了闭包的条件，这里的例子用了（垃圾回收）来更好的理解闭包。</p><h3 id="GC-垃圾回收"><a href="#GC-垃圾回收" class="headerlink" title="GC: 垃圾回收"></a>GC: 垃圾回收</h3><h6 id="闭包："><a href="#闭包：" class="headerlink" title="闭包："></a>闭包：</h6><ul><li>1.底层：栈</li><li>2.高层：<strong>函数当作对象处理</strong></li></ul><p>闭包—— 只要还在用就不会被回收</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>局部变量i在执行完成后就删除了，但是function函数里在使用i，所以i不会被回收，循环多少次产生多少i</p><h2 id="异步与同步"><a href="#异步与同步" class="headerlink" title="异步与同步"></a>异步与同步</h2><p>异步——多个操作可以一起进行，互不干扰 同步——操作一个个进行</p><h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p>Promise 是异步编程的一种解决方案，其实是一个构造函数，自己身上有all、reject、resolve这几个方法，原型上有then、catch等方法。</p><p>Promise对象代表一个异步操作，有三种状态：pending（进行中）、fulfilled（已成功）和rejected（已失败）。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。这也是Promise这个名字的由来，它的英语意思就是“承诺”，表示其他手段无法改变。</p><p><a href="参考链接">https://blog.csdn.net/qq_34645412/article/details/81170576</a></p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">rePromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>reslove<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//resolve是对promise成功时候的回调 reject则是失败</span>        <span class="token keyword">return</span> p<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//返回Promise对象</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/**reject的用法以上是对promise的resolve用法进行了解释，相当于resolve是对promise成功时候的回调，它把promise的状态修改为fullfiled，那么，reject就是失败的时候的回调，他把promise的状态修改为rejected，这样我们在then中就能捕捉到，然后执行“失败”情况的回调。rePromise()**/</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//then同样有对成功失败时的反应</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span>reject<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>   <span class="token comment" spellcheck="true">//异步方法 </span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//all接受一组数组，里面一般装异步函数代码快，</span><span class="token comment" spellcheck="true">//随机数案例 满足条件则继续向下执行，失败则停止或执行失败专有的线路</span><span class="token comment" spellcheck="true">//只有all里面的所有方法执行成功后，才会继续执行then参数中的resolve，一当里面一个方法错误，那将会执行参数中的reject</span><span class="token keyword">function</span> <span class="token function">promiseClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">var</span> num <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//生成1-10的随机数</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'随机数生成的值：'</span><span class="token punctuation">,</span>num<span class="token punctuation">)</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>num<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token function">resolve</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'数字太于10了即将执行失败回调'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span><span class="token punctuation">)</span>           <span class="token keyword">return</span> p       <span class="token punctuation">}</span>    <span class="token function">promiseClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>        <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolved成功回调'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功回调接受的值：'</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>         <span class="token keyword">function</span><span class="token punctuation">(</span>reason<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'rejected失败回调'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败执行回调抛出失败原因：'</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>随机数案例结果图：</p><p><img src="https://cdn.jsdelivr.net/gh/JingHong0202/jinghong0202.github.io@v0.1.0/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JingHong0202/blog_images/images/20180725094633828.png" alt=""></p><h2 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h2><p>async 异步</p><p>await 同步</p><p>两者结合即可以同步的方式执行异步操作</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//这种情况一般用在需要上一步返回的数据来继续执行下面的操作</span><span class="token comment" spellcheck="true">//语法格式：</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token comment" spellcheck="true">//await只能在有async装饰下才能使用</span><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token string">"loding"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*自动将常规函数转换成Promise，返回值也是一个Promise对象只有async函数内部的异步操作执行完，才会执行then方法指定的回调函数异步函数内部可以使用await*/</span></code></pre><h2 id="第6章-ES6语法及JS语言的其他特性"><a href="#第6章-ES6语法及JS语言的其他特性" class="headerlink" title="第6章 ES6语法及JS语言的其他特性"></a>第6章 ES6语法及JS语言的其他特性</h2><h3 id="6-0-ECMAScript的变迁"><a href="#6-0-ECMAScript的变迁" class="headerlink" title="6.0 ECMAScript的变迁"></a>6.0 ECMAScript的变迁</h3><p>ECMAScript 1.0（1997年）</p><p>ECMAScript 2.0（1998年）</p><p>ECMAScript 3.0（1999年12月）</p><p>ECMAScript 4.0 (太激进,夭折了)</p><p>ECMAScript 5.0 (2009) </p><p>ECMAScript 6.0 (2015) </p><p>3.0版是一个巨大的成功，在业界得到广泛支持，成为通行标准，奠定了JavaScript语言的基本语法，以后的版本完全继承。 直到今天，初学者一开始学习JavaScript，其实就是在学3.0版的语法。<br>5.0版和3.0版区别不大。</p><p>随着JS的崛起,应用于移动开发,后端开发,游戏开发等,业界对JS的语言的要求越来越高. 此时再看4.0时提出的设想,已经不显得激进了.于是,6.0版本终于通过了.</p><p>此标准严格的叫法应是<code>ECMAScript2015</code>,当然叫<code>ES6</code>也没啥,没人和你抬杠.</p><p>ESMAScript 与 JavaScript 两者的关系, 就如同 <em>快捷宾馆营业标准</em> 和 <em>如家酒店</em> 一样.</p><p><strong>浏览器支持情况</strong></p><p><a href="http://kangax.github.io/compat-table/es6/" target="_blank" rel="noopener">http://kangax.github.io/compat-table/es6/</a></p><h3 id="6-1-变量的声明"><a href="#6-1-变量的声明" class="headerlink" title="6.1 变量的声明"></a>6.1 变量的声明</h3><h4 id="6-1-1-let-块级证明"><a href="#6-1-1-let-块级证明" class="headerlink" title="6.1.1 let 块级证明"></a>6.1.1 let 块级证明</h4><p>ES6 新增了<code>let</code>命令，用来声明变量。</p><p>它的用法类似于<code>var</code>，但是所声明的变量，只在<code>let</code>命令所在的代码块内有效。</p><p>看下例:</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 相同的效果</span></code></pre><p>再看下例:</p><pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>  <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token string">'world'</span><span class="token punctuation">;</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//ReferenceError: c is not defined</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// world</span></code></pre><p>可以看出: <code>let</code>命令在定义的<code>{}</code>内生效,某些语言也有类似特点，我们将其称为”块级作用域”.</p><p>这样,<code>let</code>定义的变量,只在块内生效,不影响其他区域,所以我们说Ta更 “清洁”.</p><p>在某些场合下,用<code>let</code>特别适合,比如<code>for()</code>循环</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 设置i仅为循环数组,但循环后,残留一个变量i.</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span> <span class="token punctuation">,</span> <span class="token string">'b'</span> <span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 3</span></code></pre><p>换成<code>let</code>再试一下,是不是更清洁?</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// i变量只在for()内有效,不污染其他区域</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span> <span class="token punctuation">,</span> <span class="token string">'b'</span> <span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ReferenceError: i is not defined</span></code></pre><p>不污染全局的window属性</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span><span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token string">'world'</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span>d<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//undefined</span>window<span class="token punctuation">.</span>c<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//hello</span></code></pre><p>注:同域下,var ,let 声明同一变量名,error</p><blockquote><p>let 申明的变量不存在变量提升 </p><p>let 申明的变量不允许重复声明</p><p>let 申明的变量存在块级作用域</p></blockquote><h4 id="6-1-2-const-常量"><a href="#6-1-2-const-常量" class="headerlink" title="6.1.2 const 常量"></a>6.1.2 const 常量</h4><p>常量并不稀奇 (话外音：都21世纪了，你咋现在才有?) PHP,Java,C,C++ …多数语言都有常量.</p><p><code>const</code> 声明一个只读的常量。一旦声明，常量的值就不能改变。</p><p>常量,即不可改变其值的量.</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> PI <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>PI<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 一旦声明值不可修改</span>PI <span class="token operator">=</span> <span class="token number">3.15</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// TypeError: Assignment to constant variable.</span><span class="token comment" spellcheck="true">// 不可重复声明</span><span class="token keyword">const</span> PI <span class="token operator">=</span> <span class="token number">3.15</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Identifier 'PI' has already been declare</span><span class="token comment" spellcheck="true">// 因为声明后值不能修改，所以声明必须赋值</span><span class="token keyword">const</span> c <span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Missing initializer in const declaration</span></code></pre><p>注:常量名和变量名,都区分大小写</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> STU <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'lucy'</span> <span class="token punctuation">,</span> age <span class="token punctuation">:</span> <span class="token number">22</span><span class="token punctuation">}</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>STU<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// { name: 'lucy', age: 22 }</span>STU<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'lily'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>STU<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// { name: 'lily', age: 22 }</span></code></pre><p>注：常量不可改变的是其引用地址；</p><h3 id="6-2-模板字符"><a href="#6-2-模板字符" class="headerlink" title="6.2 模板字符"></a>6.2 模板字符</h3><p>ES6用反引号 <strong>( ` )</strong>  包住字符串,可以让字符串多行书写,也可以自由的嵌入变量.</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">'world'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'李四'</span><span class="token punctuation">}</span><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token string">`hello</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>obj<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> , </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">7</span> <span class="token operator">+</span> <span class="token number">9</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> , </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'ok'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,这是个换行`</span></span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// hello李四 world , 16 , ok,</span><span class="token comment" spellcheck="true">// 这是个换行</span></code></pre><h3 id="6-3-变量的解构赋值"><a href="#6-3-变量的解构赋值" class="headerlink" title="6.3 变量的解构赋值"></a>6.3 变量的解构赋值</h3><p>ES6 允许按照一定模式，从数组和对象中提取值，对变量进行赋值，这被称为解构（Destructuring）。</p><p>字符串解构赋值</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>a <span class="token comment" spellcheck="true">// "h"</span>b <span class="token comment" spellcheck="true">// "e"</span>c <span class="token comment" spellcheck="true">// "l"</span>d <span class="token comment" spellcheck="true">// "l"</span>e <span class="token comment" spellcheck="true">// "o"</span></code></pre><h4 id="6-3-1-数组的解构赋值"><a href="#6-3-1-数组的解构赋值" class="headerlink" title="6.3.1 数组的解构赋值"></a>6.3.1 数组的解构赋值</h4><p>以前，为变量赋值，只能直接指定值。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ES6允许写成下面这样。</span><span class="token keyword">let</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><p>上面代码表示，可以从数组中提取值，按照对应位置，对变量赋值。</p><p>本质上，这种写法属于“模式匹配”，只要等号两边的模式相同，左边的变量就会被赋予对应的值。下面是一些使用嵌套数组进行解构的例子。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> <span class="token punctuation">[</span>foo<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>bar<span class="token punctuation">]</span><span class="token punctuation">,</span> baz<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>foo <span class="token comment" spellcheck="true">// 1</span>bar <span class="token comment" spellcheck="true">// 2</span>baz <span class="token comment" spellcheck="true">// 3</span><span class="token keyword">let</span> <span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token punctuation">,</span> third<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token string">"bar"</span><span class="token punctuation">,</span> <span class="token string">"baz"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>third <span class="token comment" spellcheck="true">// "baz"</span><span class="token keyword">let</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> <span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>x <span class="token comment" spellcheck="true">// 1</span>y <span class="token comment" spellcheck="true">// 3</span><span class="token keyword">let</span> <span class="token punctuation">[</span>head<span class="token punctuation">,</span> <span class="token operator">...</span>tail<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>head <span class="token comment" spellcheck="true">// 1</span>tail <span class="token comment" spellcheck="true">// [2, 3, 4]</span><span class="token keyword">let</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">...</span>z<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>x <span class="token comment" spellcheck="true">// "a"</span>y <span class="token comment" spellcheck="true">// undefined</span>z <span class="token comment" spellcheck="true">// []</span></code></pre><h4 id="6-3-2-对象的解构赋值"><a href="#6-3-2-对象的解构赋值" class="headerlink" title="6.3.2 对象的解构赋值"></a>6.3.2 对象的解构赋值</h4><p>解构不仅可以用于数组，还可以用于对象。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">{</span> foo<span class="token punctuation">,</span> bar <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token string">"aaa"</span><span class="token punctuation">,</span> bar<span class="token punctuation">:</span> <span class="token string">"bbb"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>foo <span class="token comment" spellcheck="true">// "aaa"</span>bar <span class="token comment" spellcheck="true">// "bbb"</span></code></pre><p>对象的解构与数组有一个重要的不同。数组的元素是按次序排列的，变量的取值由它的位置决定；而对象的属性没有次序，变量必须与属性同名，才能取到正确的值。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">{</span> bar<span class="token punctuation">,</span> foo <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token string">"aaa"</span><span class="token punctuation">,</span> bar<span class="token punctuation">:</span> <span class="token string">"bbb"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>foo <span class="token comment" spellcheck="true">// "aaa"</span>bar <span class="token comment" spellcheck="true">// "bbb"</span><span class="token keyword">let</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token string">"aaa"</span><span class="token punctuation">,</span> bar<span class="token punctuation">:</span> <span class="token string">"bbb"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>name <span class="token comment" spellcheck="true">// undefined</span></code></pre><p>上面代码的第一个例子，等号左边的两个变量的次序，与等号右边两个同名属性的次序不一致，但是对取值完全没有影响。第二个例子的变量没有对应的同名属性，导致取不到值，最后等于<code>undefined</code>。</p><h3 id="6-4-对象的扩展"><a href="#6-4-对象的扩展" class="headerlink" title="6.4 对象的扩展"></a>6.4 对象的扩展</h3><h4 id="6-4-1-属性的简洁表示法"><a href="#6-4-1-属性的简洁表示法" class="headerlink" title="6.4.1 属性的简洁表示法"></a>6.4.1 属性的简洁表示法</h4><p>ES6 允许直接写入变量和函数，作为对象的属性和方法。这样的书写更加简洁。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span><span class="token keyword">const</span> baz <span class="token operator">=</span> <span class="token punctuation">{</span>foo<span class="token punctuation">}</span><span class="token punctuation">;</span>baz <span class="token comment" spellcheck="true">// {foo: "bar"}</span><span class="token comment" spellcheck="true">// 等同于</span><span class="token keyword">const</span> baz <span class="token operator">=</span> <span class="token punctuation">{</span>foo<span class="token punctuation">:</span> foo<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>上面代码表明，ES6 允许在对象之中，直接写变量。这时，属性名为变量名, 属性值为变量的值。</p><h4 id="6-4-2-方法的简洁表示法"><a href="#6-4-2-方法的简洁表示法" class="headerlink" title="6.4.2 方法的简洁表示法"></a>6.4.2 方法的简洁表示法</h4><p>除了属性简写，方法也可以简写。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> fun <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>    fun<span class="token punctuation">:</span>fun<span class="token punctuation">,</span>    b<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span>obj<span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 3</span><span class="token comment" spellcheck="true">// 等同于</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    a<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span>    fun<span class="token punctuation">,</span>    b<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span>obj<span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 7</span><span class="token comment" spellcheck="true">// 等同于</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    a<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">,</span>    <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    b<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span>obj<span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 11</span></code></pre><p>CommonJS 模块输出一组数据及方法，就非常合适使用简洁写法。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">setItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> getItem<span class="token punctuation">,</span> setItem<span class="token punctuation">,</span> clear <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 等同于</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    getItem<span class="token punctuation">:</span> getItem<span class="token punctuation">,</span>    setItem<span class="token punctuation">:</span> setItem<span class="token punctuation">,</span>    clear<span class="token punctuation">:</span> clear<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h3 id="6-5-Promise-异步控制对象"><a href="#6-5-Promise-异步控制对象" class="headerlink" title="6.5 Promise 异步控制对象"></a>6.5 Promise 异步控制对象</h3><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Using_promises" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Using_promises</a></p></blockquote><h4 id="6-5-1为什么要使用-Promise"><a href="#6-5-1为什么要使用-Promise" class="headerlink" title="6.5.1为什么要使用 Promise"></a>6.5.1为什么要使用 Promise</h4><p><strong>以读取文件内容为例：</strong></p><p>无法保证顺序的代码</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./data/a.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// return console.log('读取失败')</span>    <span class="token comment" spellcheck="true">// 抛出异常</span>    <span class="token comment" spellcheck="true">//    1. 阻止程序的执行</span>    <span class="token comment" spellcheck="true">//    2. 把错误消息打印到控制台</span>    <span class="token keyword">throw</span> err  <span class="token punctuation">}</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./data/b.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// return console.log('读取失败')</span>    <span class="token comment" spellcheck="true">// 抛出异常</span>    <span class="token comment" spellcheck="true">//    1. 阻止程序的执行</span>    <span class="token comment" spellcheck="true">//    2. 把错误消息打印到控制台</span>    <span class="token keyword">throw</span> err  <span class="token punctuation">}</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./data/c.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// return console.log('读取失败')</span>    <span class="token comment" spellcheck="true">// 抛出异常</span>    <span class="token comment" spellcheck="true">//    1. 阻止程序的执行</span>    <span class="token comment" spellcheck="true">//    2. 把错误消息打印到控制台</span>    <span class="token keyword">throw</span> err  <span class="token punctuation">}</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>通过回调嵌套的方式来保证顺序：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./data/a.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// return console.log('读取失败')</span>    <span class="token comment" spellcheck="true">// 抛出异常</span>    <span class="token comment" spellcheck="true">//    1. 阻止程序的执行</span>    <span class="token comment" spellcheck="true">//    2. 把错误消息打印到控制台</span>    <span class="token keyword">throw</span> err  <span class="token punctuation">}</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./data/b.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// return console.log('读取失败')</span>      <span class="token comment" spellcheck="true">// 抛出异常</span>      <span class="token comment" spellcheck="true">//    1. 阻止程序的执行</span>      <span class="token comment" spellcheck="true">//    2. 把错误消息打印到控制台</span>      <span class="token keyword">throw</span> err    <span class="token punctuation">}</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./data/c.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// return console.log('读取失败')</span>        <span class="token comment" spellcheck="true">// 抛出异常</span>        <span class="token comment" spellcheck="true">//    1. 阻止程序的执行</span>        <span class="token comment" spellcheck="true">//    2. 把错误消息打印到控制台</span>        <span class="token keyword">throw</span> err      <span class="token punctuation">}</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>多层使用回调函数，就会进入 “<strong>回调地狱</strong>“</p><p>为了解决以上编码方式带来的问题（回调地狱嵌套），所以在 EcmaScript 6 中新增了一个 API：<code>Promise</code>。</p><h4 id="6-5-2-Promise-的使用"><a href="#6-5-2-Promise-的使用" class="headerlink" title="6.5.2 Promise 的使用"></a>6.5.2 Promise 的使用</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 在 EcmaScript 6 中新增了一个 API Promise</span><span class="token comment" spellcheck="true">// Promise 是一个构造函数</span><span class="token comment" spellcheck="true">// 创建 Promise 容器</span><span class="token comment" spellcheck="true">// 1. 给别人一个承诺 I promise you.</span><span class="token comment" spellcheck="true">//    Promise 容器一旦创建，就开始执行里面的代码</span><span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// console.log(2)</span>  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./data/aa.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 失败了，承诺容器中的任务失败了</span>      <span class="token comment" spellcheck="true">// console.log(err)</span>      <span class="token comment" spellcheck="true">// 把容器的 Pending 状态变为 Rejected</span>      <span class="token comment" spellcheck="true">// 调用 reject 就相当于调用了 then 方法的第二个参数函数</span>      <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// console.log(3)</span>      <span class="token comment" spellcheck="true">// 承诺容器中的任务成功了</span>      <span class="token comment" spellcheck="true">// console.log(data)</span>      <span class="token comment" spellcheck="true">// 把容器的 Pending 状态改为成功 Resolved</span>      <span class="token comment" spellcheck="true">// 也就是说这里调用的 resolve 方法实际上就是 then 方法传递的那个 function</span>      <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// console.log(4)</span><span class="token comment" spellcheck="true">// p1 就是那个承若</span><span class="token comment" spellcheck="true">// 当 p1 成功了 然后(then) 做指定的操作</span><span class="token comment" spellcheck="true">// then 方法接收的 function 就是容器中的 resolve 函数</span>p1  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取文件失败了'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>封装 Promise 版本的 <code>readFile</code>:</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">pReadFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">pReadFile</span><span class="token punctuation">(</span><span class="token string">'./data/a.txt'</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token function">pReadFile</span><span class="token punctuation">(</span><span class="token string">'./data/b.txt'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token function">pReadFile</span><span class="token punctuation">(</span><span class="token string">'./data/c.txt'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="6-6-箭头函数"><a href="#6-6-箭头函数" class="headerlink" title="6.6 箭头函数"></a>6.6 箭头函数</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions</a></p><p>ES6 允许使用“箭头”（<code>=&gt;</code>）定义函数。</p><p><strong>箭头函数表达式</strong>的语法比 <em>函数表达式</em> 更短，并且没有自己的 this，arguments。这些函数表达式更适用于那些本来需要匿名函数的地方，并且它们不能用作构造函数。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> fun1 <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span>str2<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>str1 <span class="token operator">+</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ↓ </span><span class="token keyword">var</span> fun2 <span class="token operator">=</span> <span class="token punctuation">(</span>str1<span class="token punctuation">,</span>str2<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>str1 <span class="token operator">+</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ↓ </span><span class="token keyword">var</span> fun3 <span class="token operator">=</span> <span class="token punctuation">(</span>str1<span class="token punctuation">,</span>str2<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> str1 <span class="token operator">+</span> str2<span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fun1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fun2</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 5</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fun1</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 9</span></code></pre><blockquote><p>如果参数只有一个，可以将()省略    // arr.map(c=&gt;c+1); 如果没有参数，则一定能要写上()     // ()=&gt; console.log(‘a’)<br>如果多于一个参数，每个参数之间用逗号分隔   (x, y) =&gt; { … }<br>如果方法体只有一句代码，可以省略{} 和分号，如果有返回可以省略return<br>如果方法体多于一句代码，则不能省略{} ,每句代码使用 分号分隔</p></blockquote><p><strong>注意：</strong></p><blockquote><p>a. 箭头函数没有自己的this，函数体内部写的this，指向的是外层代码块的this b. 箭头函数内部的this是定义时所在的对象，而不是使用时所在的对象并且不会改变<br>c. 箭头箭头函数不能用作构造函数<br>d. 箭头函数内部不存在arguments，箭头函数体中使用的arguments其实指向的是外层函数的arguments</p></blockquote><p>箭头就是让你当做一个普通函数来使用,别整花里胡哨;</p>]]></content>
      
      
      <categories>
          
          <category> Front </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 笔记 </tag>
            
            <tag> ES6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ajax</title>
      <link href="/posts/921d.html"/>
      <url>/posts/921d.html</url>
      
        <content type="html"><![CDATA[<h1 id="什么是Ajax？"><a href="#什么是Ajax？" class="headerlink" title="什么是Ajax？"></a>什么是Ajax？</h1><blockquote><p>Ajax是一种可以与服务器交换数据并更新部分页面内容，同时可以在不让整个网页重新加载的情况下更新网页的一种技术</p></blockquote><h2 id="Ajax请求过程："><a href="#Ajax请求过程：" class="headerlink" title="Ajax请求过程："></a><strong>Ajax请求过程：</strong></h2><h5 id="1：创建一个异步对象"><a href="#1：创建一个异步对象" class="headerlink" title="1：创建一个异步对象"></a>1：创建一个异步对象</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> xmlHttp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h5 id="2：设置请求方式和请求地址"><a href="#2：设置请求方式和请求地址" class="headerlink" title="2：设置请求方式和请求地址"></a>2：设置请求方式和请求地址</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/*    参数顺序，描述    （1）method：请求的类型；GET 或 POST    （2）url：文件在服务器上的位置    （3）async：true（异步）或 false（同步） （一般为true，因ajax的精髓就是异步）*/</span>    xmlHttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"GET||POST"</span><span class="token punctuation">,</span><span class="token string">"url 如（./ajax.php）"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//注意点：url中不能出现中文，只能数字、字母、ASCII码、下划线</span><span class="token comment" spellcheck="true">//  GET方式的 url格式：./ajax.php?t=123&amp;321......</span><span class="token comment" spellcheck="true">//如果出现中文也可以用encodeURIComponent方法转换</span><span class="token comment" spellcheck="true">//  POST方式的url不能在后面接字符串传递参数</span>xmlHttp<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">"Content-type"</span><span class="token punctuation">,</span><span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//setRequestHeader 必须放在设置请求与发送请求之间</span><span class="token comment" spellcheck="true">//下一步在发送请求send中传递参数即可</span>xmlHttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"name=xuyuxin&amp;age=18"</span><span class="token punctuation">)</span></code></pre><h5 id="3：发送请求"><a href="#3：发送请求" class="headerlink" title="3：发送请求"></a>3：发送请求</h5><pre class=" language-javascript"><code class="language-javascript"> xmlHttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h5 id="4-监听状态变化"><a href="#4-监听状态变化" class="headerlink" title="4.监听状态变化"></a>4.监听状态变化</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//监听事件： onreadystatechange 每当请求状态发生变化，就会触发此函数</span>xmlHttp<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ev2<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/*    readyState 状态变化有以下5种    0：请求未初始化    1：服务器连接已建立    2：请求已接收    3：请求处理中    4：请求已完成，且响应已就绪*/</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>xmlHttp<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//请求已完成，并不代表请求成功，因此还需判断是否请求成功</span>        <span class="token comment" spellcheck="true">//status是专门判断请求是否成功的状态码</span>        <span class="token comment" spellcheck="true">// 状态码大于或等于200并且不能超过300以上，300以上除了304以外全都是请求失败</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>xmlHttp<span class="token punctuation">.</span>status <span class="token operator">>=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xmlHttp<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span> <span class="token operator">||</span> xmlHttp<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求成功'</span><span class="token punctuation">)</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求失败'</span><span class="token punctuation">)</span>                <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><a href="http://baike.baidu.com/link?url=LarF3FUBzX-IU1BMZbwbxaC8oJPUSGOj3seQRNVSVbZ2F9A6BiE-Je0sxFwsQK8dFJkKH6VP_ghpK66p8C2Zvkdl9nABXBR8mIqZGJj_D59q6NJQwmw3GqjIx2bzAsEG" target="_blank" rel="noopener">http请求成功或失败状态码资料查询</a></p><h2 id="IE低版本浏览器兼容问题"><a href="#IE低版本浏览器兼容问题" class="headerlink" title="IE低版本浏览器兼容问题"></a>IE低版本浏览器兼容问题</h2><blockquote><p>由于在IE6-IE5以下不支持XMLHttpRequest这个属性，因此会产生错误，在低级浏览器中可以使用ActiveXObject来实现同样的效果</p></blockquote><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> xmlHttp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">"Microsoft.XMLHTTP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>在IE低版本中ajax还有缓存的问题，解决这个问题，要url地址不断改变，不能为常量，即可解决</p></blockquote><pre class=" language-javascript"><code class="language-javascript">xmlhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span><span class="token string">"ajax.php?"</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span></code></pre><h2 id="解决兼容性通用方法"><a href="#解决兼容性通用方法" class="headerlink" title="解决兼容性通用方法"></a>解决兼容性通用方法</h2><blockquote><p>由于在Ajax中浏览器支持的属性不同，单一方案不能支持全部浏览器，有两种解决方案，因此可以把这两种方案合成一种，以便使用</p></blockquote><pre class=" language-javascript"><code class="language-javascript">  <span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>XMLHttpRuquest<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">var</span> xmlHttp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>           <span class="token keyword">var</span> xmlHttp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">"Microsoft.XMLHTTP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span>    <span class="token keyword">var</span> xmlHttp <span class="token operator">=</span> window<span class="token punctuation">.</span>XMLHttpRequest <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">new</span>                     <span class="token class-name">ActiveXOject</span><span class="token punctuation">(</span><span class="token string">"Microsoft.XMLHTTP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="封装Ajax"><a href="#封装Ajax" class="headerlink" title="封装Ajax"></a>封装Ajax</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * @param {请求的类型}option.type * @param {发送请求的地址} option.url * @param {发送请求的数据}option.data * @param {超时时间} option.timeout * @param {请求成功后执行的函数*} option.sucess * @param {请求失败后执行的函数*} option.error */</span><span class="token keyword">function</span> <span class="token function">createAjax</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//0.把传入对象处理成字符串，服务器才可接收</span>  <span class="token keyword">var</span> toStringObj <span class="token operator">=</span> <span class="token function">objToString</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//1.创建ajax对象，并判断游览器支持那个属性</span>  <span class="token keyword">var</span> xmlHttp <span class="token operator">=</span> window<span class="token punctuation">.</span>XMLHttpRequest    <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">"Microsoft.XMLHTTP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> timer<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>option<span class="token punctuation">.</span>type<span class="token punctuation">.</span>toloworCase <span class="token operator">===</span> <span class="token string">"get"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//2.设置请求方式和地址</span>    xmlHttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> option<span class="token punctuation">.</span>url <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> toStringObj<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//3.发送请求</span>    xmlHttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//4.监听请求状态</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// POST请求方式</span>    xmlHttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>type<span class="token punctuation">,</span> option<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    xmlHttp<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span>      <span class="token string">"Content-type"</span><span class="token punctuation">,</span>      <span class="token string">"application/x-www-form-urlencoded"</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    xmlHttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>toStringObj<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  xmlHttp<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//请求完成，并不代表请求成功</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>xmlHttp<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//判断请求是否成功</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>        <span class="token punctuation">(</span>xmlHttp<span class="token punctuation">.</span>status <span class="token operator">>=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xmlHttp<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span>        xmlHttp<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span>      <span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>        option<span class="token punctuation">.</span><span class="token function">sucess</span><span class="token punctuation">(</span>xmlHttp<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        option<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>xmlHttp<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//判断外界是否传入超时时间</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>option<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>    timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//超时时间到后执行停止此次发送请求，默认为失败</span>      xmlHttp<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> option<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//把obj转为字符串</span><span class="token keyword">function</span> <span class="token function">objToString</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  data<span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//encodeURLComponent函数对，对象名和属性进行转换，以防出现url中不能出现的字符而出错</span>    res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//调用方式</span>    <span class="token function">createAjax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                    data<span class="token punctuation">:</span><span class="token punctuation">{</span>                       name<span class="token punctuation">:</span> that<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    type<span class="token punctuation">:</span><span class="token string">"POST"</span><span class="token punctuation">,</span>                    timeout<span class="token punctuation">:</span><span class="token number">3000</span><span class="token punctuation">,</span>                    url<span class="token punctuation">:</span><span class="token string">"./ajaxLesson2.php"</span><span class="token punctuation">,</span>                    sucess<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>xml<span class="token punctuation">)</span><span class="token punctuation">{</span>                         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    error<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>xml<span class="token punctuation">)</span><span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"请求失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>；</code></pre><h2 id="获取服务器响应数据方式"><a href="#获取服务器响应数据方式" class="headerlink" title="获取服务器响应数据方式"></a>获取服务器响应数据方式</h2><blockquote><ol><li>responseText 可以获取服务器以字符串形式返回的数据</li><li>responseXML 可以获取服务器以XML形式返回的数据</li></ol></blockquote><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//调用方式</span><span class="token comment" spellcheck="true">// ajax对象.要获取的方式</span>xmlHttp<span class="token punctuation">.</span>responseText</code></pre><h2 id="通过XML传输数据"><a href="#通过XML传输数据" class="headerlink" title="通过XML传输数据"></a>通过XML传输数据</h2><h4 id="XML数据基本格式"><a href="#XML数据基本格式" class="headerlink" title="XML数据基本格式"></a>XML数据基本格式</h4><p>​        1.开头前缀指定版本和编码（必要）</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span></code></pre><p>​        2.根目录（必要 和html标签一样要闭合）</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><p>​        3.之后标签名不受限制，完整版</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nz</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>甜美女装<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>des</span><span class="token punctuation">></span></span>人见人爱,花间花开,甜美系列<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>des</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">></span></span>images/1.jpg<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nz</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bb</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>奢华驴包<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>des</span><span class="token punctuation">></span></span>送女友,送情人,送学妹,一送一个准系列<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>des</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">></span></span>images/2.jpg<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bb</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tx</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>键盘拖鞋<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>des</span><span class="token punctuation">></span></span>程序员专属拖鞋, 屌丝气息浓郁, 你值得拥有<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>des</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">></span></span>images/3.jpg<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tx</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><h4 id="PHP基本XML配置格式"><a href="#PHP基本XML配置格式" class="headerlink" title="PHP基本XML配置格式"></a>PHP基本XML配置格式</h4><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token comment" spellcheck="true">//向客户端发送原始的 HTTP 报头。</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"content-type:text/xml;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//file_get_contents() 函数是用于将文件的内容读入到一个字符串中的首选方法。如果操作系统支持，还会使用    内存映射技术来增强性能。</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">"xml文件地址如（./ajax.xml）"</span><span class="token punctuation">)</span>    <span class="token delimiter">?></span></code></pre><h4 id="Ajax获取XML数据格式"><a href="#Ajax获取XML数据格式" class="headerlink" title="Ajax获取XML数据格式"></a>Ajax获取XML数据格式</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//获取XML传输而来的数据要使用 responseXML方式获取</span><span class="token keyword">var</span> Data <span class="token operator">=</span> xml<span class="token punctuation">.</span>responseXML<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//返回的是一个document文档对象</span><span class="token comment" spellcheck="true">//接着使用javascript获取遍历DOM元素</span> <span class="token keyword">var</span> titleinfo <span class="token operator">=</span> Data<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>name<span class="token operator">+</span><span class="token string">'>title'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> des <span class="token operator">=</span> Data<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>name<span class="token operator">+</span><span class="token string">'>des'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> image <span class="token operator">=</span> Data<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>name<span class="token operator">+</span><span class="token string">'>image'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//最后就可以对DOM里面存储的数据进行操作了</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>des<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="通过JSON传输数据"><a href="#通过JSON传输数据" class="headerlink" title="通过JSON传输数据"></a>通过JSON传输数据</h2><blockquote><p><a href="https://baike.baidu.com/item/JSON/2462549?fr=aladdin" target="_blank" rel="noopener">JSON资料</a></p></blockquote><h4 id="JSON数据基本格式"><a href="#JSON数据基本格式" class="headerlink" title="JSON数据基本格式"></a>JSON数据基本格式</h4><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"nz"</span><span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"甜美女装"</span><span class="token punctuation">,</span>        <span class="token property">"des"</span><span class="token operator">:</span><span class="token string">"人见人爱,花间花开,甜美系列"</span><span class="token punctuation">,</span>        <span class="token property">"image"</span><span class="token operator">:</span><span class="token string">"./images/1.jpg"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"bb"</span><span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"奢华驴包"</span><span class="token punctuation">,</span>        <span class="token property">"des"</span><span class="token operator">:</span><span class="token string">"送女友,送情人,送学妹,一送一个准系列"</span><span class="token punctuation">,</span>        <span class="token property">"image"</span><span class="token operator">:</span><span class="token string">"./images/2.jpg"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"tx"</span><span class="token operator">:</span><span class="token punctuation">{</span>        <span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"键盘拖鞋"</span><span class="token punctuation">,</span>        <span class="token property">"des"</span><span class="token operator">:</span><span class="token string">"程序员专属拖鞋, 屌丝气息浓郁, 你值得拥有"</span><span class="token punctuation">,</span>        <span class="token property">"image"</span><span class="token operator">:</span><span class="token string">"./images/3.jpg"</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>//在 JS 语言中，一切都是对象。因此，任何支持的类型都可以通过 JSON 来表示，例如字符串、数字、对象、数组等。但是对象和数组是比较特殊且常用的两种类型：//JSON 键/值对//JSON 键值对是用来保存 JS 对象的一种方式，和 JS 对象的写法也大同小异，键/值对组合中的键名写在前面并用双引号 <span class="token string">""</span> 包裹，使用冒号 <span class="token operator">:</span> 分隔，然后紧接着值："<span class="token punctuation">{</span><span class="token property">"firstName"</span><span class="token operator">:</span> <span class="token string">"Json"</span><span class="token punctuation">}</span><span class="token string">"这很容易理解，等价于这条 JavaScript 语句：{firstName : "</span>Json"<span class="token punctuation">}</span>//JSON 与 JS 对象的关系//很多人搞不清楚 JSON 和 Js 对象的关系，甚至连谁是谁都不清楚。其实，可以这么理解：//JSON 是 JS 对象的字符串表示法，它使用文本表示一个 JS 对象的信息，本质是一个字符串。//如<span class="token operator">:</span>var obj = <span class="token punctuation">{</span>a<span class="token operator">:</span> 'Hello'<span class="token punctuation">,</span> b<span class="token operator">:</span> 'World'<span class="token punctuation">}</span><span class="token punctuation">;</span> //这是一个对象，注意键名也是可以使用引号包裹的var json = '<span class="token punctuation">{</span><span class="token property">"a"</span><span class="token operator">:</span> <span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token property">"b"</span><span class="token operator">:</span> <span class="token string">"World"</span><span class="token punctuation">}</span>'<span class="token punctuation">;</span> //这是一个 JSON 字符串，本质是一个字符串</code></pre><h4 id="JSON和JS对象互转"><a href="#JSON和JS对象互转" class="headerlink" title="JSON和JS对象互转"></a>JSON和JS对象互转</h4><pre class=" language-json"><code class="language-json">//要实现从JSON对象转换为JS字符串，使用 JSON.parse(<span class="token punctuation">)</span> 方法：var obj = JSON.parse('<span class="token punctuation">{</span><span class="token property">"a"</span><span class="token operator">:</span> <span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token property">"b"</span><span class="token operator">:</span> <span class="token string">"World"</span><span class="token punctuation">}</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span> //结果是 <span class="token punctuation">{</span>a<span class="token operator">:</span> 'Hello'<span class="token punctuation">,</span> b<span class="token operator">:</span> 'World'<span class="token punctuation">}</span>//要实现从JS对象转换为JSON字符串，使用 JSON.stringify(<span class="token punctuation">)</span> 方法：var json = JSON.stringify(<span class="token punctuation">{</span>a<span class="token operator">:</span> 'Hello'<span class="token punctuation">,</span> b<span class="token operator">:</span> 'World'<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> //结果是 '<span class="token punctuation">{</span><span class="token property">"a"</span><span class="token operator">:</span> <span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token property">"b"</span><span class="token operator">:</span> <span class="token string">"World"</span><span class="token punctuation">}</span>'//当从服务器返回的数据不是标准json字符串时是无法使用parse的，那么可以试试用eval(<span class="token punctuation">)</span>强制转化和为js对象</code></pre><h4 id="非标准json转js对象"><a href="#非标准json转js对象" class="headerlink" title="非标准json转js对象"></a>非标准json转js对象</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//当从服务器返回的数据不是标准json字符串时是无法使用parse的，那么可以试试用eval()强制转化和为js对象</span><span class="token comment" spellcheck="true">//注意点： 转js对象必须加 "("+data+")"</span><span class="token keyword">var</span> Data <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"("</span><span class="token operator">+</span>data<span class="token operator">+</span><span class="token string">")"</span><span class="token punctuation">)</span></code></pre><h4 id="JSON兼容性问题"><a href="#JSON兼容性问题" class="headerlink" title="JSON兼容性问题"></a>JSON兼容性问题</h4><blockquote><p> 在低版本的IE中, 不可以使用原生的JSON.parse方法, 但是可以使用json2.js这个框架来兼容</p><p><a href="https://github.com/douglascrockford/JSON-js" target="_blank" rel="noopener">json2.js下载地址：</a></p></blockquote><h4 id="PHP基本JSON格式"><a href="#PHP基本JSON格式" class="headerlink" title="PHP基本JSON格式"></a>PHP基本JSON格式</h4><pre class=" language-php"><code class="language-php"><span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">" JSON文件地址 如(./json.txt)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h2><blockquote><p>ajax的请求过程：ajax发送请求–浏览器–服务器</p><p>响应过程则是请求过程的颠倒</p><p>当ajax发送请求到浏览器，浏览器发送到服务器，处理并响应后，原路返回到浏览器，此时会验证其请求来源的域名跟发送请求时是否一样，是则过，否则会被浏览器截止并提示错误，这正是跨域所造成的，想要解决此问题，并不能从前端入手，应该从后端，只有在后端响应并返回后告诉浏览器是自己人即可。</p><p>那怎么告诉浏览器是自己人呢？ 只要设置其响应头部信息+（<strong>Access-Control-Allow-Origin</strong>：域名）告诉浏览器即可,允许多个、单个、全部 （*）。</p></blockquote><h3 id="PHP-方式"><a href="#PHP-方式" class="headerlink" title="PHP 方式"></a>PHP 方式</h3><pre class=" language-php"><code class="language-php"><span class="token comment" spellcheck="true">/*    1、允许单个域名访问*/</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin:(域名)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*    2、允许多个域名访问*/</span>    <span class="token variable">$origin</span> <span class="token operator">=</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'HTTP_ORIGIN'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'HTTP_ORIGIN'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token variable">$option</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>        <span class="token punctuation">(</span><span class="token string">'域名1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span><span class="token string">'域名2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$origin</span><span class="token punctuation">,</span><span class="token variable">$option</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin:$origin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*    3、允许全部域名访问*/</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin:*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="node方式"><a href="#node方式" class="headerlink" title="node方式"></a>node方式</h3><pre><code>/*    1、允许单个域名访问*/    http.createServer(req,res)    {        res.setHeader(&quot;Access-Control-Allow-Origin&quot;,&quot;（域名）&quot;);    }/*    2、允许多个域名访问*/        let option = [        (域名1),        (域名2),        ...    ];    http.createServer(req,res)    {      let {origin} =  req.headers;      let ori = option[&quot;origin&quot;] ? option[&quot;origin&quot;] ： null；      res.setHeader(&quot;Access-Control-Allow-Origin&quot;,ori);    }/*    3、允许全部域名访问*/    http.createServer(req,res)    {        res.setHeader(&quot;Access-Control-Allow-Origin&quot;,&quot;*&quot;);    }</code></pre><h2 id="FormData"><a href="#FormData" class="headerlink" title="FormData"></a>FormData</h2><blockquote><p>FormData是ajax2.0新添加的功能，其作用是让表单也能异步发送</p></blockquote><h3 id="语法格式："><a href="#语法格式：" class="headerlink" title="语法格式："></a>语法格式：</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//必须要new 一个FormData对象 参数是要应用的表单元素 </span><span class="token comment" spellcheck="true">//禁止表单默认行为</span><span class="token comment" spellcheck="true">//其请求方式、请求地址跟随表单元素</span><span class="token comment" spellcheck="true">//最后发送formdata对象即可</span><span class="token comment" spellcheck="true">//原生方式</span>         <span class="token keyword">let</span> form <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"form"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"form"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onsubmit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> formdata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span>method<span class="token punctuation">,</span>form<span class="token punctuation">.</span>action<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formdata<span class="token punctuation">)</span><span class="token punctuation">;</span>        xhr<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>          <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>          <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span>          <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token keyword">else</span>          <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token punctuation">}</span>          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//jQuery方式 </span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"form"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"submit"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">let</span> formdata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>              url<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>action<span class="token punctuation">,</span>              type<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>method<span class="token punctuation">,</span>              data<span class="token punctuation">:</span>formdata<span class="token punctuation">,</span>                <span class="token comment" spellcheck="true">//由于jq在发送请求时，会把请求数据自动处理为适合发送的数据格式，但是formdata对象本事就不用处理，系统识别会自动处理数据，如果被jq格式化后，数据就会出错，所以要关闭其数据格式化，以及发送的头部信息。</span>              processData<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>                  contentType<span class="token punctuation">:</span><span class="token boolean">false</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>             console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//如果不使用表单提交，可以使用以下另门方式</span><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span> dir<span class="token operator">=</span><span class="token string">"ltr"</span><span class="token operator">></span>  <span class="token operator">&lt;</span>head<span class="token operator">></span>    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>  <span class="token operator">&lt;</span>body<span class="token operator">></span>    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"div1"</span><span class="token operator">></span>      用户：<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> id<span class="token operator">=</span><span class="token string">"user"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span>br<span class="token operator">></span>      密码：<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"password"</span> id<span class="token operator">=</span><span class="token string">"pass"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span>br<span class="token operator">></span>      文件：<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"file"</span> id<span class="token operator">=</span><span class="token string">"f1"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span>br<span class="token operator">></span>      <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">"btn1"</span> type<span class="token operator">=</span><span class="token string">"button"</span> value<span class="token operator">=</span><span class="token string">"提交"</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>  <span class="token operator">&lt;</span>script<span class="token operator">></span>  <span class="token keyword">let</span> oBtn<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#btn1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  oBtn<span class="token punctuation">.</span>onclick<span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">let</span> formdata<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    formdata<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    formdata<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#pass'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    formdata<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'f1'</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#f1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//</span>    <span class="token keyword">let</span> xhr<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'post'</span><span class="token punctuation">,</span> <span class="token string">'http://localhost:8080/'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formdata<span class="token punctuation">)</span><span class="token punctuation">;</span>    xhr<span class="token punctuation">.</span>onreadystatechange<span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState<span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token operator">==</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre><h2 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a>fetch</h2><blockquote><p>fetch是官方用来解决原生js的ajax的繁杂步骤问题的一门新语法，大大简化了ajax操作，原理基于ajax</p></blockquote><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// get txt</span> window<span class="token punctuation">.</span>onload<span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">let</span> oBtn<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      oBtn<span class="token punctuation">.</span>onclick<span class="token operator">=</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//1.请求</span>        <span class="token keyword">let</span> res<span class="token operator">=</span><span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'data/1.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//2.解析</span>        <span class="token keyword">let</span> str<span class="token operator">=</span><span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">alert</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//get json</span> window<span class="token punctuation">.</span>onload<span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">let</span> oBtn<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      oBtn<span class="token punctuation">.</span>onclick<span class="token operator">=</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//1.请求</span>        <span class="token keyword">let</span> res<span class="token operator">=</span><span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'data/1.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//2.解析</span>        <span class="token keyword">let</span> json<span class="token operator">=</span><span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//get blod</span>window<span class="token punctuation">.</span>onload<span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">let</span> oImg<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'img1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">let</span> oBtn<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      oBtn<span class="token punctuation">.</span>onclick<span class="token operator">=</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//1.请求</span>        <span class="token keyword">let</span> res<span class="token operator">=</span><span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'data/1.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//2.解析</span>        <span class="token keyword">let</span> data<span class="token operator">=</span><span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> url<span class="token operator">=</span>URL<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        oImg<span class="token punctuation">.</span>src<span class="token operator">=</span>url<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Front </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Ajax </tag>
            
            <tag> CORS </tag>
            
            <tag> 笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webSocket</title>
      <link href="/posts/a65a.html"/>
      <url>/posts/a65a.html</url>
      
        <content type="html"><![CDATA[<h1 id="WebSocket介绍、使用"><a href="#WebSocket介绍、使用" class="headerlink" title="WebSocket介绍、使用"></a>WebSocket介绍、使用</h1><blockquote><p>webSocket是一种新的传输协议，HTML5新增的协议，相较于http协议，webSocket更像是一台对讲机，可以实现实时通信，双向传输，即服务器也可以主动发送请求到前端，打破了以往只能前端发送请求，然后服务器被动响应的传统方式</p></blockquote><h2 id="node-js"><a href="#node-js" class="headerlink" title="node.js"></a>node.js</h2><h3 id="socket-io"><a href="#socket-io" class="headerlink" title="socket.io"></a>socket.io</h3><blockquote><p>socket.io是一个node.js平台上的webSocket封装框架，使用难度比较容易</p><p>在使用前必须先安装： </p><p>npm|cnpm  i  socket.io -D </p></blockquote><p>语法格式：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/*socket.emit('name', 数据)  发送socket.on(name，(data)=>{})    接收发送的名字是什么接收的名字就是什么，参数的个数也一样*/</span><span class="token comment" spellcheck="true">//后端</span><span class="token keyword">const</span> http <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"http"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> io <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"socket.io"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> wsServer <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>wsServer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"connection"</span><span class="token punctuation">,</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"time"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//前端</span><span class="token comment" spellcheck="true">//注意：必须在服务器里面成功导入此模块并且成功服务器开启后，方可引入soket.io.js</span><span class="token comment" spellcheck="true">//本地安装位置：node_modules/socket.io-client\dist\soket.io.js</span><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"http://localhost:8080/socket.io/socket.io.js"</span> charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>    <span class="token operator">&lt;</span>script<span class="token operator">></span>        <span class="token keyword">let</span> socket <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"ws://localhost:8080/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"time"</span><span class="token punctuation">,</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Back </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Node </tag>
            
            <tag> webSocket </tag>
            
            <tag> socket.io </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cookie</title>
      <link href="/posts/295f.html"/>
      <url>/posts/295f.html</url>
      
        <content type="html"><![CDATA[<h1 id="什么是cookie"><a href="#什么是cookie" class="headerlink" title="什么是cookie"></a>什么是cookie</h1><blockquote><p>cookie:会话跟踪技术 <u><strong>客户端</strong></u></p><p>session：会话跟踪技术 <u><strong>服务端</strong></u></p></blockquote><p><strong>在网页中怎么查看cookie里面的数据情况？</strong></p><p><strong>1.可以在编辑器中输入document.cookie,然后打印或输出即可</strong></p><p><strong>2.Chrome浏览器中F12打开，开发者工具 —— Application面板中查找cookie即可</strong></p><h2 id="cookie作用："><a href="#cookie作用：" class="headerlink" title="cookie作用："></a>cookie作用：</h2><blockquote><p><u><strong>将网页中的数据保存到浏览器中</strong></u></p></blockquote><h2 id="cookie生命周期："><a href="#cookie生命周期：" class="headerlink" title="cookie生命周期："></a>cookie生命周期：</h2><blockquote><p>默认情况下cookie生命周期是一次会话（<u><strong>浏览器被关闭</strong></u>）</p><p>可以通过<u><strong>expires</strong></u>来设置cookie的生命周期</p></blockquote><ol><li><strong>如果通过<u>expires=</u>设置了过期时间, 并且过期时间没有过期, 那么下次打开浏览器还是存在</strong></li><li><strong><u>如果通过expires=设置了过期时间, 并且过期时间没有过期, 那么下次打开浏览器还是存在</u></strong></li></ol><p>以下代码块示例怎么修改cookie的过期时间并设置到当天的时间</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>date<span class="token punctuation">.</span>setDate（curTime<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>） <span class="token comment" spellcheck="true">//这里可以加一就是明天，也可以减一就是昨天也就看不到此数据，两者只能选其一</span>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">"name=xuyuxin;expires="</span><span class="token operator">+</span>date<span class="token punctuation">.</span><span class="token function">toGMTString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">";"</span><span class="token punctuation">;</span><span class="token function">alert</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="cookie其他注意点："><a href="#cookie其他注意点：" class="headerlink" title="cookie其他注意点："></a>cookie其他注意点：</h2><ol><li>cookie<strong>默认不会保存任何数据</strong></li><li>cookie<strong>不能一次性保存多条数据</strong></li><li>cookie<u>保存数据有大小和个数限制</u>： <u><strong>个数限制：20~60</strong></u>  ，  <strong><u>总大小不能超过4KB左右</u></strong></li></ol><h2 id="cookie作用范围："><a href="#cookie作用范围：" class="headerlink" title="cookie作用范围："></a>cookie作用范围：</h2><ol><li>同一个浏览器同一个路径下访问</li><li>如果在同一个浏览器中，默认情况下，下一级路径也能访问</li><li>如果在同一个浏览器中，想让上一级目录也能访问到保存的cookie数据，那么需要添加一个<strong><u>path</u></strong>属性即可（如下）</li></ol><pre class=" language-cookie"><code class="language-cookie">document.cookie = "name=xuyuxin;path=/;"           例如:            保存到了www.it666.com/jQuery/Ajax/路径下,            我们想在 www.it666.com/jQuery/Ajax/13-weibo/,            和 www.it666.com/jQuery/ 路径下也能访问            例如:            我们在www.it666.com下面保存了一个cookie,            那么我们在edu.it666.com中是无法访问的            如果想在edu.it666.com中也能访问, 那么我们需要再添加一个domain属性才可以;            document.cookie = "name=zs;path=/;domain=it666.com;";            */</code></pre><h2 id="cookie封装"><a href="#cookie封装" class="headerlink" title="cookie封装"></a>cookie封装</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * @param {*} option.key  * @param {*} option.value  * @param {*} option.path  * @param {*} option.domain  * @param {*} option.beOverDueTime  * @method 添加一条cookie数据 */</span><span class="token keyword">function</span> <span class="token function">addCookie</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//路径</span>  <span class="token keyword">var</span> index <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    curPath <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>  option<span class="token punctuation">.</span>path <span class="token operator">=</span> option<span class="token punctuation">.</span>path <span class="token operator">||</span> curPath<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//域名作用域</span>    option<span class="token punctuation">.</span>domain <span class="token operator">=</span> option<span class="token punctuation">.</span>domain <span class="token operator">||</span> document<span class="token punctuation">.</span>domain<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//过期时间</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>option<span class="token punctuation">.</span>beOverDueTime<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//没传则直接创建cookie</span>        document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> option<span class="token punctuation">.</span>key<span class="token operator">+</span><span class="token string">"="</span><span class="token operator">+</span>option<span class="token punctuation">.</span>value<span class="token operator">+</span><span class="token string">";path="</span><span class="token operator">+</span>option<span class="token punctuation">.</span>path<span class="token operator">+</span><span class="token string">";domain="</span><span class="token operator">+</span>option<span class="token punctuation">.</span>domain<span class="token operator">+</span><span class="token string">";"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//创建cookie</span>        <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        date<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>option<span class="token punctuation">.</span>beOverDueTime<span class="token punctuation">)</span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> option<span class="token punctuation">.</span>key<span class="token operator">+</span><span class="token string">"="</span><span class="token operator">+</span>option<span class="token punctuation">.</span>value<span class="token operator">+</span><span class="token string">";path="</span><span class="token operator">+</span>option<span class="token punctuation">.</span>path<span class="token operator">+</span><span class="token string">";domain="</span><span class="token operator">+</span>option<span class="token punctuation">.</span>domain<span class="token operator">+</span><span class="token string">";expires="</span><span class="token operator">+</span>date<span class="token punctuation">.</span><span class="token function">toGMTString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">";"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * @param {*} key  * @method 获取指定的cookie数据 */</span><span class="token keyword">function</span> <span class="token function">getCookie</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i<span class="token operator">&lt;</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">===</span>key<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * @param {*} key  * @param {*} path  * @method 删除指定的cookie数据，注意点：默认只能删除默认路径的cookie数据，想删除别的路径的cookie，必须在调用函数前传入指定的路径即可删除 */</span><span class="token keyword">function</span> <span class="token function">delCookie</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">addCookie</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        key<span class="token punctuation">:</span>key<span class="token punctuation">,</span>        value<span class="token punctuation">:</span><span class="token function">getCookie</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span>        path<span class="token punctuation">:</span>path<span class="token punctuation">,</span>        beOverDueTime<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h1 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h1><blockquote><p><strong>hash能实现和cookie一样的功能，各有各的好处，hash使用起来被cookie方便许多</strong></p></blockquote><h2 id="添加一条hash数据"><a href="#添加一条hash数据" class="headerlink" title="添加一条hash数据"></a>添加一条hash数据</h2><pre class=" language-javascript"><code class="language-javascript">window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token operator">=</span> 要添加的数据；</code></pre><h2 id="获取hash数据"><a href="#获取hash数据" class="headerlink" title="获取hash数据"></a>获取hash数据</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//在js中没有专门获取hash数据的函数，因此只能自寻方法这里用substring()函数截取</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">//从索引为1的字符串开始截取</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Front </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 笔记 </tag>
            
            <tag> Web Storage </tag>
            
            <tag> Cookie </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
